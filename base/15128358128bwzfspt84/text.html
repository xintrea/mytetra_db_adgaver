<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="cc-matrix-2068015585"></a>VBA - объектно-ориентированный язык, что означает, что всё в нём является объектом, то есть неким &quot;предметом&quot; мира VBA. А у предметов есть свойства. Кроме того они могут иметь какие-то отношения с другими предметами, входить в различные группы предметов. Например, деревянный стул входит в группу деревянной мебели, группа деревянной мебели входит в группу мебели вообще. В VBA та же система. Отдельный лист входит в группу листов, все листы являются частью рабочей книги, книга - лишь один элемент из целого набора открытых книг. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Говоря языком VBA, каждый объект входит в какую-нибудь коллекцию. Коллекция может принадлежать какому-то другому объекту, а тот в свою очередь опять входит в какую-то другую коллекцию. Что нам это дает? Самое главное и широко используемое следствие из такого разделения вещей в VBA это возможность оперировать всеми элементами коллекции. Для этого даже существует специальный <span style=" font-weight:600;">цикл &quot;</span><span style=" font-weight:600; font-style:italic;">For Each</span><span style=" font-weight:600;">&quot;</span>. Например, если нам нужно пробежатьcя по всем листам книги, мы можем написать так: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    For Each sh in Sheets</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">         sh.Activate</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    Next</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном цикле переменная sh будет принимать значение следующего листа, её мы можем использовать в цикле в качестве объекта листа, который используется в данный момент. Обратите внимание, что переменная равняется именно объекту, всему листу, а не его имени! </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Распространенный пример перебора всех сводных таблиц в книге можете найти на странице примеров макросов. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">VBA очень аккуратен, он всегда знает, где, чего и сколько у него хранится. Каждому объекту в каждой коллекции он присваивает номер, и мы можем использовать это в своих целях. Например, мы можем узнать количество объектов в коллекции с помощью <span style=" font-weight:600;">функции </span><span style=" font-weight:600; font-style:italic;">Count</span>. Или мы можем перебрать все элементы коллекции не циклом <span style=" font-style:italic;">For Each</span>, а обычным циклом For, записав это так: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    For i=1 to Sheets.Count</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">        Sheets(i).Activate</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    Next</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратите внимание, что когда мы обращаемся к объекту не по названию, а по номеру, мы не ставим кавычек (потому что это не строка, не название)! </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы можем использовать это прекрасное свойство в случае, если имя объекта, к которому мы обращаемся, меняется, а порядковый номер всегда тот же. Например, допустим у нас есть несколько листов в книге, на каждом по одной сводной таблице или кубу. Нам нужно перебрать все эти таблицы. Но так как на каждом листе таблица одна, было бы глупо использовать цикл для перебора всех таблиц на листе. Гораздо проще было бы обратиться к таблице напрямую. Но вот беда, названия таблиц на разных листах могут быть разные, то есть по имени к ним не обратиться. В таком случае нам и пригодится нумерация. Так как таблица одна, у неё 100% будет номер 1. Тогда мы можем сделать такой цикл: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-style:italic;">For Each sh In Sheets</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">        sh.activate</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">        PivotTables(1). .....</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    Next sh</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;"> </span><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Коллекции - одна из самых замечательных возможностей VBA. Если вы научитесь ими пользоваться, ваш код и ваша жизнь могут стать намного проще. </p></body></html>