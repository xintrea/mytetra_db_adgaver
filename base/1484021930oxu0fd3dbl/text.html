<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание: В статье описываются различные методы, поддерживаемые Access для работы с текстовыми файлами, некоторые тонкости и возникающие проблемы.<br />Основное внимание уделено использованию файла спецификации Schema.ini вместо спецификаций Access, а также - методам прямого доступа из VBA, позволяющим получить информацию из нестандартных файлов или &quot;причесать&quot; их для последующего импорта. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td colspan="2">
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="lbComment"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">О</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">бсуждение статьи:  </span></p></td></tr></table></td></tr>
<tr>
<td colspan="2"></td></tr></table>
<table border="1" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#cacaca">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="57306"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Н</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">есколько дополнений, плюс UTF-8</span></p></td>
<td bgcolor="#cacaca"></td>
<td bgcolor="#cacaca"></td></tr></table></td></tr></table></td></tr>
<tr>
<td bgcolor="#eeeeee">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; background-color:#eeeeee;">Хочу внести некоторые дополнения...</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"><br />1. Драйвер при чтении из файла воспринимает как разделитель строк не только vbCrLf, но и vbCr, и vbLf. И это радует . Но при записи в файл всегда используется vbCrLf.<br /><br />2. Драйвер умеет работать с файлами в кодировке Unicode. Эта кодировка имеет несколько форматов, в частности: UTF-16LE (основной), UTF-16BE (старший байт в паре стоит первым), UTF-8. Каждый из этих форматов может иметь свой признак (Byte Order Mark или BOM). Это 2-3 байта с определенными значениями в начале файла. Его наличие желательно, т.к. однозначно указывает на формат текста в Unicode.<br />Указав &quot;Юникод&quot; в спецификации Access или CharacterSet=Unicode в файле Schema.ini, можно работать с файлами в формате UTF-16LE. В спецификации Access можно указать и другой формат (&quot;Юникод (Big-Endian)&quot; и &quot;Юникод (UTF-8)&quot;). В Schema.ini это выглядит так:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">CharacterSet=Unicode или  1200 - UTF-16LE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">CharacterSet=1201  - UTF-16BE </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">CharacterSet=65001 - UTF-8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Но здесь есть несколько замечаний:<br />а) При чтении из UTF-16LE драйвер &quot;культурно&quot; анализирует BOM и не включает его возвращаемые данные. При создании файла BOM добавляется.<br />В других форматах при создании файла BOM не добавляется, а при чтении включается в имя или значение первого поля.<br />б) Если в читаемом файле BOM отсутствует, то драйвер &quot;думает&quot;, что это UTF-16LE (Блокнот, кстати - тоже). Это противоречит правилу в стандарте Unicode, что файл без BOM должен быть в формате UTF-16BE.<br /><br />3. В статье, в примерах прямого доступа к файлам, наличие BOM не учтено. При создании файла без BOM внешняя программа может и не прочитать его, поэтому пример записи в файл желательно изменить:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'СОЗДАНИЕ ФАЙЛА С UNICODE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">f = FreeFile: Open </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;C:\Файл U.txt&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Binary </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> f</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Преобразование строки в массив и запись массива выполняется &quot;как есть&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> bytArr = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Строка1&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp; vbCrLf &amp; </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Строка2&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp; vbCrLf &amp; </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Строка3&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp; vbCrLf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Put f, , CByte(&amp;HFF)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Put f, , CByte(&amp;HFE)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Put f, , bytArr</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Close f</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Вместо функции ReadTextFile предлагаю функцию, которая умеет читать файлы UTF-16LE, UTF-16BE и UTF-8, с BOM и без него. Также предлагаю функцию создания файла в UTF-8.<br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> ReadAnyTextFile(sFilePath$, </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Optional</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> fGetRowsArray </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Boolean</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Variant</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Функция читает файлы в формате:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">' Обычный (ANSI/OEM и т.п. с однобайтовой кодировкой)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">' Unicode (UTF-16 LE, UTF-16 BE)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">' UTF-8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Формат файла определяется по маркеру BOM (первые 2-3 байта в начале файла)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">' или анализом.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Лишние завершающие символы vbCr и/или vbLf исключаются.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Если fGetRowsArray=0, возвращает содержимое файла.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Если fGetRowsArray=1, возвращает массив строк (разделитель vbCrLf, vbCr или vbLf).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">On</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Error</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Resume</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Dim</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i&amp;, j&amp;, k%, s$, arr() </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Byte</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">, iUtf8%, iUtf16%</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    i = FreeFile: Open sFilePath$ </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Binary Access Read Shared </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Err.Number &lt;&gt; 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Err.Clear: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    j = LOF(i): </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j = 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Close i: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">GoTo</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Finish</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j &gt;= 4 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ReDim</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> 4): Get i, , arr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Проверяется наличие признака кодировки (первые 2-3 байта).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1) = &amp;HFF </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(2) = &amp;HFE </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(3) &lt;&gt; 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Есть признак Unicode(UTF-16 LE). Читаем с 3-го байта.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = 2: iUtf16 = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ElseIf</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1) = &amp;HFE </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(2) = &amp;HFF </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(4) &lt;&gt; 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Есть признак Unicode(UTF-16 BE). Читаем с 3-го байта.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = 2: iUtf16 = 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ElseIf</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1) = &amp;HEF </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(2) = &amp;HBB </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(3) = &amp;HBF </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Есть признак UTF-8. Читаем с 4-го байта.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = 3: iUtf8 = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    j = j - k: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ReDim</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j): Get i, 1 + k, arr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    Close i</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf16 = 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf8 = 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> (UBound(arr) Mod 2) = 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Проверка Unicode. Контролируется значение старшего байта в первом и последнем символе.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Этого достаточно, если эти символы не &quot;№&quot; и не специальные знаки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">' (например - математические или химические).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(2) &lt;= 5 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(UBound(arr)) &lt;= 5 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    iUtf16 = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ElseIf</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1) &lt;= 5 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(UBound(arr) - 1) &lt;= 5 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    iUtf16 = 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf16 = 2 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Для UTF-16 BE в цикле меняем местами парные байты.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i = 1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j - 1 Step 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = arr(i): arr(i) = arr(i + 1): arr(i + 1) = k</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf16 &gt; 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> s = arr: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">GoTo</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Finish</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Проверка UTF-8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i = 1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j - 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Select</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(i)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Is &lt;= 127</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HC2 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HDF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'В UTF-8 после байта с таким кодом должен стоять байт с кодом &amp;H80-&amp;HBF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">   </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(i + 1) &lt; &amp;H80 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(i + 1) &gt; &amp;HBF </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf8 = 0: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    iUtf8 = 3: i = i + 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HE0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HFF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'В UTF-8 после байта с таким кодом должны стоять 2 байта с кодом &amp;H80-&amp;HBF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">   </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i = j - 1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf8 = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">False</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">   </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(i + 1) &lt; &amp;H80 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(i + 1) &gt; &amp;HBF </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf8 = 0: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">   </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(i + 2) &lt; &amp;H80 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(i + 2) &gt; &amp;HBF </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf8 = 0: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    iUtf8 = 3: i = i + 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    iUtf8 = 0: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Select</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Если в массиве найдены недопустимые для UTF-8 коды или все коды &lt;=127</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> iUtf8 &lt; 3 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> s = StrConv(arr, vbUnicode): </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">GoTo</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Finish</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Преобразование UTF-8 -&gt; Unicode</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i = 1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Переменная &quot;k&quot; (код символа) - Integer (2 байта или 16 битов с весом 0-15)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Select</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(i)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Is &lt;= 127</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = arr(i)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HC2 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HDF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'6 младших битов 2-го байта переносятся в код с тем же весом (0-5)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = (arr(i + 1) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H3F)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'5 младших битов 1-го байта переносятся в код с весом 6-10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = k + (arr(i) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H1F) * &amp;H40        </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты смещаются на 6 позиций влево.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    i = i + 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Case</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HE0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HFF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'6 младших битов 3-го байта переносятся в код с тем же весом (0-5)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = (arr(i + 2) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H3F)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'6 младших битов 2-го байта переносятся в код с весом 6-11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = k + (arr(i + 1) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H1F) * &amp;H40    </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты смещаются на 6 позиций влево.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'4 младших бита 1-го байта переносятся в код с весом 12-15</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = k + (arr(i) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HF) * &amp;H1000       </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты смещаются на 12 позиций влево.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    i = i + 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Select</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> k &lt;= 127 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> s = s &amp; </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Chr</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(k) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Else</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> s = s &amp; ChrW(k)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Next</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Finish:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Исключаются лишние завершающие символы vbCr и/или vbLf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    j = Len(s): Erase arr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i = j </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> 1 Step -1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Asc</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Mid</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$(s, i, 1))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> k &lt;&gt; 13 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> k &lt;&gt; 10 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i &lt; j </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> s = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Left</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(s, i)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Not</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> fGetRowsArray </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> ReadAnyTextFile = s: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i &lt;= 1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> ReadAnyTextFile = Split(s): </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Преобразование текста в массив строк.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">InStr</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(s, vbCrLf) &gt; 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ReadAnyTextFile = Split(s, vbCrLf)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ElseIf</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">InStr</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(s, vbLf) &gt; 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ReadAnyTextFile = Split(s, vbLf)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ReadAnyTextFile = Split(s, vbCr)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> CreateFileUTF8(strText </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">String</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">, strFilePath </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">String</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">                                    </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Optional</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> fAppend </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Boolean</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Boolean</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Функция создает или дополняет (fAppend=True) файл в формате UTF-8.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'В начало нового файла добавляется признак UTF-8 (3 байта).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'При успешном завершении возвращает True.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Внимание! Функция не добавляет символ(ы) перевода строки. При необходимости</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">' они должны быть включены в передаваемый текст.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Dim</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i&amp;, j&amp;, k&amp;, arr() </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Byte</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">On</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Error</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">GoTo</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Func_err</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Len(strText) = 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Len(Trim$(strFilePath)) = 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Если fAppend=False и файл существует - удаляем.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Not</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> fAppend </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Len(Dir$(strFilePath)) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Kill strFilePath</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Создается массив с запасом 5% от длины текста</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ReDim</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> LenB(strText) * 1.05): i = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j = 1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Len(strText)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Читаем код символа (Unicode).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = AscW(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Mid</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$(strText, j, 1))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'При необходимости увеличиваем размер массива</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> (UBound(arr) - i) &lt; 3 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ReDim</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Preserve</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> UBound(arr) * 1.05 + 3)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> k &lt;= 127 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i) = k: i = i + 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ElseIf</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> k &gt; &amp;H7FF </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Формируем значения трех байтов в UTF-8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i) = (k </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HF000) / &amp;H1000  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты 12-15 переносятся в биты 0-3 первого байта.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i) = arr(i) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HE0           </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Добавляется признак 1-го байта (биты 5-7)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i + 1) = (k </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HFC0) / &amp;H40 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты 6-11 -&gt; биты 0-5 2-го байта</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i + 1) = arr(i + 1) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H80   </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Добавляется признак 2-го байта (биты 6-7)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i + 2) = (k </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H3F)         </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты 0-5 -&gt; биты 0-5 3-го байта</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i + 2) = arr(i + 2) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H80   </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Добавляется признак 3-го байта (биты 6-7)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    i = i + 3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Формируем значения двух байтов в UTF-8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i) = (k </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H700) / &amp;H40     </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты 8-10 -&gt; биты 2-4 1-го байта</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i) = arr(i) + (k </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HC0) / &amp;H40 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты 6-7 -&gt; биты 0-1 1-го байта</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i) = arr(i) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;HC0           </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Добавляется признак 1-го байта (биты 6-7)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i + 1) = (k </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H3F)         </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Биты 0-5 -&gt; биты 0-5 2-го байта</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    arr(i + 1) = arr(i + 1) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Or</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> &amp;H80   </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Добавляется признак 2-го байта (биты 6-7)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    i = i + 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Next</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Убираем лишние элементы из массива</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i &lt;= UBound(arr) </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ReDim</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Preserve</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> i - 1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Открываем файл, вычисляем его размер</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    k = FreeFile: Open strFilePath </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">For</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Binary </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">As</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> k: j = LOF(k)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> fAppend </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">And</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> j &gt; 0 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Если режим &quot;Добавление&quot; и файл не пустой - добавляем массив в конец файла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    Put k, j + 1, arr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'При создании нового файла добавляем массив, начиная с 4-й позиции</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    Put k, 4, arr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'В первые 3 байта пишем признак UTF-8 (BOM)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">ReDim</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> arr(1 </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">To</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> 3): arr(1) = &amp;HEF: arr(2) = &amp;HBB: arr(3) = &amp;HBF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    Put k, 1, arr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#008000;">'Закрываем файл.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    Close k: CreateFileUTF8 = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Func_</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Exit</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Func_err:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    MsgBox Err.Description, vbCritical, </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Создание файла&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Resume</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> Func_</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">exit</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">End</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"><br /><br /></span></p></td></tr>
<tr>
<td bgcolor="#eeeeee">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">14.04.2009 12:46</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"><br /></span></p>
<table border="1" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#cacaca">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image7363.png" /><a name="64555"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Е</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">ще несколько дополнений...</span></p></td>
<td bgcolor="#cacaca">
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Анатолий (Киев)</span></p></td>
<td bgcolor="#cacaca">
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image32227.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span><img src="image30814.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p></td></tr></table></td></tr></table></td></tr>
<tr>
<td bgcolor="#eeeeee">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; background-color:#eeeeee;">На основании проведенных экспериментов хочу добавить следующее:</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"><br />1. Утверждение, что спецификацию Access можно создать/редактировать/удалить только интерактивно - не совсем верно.<br />Да, системные таблицы MSysIMEXSpecs (общие параметры спецификаций) и MSysIMEXColumns (параметры полей) - только для чтения, но если в этой же БД создать связанные таблицы к этим системным таблицам, то редактировать спецификации можно! Но самую первую спецификацию надо создать &quot;ручками&quot;, т.к. до этого указанные системные таблицы отсутствуют.<br /><br />2. Серьезным недостатком спецификации в Schema.ini считается отсутствие параметра, указывающего символ - ограничитель текста или его отсутствие.<br />Из-за этого в экспортированном файле текстовые поля обрамляются кавычками, а кавычки внутри текста дублируются (это правило по умолчанию), а импорт файлов с текстовыми полями, не обрамленными кавычками, но имеющими кавычки в тексте приводит к искажению результата (потеря всего текста или части в таких полях и т.п.), а то и к ошибке импорта.<br />В официальной документации такой параметр не описывается, но на самом деле он есть и называется </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">TextDelimiter</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. Если указать TextDelimiter=None, то файл будет создан или прочитан правильно.<br />Вроде бы в Jet3.x значение None не работает, но для импорта можно указать любой символ, отсутствующий в тексте - эффект тот же.<br /><br />3. Еще один недостаток использования Schema.ini - для каждого файла нужно создавать секцию. Оказывается, и это не так. Можно использовать одну секцию в качестве DSN, для чего в строке подключения запроса (или в св-ве &quot;Extended Properties&quot; создаваемого ADODB.Connection, или при вызове метода OpenDatabase (DAO)) указать &quot;Text;</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600; color:#0000ff;">DSN=ИмяСекции</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">&quot;.<br />Отмечу сразу, что в Access это не работает (он дальше своих спецификаций не видит), а, например, в Excel, VB, VBS – запросто.<br />Например, есть папка D:\Temp, в которой есть файлы Temp1.txt и Temp2.txt (без заголовков, без ограничителей текста с разделителем полей “#”, а также файл Schema.ini с секцией:<br />[TempSpec]<br />ColNameHeader=False<br />Format=Delimited(#)<br />TextDelimiter=None<br /><br />В модуле Excel выполняем код, который читает оба файла и выкладывает на лист:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Set</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> cnn = CreateObject(‘ADODB.Connection”)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Set</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> rs = CreateObject(‘ADODB.Recordset”)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.ConnectionString = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Provider=Microsoft.Jet.OLEDB.4.0&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.Properties(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Data Source&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">) = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;D:\Temp&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.Properties(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Extended Properties&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">) = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Text;DSN=TempSpec&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.Open</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Set</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> rs = cnn.Execute(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;SELECT * FROM [Temp1.txt];&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">ActiveSheet.Range(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;A1&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">).CopyFromRecordset  rs</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Set</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> rs = cnn.Execute(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;SELECT * FROM [Temp2.txt];&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">ActiveSheet.Range(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;A10&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">).CopyFromRecordset  rs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">В модуле Excel выполняем код, который в D:\MyDB\db1.mdb импортирует файл Temp1.txt (создает таблицу Temp) и экспортирует в файл Temp3.txt имеющуюся таблицу:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#00008b;">Set</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> cnn = CreateObject(‘ADODB.Connection”)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.ConnectionString = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Provider=Microsoft.Jet.OLEDB.4.0&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.Properties(</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;Data Source&quot;</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">) = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;D:\MyDB\db1.mdb&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.Open</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">s = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;SELECT * INTO Temp FROM [Temp1.txt] IN 'D:\Temp' [Text;DSN=TempSpec];&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.Execute s</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">s = </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; color:#0000ff;">&quot;SELECT * INTO [Temp3.txt] IN ' D:\Temp' [Text; DSN=TempSpec] FROM Table1;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">cnn.Execute s</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"><br /></span></p></td></tr>
<tr>
<td bgcolor="#eeeeee">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">16.02.2012 15:07</span></p></td></tr></table></body></html>