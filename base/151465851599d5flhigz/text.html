<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:12pt; font-weight:600;">1. Код на основе API функций библиотеки cryptdll.</span><br />Примечание: начиная с Vista эти функции продублированы в ntdll.dll (недокументированная возможность).<br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">Option</span> Explicit<br /><span style=" font-weight:600; color:#0000ff;">Private</span> Type MD5_CTX<br />  i<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">To</span> <span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />  buf<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">To</span> <span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />  inp<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">To</span> <span style=" color:#a52a2a;">64</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br />  digest<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">To</span> <span style=" color:#a52a2a;">16</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> Type<br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Declare</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> MD5Init <span style=" font-weight:600; color:#0000ff;">Lib</span> <span style=" color:#a52a2a;">&quot;cryptdll&quot;</span> <span style=" color:#000000;">(</span>Context <span style=" font-weight:600; color:#0000ff;">As</span> MD5_CTX<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Declare</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> MD5Update <span style=" font-weight:600; color:#0000ff;">Lib</span> <span style=" color:#a52a2a;">&quot;cryptdll&quot;</span> <span style=" color:#000000;">(</span>Context <span style=" font-weight:600; color:#0000ff;">As</span> MD5_CTX, <span style=" font-weight:600; color:#0000ff;">ByVal</span> strInput <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span>, <span style=" font-weight:600; color:#0000ff;">ByVal</span> lLen <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Declare</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> MD5Final <span style=" font-weight:600; color:#0000ff;">Lib</span> <span style=" color:#a52a2a;">&quot;cryptdll&quot;</span> <span style=" color:#000000;">(</span>Context <span style=" font-weight:600; color:#0000ff;">As</span> MD5_CTX<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> Command1_Click<span style=" color:#000000;">()</span><br />    MsgBox CalcMD5<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;C:\Win32_BIOS.txt&quot;</span><span style=" color:#000000;">)</span><br />    MsgBox CalcMD5_String<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;C:\Win32_BIOS.txt&quot;</span><span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> CalcMD5_String<span style=" color:#000000;">(</span>strBuffer <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> myContext <span style=" font-weight:600; color:#0000ff;">As</span> MD5_CTX<br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> result <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lp <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> MD5 <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    MD5Init myContext<br />    MD5Update myContext, strBuffer, Len<span style=" color:#000000;">(</span>strBuffer<span style=" color:#000000;">)</span><br />    MD5Final myContext<br />    result <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=STRCONV+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">StrConv</span></a><span style=" color:#000000;">(</span>myContext<span style=" color:#000000;">.digest</span>, vbUnicode<span style=" color:#000000;">)</span><br />   <br />    <span style=" font-weight:600; color:#0000ff;">For</span> lp <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">To</span> Len<span style=" color:#000000;">(</span>result<span style=" color:#000000;">)</span><br />            CalcMD5_String <span style=" color:#000000;">=</span> CalcMD5_String <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=RIGHT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Right</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;00&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span><a href="http://www.google.com/search?q=ASC+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Asc</span></a><span style=" color:#000000;">(</span>Mid<span style=" color:#000000;">(</span>result, lp, <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)))</span>, <span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Next</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> CalcMD5<span style=" color:#000000;">(</span>strFilename <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> strBuffer <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> myContext <span style=" font-weight:600; color:#0000ff;">As</span> MD5_CTX<br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> result <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lp <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> MD5 <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    strBuffer <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=SPACE+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Space</span></a><span style=" color:#000000;">(</span><a href="http://www.google.com/search?q=FILELEN+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">FileLen</span></a><span style=" color:#000000;">(</span>strFilename<span style=" color:#000000;">))</span><br />    Open strFilename <span style=" font-weight:600; color:#0000ff;">For</span> Binary Access Read <span style=" font-weight:600; color:#0000ff;">As</span> #<span style=" color:#a52a2a;">1</span><br />        <span style=" font-weight:600; color:#0000ff;">Get</span> #<span style=" color:#a52a2a;">1</span>, , strBuffer<br />    Close #<span style=" color:#a52a2a;">1</span><br />    MD5Init myContext<br />    MD5Update myContext, strBuffer, Len<span style=" color:#000000;">(</span>strBuffer<span style=" color:#000000;">)</span><br />    MD5Final myContext<br />    result <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=STRCONV+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">StrConv</span></a><span style=" color:#000000;">(</span>myContext<span style=" color:#000000;">.digest</span>, vbUnicode<span style=" color:#000000;">)</span><br />   <br />    <span style=" font-weight:600; color:#0000ff;">For</span> lp <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">To</span> Len<span style=" color:#000000;">(</span>result<span style=" color:#000000;">)</span><br />            CalcMD5 <span style=" color:#000000;">=</span> CalcMD5 <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=RIGHT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Right</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;00&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span><a href="http://www.google.com/search?q=ASC+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Asc</span></a><span style=" color:#000000;">(</span>Mid<span style=" color:#000000;">(</span>result, lp, <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)))</span>, <span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Next</span><br />   <br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#0000ff;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#0000ff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-size:12pt; font-weight:600;">2. Чисто математическая реализация. Автор: Robert Hubley</span><br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">VERSION <span style=" color:#a52a2a;">1.0</span> <span style=" font-weight:600; color:#0000ff;">CLASS</span><br />BEGIN<br />  MultiUse <span style=" color:#000000;">=</span> <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1</span>  <span style=" font-style:italic; color:#008000;">'True</span><br />  Persistable <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span>  <span style=" font-style:italic; color:#008000;">'NotPersistable</span><br />  DataBindingBehavior <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span>  <span style=" font-style:italic; color:#008000;">'vbNone</span><br />  DataSourceBehavior  <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span>  <span style=" font-style:italic; color:#008000;">'vbNone</span><br />  MTSTransactionMode  <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span>  <span style=" font-style:italic; color:#008000;">'NotAnMTSObject</span><br /><span style=" font-weight:600; color:#0000ff;">END</span><br />Attribute VB_Name <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;MD5_Hash&quot;</span><br />Attribute VB_GlobalNameSpace <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">False</span><br />Attribute VB_Creatable <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">True</span><br />Attribute VB_PredeclaredId <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">False</span><br />Attribute VB_Exposed <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">False</span><br /><span style=" font-weight:600; color:#0000ff;">Option</span> Explicit<br /><span style=" font-style:italic; color:#008000;">'/******************************************************************************</span><br /><span style=" font-style:italic; color:#008000;">' *  Copyright (C) 2000 by Robert Hubley.                                      *</span><br /><span style=" font-style:italic; color:#008000;">' *  All rights reserved.                                                      *</span><br /><span style=" font-style:italic; color:#008000;">' *                                                                            *</span><br /><span style=" font-style:italic; color:#008000;">' *  This software is provided ``AS IS'' and any express or implied            *</span><br /><span style=" font-style:italic; color:#008000;">' *  warranties, including, but not limited to, the implied warranties of      *</span><br /><span style=" font-style:italic; color:#008000;">' *  merchantability and fitness for a particular purpose, are disclaimed.     *</span><br /><span style=" font-style:italic; color:#008000;">' *  In no event shall the authors be liable for any direct, indirect,         *</span><br /><span style=" font-style:italic; color:#008000;">' *  incidental, special, exemplary, or consequential damages (including, but  *</span><br /><span style=" font-style:italic; color:#008000;">' *  not limited to, procurement of substitute goods or services; loss of use, *</span><br /><span style=" font-style:italic; color:#008000;">' *  data, or profits; or business interruption) however caused and on any     *</span><br /><span style=" font-style:italic; color:#008000;">' *  theory of liability, whether in contract, strict liability, or tort       *</span><br /><span style=" font-style:italic; color:#008000;">' *  (including negligence or otherwise) arising in any way out of the use of  *</span><br /><span style=" font-style:italic; color:#008000;">' *  this software, even if advised of the possibility of such damage.         *</span><br /><span style=" font-style:italic; color:#008000;">' *                                                                            *</span><br /><span style=" font-style:italic; color:#008000;">' ******************************************************************************</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'  CLASS: MD5</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'  DESCRIPTION:</span><br /><span style=" font-style:italic; color:#008000;">'     This is a class which encapsulates a set of MD5 Message Digest functions.</span><br /><span style=" font-style:italic; color:#008000;">'     MD5 algorithm produces a 128 bit digital fingerprint (signature) from an</span><br /><span style=" font-style:italic; color:#008000;">'     dataset of arbitrary length.  For details see RFC 1321 (summarized below).</span><br /><span style=" font-style:italic; color:#008000;">'     This implementation is derived from the RSA Data Security, Inc. MD5 Message-Digest</span><br /><span style=" font-style:italic; color:#008000;">'     algorithm reference implementation (originally written in C)</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'  AUTHOR:</span><br /><span style=" font-style:italic; color:#008000;">'     Robert M. Hubley 12/1999</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'  NOTES:</span><br /><span style=" font-style:italic; color:#008000;">'      Network Working Group                                    R. Rivest</span><br /><span style=" font-style:italic; color:#008000;">'      Request for Comments: 1321     MIT Laboratory for Computer Science</span><br /><span style=" font-style:italic; color:#008000;">'                                             and RSA Data Security, Inc.</span><br /><span style=" font-style:italic; color:#008000;">'                                                              April 1992</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'                           The MD5 Message-Digest Algorithm</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'      Summary</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'         This document describes the MD5 message-digest algorithm. The</span><br /><span style=" font-style:italic; color:#008000;">'         algorithm takes as input a message of arbitrary length and produces</span><br /><span style=" font-style:italic; color:#008000;">'         as output a 128-bit &quot;fingerprint&quot; or &quot;message digest&quot; of the input.</span><br /><span style=" font-style:italic; color:#008000;">'         It is conjectured that it is computationally infeasible to produce</span><br /><span style=" font-style:italic; color:#008000;">'         two messages having the same message digest, or to produce any</span><br /><span style=" font-style:italic; color:#008000;">'         message having a given prespecified target message digest. The MD5</span><br /><span style=" font-style:italic; color:#008000;">'         algorithm is intended for digital signature applications, where a</span><br /><span style=" font-style:italic; color:#008000;">'         large file must be &quot;compressed&quot; in a secure manner before being</span><br /><span style=" font-style:italic; color:#008000;">'         encrypted with a private (secret) key under a public-key cryptosystem</span><br /><span style=" font-style:italic; color:#008000;">'         such as RSA.</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'         The MD5 algorithm is designed to be quite fast on 32-bit machines. In</span><br /><span style=" font-style:italic; color:#008000;">'         addition, the MD5 algorithm does not require any large substitution</span><br /><span style=" font-style:italic; color:#008000;">'         tables; the algorithm can be coded quite compactly.</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'         The MD5 algorithm is an extension of the MD4 message-digest algorithm</span><br /><span style=" font-style:italic; color:#008000;">'         1,2]. MD5 is slightly slower than MD4, but is more &quot;conservative&quot; in</span><br /><span style=" font-style:italic; color:#008000;">'         design. MD5 was designed because it was felt that MD4 was perhaps</span><br /><span style=" font-style:italic; color:#008000;">'         being adopted for use more quickly than justified by the existing</span><br /><span style=" font-style:italic; color:#008000;">'         critical review; because MD4 was designed to be exceptionally fast,</span><br /><span style=" font-style:italic; color:#008000;">'         it is &quot;at the edge&quot; in terms of risking successful cryptanalytic</span><br /><span style=" font-style:italic; color:#008000;">'         attack. MD5 backs off a bit, giving up a little in speed for a much</span><br /><span style=" font-style:italic; color:#008000;">'         greater likelihood of ultimate security. It incorporates some</span><br /><span style=" font-style:italic; color:#008000;">'         suggestions made by various reviewers, and contains additional</span><br /><span style=" font-style:italic; color:#008000;">'         optimizations. The MD5 algorithm is being placed in the public domain</span><br /><span style=" font-style:italic; color:#008000;">'         for review and possible adoption as a standard.</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'         RFC Author:</span><br /><span style=" font-style:italic; color:#008000;">'         Ronald L.Rivest</span><br /><span style=" font-style:italic; color:#008000;">'         Massachusetts Institute of Technology</span><br /><span style=" font-style:italic; color:#008000;">'         Laboratory for Computer Science</span><br /><span style=" font-style:italic; color:#008000;">'         NE43 -324545    Technology Square</span><br /><span style=" font-style:italic; color:#008000;">'         Cambridge, MA  02139-1986</span><br /><span style=" font-style:italic; color:#008000;">'         Phone: (617) 253-5880</span><br /><span style=" font-style:italic; color:#008000;">'         EMail:    Rivest@ theory.lcs.mit.edu</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'  CHANGE HISTORY:</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'     0.1.0  RMH    1999/12/29      Original version</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">'=</span><br /><span style=" font-style:italic; color:#008000;">'= Class Constants</span><br /><span style=" font-style:italic; color:#008000;">'=</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> OFFSET_4 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">4294967296</span>#<br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> MAXINT_4 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">2147483647</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S11 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">7</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S12 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">12</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S13 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">17</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S14 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">22</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S21 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">5</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S22 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">9</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S23 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">14</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S24 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">20</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S31 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">4</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S32 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">11</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S33 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">16</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S34 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">23</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S41 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">6</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S42 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">10</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S43 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">15</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Const</span> S44 <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">21</span><br /><span style=" font-style:italic; color:#008000;">'=</span><br /><span style=" font-style:italic; color:#008000;">'= Class Variables</span><br /><span style=" font-style:italic; color:#008000;">'=</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> ByteCounter <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> ByteBuffer<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">63</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br /><span style=" font-style:italic; color:#008000;">'=</span><br /><span style=" font-style:italic; color:#008000;">'= Class Properties</span><br /><span style=" font-style:italic; color:#008000;">'=</span><br /><span style=" font-weight:600; color:#0000ff;">Property</span> <span style=" font-weight:600; color:#0000ff;">Get</span> RegisterA<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    RegisterA <span style=" color:#000000;">=</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Property</span><br /><span style=" font-weight:600; color:#0000ff;">Property</span> <span style=" font-weight:600; color:#0000ff;">Get</span> RegisterB<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    RegisterB <span style=" color:#000000;">=</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Property</span><br /><span style=" font-weight:600; color:#0000ff;">Property</span> <span style=" font-weight:600; color:#0000ff;">Get</span> RegisterC<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    RegisterC <span style=" color:#000000;">=</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Property</span><br /><span style=" font-weight:600; color:#0000ff;">Property</span> <span style=" font-weight:600; color:#0000ff;">Get</span> RegisterD<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    RegisterD <span style=" color:#000000;">=</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Property</span><br /><span style=" font-style:italic; color:#008000;">'=</span><br /><span style=" font-style:italic; color:#008000;">'= Class Functions</span><br /><span style=" font-style:italic; color:#008000;">'=</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Function to quickly digest a file into a hex string</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Public</span> <span style=" font-weight:600; color:#0000ff;">Function</span> DigestFileToHexStr<span style=" color:#000000;">(</span>FileName <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    Open FileName <span style=" font-weight:600; color:#0000ff;">For</span> Binary Access Read <span style=" font-weight:600; color:#0000ff;">As</span> #<span style=" color:#a52a2a;">1</span><br />    MD5Init<br />    <span style=" font-weight:600; color:#0000ff;">Do</span> <span style=" font-weight:600; color:#0000ff;">While</span> <span style=" font-weight:600; color:#0000ff;">Not</span> <a href="http://www.google.com/search?q=EOF+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">EOF</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">Get</span> #<span style=" color:#a52a2a;">1</span>, , ByteBuffer<br />        <span style=" font-weight:600; color:#0000ff;">If</span> <a href="http://www.google.com/search?q=LOC+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Loc</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&lt;</span> <a href="http://www.google.com/search?q=LOF+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">LOF</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />            ByteCounter <span style=" color:#000000;">=</span> ByteCounter <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">64</span><br />            MD5Transform ByteBuffer<br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />    <span style=" font-weight:600; color:#0000ff;">Loop</span><br />    ByteCounter <span style=" color:#000000;">=</span> ByteCounter <span style=" color:#000000;">+</span> <span style=" color:#000000;">(</span><a href="http://www.google.com/search?q=LOF+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">LOF</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">Mod</span> <span style=" color:#a52a2a;">64</span><span style=" color:#000000;">)</span><br />    Close #<span style=" color:#a52a2a;">1</span><br />    MD5Final<br />    DigestFileToHexStr <span style=" color:#000000;">=</span> GetValues<br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Function to digest a text string and output the result as a string</span><br /><span style=" font-style:italic; color:#008000;">' of hexadecimal characters.</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Public</span> <span style=" font-weight:600; color:#0000ff;">Function</span> DigestStrToHexStr<span style=" color:#000000;">(</span>SourceString <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    MD5Init<br />    MD5Update Len<span style=" color:#000000;">(</span>SourceString<span style=" color:#000000;">)</span>, StringToArray<span style=" color:#000000;">(</span>SourceString<span style=" color:#000000;">)</span><br />    MD5Final<br />    DigestStrToHexStr <span style=" color:#000000;">=</span> GetValues<br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' A utility function which converts a string into an array of</span><br /><span style=" font-style:italic; color:#008000;">' bytes.</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> StringToArray<span style=" color:#000000;">(</span>InString <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><span style=" color:#000000;">()</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> i <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Integer</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> bytBuffer<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br />    <span style=" font-weight:600; color:#0000ff;">ReDim</span> bytBuffer<span style=" color:#000000;">(</span>Len<span style=" color:#000000;">(</span>InString<span style=" color:#000000;">))</span><br />    <span style=" font-weight:600; color:#0000ff;">For</span> i <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">To</span> Len<span style=" color:#000000;">(</span>InString<span style=" color:#000000;">)</span> <span style=" color:#000000;">-</span> <span style=" color:#a52a2a;">1</span><br />        bytBuffer<span style=" color:#000000;">(</span>i<span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=ASC+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Asc</span></a><span style=" color:#000000;">(</span>Mid<span style=" color:#000000;">(</span>InString, i <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">1</span>, <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">))</span><br />    <span style=" font-weight:600; color:#0000ff;">Next</span> i<br />    StringToArray <span style=" color:#000000;">=</span> bytBuffer<br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Concatenate the four state vaules into one string</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Public</span> <span style=" font-weight:600; color:#0000ff;">Function</span> GetValues<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />    GetValues <span style=" color:#000000;">=</span> LongToString<span style=" color:#000000;">(</span>state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">))</span> <span style=" color:#000000;">&amp;</span> LongToString<span style=" color:#000000;">(</span>state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">))</span> <span style=" color:#000000;">&amp;</span> LongToString<span style=" color:#000000;">(</span>state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">))</span> <span style=" color:#000000;">&amp;</span><br />LongToString<span style=" color:#000000;">(</span>state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">))</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Convert a Long to a Hex string</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> LongToString<span style=" color:#000000;">(</span>Num <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">String</span><br />        <span style=" font-weight:600; color:#0000ff;">Dim</span> a <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br />        <span style=" font-weight:600; color:#0000ff;">Dim</span> b <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br />        <span style=" font-weight:600; color:#0000ff;">Dim</span> c <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br />        <span style=" font-weight:600; color:#0000ff;">Dim</span> d <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br />       <br />        a <span style=" color:#000000;">=</span> Num <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFF<span style=" color:#000000;">&amp;</span><br />        <span style=" font-weight:600; color:#0000ff;">If</span> a <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">16</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />            LongToString <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;0&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span>a<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">Else</span><br />            LongToString <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span>a<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />              <br />        b <span style=" color:#000000;">=</span> <span style=" color:#000000;">(</span>Num <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFF00<span style=" color:#000000;">&amp;)</span> \ <span style=" color:#a52a2a;">256</span><br />        <span style=" font-weight:600; color:#0000ff;">If</span> b <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">16</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />            LongToString <span style=" color:#000000;">=</span> LongToString <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;0&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span>b<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">Else</span><br />            LongToString <span style=" color:#000000;">=</span> LongToString <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span>b<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />       <br />        c <span style=" color:#000000;">=</span> <span style=" color:#000000;">(</span>Num <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFF0000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">65536</span><br />        <span style=" font-weight:600; color:#0000ff;">If</span> c <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">16</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />            LongToString <span style=" color:#000000;">=</span> LongToString <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;0&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span>c<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">Else</span><br />            LongToString <span style=" color:#000000;">=</span> LongToString <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span>c<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />      <br />        <span style=" font-weight:600; color:#0000ff;">If</span> Num <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />            d <span style=" color:#000000;">=</span> <span style=" color:#000000;">((</span>Num <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>H7F000000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">16777216</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">Or</span> <span style=" color:#000000;">&amp;</span>H80<span style=" color:#000000;">&amp;</span><br />        <span style=" font-weight:600; color:#0000ff;">Else</span><br />            d <span style=" color:#000000;">=</span> <span style=" color:#000000;">(</span>Num <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFF000000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">16777216</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />       <br />        <span style=" font-weight:600; color:#0000ff;">If</span> d <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">16</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />            LongToString <span style=" color:#000000;">=</span> LongToString <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;0&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span>d<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">Else</span><br />            LongToString <span style=" color:#000000;">=</span> LongToString <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=HEX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Hex</span></a><span style=" color:#000000;">(</span>d<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />   <br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Initialize the class</span><br /><span style=" font-style:italic; color:#008000;">'   This must be called before a digest calculation is started</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Public</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> MD5Init<span style=" color:#000000;">()</span><br />    ByteCounter <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br />    state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1732584193</span>#<span style=" color:#000000;">)</span><br />    state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4023233417</span>#<span style=" color:#000000;">)</span><br />    state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2562383102</span>#<span style=" color:#000000;">)</span><br />    state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">271733878</span>#<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' MD5 Final</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Public</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> MD5Final<span style=" color:#000000;">()</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> dblBits <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Double</span><br />   <br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">72</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngBytesBuffered <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />   <br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">0</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <span style=" color:#000000;">&amp;</span>H80<br />   <br />    dblBits <span style=" color:#000000;">=</span> ByteCounter <span style=" color:#000000;">*</span> <span style=" color:#a52a2a;">8</span><br />   <br />    <span style=" font-style:italic; color:#008000;">' Pad out</span><br />    lngBytesBuffered <span style=" color:#000000;">=</span> ByteCounter <span style=" font-weight:600; color:#0000ff;">Mod</span> <span style=" color:#a52a2a;">64</span><br />    <span style=" font-weight:600; color:#0000ff;">If</span> lngBytesBuffered <span style=" color:#000000;">&lt;=</span> <span style=" color:#a52a2a;">56</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />        MD5Update <span style=" color:#a52a2a;">56</span> <span style=" color:#000000;">-</span> lngBytesBuffered, padding<br />    <span style=" font-weight:600; color:#0000ff;">Else</span><br />        MD5Update <span style=" color:#a52a2a;">120</span> <span style=" color:#000000;">-</span> ByteCounter, padding<br />    <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />   <br />   <br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">0</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span>dblBits<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFF<span style=" color:#000000;">&amp;</span><br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span>dblBits<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">256</span> <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFF<span style=" color:#000000;">&amp;</span><br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span>dblBits<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">65536</span> <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFF<span style=" color:#000000;">&amp;</span><br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span>dblBits<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">16777216</span> <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFF<span style=" color:#000000;">&amp;</span><br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">5</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">6</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br />    padding<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">7</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br />   <br />    MD5Update <span style=" color:#a52a2a;">8</span>, padding<br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Break up input stream into 64 byte chunks</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Public</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> MD5Update<span style=" color:#000000;">(</span>InputLen <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, InputBuffer<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> II <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Integer</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> i <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Integer</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> j <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Integer</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> k <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Integer</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngBufferedBytes <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngBufferRemaining <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngRem <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />   <br />    lngBufferedBytes <span style=" color:#000000;">=</span> ByteCounter <span style=" font-weight:600; color:#0000ff;">Mod</span> <span style=" color:#a52a2a;">64</span><br />    lngBufferRemaining <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">64</span> <span style=" color:#000000;">-</span> lngBufferedBytes<br />    ByteCounter <span style=" color:#000000;">=</span> ByteCounter <span style=" color:#000000;">+</span> InputLen<br />    <span style=" font-style:italic; color:#008000;">' Use up old buffer results first</span><br />    <span style=" font-weight:600; color:#0000ff;">If</span> InputLen <span style=" color:#000000;">&gt;=</span> lngBufferRemaining <span style=" font-weight:600; color:#0000ff;">Then</span><br />        <span style=" font-weight:600; color:#0000ff;">For</span> II <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">To</span> lngBufferRemaining <span style=" color:#000000;">-</span> <span style=" color:#a52a2a;">1</span><br />            ByteBuffer<span style=" color:#000000;">(</span>lngBufferedBytes <span style=" color:#000000;">+</span> II<span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> InputBuffer<span style=" color:#000000;">(</span>II<span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">Next</span> II<br />        MD5Transform ByteBuffer<br />       <br />        lngRem <span style=" color:#000000;">=</span> <span style=" color:#000000;">(</span>InputLen<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">Mod</span> <span style=" color:#a52a2a;">64</span><br />        <span style=" font-style:italic; color:#008000;">' The transfer is a multiple of 64 lets do some transformations</span><br />        <span style=" font-weight:600; color:#0000ff;">For</span> i <span style=" color:#000000;">=</span> lngBufferRemaining <span style=" font-weight:600; color:#0000ff;">To</span> InputLen <span style=" color:#000000;">-</span> II <span style=" color:#000000;">-</span> lngRem <span style=" font-weight:600; color:#0000ff;">Step</span> <span style=" color:#a52a2a;">64</span><br />            <span style=" font-weight:600; color:#0000ff;">For</span> j <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">To</span> <span style=" color:#a52a2a;">63</span><br />                ByteBuffer<span style=" color:#000000;">(</span>j<span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> InputBuffer<span style=" color:#000000;">(</span>i <span style=" color:#000000;">+</span> j<span style=" color:#000000;">)</span><br />            <span style=" font-weight:600; color:#0000ff;">Next</span> j<br />            MD5Transform ByteBuffer<br />        <span style=" font-weight:600; color:#0000ff;">Next</span> i<br />        lngBufferedBytes <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br />    <span style=" font-weight:600; color:#0000ff;">Else</span><br />      i <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br />    <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />   <br />    <span style=" font-style:italic; color:#008000;">' Buffer any remaining input</span><br />    <span style=" font-weight:600; color:#0000ff;">For</span> k <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">To</span> InputLen <span style=" color:#000000;">-</span> i <span style=" color:#000000;">-</span> <span style=" color:#a52a2a;">1</span><br />        ByteBuffer<span style=" color:#000000;">(</span>lngBufferedBytes <span style=" color:#000000;">+</span> k<span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> InputBuffer<span style=" color:#000000;">(</span>i <span style=" color:#000000;">+</span> k<span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Next</span> k<br />   <br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' MD5 Transform</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> MD5Transform<span style=" color:#000000;">(</span>Buffer<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">16</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> a <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> b <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> c <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> d <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />   <br />    a <span style=" color:#000000;">=</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span><br />    b <span style=" color:#000000;">=</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span><br />    c <span style=" color:#000000;">=</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span><br />    d <span style=" color:#000000;">=</span> state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span><br />   <br />    Decode <span style=" color:#a52a2a;">64</span>, x, Buffer<br />    <span style=" font-style:italic; color:#008000;">' Round 1</span><br />    FF a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">0</span><span style=" color:#000000;">)</span>, S11, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">680876936</span><br />    FF d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span>, S12, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">389564586</span><br />    FF c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span>, S13, <span style=" color:#a52a2a;">606105819</span><br />    FF b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span>, S14, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1044525330</span><br />    FF a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span>, S11, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">176418897</span><br />    FF d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">5</span><span style=" color:#000000;">)</span>, S12, <span style=" color:#a52a2a;">1200080426</span><br />    FF c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">6</span><span style=" color:#000000;">)</span>, S13, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1473231341</span><br />    FF b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">7</span><span style=" color:#000000;">)</span>, S14, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">45705983</span><br />    FF a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">8</span><span style=" color:#000000;">)</span>, S11, <span style=" color:#a52a2a;">1770035416</span><br />    FF d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">9</span><span style=" color:#000000;">)</span>, S12, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1958414417</span><br />    FF c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">10</span><span style=" color:#000000;">)</span>, S13, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">42063</span><br />    FF b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">11</span><span style=" color:#000000;">)</span>, S14, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1990404162</span><br />    FF a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">12</span><span style=" color:#000000;">)</span>, S11, <span style=" color:#a52a2a;">1804603682</span><br />    FF d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">13</span><span style=" color:#000000;">)</span>, S12, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">40341101</span><br />    FF c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">14</span><span style=" color:#000000;">)</span>, S13, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1502002290</span><br />    FF b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">15</span><span style=" color:#000000;">)</span>, S14, <span style=" color:#a52a2a;">1236535329</span><br />   <br />    <span style=" font-style:italic; color:#008000;">' Round 2</span><br />    GG a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span>, S21, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">165796510</span><br />    GG d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">6</span><span style=" color:#000000;">)</span>, S22, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1069501632</span><br />    GG c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">11</span><span style=" color:#000000;">)</span>, S23, <span style=" color:#a52a2a;">643717713</span><br />    GG b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">0</span><span style=" color:#000000;">)</span>, S24, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">373897302</span><br />    GG a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">5</span><span style=" color:#000000;">)</span>, S21, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">701558691</span><br />    GG d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">10</span><span style=" color:#000000;">)</span>, S22, <span style=" color:#a52a2a;">38016083</span><br />    GG c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">15</span><span style=" color:#000000;">)</span>, S23, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">660478335</span><br />    GG b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span>, S24, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">405537848</span><br />    GG a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">9</span><span style=" color:#000000;">)</span>, S21, <span style=" color:#a52a2a;">568446438</span><br />    GG d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">14</span><span style=" color:#000000;">)</span>, S22, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1019803690</span><br />    GG c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span>, S23, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">187363961</span><br />    GG b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">8</span><span style=" color:#000000;">)</span>, S24, <span style=" color:#a52a2a;">1163531501</span><br />    GG a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">13</span><span style=" color:#000000;">)</span>, S21, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1444681467</span><br />    GG d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span>, S22, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">51403784</span><br />    GG c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">7</span><span style=" color:#000000;">)</span>, S23, <span style=" color:#a52a2a;">1735328473</span><br />    GG b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">12</span><span style=" color:#000000;">)</span>, S24, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1926607734</span><br />   <br />    <span style=" font-style:italic; color:#008000;">' Round 3</span><br />    HH a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">5</span><span style=" color:#000000;">)</span>, S31, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">378558</span><br />    HH d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">8</span><span style=" color:#000000;">)</span>, S32, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">2022574463</span><br />    HH c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">11</span><span style=" color:#000000;">)</span>, S33, <span style=" color:#a52a2a;">1839030562</span><br />    HH b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">14</span><span style=" color:#000000;">)</span>, S34, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">35309556</span><br />    HH a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span>, S31, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1530992060</span><br />    HH d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span>, S32, <span style=" color:#a52a2a;">1272893353</span><br />    HH c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">7</span><span style=" color:#000000;">)</span>, S33, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">155497632</span><br />    HH b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">10</span><span style=" color:#000000;">)</span>, S34, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1094730640</span><br />    HH a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">13</span><span style=" color:#000000;">)</span>, S31, <span style=" color:#a52a2a;">681279174</span><br />    HH d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">0</span><span style=" color:#000000;">)</span>, S32, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">358537222</span><br />    HH c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span>, S33, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">722521979</span><br />    HH b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">6</span><span style=" color:#000000;">)</span>, S34, <span style=" color:#a52a2a;">76029189</span><br />    HH a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">9</span><span style=" color:#000000;">)</span>, S31, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">640364487</span><br />    HH d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">12</span><span style=" color:#000000;">)</span>, S32, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">421815835</span><br />    HH c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">15</span><span style=" color:#000000;">)</span>, S33, <span style=" color:#a52a2a;">530742520</span><br />    HH b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span>, S34, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">995338651</span><br />   <br />    <span style=" font-style:italic; color:#008000;">' Round 4</span><br />    II a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">0</span><span style=" color:#000000;">)</span>, S41, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">198630844</span><br />    II d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">7</span><span style=" color:#000000;">)</span>, S42, <span style=" color:#a52a2a;">1126891415</span><br />    II c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">14</span><span style=" color:#000000;">)</span>, S43, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1416354905</span><br />    II b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">5</span><span style=" color:#000000;">)</span>, S44, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">57434055</span><br />    II a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">12</span><span style=" color:#000000;">)</span>, S41, <span style=" color:#a52a2a;">1700485571</span><br />    II d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span>, S42, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1894986606</span><br />    II c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">10</span><span style=" color:#000000;">)</span>, S43, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1051523</span><br />    II b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span>, S44, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">2054922799</span><br />    II a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">8</span><span style=" color:#000000;">)</span>, S41, <span style=" color:#a52a2a;">1873313359</span><br />    II d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">15</span><span style=" color:#000000;">)</span>, S42, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">30611744</span><br />    II c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">6</span><span style=" color:#000000;">)</span>, S43, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1560198380</span><br />    II b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">13</span><span style=" color:#000000;">)</span>, S44, <span style=" color:#a52a2a;">1309151649</span><br />    II a, b, c, d, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span>, S41, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">145523070</span><br />    II d, a, b, c, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">11</span><span style=" color:#000000;">)</span>, S42, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">1120210379</span><br />    II c, d, a, b, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span>, S43, <span style=" color:#a52a2a;">718787259</span><br />    II b, c, d, a, x<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">9</span><span style=" color:#000000;">)</span>, S44, <span style=" color:#000000;">-</span><span style=" color:#a52a2a;">343485551</span><br />   <br />   <br />    state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> LongOverflowAdd<span style=" color:#000000;">(</span>state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span>, a<span style=" color:#000000;">)</span><br />    state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> LongOverflowAdd<span style=" color:#000000;">(</span>state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span>, b<span style=" color:#000000;">)</span><br />    state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> LongOverflowAdd<span style=" color:#000000;">(</span>state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span>, c<span style=" color:#000000;">)</span><br />    state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> LongOverflowAdd<span style=" color:#000000;">(</span>state<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">4</span><span style=" color:#000000;">)</span>, d<span style=" color:#000000;">)</span><br /><span style=" font-style:italic; color:#008000;">'  /* Zeroize sensitive information.</span><br /><span style=" font-style:italic; color:#008000;">'*/</span><br /><span style=" font-style:italic; color:#008000;">'  MD5_memset ((POINTER)x, 0, sizeof (x));</span><br />   <br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> Decode<span style=" color:#000000;">(</span>Length <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Integer</span>, OutputBuffer<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, InputBuffer<span style=" color:#000000;">()</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Byte</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> intDblIndex <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Integer</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> intByteIndex <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Integer</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> dblSum <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Double</span><br />   <br />    intDblIndex <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br />    <span style=" font-weight:600; color:#0000ff;">For</span> intByteIndex <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">To</span> Length <span style=" color:#000000;">-</span> <span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">Step</span> <span style=" color:#a52a2a;">4</span><br />        dblSum <span style=" color:#000000;">=</span> InputBuffer<span style=" color:#000000;">(</span>intByteIndex<span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> _<br />                                    InputBuffer<span style=" color:#000000;">(</span>intByteIndex <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">*</span> <span style=" color:#a52a2a;">256</span># <span style=" color:#000000;">+</span> _<br />                                    InputBuffer<span style=" color:#000000;">(</span>intByteIndex <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">*</span> <span style=" color:#a52a2a;">65536</span># <span style=" color:#000000;">+</span> _<br />                                    InputBuffer<span style=" color:#000000;">(</span>intByteIndex <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">3</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">*</span> <span style=" color:#a52a2a;">16777216</span>#<br />        OutputBuffer<span style=" color:#000000;">(</span>intDblIndex<span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">(</span>dblSum<span style=" color:#000000;">)</span><br />        intDblIndex <span style=" color:#000000;">=</span> intDblIndex <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">1</span><br />    <span style=" font-weight:600; color:#0000ff;">Next</span> intByteIndex<br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' FF, GG, HH, and II transformations for rounds 1, 2, 3, and 4.</span><br /><span style=" font-style:italic; color:#008000;">' Rotation is separate from addition to prevent recomputation.</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> FF<span style=" color:#000000;">(</span>a <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    b <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    c <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    d <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    x <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    s <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    ac <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    a <span style=" color:#000000;">=</span> LongOverflowAdd4<span style=" color:#000000;">(</span>a, <span style=" color:#000000;">(</span>b <span style=" font-weight:600; color:#0000ff;">And</span> c<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">Or</span> <span style=" color:#000000;">(</span><span style=" font-weight:600; color:#0000ff;">Not</span> <span style=" color:#000000;">(</span>b<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">And</span> d<span style=" color:#000000;">)</span>, x, ac<span style=" color:#000000;">)</span><br />    a <span style=" color:#000000;">=</span> LongLeftRotate<span style=" color:#000000;">(</span>a, s<span style=" color:#000000;">)</span><br />    a <span style=" color:#000000;">=</span> LongOverflowAdd<span style=" color:#000000;">(</span>a, b<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> GG<span style=" color:#000000;">(</span>a <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    b <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    c <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    d <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    x <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    s <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    ac <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    a <span style=" color:#000000;">=</span> LongOverflowAdd4<span style=" color:#000000;">(</span>a, <span style=" color:#000000;">(</span>b <span style=" font-weight:600; color:#0000ff;">And</span> d<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">Or</span> <span style=" color:#000000;">(</span>c <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" font-weight:600; color:#0000ff;">Not</span> <span style=" color:#000000;">(</span>d<span style=" color:#000000;">))</span>, x, ac<span style=" color:#000000;">)</span><br />    a <span style=" color:#000000;">=</span> LongLeftRotate<span style=" color:#000000;">(</span>a, s<span style=" color:#000000;">)</span><br />    a <span style=" color:#000000;">=</span> LongOverflowAdd<span style=" color:#000000;">(</span>a, b<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> HH<span style=" color:#000000;">(</span>a <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    b <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    c <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    d <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    x <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    s <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    ac <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    a <span style=" color:#000000;">=</span> LongOverflowAdd4<span style=" color:#000000;">(</span>a, b <span style=" font-weight:600; color:#0000ff;">Xor</span> c <span style=" font-weight:600; color:#0000ff;">Xor</span> d, x, ac<span style=" color:#000000;">)</span><br />    a <span style=" color:#000000;">=</span> LongLeftRotate<span style=" color:#000000;">(</span>a, s<span style=" color:#000000;">)</span><br />    a <span style=" color:#000000;">=</span> LongOverflowAdd<span style=" color:#000000;">(</span>a, b<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> II<span style=" color:#000000;">(</span>a <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    b <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    c <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    d <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    x <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    s <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, _<br />                    ac <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    a <span style=" color:#000000;">=</span> LongOverflowAdd4<span style=" color:#000000;">(</span>a, c <span style=" font-weight:600; color:#0000ff;">Xor</span> <span style=" color:#000000;">(</span>b <span style=" font-weight:600; color:#0000ff;">Or</span> <span style=" font-weight:600; color:#0000ff;">Not</span> <span style=" color:#000000;">(</span>d<span style=" color:#000000;">))</span>, x, ac<span style=" color:#000000;">)</span><br />    a <span style=" color:#000000;">=</span> LongLeftRotate<span style=" color:#000000;">(</span>a, s<span style=" color:#000000;">)</span><br />    a <span style=" color:#000000;">=</span> LongOverflowAdd<span style=" color:#000000;">(</span>a, b<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Rotate a long to the right</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Function</span> LongLeftRotate<span style=" color:#000000;">(</span>value <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, bits <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngSign <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngI <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    bits <span style=" color:#000000;">=</span> bits <span style=" font-weight:600; color:#0000ff;">Mod</span> <span style=" color:#a52a2a;">32</span><br />    <span style=" font-weight:600; color:#0000ff;">If</span> bits <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">Then</span> LongLeftRotate <span style=" color:#000000;">=</span> value: <span style=" font-weight:600; color:#0000ff;">Exit</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br />    <span style=" font-weight:600; color:#0000ff;">For</span> lngI <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">To</span> bits<br />        lngSign <span style=" color:#000000;">=</span> value <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HC0000000<br />        value <span style=" color:#000000;">=</span> <span style=" color:#000000;">(</span>value <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>H3FFFFFFF<span style=" color:#000000;">)</span> <span style=" color:#000000;">*</span> <span style=" color:#a52a2a;">2</span><br />        value <span style=" color:#000000;">=</span> value <span style=" font-weight:600; color:#0000ff;">Or</span> <span style=" color:#000000;">((</span>lngSign <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">0</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">Or</span> <span style=" color:#000000;">(</span><span style=" color:#cd6a5a;">CBool</span><span style=" color:#000000;">(</span>lngSign <span style=" font-weight:600; color:#0000ff;">And</span> _<br />                <span style=" color:#000000;">&amp;</span>H40000000<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>H80000000<span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Next</span><br />    LongLeftRotate <span style=" color:#000000;">=</span> value<br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Function to add two unsigned numbers together as in C.</span><br /><span style=" font-style:italic; color:#008000;">' Overflows are ignored!</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> LongOverflowAdd<span style=" color:#000000;">(</span>Val1 <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, Val2 <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngHighWord <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngLowWord <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngOverflow <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    lngLowWord <span style=" color:#000000;">=</span> <span style=" color:#000000;">(</span>Val1 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;)</span> <span style=" color:#000000;">+</span> <span style=" color:#000000;">(</span>Val2 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;)</span><br />    lngOverflow <span style=" color:#000000;">=</span> lngLowWord \ <span style=" color:#a52a2a;">65536</span><br />    lngHighWord <span style=" color:#000000;">=</span> <span style=" color:#000000;">(((</span>Val1 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF0000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">65536</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> <span style=" color:#000000;">((</span>Val2 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF0000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">65536</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> lngOverflow<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">And</span><br /><span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;</span><br />    LongOverflowAdd <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">((</span>lngHighWord <span style=" color:#000000;">*</span> <span style=" color:#a52a2a;">65536</span>#<span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> <span style=" color:#000000;">(</span>lngLowWord <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;))</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Function to add two unsigned numbers together as in C.</span><br /><span style=" font-style:italic; color:#008000;">' Overflows are ignored!</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> LongOverflowAdd4<span style=" color:#000000;">(</span>Val1 <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, Val2 <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, val3 <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span>, val4 <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngHighWord <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngLowWord <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> lngOverflow <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />    lngLowWord <span style=" color:#000000;">=</span> <span style=" color:#000000;">(</span>Val1 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;)</span> <span style=" color:#000000;">+</span> <span style=" color:#000000;">(</span>Val2 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;)</span> <span style=" color:#000000;">+</span> <span style=" color:#000000;">(</span>val3 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;)</span> <span style=" color:#000000;">+</span> <span style=" color:#000000;">(</span>val4 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;)</span><br />    lngOverflow <span style=" color:#000000;">=</span> lngLowWord \ <span style=" color:#a52a2a;">65536</span><br />    lngHighWord <span style=" color:#000000;">=</span> <span style=" color:#000000;">(((</span>Val1 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF0000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">65536</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> _<br />                   <span style=" color:#000000;">((</span>Val2 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF0000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">65536</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> _<br />                   <span style=" color:#000000;">((</span>val3 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF0000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">65536</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> _<br />                   <span style=" color:#000000;">((</span>val4 <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF0000<span style=" color:#000000;">)</span> \ <span style=" color:#a52a2a;">65536</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> _<br />                   lngOverflow<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;</span><br />    LongOverflowAdd4 <span style=" color:#000000;">=</span> UnsignedToLong<span style=" color:#000000;">((</span>lngHighWord <span style=" color:#000000;">*</span> <span style=" color:#a52a2a;">65536</span>#<span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> <span style=" color:#000000;">(</span>lngLowWord <span style=" font-weight:600; color:#0000ff;">And</span> <span style=" color:#000000;">&amp;</span>HFFFF<span style=" color:#000000;">&amp;))</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Convert an unsigned double into a long</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> UnsignedToLong<span style=" color:#000000;">(</span>value <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Double</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><br />        <span style=" font-weight:600; color:#0000ff;">If</span> value <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">Or</span> value <span style=" color:#000000;">&gt;=</span> OFFSET_4 <span style=" font-weight:600; color:#0000ff;">Then</span> <span style=" font-weight:600; color:#0000ff;">Error</span> <span style=" color:#a52a2a;">6</span> <span style=" font-style:italic; color:#008000;">' Overflow</span><br />        <span style=" font-weight:600; color:#0000ff;">If</span> value <span style=" color:#000000;">&lt;=</span> MAXINT_4 <span style=" font-weight:600; color:#0000ff;">Then</span><br />          UnsignedToLong <span style=" color:#000000;">=</span> value<br />        <span style=" font-weight:600; color:#0000ff;">Else</span><br />          UnsignedToLong <span style=" color:#000000;">=</span> value <span style=" color:#000000;">-</span> OFFSET_4<br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br />      <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' Convert a long to an unsigned Double</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Function</span> LongToUnsigned<span style=" color:#000000;">(</span>value <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Long</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">As</span> <span style=" color:#6a5acd;">Double</span><br />        <span style=" font-weight:600; color:#0000ff;">If</span> value <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />          LongToUnsigned <span style=" color:#000000;">=</span> value <span style=" color:#000000;">+</span> OFFSET_4<br />        <span style=" font-weight:600; color:#0000ff;">Else</span><br />          LongToUnsigned <span style=" color:#000000;">=</span> value<br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span></p></body></html>