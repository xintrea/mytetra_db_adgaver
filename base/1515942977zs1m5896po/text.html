<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">16. Дополнение </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="aswift_0_expand"></a><span style=" font-size:x-large; font-weight:600;">1</span><span style=" font-size:x-large; font-weight:600;">6.1. Интерактивный режим</span> </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">16.1.1. Обработка ошибок</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда происходит ошибка, интерпретатор выводит сообщение о ней и трассировку стека. В интерактивном режиме он затем возвращается к первичному приглашению; когда ввод поступает из файла, он выходит с ненулевым выходным статусом после печати трассировки стека. (Исключения, обработанные разделом except (docs.python.org/3/reference/compound_stmts.html#except)  оператора try (docs.python.org/3/reference/compound_stmts.html#try), не являются ошибками в этом случае.) Некоторые ошибки безусловно фатальны и являются причиной ненулевого выхода; это применяется для внутренних несоответствий и ряда случаев нехватки памяти. Все сообщения об ошибках записываются в стандартный поток ошибок; в обычный вывод выполненных команд записывается стандартный вывод. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ввод прерывающего символа (обычно Control-C или Delete) в первичном или вторичном приглашении отменяет ввод и возвращает к первичному приглашению. <a name="id1"></a><a href="http://pythoner.name/documentation/tutorial/appendix#id11"><span style=" text-decoration: underline; color:#0000ff;">[</span></a><span style=" text-decoration: underline; color:#0000ff;">1]</span> Ввод прерывания в то время как команда выполняется возбуждает исключение KeyboardInterrupt (docs.python.org/3/library/exceptions.html#KeyboardInterrupt), которое может быть обработано оператором try. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="tut-scripts"></a><span style=" font-size:large; font-weight:600;">1</span><span style=" font-size:large; font-weight:600;">6.1.2. Исполняемые скрипты Python</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На BSD-подобных Unix-системах скрипты Python можно сделать сразу выполняемыми подобно shell-скриптам, введя строку </p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">#!/usr/bin/env python3.5</span> </pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">(предполагая, что интерпретатор есть на PATH пользователя) в начале скрипта и задав файлу исполняемый режим. <span style=" font-family:'Courier New,courier';">#!</span> должны быть первыми двумя символами файла. На некоторых платформах эта первая строка должна заканчиваться окончанием строки в Unix-стиле (<span style=" font-family:'Courier New,courier';">'\n'</span>), не окончанием строки Windows (<span style=" font-family:'Courier New,courier';">'\r\n'</span>). Заметьте, что символ хэша, <span style=" font-family:'Courier New,courier';">'#'</span>, используется для обозначения начала комментария в Python. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Скрипту может быть передан исполняемый режим, или разрешения, с помощью команды <span style=" font-weight:600;">chmod</span>. </p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">$ chmod +x myscript.py</span> </pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В системах Windows нет понятия &quot;исполняемый режим&quot;. Установщик Python автоматически ассоциирует файлы <span style=" font-family:'Courier New,courier';">.py</span> с <span style=" font-family:'Courier New,courier';">python.exe</span>, так что двойной клик на Python-файле запустит его как скрипт. Расширение может быть .pyw, в этом случае окно консоли, которое обычно появляется, подавляется. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">16.1.3. Интерактивный загрузочный файл</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда вы используете Python интерактивно, часто<a name="result_box"></a> удобно иметь некоторые стандартные команды, выполняемые каждый раз при запуске интерпретатора. Вы можете сделать это, связав переменную окружения PYTHONSTARTUP (docs.python.org/3/using/cmdline.html#envvar-PYTHONSTARTUP) с именем файла, содержащем загрузочные команды. Это похоже на возможности <span style=" font-family:'Courier New,courier';">.profile</span> оболочек Unix. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Этот файл читается только в интерактивных сессиях, не когда Python читает команды из скрипта и не когда <span style=" font-family:'Courier New,courier';">/dev/tty</span> задан как явный источник команд (который иначе ведет себя как интерактивная сессия). Он выполняется в том же пространстве имен, котором выполняются интерактивные команды, так что объекты, которые он определяет или импортирует, могут быть использованы без квалификации в интерактивном сеансе. Вы также можете изменить в этом файле приглашения <span style=" font-family:'Courier New,courier';">sys.ps1</span> и <span style=" font-family:'Courier New,courier';">sys.ps2</span>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы хотите прочитать дополнительный загрузочный файл из текущей директории, то можете запрограммировать это в глобальном загрузочном файле, используя код наподобие <span style=" font-family:'Courier New,courier';">if os.path.isfile('.pythonrc.py'): exec(open('.pythonrc.py').read())</span>. Если вы хотите использовать загрузочный файл в скрипте, то должны сделать это явно в скрипте: </p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">import os</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">filename = os.environ.get('PYTHONSTARTUP')</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">if filename and os.path.isfile(filename):</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    with open(filename) as fobj:</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">        startup_file = fobj.read()</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    exec(startup_file)</span> </pre>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">16.1.4. Настройка модулей</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Python предоставляет два хука, чтобы позволить вам настроить это: <span style=" font-family:'Courier New,courier';">sitecustomize</span> и <span style=" font-family:'Courier New,courier';">usercustomize</span>. Чтобы увидеть, как это работает, вам сначала надо найти местонахождение вашей пользовательской директории site-пакетов. Запустите Python и выполните этот код: </p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">&gt;&gt;&gt; import site</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">&gt;&gt;&gt; site.getusersitepackages()</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">'/home/user/.local/lib/python3.5/site-packages'</span> </pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь вы можете создать файл под именем usercustomize.py в той директории и положить в нее что-нибудь, что вы хотите. Оно будет влиять на каждый вызов Python, <a name="result_box"></a>если только он не запущен с опцией <span style=" font-family:'Courier New,courier';">-s</span>, чтобы отключить автоматический импорт. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">sitecustomize</span> работает похожим образом, но обычно создается администратором компьютера в глобальной директории site-пакетов и импортируется перед <span style=" font-family:'Courier New,courier';">usercustomize</span>. См. документацию по модулю site (docs.python.org/3/library/site.html#module-site) для более полной информации. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечания</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="id11"></a><a href="http://pythoner.name/documentation/tutorial/appendix#id1"><span style=" text-decoration: underline; color:#0000ff;">[</span></a><span style=" text-decoration: underline; color:#0000ff;">1]</span> <a name="result_box"></a>Проблема с пакетом GNU Readline может помешать этому.</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Создано</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2017-07-10 </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://pythoner.name/index.php/comment/reply/node/94/comment#comment-form"><span style=" text-decoration: underline; color:#0000ff;">Добавить комментарий</span></a> </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="book-label-26"></a><span style=" font-size:x-large; font-weight:600;">П</span><span style=" font-size:x-large; font-weight:600;">ерекрёстные ссылки книги для 16. Дополнение</span> </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style="" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://pythoner.name/index.php/documentation/tutorial/floatingpoint"><span style=" text-decoration: underline; color:#0000ff;">15. Арифметика чисел с плавающей точкой: проблемы и ограничения</span></a> </li>
<li style="" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://pythoner.name/index.php/documentation/tutorial"><span style=" text-decoration: underline; color:#0000ff;">Вверх</span></a> </li>
<li style="" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://pythoner.name/index.php/documentation/library"><span style=" text-decoration: underline; color:#0000ff;">Стандартная библиотека Python</span></a> </li></ul></body></html>