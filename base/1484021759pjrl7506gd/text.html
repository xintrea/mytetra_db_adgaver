<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.programm-school.ru/rasshirenye_spiski_v_excel_vba.html"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">programm-school.ru</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создаем расширенный список выбора в Excel с помощью VBA </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Автор: Deys</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">6-8 минут</span><span style=" font-size:8.25pt;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<hr width="100%"/>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">В статье &quot;</span><a href="http://www.programm-school.ru/sozdanie_spiska_vibora_v_excel.html"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic; text-decoration: underline; color:#0000ff;">Создание списка выбора в Excel 2003</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">&quot; были рассмотрены способы создания списков выбора, но в этих способах есть небольшое неудобство при работе с большими списками, а именно поиск нужного значения. В этой статье будет описан способ создания списков в Excel с помощью средств языка VBA, более универсальный, с реализованной возможностью быстрого поиска.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Задача: Создать форму выбора значений из списка и их вставка в ячейку. Вызов формы осуществляется только на определенных столбцах, при этом на каждый столбец отображается свой набор значений. Форма вызывается правой кнопкой мыши(ПКМ).</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Приступим к реализации. Для начала нам необходимо создать списки значений на отдельном листе. Назовем этот лист &quot;Списки&quot;.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Начиная с первого столбца, первой строки, создадим списки следующим образом:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image22562.png" /><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">где, первая строка - наименование списка.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Лист, в котором необходимо заполнение и выбор значений, назовем реестр и выглядеть будет так:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image11041.png" /><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">т.е. нам необходимо с помощью выбора из списка подставлять значения в столбцы : B, C, D, F.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Открываем редактор VB (</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Alt+F11</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">)<br />В редакторе зададим нашим листам в окне &quot;Properties&quot; следующие имена:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image6190.png" /><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Листу с реестром зададим имя - </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">reestr</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.<br />Лист со списками же, получит имя - </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">spisok</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Далее, создадим форму с именем (name) &quot;SelectList&quot;, добавим на нее элементы Listbox и TextBox.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Имена для этих элементов следующие:<br />Listbox - List<br />TextBox - SearchText</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">В итоге получится форма следующего вида:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image13465.png" /><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Теперь необходимо прописать процедуры в код нашей формы. Для этого выделите форму и нажмите F7, после чего вставьте следующий код:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">'глобальные переменные<br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Public</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> R, C, count </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As Long</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Public</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> SheetOut </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As String</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Public</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> numList </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As Byte</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">'Вставка значения двойным кликом в общем листе<br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Private Sub</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> List_DblClick(</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ByVal</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> Cancel </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As MSForms.ReturnBoolean</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">)<br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">If</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> List.Text &lt;&gt; &quot;&quot; </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Then</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />   Sheets(SheetOut).Cells(R, C) = List.Text<br />   SelectList.Hide<br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End If</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">'Вставка значения нажатием Enter в листе Результата поиска<br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Private Sub</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> List_KeyPress(</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ByVal </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">KeyAscii </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As MSForms.ReturnInteger</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">)<br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">If</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> KeyAscii = 13 </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Then</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />  </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">If</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> List.Text &lt;&gt; &quot;&quot; </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Then</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />      Sheets(SheetOut).Cells(R, C) = List.Text<br />      SelectList.Hide<br />  </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End If</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Private Sub</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> SearchText_Change() 'Процедура поиска и отображения результатов<br /> count = 2<br /> List.Clear</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">  </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">While</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> Trim(spisok.Cells(count, numList)) &lt;&gt; &quot;&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />    </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">If</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> InStr(1, LCase(spisok.Cells(count, numList)), LCase(SearchText.Text)) &gt; 0 </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Then</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />        List.AddItem spisok.Cells(count, numList)<br />     </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">    count = count + 1</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br /> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Wend</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Public Sub</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> LoadList() 'Процедура загрузки списка<br />  count = 2<br /> List.Clear 'очищаем список<br /> SearchText.Text = &quot;&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">  </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">While</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> Trim(spisok.Cells(count, numList)) &lt;&gt; &quot;&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />    List.AddItem spisok.Cells(count, numList)<br />    count = count + 1<br /> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Wend</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br /> SelectList.Caption = &quot;Выберите - &quot; &amp; spisok.Cells(1, numList)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">      </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Все. Элементы формы запрограммированы. Немного о процедурах по порядку:</span><span style=" font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; font-style:italic;">List_DblClick</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - процедура вызываемая двойным кликом мыши по выбранному в списке значению. При выполнении, происходит вставка значения в ячейку листа &quot;Реестр&quot; координаты которой переданы в глобальных переменных R(строка), C(столбец);</span> </li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; font-style:italic;">List_KeyPress</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - процедура аналогична по действию с процедурой </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; font-style:italic;">List_DblClick, </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">только вставка осуществляется при нажатии клавиши Enter;</span> </li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; font-style:italic;">SearchText_Change</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - процедура, вызываемая при вводе символов в строку поиска. В результате работы данной процедуры, происходит обновление списка, значения которого содержат введенные символы в поле </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; font-style:italic;">SearchText</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. Ввести достаточно часть названия и будут отображены значения(значение) содержащие эту часть названия;</span> </li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; font-style:italic;">LoadList</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - дополнительная процедура, которая загружает список в элемент List. Вызов производится в следующей части кода.</span> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Для того, чтобы произвести вызов формы с нужным нам списком при нажатии правой кнопки мыши по ячейке листа Excel, необходимо в объект </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">reestr</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> (лист с реестром) добавить следующий код:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Private Sub</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> Worksheet_BeforeRightClick(</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ByVal</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> Target </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As Range</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, Cancel </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As Boolean</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">)<br />'вызов списка по щелчку ПКМ<br />  </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Select Case</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> Target.column<br />     Case 2: loadform Target, 1, Cancel<br />     Case 3: loadform Target, 2, Cancel<br />     Case 4: loadform Target, 3, Cancel<br />     Case 6: loadform Target, 4, Cancel<br />    '....<br />  </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End Select</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Private Sub</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> loadform(</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ByVal </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Target </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As Range</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, numList </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As Byte</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, Cancel </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">As Boolean</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">)<br />Cancel = True 'отключает показ контекста после закрытия формы</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">With</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> SelectList ' отправляем параметры форме, загружаем список и откр. форму</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />    .R = Target.Row<br />    .C = Target.column<br />    .numList = numList<br />    .LoadList<br />    .SearchText.SetFocus<br />    .SheetOut = reestr.Name<br />    .Show<br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;"> End With</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">End Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Процедура:</span><span style=" font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">loadform</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - загружает форму со списком, передает координаты ячейки, в которой произошел правый клик (глобальные переменные С и R) и вызывает процедуру </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">LoadList</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> для загрузки списка;</span> </li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Worksheet_BeforeRightClick</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - процедура, которая вызывается по событию нажатия ПКМ на листе. Собственно это наша ключевая процедура в которой происходит определение столбца, в котором необходимо использовать форму выбора из списка и задается номер загружаемого списка. Все это происходит в операторе </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Select Case</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.</span> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Логика работы!</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">В Target.column возвращается номер столбца, в котором произошел клик ПКМ. Этот номер ищется в списке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Select </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, если номер найден, то запускается процедура </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">loadform</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> с загрузкой соответствующего списка.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Например, Case 2: loadform Target, 1, Cancel, если кликнули ПКМ по второму столбцу </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">(Case 2)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, то вызываем процедуру </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">loadform</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, передаем ей координаты ячейки, которые находятся в </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Target</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, затем, указываем номер столбца списка (лист &quot;Списки&quot;), который необходимо загрузить.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Соответственно, для столбца в реестре:<br /> 2 загружаем список 1 (Месяц)<br /> 3 загружаем список 2 (Склад)<br /> 4 загружаем список 3 (НаимТовара)<br /> 6 загружаем список 4 (НаимКА)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">На другие столбцы реакции не произойдет, будет вызвано контекстное меню. Этот список можно сократить (достаточно убрать Case 2, 3 ..) или добавить.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Снимок работающего списка</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image13200.png" /><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Вот и все. Если возникли вопросы, пишите.<br /> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">П.С.: Данный вариант реализации списков отлично работает в Excel 2003-2007-2010</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; font-style:italic;">Прикрепленный файл:</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><a href="http://dfiles.ru/files/mtqyemr7g"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">lists_vba.zip</span></a><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">  </span></p></body></html>