<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<html>
<main>
        <h1>Интерполяция строк</h1>
        <p>Все хорошо знают об операторе форматирования в языке Python. В этой заметке приводятся малоизвестные приемы его использования.</p>
<p>В самом простом способе применения оператора форматирования его поведение аналогично функций *printf в C:</p>
<div class="prettyprint-wrap"><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><ol class="linenums"><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'Длина удава: %d попугаев и %d попугайское крылышко'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="lit">38</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></li><li class="L1"><span class="pun">Длина</span><span class="pln"> </span><span class="pun">удава:</span><span class="pln"> </span><span class="lit">38</span><span class="pln"> </span><span class="pun">попугаев</span><span class="pln"> </span><span class="pun">и</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">попугайское</span><span class="pln"> </span><span class="pun">крылышко</span></li></ol></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
<p>При использовании ‘%s’ или ‘%r’ объекты любого типа автоматически 
преобразуются к строке, как если бы к ним применялась функция str или 
repr соответственно:</p>
<div class="prettyprint-wrap"><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><ol class="linenums"><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'Длина удава: %s попугаев и %s попугайское крылышко'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="lit">38</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></li><li class="L1"><span class="pun">Длина</span><span class="pln"> </span><span class="pun">удава:</span><span class="pln"> </span><span class="lit">38</span><span class="pln"> </span><span class="pun">попугаев</span><span class="pln"> </span><span class="pun">и</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">попугайское</span><span class="pln"> </span><span class="pun">крылышко</span></li></ol></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
<p>Для длинных строк с большим количеством параметров удобнее ссылаться 
на значения по имени. Это позволит менять порядок следования значений в 
строке не меняя правый аргумент оператора форматирования:</p>
<div class="prettyprint-wrap"><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><ol class="linenums"><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> args </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="str">'parrots'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">38</span><span class="pun">,</span><span class="pln"> </span><span class="str">'wings'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">}</span></li><li class="L1"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'%(parrots)s попугаев и %(wings)s попугайское крылышко'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> args</span></li><li class="L2"><span class="lit">38</span><span class="pln"> </span><span class="pun">попугаев</span><span class="pln"> </span><span class="pun">и</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">попугайское</span><span class="pln"> </span><span class="pun">крылышко</span></li><li class="L3"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'%(wings)s крылышко в добавок к %(parrots)s попугаям'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> args</span></li><li class="L4"><span class="lit">1</span><span class="pln"> </span><span class="pun">крылышко</span><span class="pln"> </span><span class="pun">в</span><span class="pln"> </span><span class="pun">добавок</span><span class="pln"> </span><span class="pun">к</span><span class="pln"> </span><span class="lit">38</span><span class="pln"> </span><span class="pun">попугаям</span></li><li class="L5"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'%(wings)s крылышко не в счет'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> args</span></li><li class="L6"><span class="lit">1</span><span class="pln"> </span><span class="pun">крылышко</span><span class="pln"> </span><span class="pun">не</span><span class="pln"> </span><span class="pun">в</span><span class="pln"> </span><span class="pun">счет</span></li></ol></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
<p>Можно не составлять словарь самостоятельно, а использовать функцию globals, locals или vars:</p>
<div class="prettyprint-wrap"><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><ol class="linenums"><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'%(parrots)s попугаев и %(wings)s попугайское крылышко'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> vars</span><span class="pun">()</span></li><li class="L1"><span class="lit">38</span><span class="pln"> </span><span class="pun">попугаев</span><span class="pln"> </span><span class="pun">и</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">попугайское</span><span class="pln"> </span><span class="pun">крылышко</span></li></ol></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
<p>Однако и это не все, что можно делать с оператором форматирования. 
Тем, кто знаком с языком perl, обычно сильно не достает интерполяции 
строк с выражениями, записанными непосредственно в строке-шаблоне. 
Аналогичный эффект можно получить и в языке Python с помощью простого 
классом, имитирующего поведение словаря:</p>
<div class="a69fc18d" data-region="main-content" data-finished="true"><div class="group group-A"><div class="block block-174 type-custom "><div class="field field-528">
<ins class="adsbygoogle" style="display: block; text-align: center; height: 0px;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7264282846152864" data-ad-slot="1901069998" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display: inline-table; border: medium none; height: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 740px; background-color: transparent;"><ins id="aswift_0_anchor" style="display: block; border: medium none; height: 0px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 740px; background-color: transparent; overflow: hidden; opacity: 0;"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:740px;height:185px;" width="740" height="185" frameborder="0"></iframe></ins></ins></ins>
</div>
</div></div></div><div class="prettyprint-wrap"><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><ol class="linenums"><li class="L0"><span class="kwd">class</span><span class="pln"> </span><span class="typ">EvalDict</span><span class="pun">:</span></li><li class="L1"><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __getitem__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> key</span><span class="pun">):</span></li><li class="L2"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">eval</span><span class="pun">(</span><span class="pln">key</span><span class="pun">)</span></li></ol></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
<p>Использовать класс EvalDict можно аналогично функции vars:</p>
<div class="prettyprint-wrap"><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><ol class="linenums"><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> nums </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">38</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span></li><li class="L1"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'%(nums[0])s попугаев и %(nums[1])s крылышко'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="typ">EvalDict</span><span class="pun">()</span></li><li class="L2"><span class="lit">38</span><span class="pln"> </span><span class="pun">попугаев</span><span class="pln"> </span><span class="pun">и</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">крылышко</span></li></ol></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
<p>Приведенный класс EvalDict обладает двумя недостатками. Во-первых, он
 ищет значения переменных только в глобальном пространстве имен модуля, в
 котором он определен. Во-вторых, он не будет обрабатывать вложенные 
выражения. Исправим эти недостатки.</p>
<div class="prettyprint-wrap"><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><ol class="linenums"><li class="L0"><span class="kwd">import</span><span class="pln"> sys</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="kwd">class</span><span class="pln"> </span><span class="typ">EvalDict</span><span class="pun">:</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __init__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> globals</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">,</span><span class="pln"> locals</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">):</span></li><li class="L5"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> globals </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span></li><li class="L6"><span class="pln">            globals </span><span class="pun">=</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">_getframe</span><span class="pun">(</span><span class="lit">1</span><span class="pun">).</span><span class="pln">f_globals</span></li><li class="L7"><span class="pln">        </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">globals </span><span class="pun">=</span><span class="pln"> globals</span></li><li class="L8"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> locals </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span></li><li class="L9"><span class="pln">            locals </span><span class="pun">=</span><span class="pln"> sys</span><span class="pun">.</span><span class="pln">_getframe</span><span class="pun">(</span><span class="lit">1</span><span class="pun">).</span><span class="pln">f_locals</span></li><li class="L0"><span class="pln">        </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">locals </span><span class="pun">=</span><span class="pln"> locals</span></li><li class="L1"><span class="pln"> </span></li><li class="L2"><span class="pln">    </span><span class="kwd">def</span><span class="pln"> __getitem__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> key</span><span class="pun">):</span></li><li class="L3"><span class="pln">        key </span><span class="pun">=</span><span class="pln"> key </span><span class="pun">%</span><span class="pln"> </span><span class="kwd">self</span></li><li class="L4"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">eval</span><span class="pun">(</span><span class="pln">key</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">globals</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">locals</span><span class="pun">)</span></li></ol></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
<p>Теперь определение класса можно спокойно вынести в отдельный модуль и использовать вложенные выражения:</p>
<div class="prettyprint-wrap"><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><ol class="linenums"><li class="L0"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> nums </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">38</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span></li><li class="L1"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> units </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'попугаев'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'крылышко'</span><span class="pun">]</span></li><li class="L2"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span></li><li class="L3"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'%(nums[index])d %(units[index])s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="typ">EvalDict</span><span class="pun">()</span></li><li class="L4"><span class="lit">38</span><span class="pln"> </span><span class="pun">попугаев</span></li><li class="L5"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></li><li class="L6"><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'%(nums[index])d %(units[index))s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="typ">EvalDict</span><span class="pun">()</span></li><li class="L7"><span class="lit">1</span><span class="pln"> </span><span class="pun">крылышко</span></li></ol></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
    </main>
</body>
</html></p></body></html>