<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Массовая замена слов </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Предположим, что нам необходимо заменить все &quot;ул.&quot; на листе на &quot;улица &quot;. Или русское слово &quot;дом&quot; на английское &quot;house&quot;. Или еще интереснее: все английские буквы на русские. Например, английская &quot;а&quot; должна быть заменена на русскую &quot;a&quot;, английская &quot;c&quot; на русскую &quot;с&quot;, английская &quot;H&quot; на русскую &quot;Н&quot; и т.д. А такое тоже нередко бывает и доставляет проблемы. Ведь если в одной таблице будут русские буквы, а в другой английские - то применение большинства встроенных функций поиска(та же </span><a href="http://www.excel-vba.ru/chto-umeet-excel/kak-najti-znachenie-v-drugoj-tablice-ili-sila-vpr/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">ВПР</span></a><span style=" font-size:8.25pt;">) просто не найдут соответствия.<br />Если подобную замену надо сделать для одного сочетания, то все просто: жмем </span><span style=" font-size:8.25pt; font-weight:600;">Ctrl</span><span style=" font-size:8.25pt;">+</span><span style=" font-size:8.25pt; font-weight:600;">H</span><span style=" font-size:8.25pt;"> и указываем что заменить и на что. Но если таких замен надо сделать 20? Или 120? Это надо будет 120 раз нажать и ввести что заменять и на что. А если это надо сделать еще и не в одном документе - то...Думаю сами справитесь с умножением количества замен на количество файлов, в которых это надо сделать. И вроде бы простая операция превращается в ваш личный ад на работе.<br />Недавно на форуме участнику потребовалось автоматизировать именно такую штуку. Т.к. код несложный - решил написать и чуть дополнив выложить для всех кому код может потребоваться: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce75304a5f344223884"></a><span style=" font-size:8.25pt;">O</span><span style=" font-size:8.25pt;">ption Explicit Sub Replace_Mass() Dim s As String Dim lCol As Long Dim avArr, lr As Long Dim lLastR As Long Dim lToFindCol As Long, lToReplaceCol As Long, lLookAt As Long 'запрашиваем направление перевода - с русского на англ. или наоборот lCol = Val(InputBox(&quot;Укажите направление перевода:&quot; &amp; vbNewLine &amp; _ &quot; 1 - ru-en&quot; &amp; vbNewLine &amp; _ &quot; 2 - en-ru&quot;, &quot;Запрос&quot;, 1)) If lCol = 0 Then Exit Sub 'запрашиваем по части ячейки искать или по всему тексту 'по умолчанию - по части lLookAt = Val(InputBox(&quot;Искать соответствие по части ячейки или по всему тексту:&quot; &amp; vbNewLine &amp; _ &quot; 1 - по всему тексту&quot; &amp; vbNewLine &amp; _ &quot; 2 - по части ячейки&quot;, &quot;Запрос&quot;, 2)) If lLookAt = 0 Then Exit Sub Select Case lCol Case 1 lToFindCol = 1 lToReplaceCol = 2 Case 2 lToFindCol = 2 lToReplaceCol = 1 End Select Application.ScreenUpdating = 0 'Получаем с листа Соответствия значения, которые надо заменить в выделенном диапазоне With ThisWorkbook.Sheets(&quot;Соответствия&quot;) lLastR = .Cells(.Rows.Count, 1).End(xlUp).Row avArr = .Cells(1, 1).Resize(lLastR, 2) End With 'заменяем For lr = 1 To UBound(avArr, 1) s = avArr(lr, lToFindCol) If Len(s) Then 'если значение для замены не пустое Selection.Replace s, avArr(lr, lToReplaceCol), lLookAt End If Next lr Application.ScreenUpdating = 1 End Sub </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><span style=" font-size:8.25pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">9</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">12</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">14</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">15</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">17</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">18</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">19</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">20</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">21</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">22</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">23</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">24</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">25</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">26</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">27</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">28</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">29</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">30</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">31</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">32</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">33</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">34</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">35</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">36</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">37</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">38</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">39</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">40</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">41</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">42</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">43</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">44 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce75304a5f344223884-1"></a><span style=" font-size:8.25pt;">O</span><span style=" font-size:8.25pt;">ption Explicit</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-2"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ub Replace_Mass()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-3"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim s As String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-4"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim lCol As Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-5"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim avArr, lr As Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-6"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim lLastR As Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-7"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim lToFindCol As Long, lToReplaceCol As Long, lLookAt As Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-8"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-9"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   'запрашиваем направление перевода - с русского на англ. или наоборот</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-10"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   lCol = Val(InputBox(&quot;Укажите направление перевода:&quot; &amp; vbNewLine &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-11"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                   &quot;   1 - ru-en&quot; &amp; vbNewLine &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-12"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                   &quot;   2 - en-ru&quot;, &quot;Запрос&quot;, 1))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-13"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   If lCol = 0 Then Exit Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-14"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   'запрашиваем по части ячейки искать или по всему тексту</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-15"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   'по умолчанию - по части</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-16"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   lLookAt = Val(InputBox(&quot;Искать соответствие по части ячейки или по всему тексту:&quot; &amp; vbNewLine &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-17"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                   &quot;   1 - по всему тексту&quot; &amp; vbNewLine &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-18"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                   &quot;   2 - по части ячейки&quot;, &quot;Запрос&quot;, 2))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-19"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   If lLookAt = 0 Then Exit Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-20"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-21"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Select Case lCol</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-22"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Case 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-23"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       lToFindCol = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-24"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       lToReplaceCol = 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-25"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Case 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-26"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       lToFindCol = 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-27"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       lToReplaceCol = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-28"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   End Select</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-29"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-30"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Application.ScreenUpdating = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-31"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   'Получаем с листа Соответствия значения, которые надо заменить в выделенном диапазоне</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-32"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   With ThisWorkbook.Sheets(&quot;Соответствия&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-33"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       lLastR = .Cells(.Rows.Count, 1).End(xlUp).Row</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-34"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       avArr = .Cells(1, 1).Resize(lLastR, 2)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-35"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   End With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-36"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   'заменяем</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-37"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   For lr = 1 To UBound(avArr, 1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-38"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       s = avArr(lr, lToFindCol)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-39"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       If Len(s) Then 'если значение для замены не пустое</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-40"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">           Selection.Replace s, avArr(lr, lToReplaceCol), lLookAt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-41"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-42"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Next lr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-43"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Application.ScreenUpdating = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce75304a5f344223884-44"></a><span style=" font-size:8.25pt;">E</span><span style=" font-size:8.25pt;">nd Sub</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Как это работает. В книге есть специальный лист с именем &quot;Соответствия&quot;. На нем в столбце А записаны слова, которые необходимо заменить, а в столбце В - на что эти слова заменить. Если в столбце А пусто - то замена не будет произведена. Если в столбце В пусто - то значение из столбца А будет просто удалено.<br />Замены производятся исключительно в выделенных на листе ячейках. Ячейки могут быть несмежными.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Итак, необходимо сделать много замен. Скачиваете файл:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image6415.png" /><span style=" font-size:8.25pt;">  </span><a href="http://www.excel-vba.ru/download/114/"><span style=" font-size:8.25pt; font-weight:600; text-decoration: underline; color:#0000ff;">Массовая замена слов</span></a><span style=" font-size:8.25pt;"> (54,5 KiB, 3 026 скачиваний)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"><br /></span><span style=" font-size:8.25pt; font-weight:600;">Примечание:</span><span style=" font-size:8.25pt;"> Я сделал файл как переводчик. Т.е. в первом столбце русские слова, во втором английские. Но в столбцах может быть что угодно - хоть слова, хоть символы, хоть числа.<br />На лист &quot;Соответствия&quot; записываете в столбец А - что заменять, в столбец В - на что заменять. Переходите на лист книги, в котором необходимо произвести замену. Выделяете ячейки, значения в которых надо найти и заменить. После чего жмете </span><span style=" font-size:8.25pt; font-weight:600;">Alt</span><span style=" font-size:8.25pt;">+</span><span style=" font-size:8.25pt; font-weight:600;">F8</span><span style=" font-size:8.25pt;"> и выбираете макрос &quot;Tips_Macro_ReplaceMASS.xls!Replace_Mass&quot;(или просто &quot;Replace_Mass&quot;, если код в той же книге, что и ячейки для поиска и замены).<br />Первым появится окно с запросом направления перевода. По умолчанию 1(ru-en). Т.е. будет браться слово из столбца А и заменяться словом из столбца В. Но если указать 2 - то будет браться слово из столбца В и заменяться словом из столбца А. Т.е. аналог переводчика - с рус. на англ. и наоборот. Либо из А в В, либо из В в А.<br />Вторым появится запрос на метод просмотра данных:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">если указать &quot;1 - по всему тексту&quot; - данные из столбца А будут заменять только в том случае, если ячейка в выделенном для замены диапазоне полностью совпадает со значением из столбца А листа &quot;Соответствия&quot;. Например, в любой из выделенных ячеек записано &quot;На столе книга&quot;, а на листе &quot;Соответствия&quot; в столбце А есть только слово &quot;книга&quot;. Замена не будет произведена, т.к. необходимо, чтобы в столбце А было так же &quot;На столе книга&quot;.</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">если указать &quot;2 - по части ячейки&quot; - данные из столбца А будут заменять в случае, если ячейка в выделенном для замены диапазоне содержит любое слово из столбца А листа &quot;Соответствия&quot;. На том же примере - &quot;На столе книга&quot;. Если выбрать 2, то в тексте &quot;На столе книга&quot; слово книга будет заменено на слово из столбца В - &quot;book&quot;.</li></ul>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">И еще один практический пример чуть модифицированного кода. Предположим, имеется таблица выручки по реализации продукции:<br /></span><img src="image3081.png" /><span style=" font-size:8.25pt;"><br />Как видно, здесь присутствую только номера статей, но нет их расшифровки. Зато расшифровка есть в отдельном листе &quot;Справочник&quot;:<br /></span><img src="image6301.png" /><span style=" font-size:8.25pt;"><br />Как видно, в справочнике присутствуют нужные номера статей и можно было бы применить ту же </span><a href="http://www.excel-vba.ru/chto-umeet-excel/kak-najti-znachenie-v-drugoj-tablice-ili-sila-vpr/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">ВПР(VLOOKUP)</span></a><span style=" font-size:8.25pt;"> для замен. Если бы не одно но: в таблице по реализации помимо номеров статьей есть еще лишний текст &quot;Статья затрат:&quot;. Конечно, можно сначала заменить этот текст, потом в отдельном столбце применить ВПР, </span><a href="http://www.excel-vba.ru/chto-umeet-excel/kak-udalit-v-yachejke-formulu-ostaviv-znacheniya/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">заменить формулу значениями</span></a><span style=" font-size:8.25pt;"> и вернуть в исходный столбец. Если при этом надо еще оставить текст &quot;Статья затрат:&quot;, то надо будет сделать еще доп.манипуляции либо при составлении формулы, либо после. В любом случае - слишком много лишних телодвижений. А значит бОльшие времязатраты.<br />Приложенный ниже файл поможет сделать это в разы быстрее:<br />Скачать файл с примером и кодом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image6415.png" /><span style=" font-size:8.25pt;">  </span><a href="http://www.excel-vba.ru/download/263/"><span style=" font-size:8.25pt; font-weight:600; text-decoration: underline; color:#0000ff;">Массовая замена слов - статьи.xls</span></a><span style=" font-size:8.25pt;"> (91,5 KiB, 350 скачиваний)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"><br />и в итоге за пару секунд получим следующий результат:<br /></span><img src="image24393.png" /><span style=" font-size:8.25pt;"><br />Достаточно выделить столбец со статьями на листе с реализацией и запустить код(либо нажатием кнопки заменить значения, либо нажав </span><span style=" font-size:8.25pt; font-weight:600;">Alt</span><span style=" font-size:8.25pt;">+</span><span style=" font-size:8.25pt; font-weight:600;">F8</span><span style=" font-size:8.25pt;"> и выбрав из списка макросов макрос Replace_Mass).<br />После нажатия на кнопку будут запрошены следующие параметры:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">указать номер столбца значений в листе &quot;Справочник&quot;, в котором искать соответствия номерам статей(в нашем случае это столбец 1(А))</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">указать номер столбца, значениями которого заменять найденные в таблице реализации значения(это может быть один из трех столбцов справочника: Группа затрат, Статья затрат, Подстатьи затрат). Логичнее всего указать столбец 4, т.к. он наиболее детализирован и конкретнее указывает расшифровку статьи</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">далее будет предложено указать точность поиска: </li></ol>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">если указать &quot;1 - по всему тексту&quot; - данные будут заменены только в том случае, если значение ячейки в выделенном для замены диапазоне полностью совпадает со значением из столбца А листа &quot;Справочник&quot;. Т.е. если бы у нас в таблице реализации был бы записан только номер статьи(1.01), тогда можно было бы указать именно 1</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">если указать &quot;2 - по части ячейки&quot; - данные будут заменены только в том случае, если значение ячейки в выделенном для замены диапазоне содержит любое значение из столбца А листа &quot;Справочник&quot;. Это больше подходит к описанному случаю, т.к. нам необходимо заменить исключительно номер статьей на их расшифровку, оставив при этом текст &quot;Статья затрат: &quot;</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Если все указано корректно, то на листе будут произведены все необходимые замены.<br />Возможные ошибки, которые предусмотрены кодом и о которых будет сообщено соответствующим сообщением(код прервется, замены не будут произведены):</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">на листе Справочник нет значений</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в качестве столбца для поиска значений и для замены значений на листе Справочник указано одно и то же число</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в качестве столбца значений для замены указано число, превышающее общее количество столбцов на листе Справочник</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Особое внимание хочу уделить случаю, когда выбирается замена по части ячейки. В этом случае лучше список на листе </span><span style=" font-size:8.25pt; font-weight:600;">Справочник</span><span style=" font-size:8.25pt;"> отсортировать по длине текста по тому столбцу, в котором будут значения для поиска. Зачем это надо: т.к. значение по части ячейки будет заменять не полное соответствие, то есть вероятность неверных замен. Например, есть текст &quot;Статья затрат: 1.011&quot;. В то же время на листе Справочник есть статьи &quot;1.01&quot; и &quot;1.011&quot;. Т.к. &quot;1.01&quot; идет раньше в большинстве случаев, то текст будет заменен некорректно: &quot;Статья затрат: ТВ</span><span style=" font-size:8.25pt; font-weight:600;">1</span><span style=" font-size:8.25pt;">&quot;.<br />Чтобы получить длину строки текста можно использовать функцию ДЛСТР(LEN):<br />=ДЛСТР(A2)<br />=LEN(A2)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">В отличие от кода, приведенного в начале статьи, код во втором файле позволяет производить замену не только на основании двух столбцов, но и ориентируясь на таблицу данных, как видно из реализации. Можно выбрать любой столбец Справочника для поиска значений и так же любой для замены, что предоставляет большую гибкость по замене значений.</span></p></body></html>