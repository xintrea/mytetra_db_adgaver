<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Получить текст из буфера обмена</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GetFromClipBoard <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;htmlfile&quot;</span><span style=" color:#000000;">).ParentWindow.ClipboardData.GetData(</span><span style=" color:#a52a2a;">&quot;text&quot;</span><span style=" color:#000000;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Скопировать текст в буфер обмена</span> (используется временный файл HTA)<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">Sub</span> CopyToClipBoard<span style=" color:#000000;">(</span>Data<span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Const</span> QT <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;&quot;&quot;&quot;</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> oShell: <span style=" font-weight:600; color:#0000ff;">set</span> oShell <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;WScript.Shell&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> oFSO:   <span style=" font-weight:600; color:#0000ff;">set</span> oFSO   <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;Scripting.FileSystemObject&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> cur:  cur <span style=" color:#000000;">=</span> oFSO<span style=" color:#000000;">.GetParentFolderName(</span>WScript<span style=" color:#000000;">.ScriptFullName)</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> BuferServer: BuferServer <span style=" color:#000000;">=</span> oFSO<span style=" color:#000000;">.BuildPath(</span>cur, <span style=" color:#a52a2a;">&quot;SetClipBoard.hta&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">if</span> <span style=" font-weight:600; color:#0000ff;">not</span> oFSO<span style=" color:#000000;">.FileExists(</span>BuferServer<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">then</span><br />        <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">resume</span> <span style=" font-weight:600; color:#0000ff;">next</span><br />        <span style=" font-weight:600; color:#0000ff;">Dim</span> oTS: <span style=" font-weight:600; color:#0000ff;">set</span> oTS <span style=" color:#000000;">=</span> oFSO<span style=" color:#000000;">.OpenTextFile(</span>BuferServer,<span style=" color:#a52a2a;">2</span>,<span style=" font-weight:600; color:#0000ff;">true</span><span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">if</span> Err<span style=" color:#000000;">.Number</span> <span style=" color:#000000;">&lt;&gt;</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">then</span> <span style=" font-style:italic; color:#008000;">' не хватает прав для распаковки ресурса в папку со скриптом - распаковую в папку %temp%</span><br />            Err<span style=" color:#000000;">.Clear</span><br />            <span style=" font-weight:600; color:#0000ff;">Dim</span> temp: temp <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.ExpandEnvironmentStrings(</span><span style=" color:#a52a2a;">&quot;%temp%&quot;</span><span style=" color:#000000;">)</span><br />            BuferServer <span style=" color:#000000;">=</span> oFSO<span style=" color:#000000;">.BuildPath(</span>temp, <span style=" color:#a52a2a;">&quot;SetClipBoard.hta&quot;</span><span style=" color:#000000;">)</span><br />            <span style=" font-weight:600; color:#0000ff;">set</span> oTS <span style=" color:#000000;">=</span> oFSO<span style=" color:#000000;">.OpenTextFile(</span>BuferServer,<span style=" color:#a52a2a;">2</span>,<span style=" font-weight:600; color:#0000ff;">true</span><span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">end</span> <span style=" font-weight:600; color:#0000ff;">if</span><br />        oTS<span style=" color:#000000;">.WriteLine</span> <span style=" color:#a52a2a;">&quot;&lt;html&gt;&lt;head&gt;&lt;HTA:APPLICATION ID=&quot;&quot;objHTA&quot;&quot; WindowState=&quot;&quot;minimize&quot;&quot; ShowInTaskbar=&quot;&quot;yes&quot;&quot;/&gt;&lt;/head&gt;&quot;</span><br />        oTS<span style=" color:#000000;">.WriteLine</span> <span style=" color:#a52a2a;">&quot;&lt;script language=&quot;&quot;VBScript&quot;&quot;&gt;Sub Window_onLoad(): comm = objHTA.CommandLine&quot;</span><br />        oTS<span style=" color:#000000;">.WriteLine</span> <span style=" color:#a52a2a;">&quot;document.parentwindow.clipboardData.SetData &quot;&quot;text&quot;&quot;, mid(comm, instr(2, comm, chr(34)) + 2)&quot;</span><br />        oTS<span style=" color:#000000;">.WriteLine</span> <span style=" color:#a52a2a;">&quot;window.close(): End Sub &lt;/script&gt;&lt;/html&gt;&quot;</span><br />        oTS<span style=" color:#000000;">.Close</span>: <span style=" font-weight:600; color:#0000ff;">set</span> oTS <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span><br />        <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">goto</span> <span style=" color:#a52a2a;">0</span><br />    <span style=" font-weight:600; color:#0000ff;">end</span> <span style=" font-weight:600; color:#0000ff;">if</span><br />    <span style=" font-weight:600; color:#0000ff;">if</span> oFSO<span style=" color:#000000;">.FileExists(</span>BuferServer<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">then</span><br />        <span style=" font-weight:600; color:#0000ff;">Dim</span> windir: windir <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.ExpandEnvironmentStrings(</span><span style=" color:#a52a2a;">&quot;%windir%&quot;</span><span style=" color:#000000;">)</span> <span style=" font-style:italic; color:#008000;">'Получаем путь к серверу HTA</span><br />        oShell<span style=" color:#000000;">.Run</span> windir <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\system32\mshta.exe &quot;</span> <span style=" color:#000000;">&amp;</span> QT <span style=" color:#000000;">&amp;</span> BuferServer <span style=" color:#000000;">&amp;</span> QT <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot; &quot;</span> <span style=" color:#000000;">&amp;</span> QT <span style=" color:#000000;">&amp;</span> Data <span style=" color:#000000;">&amp;</span> QT, <span style=" color:#a52a2a;">0</span>, <span style=" font-weight:600; color:#0000ff;">false</span><br />    <span style=" font-weight:600; color:#0000ff;">end</span> <span style=" font-weight:600; color:#0000ff;">if</span><br />    <span style=" font-weight:600; color:#0000ff;">Set</span> oFSO <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span>: <span style=" font-weight:600; color:#0000ff;">set</span> oShell <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Упрощенный вариант:<br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">Sub</span> CopyToClipBoard<span style=" color:#000000;">(</span>Data<span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> oShell: <span style=" font-weight:600; color:#0000ff;">set</span> oShell <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;WScript.Shell&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> mshta: mshta <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.ExpandEnvironmentStrings(</span><span style=" color:#a52a2a;">&quot;%windir%&quot;</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\system32\mshta.exe&quot;</span> <span style=" font-style:italic; color:#008000;">'Получаем путь к серверу HTA</span><br />    oShell<span style=" color:#000000;">.Run</span> mshta <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot; &quot;&quot;vbscript:document.parentwindow.clipboardData.SetData(&quot;&quot;text&quot;&quot;,replace(&quot;&quot;&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=REPLACE+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">replace</span></a><span style=" color:#000000;">(</span>Data,<span style=" color:#a52a2a;">&quot; &quot;</span>,<span style=" color:#a52a2a;">&quot;$#@!~%&quot;</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;&quot;&quot;,&quot;&quot;$#@!~%&quot;&quot;,chr(32)))&amp;close()&quot;&quot;&quot;</span>,<span style=" color:#a52a2a;">0</span>,<span style=" font-weight:600; color:#0000ff;">false</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>