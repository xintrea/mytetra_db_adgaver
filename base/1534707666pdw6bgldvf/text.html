<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Top"></a><span style=" font-size:8.25pt; font-weight:600;">M</span><span style=" font-size:8.25pt; font-weight:600;">icrosoft Acces. Советы для пользователей</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Автор </span><a href="http://allenbrowne.com/who-am-i.html"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Allen Browne</span></a><span style=" font-size:8.25pt;">, ноябрь 2003 г. Обновление апрель 2010 г.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Перевод с английского </span><a href="mailto:alx.artamonov@yandex.ru"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Александр Артамонов</span></a><span style=" font-size:8.25pt;">, октябрь 2011 г.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Оригинал </span><a href="http://allenbrowne.com/casu-14.html"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">http://allenbrowne.com/casu-14.html</span></a></p>
<hr />
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Вычисляемые поля</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Как заставить Аксесс хранить результат вычислений?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Например, если у вас есть поля </span><span style=" font-size:8.25pt; font-style:italic;">Количество</span><span style=" font-size:8.25pt;"> и </span><span style=" font-size:8.25pt; font-style:italic;">ЦенаЗаЕдиницу</span><span style=" font-size:8.25pt;">, как заставить Аксесс записать </span><span style=" font-size:8.25pt; font-style:italic;">Количество * ЦенаЗаЕдиницу</span><span style=" font-size:8.25pt;"> в поле </span><span style=" font-size:8.25pt; font-style:italic;">Стоимость</span><span style=" font-size:8.25pt;">?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Лучший ответ: &quot;Не делайте этого!&quot;</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Место вычисляемых полей ― в запросах, а не в таблицах.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Вычисляемые столбцы являются неотъемлемой частью электронных таблиц типа Excel и ему подобных, но им не место в таблице базы данных. Никогда не храните значение, которое зависит от других полей: это базовое правило нормализации. Нарушьте это правило ― и сразу появится забота, как поддерживать корректность вычисления во всех возможных ситуациях.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Спросите себя: </span><span style=" font-size:8.25pt; font-weight:600;">&quot;Если в этом поле окажется значение, отличное от вычисленного, будет ли это ошибкой?&quot;</span><span style=" font-size:8.25pt;"> Если ответ «Да», вам не стоит заводить это поле. Если разница будет нести определенный смысл, тогда вам это поле действительно нужно.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Итак, как же получить вычисленное поле, если его нельзя хранить в таблице? Используйте запрос:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создайте запрос, основанный на этой таблице.</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Запишите выражение в строке конструктора запроса:<br /><span style=" font-family:'Courier New';">    Стоимость: [Количество] * [ЦенаЗаЕдиницу]</span></li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Это создаст поле с именем </span><span style=" font-size:8.25pt; font-style:italic;">Стоимость</span><span style=" font-size:8.25pt;">. Любая форма или отчет, основанные на этом запросе, воспримут это вычисленное поле как любое другое, так что вы легко сможете просуммировать результат. Это просто, эффективно и надежно.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Ну... Почти надежно. Остается вероятность </span><a href="http://allenbrowne.com/ser-45.html"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">неверной интерпретации вычисляемых полей</span></a><span style=" font-size:8.25pt;">.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Вы все еще хотите хранить вычисляемые поля?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Есть обстоятельства, когда хранение вычисленного результата имеет смысл ― типичный случай, когда нужна возможность иногда хранить отличное от вычисленного значение.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Скажем, плата за монтаж составляет дополнительные 10%, но чтобы выиграть тендер вы хотите отменить эту плату. Вычисляемое поле не сработает. В этом случае вполне разумно иметь запись с платой 0% вместо 10%, так что вам придется хранить это как поле в таблице.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Чтобы получить это, используйте событие AfterUpdate контрола на вашей форме, чтобы автоматически посчитать плату:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выставьте значение свойства <span style=" font-style:italic;">AfterUpdate</span> текстового поля <span style=" font-style:italic;">Количество</span> на <span style=" font-family:'Courier';">[Обработка события]</span>.</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нажмите кнопку построителя (...). Аксесс откроет окно редактора кода</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Введите эту строку между строками <span style=" font-style:italic;">Private Sub...</span> и <span style=" font-style:italic;">End Sub</span>:<br /></li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Private Sub Количество_AfterUpdate()<br />          Me.Плата = Round(Me.Количество * Me.ЦенаЗаЕдиницу * 0.1, 2)   <br />End Sub  </span></p>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Установите свойство <span style=" font-style:italic;">After Update</span> текстового поля <span style=" font-style:italic;">ЦенаЗаЕдиницу</span> на <span style=" font-family:'Courier';">[Обработка события]</span>, и нажмите кнопку построителя.</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Введите следующую строчку:</li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Private Sub ЦенаЗаЕдиницу_AfterUpdate()<br />          Call Количество_AfterUpdate    <br />End Sub  </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Теперь, каждый раз, когда меняется </span><span style=" font-size:8.25pt; font-style:italic;">Количество</span><span style=" font-size:8.25pt;"> или </span><span style=" font-size:8.25pt; font-style:italic;">ЦенаЗаЕдиницу</span><span style=" font-size:8.25pt;">, Аксесс автоматически пересчитает новую плату, но пользователь может перезаписать вычисление и ввести другое число, если потребуется.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Если у вас возник вопрос, как бы помочь пользователю с вычислением с помощью описанного приема, см. </span><a href="http://allenbrowne.com/TechniqueEnterCalcText.html"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Enter text in calculated controls</span></a><span style=" font-size:8.25pt;">.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="CalcTableField"></a><span style=" font-size:8.25pt; font-weight:600;">А</span><span style=" font-size:8.25pt; font-weight:600;"> как насчет вычисляемых полей в Аксессе 2010?</span></p>
<p style=" margin-top:12px; margin-bottom:5px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Аксесс 2010 позволяет создать вычисляемое поле в таблице вот таким образом:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image203.png" /><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Просто выберите «Вычисляемый» из типов данных и ниже появится строка «Выражение». Впишите выражение. Аксесс будет пересчитывать его каждый раз, когда вы вводите запись.</span></p>
<p style=" margin-top:12px; margin-bottom:5px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Это может показаться простым решением, но оно создает больше проблем, чем решает. Вы быстро столкнетесь с тем, что выражения весьма ограничены. Также это сделает базу данных бесполезной для тех, кто будет использовать ее в Аксессе 2007. Вместо того, чтобы прочитать данные, они увидят вот такое сообщение:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image6176.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Хуже того, результаты вычислений ненадежны. Если вы поменяете формулу выражения после того, как данные были внесены в таблицу, существующие результаты не будут правильно обновлены (хотя для новых записей редактирование обновит результаты). Так что на результаты вычислений полагаться нельзя. Сжатие/восстановление не производит пересчет, так что нет очевидного пути исправить неверные результаты.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Поскольку нельзя проиндексировать вычисляемые поля, вы не получите выигрыша в производительности, используя их. Вы нарушите фундаментальное правило нормализации, не получив ничего взамен. Мы рекомендуем использовать запросы для вычисляемых полей ― как и в предыдущих версиях.</span></p></body></html>