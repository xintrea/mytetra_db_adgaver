<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Как запускать запросы из VBA</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Опубликовано: 28 янв 05<br />Рейтинг: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.addthis.com/bookmark.php?v=250&amp;username=xa-4cb75b821386eec8"><span style=" text-decoration: underline; color:#0000ff;">Добавить в закладки и поделиться</span></a> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a href="http://www.sql.ru/faq/faq_topic.aspx?fid=410#add-comment"><span style=" text-decoration: underline; color:#0000ff;">Оценить и прокомменитировать</span></a><br /><a href="http://www.sql.ru/faq/faq_topic.aspx?fid=410#"><span style=" text-decoration: underline; color:#0000ff;">Распечатать статью</span></a><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Автор: Sfagnum, участники форума по Аксессу<br />Прислал: Владимир Саныч </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">1. Вопросы.</span><br />1.1. <span style=" color:#ff0000;">Как отключить подтверждения?</span><br />1.2. <span style=" color:#000080;">Execute</span> либо <span style=" color:#000080;">OpenRecordset</span> выдаёт ошибку <span style=" color:#ff0000;">&quot;слишком мало параметров&quot;</span>, что делать?<br />1.3. Как правильно использовать <span style=" color:#000080;">DoCmd.RunSQL</span>?<br />1.4. Почему нельзя использовать конструкцию <span style=" color:#000080;">Application.SetOption</span>?<br /><br /><span style=" font-weight:600;">2. Ответы.</span><br />Прежде чем перейти к ответам, надо отметить, что запрос будет выполнять непосредственно <span style=" font-weight:600;">Jet</span> и что <span style=" color:#000080;">DoCmd.RunSQL</span> (<span style=" font-weight:600;">Access</span>), <span style=" color:#000080;">CurrentDb.Execute</span> (<span style=" font-weight:600;">DAO</span>), <span style=" color:#000080;">Connection.Execute</span> (<span style=" font-weight:600;">ADO</span>) являются не более чем интерфейсами к <span style=" font-weight:600;">Jet</span>.<br /><br /><span style=" font-style:italic; text-decoration: underline;">2.1. Методы отключения сообщений на подтверждение при запуске </span><span style=" font-weight:600; font-style:italic; text-decoration: underline;">Action Queries</span><span style=" font-style:italic; text-decoration: underline;">.</span><br />Подтверждения отключаются следующими способами (ответы перечислены в порядке применимости):<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#ff0000;">Перейти на использование конструкции</span> <span style=" color:#000080;">CurrentDb.Execute</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Использовать вместе с <span style=" color:#000080;">DoCmd.RunSQL</span>, <span style=" color:#000080;">DoCmd.SetWarnings False</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Изменить глобальные настройки с помощью конструкции<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Application.SetOption </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;Confirm Record Changes&quot;</span><span style=" font-family:'Courier New,courier';">, </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">False</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Application.SetOption </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;Confirm Document Deletions&quot;</span><span style=" font-family:'Courier New,courier';">, </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">False</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Application.SetOption </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;Confirm Action Queries&quot;</span><span style=" font-family:'Courier New,courier';">, </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">False</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">и т.п.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">NB!!!</span> (Категорически <span style=" font-weight:600;">НЕ</span> рекомендуется).<br /><br /><span style=" font-style:italic; text-decoration: underline;">2.2 Устранение ошибок в </span><span style=" font-style:italic; text-decoration: underline; color:#000080;">CurrentDb.Execute</span><span style=" font-style:italic; text-decoration: underline;"> и в </span><span style=" font-style:italic; text-decoration: underline; color:#000080;">CurrentDb.OpenRecordset</span><br />Ошибка, как правило, возникает со следующим текстом <span style=" font-weight:600;">&quot;Too few parameters. Expected Число&quot;</span> (&quot;Слишком мало параметров. Ожидалось Число&quot;). <br />Эта ошибка возникает, если команда или один из нижележащих запросов содержит обращения к формам или собственные параметры, - все эти обращения будут восприняты как параметры, которым не передано значение. <br />Почему так происходит? - Вот вольный перевод из MSDN (<a href="ms-help://MS.MSDNQTR.2003APR.1033/enu_kbacc2000kb/acc2000kb/209203.htm"><span style=" font-style:italic; text-decoration: underline; color:#0000ff;">ms-help://MS.MSDNQTR.2003APR.1033/enu_kbacc2000kb/acc2000kb/209203.htm</span></a>): <br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">MSDN</span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">NOTE</span>: В <span style=" font-weight:600;">DAO</span> Вы должны явно присвоить значение параметру. При использовании <span style=" color:#000080;">DoCmd.OpenQuery</span> Вы этого делать не должны, т.к. <span style=" font-weight:600;">DAO</span> использует операции низкого уровня, что даёт Вам большую свободу в использовании параметров (т.е. Вы можете сами присвоить параметру значение переменной, а не использовать ссылку на форму), но Вы должны выполнить служебные действия, которые Аксесс делает &quot;за кулисами&quot; при исполнении <span style=" color:#000080;">DoCmd</span>. С другой стороны, <span style=" color:#000080;">DoCmd</span> работает на более высоком уровне, чем <span style=" font-weight:600;">DAO</span>. Выполняя <span style=" color:#000080;">DoCmd</span>, Microsoft Access делает некоторые предположения о том, как поступить с параметрами, и не дает Вам никакой свободы в этом отношении.</p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если все параметры являются ссылками на контролы форм (<span style=" color:#000080;">Forms![ИмяФормы]![ИмяКонтрола]</span>), тогда самое простое (и красивое) решение:<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> q </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> DAO.QueryDef, p </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> DAO.Parameter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> q = CurrentDb.QueryDefs(</span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;ИмяЗапроса&quot;</span><span style=" font-family:'Courier New,courier';">) </span><span style=" font-family:'Courier New,courier'; color:#008000;">'как обычного запроса Select,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#008000;">'так и INSERT/UPDATE; в запросах на удаление это не помогает</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">For</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Each</span><span style=" font-family:'Courier New,courier';"> p </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">In</span><span style=" font-family:'Courier New,courier';"> q.Parameters</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    p.Value = Eval(p.Name)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  q.Execute</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  q.close: </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> q=</span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вместо обращений к формам Вы используете собственные параметры (например, [Введите начальную дату:]), тогда Вам нужно задать параметры вручную: <br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> q </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> DAO.QueryDef</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> q = CurrentDb.QueryDefs(</span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;ИмяЗапроса&quot;</span><span style=" font-family:'Courier New,courier';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  q.Parameters(</span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;[Введите начальную дату:]&quot;</span><span style=" font-family:'Courier New,courier';">).Value=</span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Cdate</span><span style=" font-family:'Courier New,courier';">(Ваше_значение_параметра)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">'и т.д. пока не переберете все параметры</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  q.Execute</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  q.close: </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">set</span><span style=" font-family:'Courier New,courier';"> q=</span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Узнать, какие параметры от Вас хочет Аксесс, можно с помощью следующего кода:<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> q </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> DAO.QueryDef, p </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> DAO.Parameter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> q = CurrentDb.QueryDefs(</span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;ИмяЗапроса&quot;</span><span style=" font-family:'Courier New,courier';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">For</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Each</span><span style=" font-family:'Courier New,courier';"> p </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">In</span><span style=" font-family:'Courier New,courier';"> q.Parameters</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    debug.print p.Name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  q.close: </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">set</span><span style=" font-family:'Courier New,courier';"> q=</span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Альтернативой может быть использование функций, которые будут брать значения либо напрямую из нужного контрола, либо из переменной. (Такая функция должна быть описана в стандартном модуле. В модуле формы можно пользоваться свойством без параметров, функцией без параметров либо публичной переменной, но на них надо ссылаться через форму и без скобок в конце.) Использование данного метода позволяет более широко контролировать подставляемое значение, а также позволяет избавиться от квадратных скобок, что иногда бывает критично. Пример: в модуле пишем функцию, которая получает значение из поля формы:<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Function</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#000000;">Rep_BegDate</span><span style=" font-family:'Courier New,courier'; color:#808080;">()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Rep_BegDate = Forms</span><span style=" font-family:'Courier New,courier'; color:#808080;">!</span><span style=" font-family:'Courier New,courier';">frmRep</span><span style=" font-family:'Courier New,courier'; color:#808080;">!</span><span style=" font-family:'Courier New,courier';">txtBegDate</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">End</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />и тогда в запросах и отчетах вместо<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">WHERE</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">...</span><span style=" font-family:'Courier New,courier';"> = Forms</span><span style=" font-family:'Courier New,courier'; color:#808080;">!</span><span style=" font-family:'Courier New,courier';">frmRep</span><span style=" font-family:'Courier New,courier'; color:#808080;">!</span><span style=" font-family:'Courier New,courier';">txtBegDate</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />пишем<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">WHERE</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">...</span><span style=" font-family:'Courier New,courier';"> = </span><span style=" font-family:'Courier New,courier'; color:#000000;">Rep_BegDate</span><span style=" font-family:'Courier New,courier'; color:#808080;">()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Обратите внимание на Rep_BegDate() со скобками.<br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Еще одной альтернативой является программное формирование команды SQL, в которой все значения параметров подставлены в явном виде. Подробнее см. здесь: <a href="http://www.sql.ru/faq/faq_topic.aspx?fid=157"><span style=" text-decoration: underline; color:#0000ff;">http://www.sql.ru/faq/faq_topic.aspx?fid=157</span></a><br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если аналогичное явление происходит не при <span style=" color:#000080;">CurrentDb.Execute</span>, а при <span style=" color:#000080;">CurrentDb.OpenRecordset</span>, то годятся все те же решения. При этом если параметры задаются вручную, то открывать рекордсет надо так:<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> rs = q.OpenRecordset(...)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#008000;">'а не Set rs = CurrentDb.OpenRecordset(&quot;ИмяЗапроса&quot;), ...)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В перекрестных запросах возникает то же явление. Правда, оно возникает не при попытке запуска (ибо перекрестный запрос не является Action Query), а при любом использовании, например при открывании формы, основанной на таком запросе. В этом случае надо действовать следующим образом:<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">PARAMETERS [Forms]![ИмяФормы]![ИмяКонтрола] </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Text</span><span style=" font-family:'Courier New,courier';">, ... ;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">WHERE</span><span style=" font-family:'Courier New,courier';"> ИмяТаблицы.ИмяПоля=[Forms]![ИмяФормы]![ИмяКонтрола] ... </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Примечание.</span> Везде в примерах, где сказано &quot;ИмяЗапроса&quot;, имеется в виду не обязательно имя сохраненного запроса, но также и команда SQL, которая нигде не сохранена.<br /><br /><span style=" font-style:italic; text-decoration: underline;">2.3 Устранение ошибок в </span><span style=" font-style:italic; text-decoration: underline; color:#000080;">Command.Execute</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если все параметры являются ссылками на контролы форм (<span style=" color:#000080;">Forms![ИмяФормы]![ИмяКонтрола]</span>), тогда самое простое (и красивое) решение: <br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> cmd </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Command</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> cnn </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> rs </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Recordset</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> p </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Parameter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cnn = CurrentProject.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#008000;">'или если не используете текущее соединение:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#008000;">'Set cnn = New adodb.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#008000;">'cnn.Open &quot;Cтрока подключения по аналогии с CurrentProject.BaseConnectionString&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cmd = </span><span style=" font-family:'Courier New,courier'; color:#8515ea;">New</span><span style=" font-family:'Courier New,courier';"> ADODB.Command</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">With</span><span style=" font-family:'Courier New,courier';"> cmd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .ActiveConnection = cnn</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .CommandText = </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;ИмяПроцедуры&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .CommandType = adCmdStoredProc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .NamedParameters = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'начиная с ADO версии 2.6 (???) без этого свойства работать не будет -</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'ADO будет заполнять коллекцию параметров не по имени, а по порядку</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">For</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Each</span><span style=" font-family:'Courier New,courier';"> p </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">In</span><span style=" font-family:'Courier New,courier';"> .Parameters</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'имена параметров равны именам контролов формы, только без @</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'Имя контрола NameFIO, тогда в процедуре @NameFIO. @- убираем с помощью Replace</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      p.Value = Eval(Forms(</span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;ИмяФормы&quot;</span><span style=" font-family:'Courier New,courier';">)(Replace(p.Name, </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;@&quot;</span><span style=" font-family:'Courier New,courier';">, </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;&quot;</span><span style=" font-family:'Courier New,courier';">, 1, 1, vbTextCompare)))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> rs = .Execute(, , adExecuteNoRecords)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'adExecuteNoRecords - можно и не указывать, если в процедуре стоит Set NoCount ON</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'или чтобы иметь возможность задать свойства rs (обновляемость, например):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'Set rs = New ADODB.Recordset</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'rs.CursorType = adOpenDynamic</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'rs.Open cmd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">End</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cmd = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  rs.Close: </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> rs = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  cnn.Close: </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cnn = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вместо обращений к формам Вы используете собственные параметры, тогда Вам нужно задать параметры вручную: <br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> cmd </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Command</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> cnn </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> rs </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Recordset</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cnn = CurrentProject.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cmd = </span><span style=" font-family:'Courier New,courier'; color:#8515ea;">New</span><span style=" font-family:'Courier New,courier';"> ADODB.Command</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">With</span><span style=" font-family:'Courier New,courier';"> cmd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .ActiveConnection = cnn</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .CommandText = </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;ИмяПроцедуры&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .CommandType = adCmdStoredProc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .NamedParameters = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'Cоздадим параметр nVarChar (500)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .Parameters.Append .CreateParameter(</span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;@имяПарматра1&quot;</span><span style=" font-family:'Courier New,courier';">, adVarWChar, adParamInput, 500, </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;Некая строка&quot;</span><span style=" font-family:'Courier New,courier';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'создадим параметр типа int (SQL) - Long (VBA)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .Parameters.Append .CreateParameter(</span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;@имяПараметра2&quot;</span><span style=" font-family:'Courier New,courier';">, adInteger, adParamInput, , </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">CLng</span><span style=" font-family:'Courier New,courier';">(111))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#008000;">'и т.д.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> rs = .Execute(, , adExecuteNoRecords)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">End</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cmd = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  rs.Close: </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> rs = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  cnn.Close: </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cnn = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Узнать, какие параметры от Вас хочет Аксесс, можно с помощью следующего кода:<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> cmd </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Command</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> cnn </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Dim</span><span style=" font-family:'Courier New,courier';"> p </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">As</span><span style=" font-family:'Courier New,courier';"> ADODB.Parameter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cnn = CurrentProject.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cmd = </span><span style=" font-family:'Courier New,courier'; color:#8515ea;">New</span><span style=" font-family:'Courier New,courier';"> ADODB.Command</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">With</span><span style=" font-family:'Courier New,courier';"> cmd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .ActiveConnection = cnn</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .CommandText = </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;ИмяПроцедуры&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    .CommandType = adCmdStoredProc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">For</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Each</span><span style=" font-family:'Courier New,courier';"> p </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">In</span><span style=" font-family:'Courier New,courier';"> .Parameters</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      Debug.Print p.Name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">End</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cmd = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  cnn.Close: </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Set</span><span style=" font-family:'Courier New,courier';"> cnn = </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /><span style=" font-style:italic; text-decoration: underline;">2.4. Использование </span><span style=" font-style:italic; text-decoration: underline; color:#000080;">DoCmd.RunSQL</span><span style=" font-style:italic; text-decoration: underline;">.</span><br />Иногда советуют поставить <span style=" color:#000080;">DoCmd.SetWarnings False </span>перед <span style=" color:#000080;">DoCmd.RunSQL</span>, но это крайне опасно. Это требует добавить <span style=" color:#000080;">DoCmd.SetWarnings True</span> где только можно, особенно в обработчиках ошибок. В противном случае Аксесс в какой-нибудь момент вообще перестанет выдавать предупреждения на удаление и т.п. (в том числе и предупреждения об ошибках) до конца работы программы. Также есть возможность, что в отладочный период Вы остановите выполнение кода <span style=" font-weight:600;">ДО</span> включения сообщений, что тоже повлечёт за собой выше описанный результат. Но если Вы решили использовать данную конструкцию, то используйте её следующим образом.<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">On</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Error</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Goto</span><span style=" font-family:'Courier New,courier';"> mis</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  DoCmd.SetWarnings </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">False</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  DoCmd.RunSQL ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  DoCmd.SetWarnings </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Exit</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  mis:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    DoCmd.SetWarnings </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">True</span><br /><br /><span style=" font-style:italic; text-decoration: underline;">2.5. Противопоказания к использованию конструкции </span><span style=" font-style:italic; text-decoration: underline; color:#000080;">Application.SetOption</span><br />Подтверждения исчезнут во всей аппликации насквозь, в том числе там, где это не планировалось. Это можно делать только в том случае, если соблюдены два условия: <br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пользователь лишен права на удаление тех объектов, которые нужны для нормальной работы программы, и его устраивает отсутствие подтверждений при удалении/редактировании данных через экран. <br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Подтверждения не отключаются, если в приложении работает сам разработчик.<br /><br /><span style=" font-style:italic; text-decoration: underline;">2.6. Возможность отката</span><br />Нередко возникает необходимость при возникновении ошибок отменить результат исполнения целого ряда запросов. <span style=" color:#000080;">DoCmd.RunSQL</span> такой возможности не дает. <span style=" color:#000080;">CurrentDb.Execute</span>, в отличие от него, позволяет откатить транзакцию, в которую включено то, что посчитает нужным программист. В <span style=" color:#000080;">CurrentDb.Execute</span> есть опция <span style=" font-style:italic;">dbFailOnError</span> - она относится только к выполнению конкретного запроса, т.е. отвечает только за то, будет ли запрос при ошибке откачен целиком и будет возвращена ошибка, или же возможно частичное выполнение запроса.<br /><span style=" font-style:italic;">Пример отката внешней транзакции:</span><br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">Public</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Function</span><span style=" font-family:'Courier New,courier';"> Test()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">On</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Error</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Goto</span><span style=" font-family:'Courier New,courier';"> Rollback_Label</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  DBEngine(0).BeginTrans</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    CurrentDb.Execute </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;Запрос1&quot;</span><span style=" font-family:'Courier New,courier';">, dbFailOnError</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    CurrentDb.Execute </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;Запрос2&quot;</span><span style=" font-family:'Courier New,courier';">, dbFailOnError</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    CurrentDb.Execute </span><span style=" font-family:'Courier New,courier'; color:#008080;">&quot;Запрос3&quot;</span><span style=" font-family:'Courier New,courier';">, dbFailOnError</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  DBEngine(0).CommitTrans</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Exit_Label:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Exit</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Rollback_Label:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  DBEngine(0).Rollback</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">  </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Resume</span><span style=" font-family:'Courier New,courier';"> Exit_Label</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">End</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />В данном случае если не выполнится хотя бы один запрос, то все запросы &quot;откатятся&quot;.</p></body></html>