<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рабочая программа используется на компах в офисе с разными мониторами. Задумал програмное определение разрешения монитора и &quot;подгонку&quot; под его размеры основной страницы книги.<br />В одной книжке нашел примерно следующее<br /><br /></p>
<p style=" margin-top:5px; margin-bottom:2px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;">Код:</p>
<pre style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Declare Function GetSystemMetrics Lib &quot;user32.dll&quot; (ByVal nIndex As Long) As Long</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Const SM_CXSCREEN = 0</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Const SM_CYSCREEN = 1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Private Sub Workbook_Open()</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    x = GetSystemMetrics(SM_CXSCREEN)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    y = GetSystemMetrics(SM_CYSCREEN)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    If x = 768 Then ActiveWindow.Zoom = 80</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    ActiveWindow.Zoom = 100</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">End Sub</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При запуске-закрытии книги вылезает ошибка (в приложении)</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Я использую такой макрос от <span style=" font-weight:600;">SAS</span><br /></p>
<p style=" margin-top:5px; margin-bottom:2px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;">Код:</p>
<pre style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Private Sub Workbook_Open()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    Application.EnableEvents = False</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Dim i As Integer, xK As Long</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">i = 11: xK = 23 ': x = 115 'Масштаб для все листов</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            For L = 1 To 16</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            Sheets(L).Select</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            'If L = 8 Then xK = 22</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            If L = 14 Then xK = 21: i = 9</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            If L &gt; 14 Then xK = 23</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    R = ActiveCell.Row</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    C = ActiveCell.Column</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    Range(Cells(1, 1), Cells(xK, i)).Select</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    ActiveWindow.Zoom = True</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    Cells(R, C).Select</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    xK = 23</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">            Next</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Application.EnableEvents = True</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">End Sub</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Понятно, но не совсем то.<br /><br />Valerij, вы знаете, какого размера(маштаба) должны быть листы и представленным кодом, после открытия книги, приводите маштаб листов к константе.<br /><br />У меня несколько другая задача: <br />Определив программно размерность используемого монитора, подогнать маштаб ПЕРВОЙ страницы книги под максимальное заполнение экрана монитора.<br /><br />Маленький скин с видом первого листа прилагаю. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">У меня 4 -монитора, 17' прямоугольник, 19' квадрат, 19' прямоугольник и 15'. На любом мониторе, моя книга открывается с полным заполнением экрана, которое я задал в макросе </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В итоге составлен следующий код:<br /></p>
<p style=" margin-top:5px; margin-bottom:2px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;">Код:</p>
<pre style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Private Sub Workbook_Open()</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Application.ScreenUpdating = False 'отключил обновление экрана</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Application.EnableEvents = False</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Dim i As Integer, xK As Long</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">i = 24: xK = 31</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Sheets(1).Range(Cells(1, 1), Cells(xK, i)).Select</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ActiveWindow.Zoom = True</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Range(&quot;A1&quot;).Select</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Application.EnableEvents = True</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Application.ScreenUpdating = True</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">End Sub</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Спасибо за идею! И Вам и SAS!</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В Вашем случае всё делается проще:<br /></p>
<p style=" margin-top:5px; margin-bottom:2px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;">Код:</p>
<pre style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Sub </span><span style=" font-family:'Courier New,courier'; font-weight:600;">testZoom</span><span style=" font-family:'Courier New,courier';">()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    Set ra = Selection    ' запоминаем выделенную область листа</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    [a1:g1].Select    ' выделяем нужное количество столбцов</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    ActiveWindow.Zoom = True ' устанавливаем масштаб по выделению</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    ra.Select ' восстанавливаем прежнее выделение на листе</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">End Sub</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Или даже так:<br /></p>
<p style=" margin-top:5px; margin-bottom:2px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;">Код:</p>
<pre style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Sub </span><span style=" font-family:'Courier New,courier'; font-weight:600;">testZoom</span><span style=" font-family:'Courier New,courier';">()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    [a1:g1].Select: ActiveWindow.Zoom = True</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">End Sub</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вставь этот код <span style=" font-weight:600;">в новый программный модуль</span> (а не в модуль листа или книги, как ты делал это раньше)<br /></p>
<p style=" margin-top:5px; margin-bottom:2px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;">Код:</p>
<pre style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Declare Function GetSystemMetrics Lib &quot;user32.dll&quot; (ByVal nIndex As Long) As Long</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Const SM_CXSCREEN = 0, SM_CYSCREEN = 1</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">Private Sub Workbook_Open()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    x = GetSystemMetrics(SM_CXSCREEN)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    y = GetSystemMetrics(SM_CYSCREEN)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">    MsgBox &quot;Разрешение экрана &quot; &amp; x &amp; &quot; * &quot; &amp; y</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">End Sub</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:20px; margin-right:20px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre></body></html>