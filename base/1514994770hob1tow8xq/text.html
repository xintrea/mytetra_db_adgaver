<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Субъект не имеет доверия для выполнения указанного действия </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Недавно столкнулся с ситуацией, когда в присланном файле не обнаружил на пользовательских формах(UserForms) элементов RefEdit.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Кто не в курсе, данный контрол предназначен для указания диапазона ячеек. По умолчанию он отсутствует в стандартном наборе контролов на форме Toolbox, но его легко добавить: </span><span style=" font-size:8.25pt; font-weight:600;">Tools</span><span style=" font-size:8.25pt;">- </span><span style=" font-size:8.25pt; font-weight:600;">Additional Controls</span><span style=" font-size:8.25pt;">- </span><span style=" font-size:8.25pt; font-weight:600;">RefEdit</span><span style=" font-size:8.25pt; font-style:italic;">(или </span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">RefEdit.Ctrl</span><span style=" font-size:8.25pt; font-style:italic;">)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Естественно, формы в файле не работали должным образом и при вызове выдавали ошибку, ругаясь на отсутствие контрола. Я лично грешу, что произошло это у меня после обновления офиса до версии RU-EN</span><span style=" font-size:8.25pt; font-style:italic;">(ранее была только RU)</span><span style=" font-size:8.25pt;">. Странно все это, конечно. Если бы это было ошибкой библиотеки контрола - была бы хоть какая-то ошибка при запуске проекта</span><span style=" font-size:8.25pt; font-style:italic;">(как правило &quot;</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Could not load an object because it is not available on this machine</span><span style=" font-size:8.25pt; font-style:italic;">&quot;)</span><span style=" font-size:8.25pt;">. Поэтому я решил удалить старый контрол RefEdit из Tollbox и добавить его заново. И, о чудо! Ничего не случилось. Контрол есть в Toolbox, но нет в файле. Что интересно - при попытке самому добавить на любую форму данный контрол появлялось сообщение &quot;</span><span style=" font-size:8.25pt; font-weight:600;">Субъект не имеет доверия для выполнения указанного действия</span><span style=" font-size:8.25pt;">&quot;:<br /></span><img src="image32129.png" /><span style=" font-size:8.25pt;"><br />Первое, что я сделал, это посмотрел в реестре, зарегистрирован ли данный компонент и все ли там на месте. Я использовал утилиту &quot;oleview&quot; от Microsoft, которая позволяет просмотреть все компоненты на ПК. В реестре он присутствовал и вроде все регистрационные данные были верными. Тогда я скопировал его CLSID и решил посмотреть есть ли он среди доверенных компонентов ActiveX в ветках реестра:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Office\Common\Security<br />HKEY_CURRENT_USER\Software\Microsoft\VBA\Security</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Вроде бы все нормально. Зашел до кучи в эти ветки:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\ActiveX Compatibility\<br />HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\Common\COM Compatibility\</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Изначально там было значение 400. Заменил на 0. Ничего не поменялось, ошибка не исчезла.<br />Потратив еще часок на это недоразумение меня посетила мысль начать с самого простого: настройки Excel(</span><span style=" font-size:8.25pt; font-weight:600; color:#008000;">Excel 2010</span><span style=" font-size:8.25pt;">). Я зашел в:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Файл</span><span style=" font-size:8.25pt; font-style:italic;"> -</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Параметры</span><span style=" font-size:8.25pt; font-style:italic;"> -</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Центр управления безопасностью</span><span style=" font-size:8.25pt; font-style:italic;"> -</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Параметры центра управления безопасностью</span><span style=" font-size:8.25pt; font-style:italic;"> -</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Параметры ActiveX</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">в </span><span style=" font-size:8.25pt; font-weight:600; color:#008000;">Excel 2007</span><span style=" font-size:8.25pt;"> этот параметр расположен в:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Меню</span><span style=" font-size:8.25pt; font-style:italic;"> -</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Параметры Excel</span><span style=" font-size:8.25pt; font-style:italic;"> -</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Центр управления безопасностью</span><span style=" font-size:8.25pt; font-style:italic;"> -</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Параметры центра управления безопасностью</span><span style=" font-size:8.25pt; font-style:italic;"> -</span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">Параметры ActiveX</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">и установил &quot;</span><span style=" font-size:8.25pt; font-weight:600;">Запрос перед включением всех элементов управления с минимальными ограничениями</span><span style=" font-size:8.25pt;">&quot;. Можно так же установить &quot;</span><span style=" font-size:8.25pt; font-weight:600;">Включить все элементы управления без ограничений и запросов</span><span style=" font-size:8.25pt;">&quot;.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">И вот тогда все заработало. Как же оказывается все просто. А я, дурак, лез в реестр, искал, копошил, сверял...Хотя, надо сказать в свое оправдание, что было уже такое, когда Microsoft выпустила обновление системы </span><span style=" font-size:8.25pt; font-weight:600;">KB960715</span><span style=" font-size:8.25pt;">. Некоторые контролы вели себя таким же образом после данного обновления и устранить можно было только через реестр. Кстати, для Excel 2003 эта проблема решается вообще только через правку реестра(HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\Common\Security - установить параметр </span><span style=" font-size:8.25pt; font-weight:600;">UFIControls</span><span style=" font-size:8.25pt;"> в 6, а параметр DisableAllActiveX - 0). Более подробно про правку реестра для Excel 2003 можно почитать на офф.сайте Microsft - </span><a href="http://support.microsoft.com/kb/827742"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">http://support.microsoft.com/kb/827742</span></a><span style=" font-size:8.25pt;"><br />Надеюсь, эта статья поможет еще кому-нибудь для решения данной проблемы.</span></p></body></html>