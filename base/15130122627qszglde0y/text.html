<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="container"></a><a href="http://www.interface.ru/home.asp?artId=16288"><span style=" text-decoration: underline; color:#0000ff;">i</span></a><span style=" text-decoration: underline; color:#0000ff;">nterface.ru</span> </p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="reader-title"></a><span style=" font-size:xx-large; font-weight:600;">О</span><span style=" font-size:xx-large; font-weight:600;">бъект Collection(VBA) как альтернатива динамическому массиву - Программные продукты</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="reader-credits"></a>4-5 минут </p>
<hr />
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="moz-reader-content"></a>Приведенная ниже функция формирует отсортированный список файлов или  вложенных папок согласно указанного шаблона. Здесь применяется метод быстрой сортировки. Новое значение сравнивается со значением из середины  диапазона, затем одна половина диапазона исключается и цикл повторяется.  Когда новое значение становится меньше первого или больше последнего в интервале, оно добавляется в семейство.</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Объест Collection объявляется как Dim col As New Collection. <br />Использование New в данном случае обязательно.</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В вызывающей процедуре можно применить 2 варианта:<br />Dim col As New Collection Здесь col - пустое семейство. <br />Set col = GetFilesList(......)<br />или<br />Dim col As Collection Здесь col - пустая ссылка на семейство. <br />Set col = GetFilesList(......)<br />Во втором варианте переменная может быть в состоянии Nothing, и обращение к свойству Count или любому методу семейства сгенерирует ошибку.<br /><a href="http://click02.begun.ru/click.jsp?url=4vrJyNqpZNp1G9jtE7RRVep*wrkz8eyjoEcG1K*VwiHvhdpz12yYkkokcX-5zc8XRBnWadOMdYtF6TR3yoGyivOe2ZO8THC-O4uAVzmNs7R9MchC6L4dri5RqyTohqufsDZxstX8qkHevESj2PJjBUuxmgoTxvpGpXQG08NJOCNv7SIsmc6LnMiKyNoZ7Tazekujos58Naec2AMwAkTevm8b9zKuCrxRNvLuIXIjk7IgO3iLjuPO1X5F1nxXlISkoHWwgns5608EQG5e7fP5ATChV2f027iNBqswhgPI9x6GCR6tfTbaI83Uw-cT2xu1Z**nitwFQ3c3Pv8Pdy*kXLVL9bc5A-2NJ4ZOxLMsArd9Y5jMCtiaKkUMmcyZFLoTc-m8IFfvxRqhDwDM4GM71ToaKkDYs4BlwnF32uJT90-4q1BusS6*S*zCVZ*nAJ9ja7pVrHeLWjryZoJTBJAFtQ"><span style=" text-decoration: underline; color:#0000ff;">Специалисты</span></a> настоятельно советуют использовать первый вариант всегда.<br />Другие возможности Collection:<br />Можно использовать конструкцию For Each ..... Next.<br />При добавлении нового элемента можно указать уникальный строковый ключ и затем использовать его при обращении к элементу. Например:<br />col.Add 100, &quot;New&quot;<br />MsgBox col(&quot;New&quot;) ( или col!New ) <br />col.Remove &quot;New&quot;<br />К сожалению, прочитать значение ключа нельзя.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Function GetFilesList(Optional PathName As String, _</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Optional FoldersOnly As Boolean) As Collection<br />' Функция возвращает отсортированное семейство имен файлов или<br />'вложенных папок (если установлен FoldersOnly).<br />' Аргумент PathName может принимать значение, распознаваемое<br />'функцией Dir().<br />On Error GoTo GetFilesList_err<br />Dim col As New Collection<br />Dim strFileName As String, strCompareFileName As String, _<br />i As Integer, j As Integer, MidPos As Integer</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If FoldersOnly Then<br />strFileName = Dir$(PathName, vbDirectory)<br />Else<br />strFileName = Dir$(PathName)<br />End If</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Do Until Len(strFileName) = 0<br />' В режиме поиска вложенных папок игнорирует папки &quot;.&quot;,&quot;..&quot; и</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'файлы.<br />If FoldersOnly Then<br />'Если первый символ - &quot;.&quot;(код 46), игнорируется.<br />If Asc(strFileName) = 46 Then GoTo NextFile<br />'Если отсутствует аттрибут vbDirectory, игнорируется.<br />If Not (GetAttr(PathName &amp; strFileName) And vbDirectory) = _<br />vbDirectory Then GoTo NextFile<br />End If</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">i = 1<br />j = col.Count<br />'Если коллекция пуста - добавляет значение.<br />If j = 0 Then<br />col.Add strFileName<br />GoTo NextFile<br />End If</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">SearchBlock:<br />' Вычисляется <a href="http://click02.begun.ru/click.jsp?url=4vrJyCokRF3ynF9qlDPW0m35RT60dmskJ8CBUygSRaYKXBVFSDH6UXZ1O2SuFn-ntOkmmSN8hXs8aCTBYsCDrvPMCSUQcl6E3g6afJMGWpwyCDtgSxAtBYX6AI9DLQA0G53aGX5XAep1F*8Ic1nIruAaMaG4bVHtxIqCWctujmwgom1j1oHE04fFh5VWonn8NQTs7YEzeujTl0x-TQuR8SBUuH3hRfMeeb2hbj1s3P1vdDfEwayBmjEKmTMY28vr7zr-zTR2pABLDyERory2Tn-uGCi7lPfCSeR-yUyHuFEfmkZvzpogOqlt49gUuafxLDnyy1ctgX6nOnQS8*TxTIGCYygnsJQgLOa5G9pDv8FB-Dc6Re1j4POI-6NQt1Pwr-PTxnG7LB9c6hntFkMzvGUz7cmdKtud*qGYTChP8uvMvljpsIXMy9GVDEECMT3CbI78gQSEtBRsBM*vUSKgikiFrYWn*2PXCqmaab5SEt5cKG4yH9fcoQwRE7qk4L8tq8cQTaEB3ge*A5Y3YvmBChfH2dHnPCBjKuGWjxG-xoKy49*IHXEmZmjplHqRsNASmq9wn1IVEN3ZypWAeTa4x70Tr3VOPG*Kowk1gtiTFFWA7Kf1XBKiYalVu75DBLq7"><span style=" text-decoration: underline; color:#0000ff;">средний</span></a> индекс в диапазоне и извлекается<br />'соответствующее значение.<br />MidPos = (i + j) 2<br />strCompareFileName = col(MidPos)</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">' Имя нового файла сравнивается с текущим значением.<br />Select Case StrComp(strFileName, strCompareFileName, _<br />vbTextCompare)<br />Case -1 'strFileName &lt; strCompareFileName<br />'Новое значение меньше текущего.<br />If MidPos &lt;= i Then<br />' Если текущий индекс совпадает с начальным(&lt; - для надежности),<br />'добавляется перед первым значением в диапазоне.<br />col.Add strFileName, , i<br />Else<br />'Диапазон ограничивается первой половиной и цикл повторяется.<br />j = MidPos - 1<br />GoTo SearchBlock<br />End If</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Case 1 'strFileName &gt; strCompareFileName<br />'Новое значение больше текущего.<br />If MidPos &gt;= j Then<br />' Если текущий индекс совпадает с конечным(&gt; - для надежности),<br />'добавляется после конечного значения в диапазоне.<br />col.Add strFileName, , , j<br />Else<br />'Диапазон ограничивается второй половиной и цикл повторяется.<br />i = MidPos + 1<br />GoTo SearchBlock<br />End If</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">' Case 0 strFileName = strCompareFileName<br />End Select<br />NextFile:<br />strFileName = Dir$(, vbDirectory)<br />Loop</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Set GetFilesList = col</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GetFilesList_exit:<br />Exit Function</p>
<p align="justify" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GetFilesList_err:<br />Select Case Err.Number<br />Case 52<br />MsgBox &quot;Путь к файлу(папке) указан неправильно.&quot;, vbCritical<br />Case 68<br />MsgBox &quot;Устройство недоступно.&quot;, vbCritical<br />Case 76<br />MsgBox &quot;Путь не найден.&quot;, vbCritical<br />Case Else<br />MsgBox Err &amp; &quot; - &quot; &amp; Err.Description, vbCritical, _<br />&quot;GetFilesList&quot;<br />End Select<br />Resume GetFilesList_exit<br />End Function </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>