<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="share42"></a>Как объединить несколько текстовых файлов в один? </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">В общем-то проблема не такая распространенная, как сбор данных из нескольких файлов/листов в Excel, но все же. Решил вот написать, как просто и быстро можно из множества текстовых файлов собрать информацию в один новый текстовый файл. Притом это не потребует от Вас никаких усилий, кроме как нажатия кнопочки и выбора нужных файлов. Ну и скачивания файла с этой странички. Или ручной вставки кода в свою книгу. Собственно, сам код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6dfcad90281484357"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ub Get_All_TXT_Text() Dim avFiles, li As Long avFiles = Application.GetOpenFilename(&quot;TXT Files(*.txt),*.txt&quot;, , , , True) If VarType(avFiles) = vbBoolean Then Exit Sub Dim objFSO As Object, objTxtFile As Object, sTxt, sAllTxt Set objFSO = CreateObject(&quot;Scripting.FileSystemObject&quot;) For li = LBound(avFiles) To UBound(avFiles) Set objTxtFile = objFSO.OpenTextFile(avFiles(li), 1) sTxt = objTxtFile.ReadAll sAllTxt = sAllTxt &amp; vbNewLine &amp; sTxt objTxtFile.Close Next li Set objTxtFile = objFSO.CreateTextFile(&quot;C:\AllText.txt&quot;, True) objTxtFile.WriteLine sAllTxt objTxtFile.Close Set objTxtFile = Nothing: Set objFSO = Nothing End Sub </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><span style=" font-size:8.25pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">9</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">12</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">14</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">15</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">17 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6dfcad90281484357-1"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ub Get_All_TXT_Text()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-2"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim avFiles, li As Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-3"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   avFiles = Application.GetOpenFilename(&quot;TXT Files(*.txt),*.txt&quot;, , , , True)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-4"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   If VarType(avFiles) = vbBoolean Then Exit Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-5"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim objFSO As Object, objTxtFile As Object, sTxt, sAllTxt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-6"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Set objFSO = CreateObject(&quot;Scripting.FileSystemObject&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-7"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   For li = LBound(avFiles) To UBound(avFiles)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-8"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       Set objTxtFile = objFSO.OpenTextFile(avFiles(li), 1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-9"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       sTxt = objTxtFile.ReadAll</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-10"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       sAllTxt = sAllTxt &amp; vbNewLine &amp; sTxt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-11"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       objTxtFile.Close</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-12"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Next li</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-13"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Set objTxtFile = objFSO.CreateTextFile(&quot;C:\AllText.txt&quot;, True)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-14"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   objTxtFile.WriteLine sAllTxt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-15"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   objTxtFile.Close</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-16"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Set objTxtFile = Nothing: Set objFSO = Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6dfcad90281484357-17"></a><span style=" font-size:8.25pt;">E</span><span style=" font-size:8.25pt;">nd Sub</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Вот и все. Теперь этот код необходимо вставить в </span><a href="http://www.excel-vba.ru/chto-umeet-excel/chto-takoe-modul-kakie-byvayut-moduli#StandartModule/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">стандартный модуль</span></a><span style=" font-size:8.25pt;">. И либо создать кнопку на листе для его вызова(</span><a href="http://www.excel-vba.ru/chto-umeet-excel/kak-sozdat-knopku-dlya-vyzova-makrosa-na-liste/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Как создать кнопку для вызова макроса на листе?</span></a><span style=" font-size:8.25pt;">), либо вызывать нажатием сочетания клавиш </span><span style=" font-size:8.25pt; font-weight:600;">Alt</span><span style=" font-size:8.25pt;">+</span><span style=" font-size:8.25pt; font-weight:600;">F8</span><span style=" font-size:8.25pt;"> -</span><span style=" font-size:8.25pt; font-weight:600;">Get_All_TXT_Text</span><span style=" font-size:8.25pt;"> -</span><span style=" font-size:8.25pt; font-weight:600;">Выполнить</span><span style=" font-size:8.25pt;">.<br />После работы кода на диске &quot;С&quot; будет создан файл &quot;AllText.txt&quot;, в котором и будут содержаться данные всех выбранных файлов.<br />Скачать пример </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image31979.png" /><span style=" font-size:8.25pt;">  </span><a href="http://www.excel-vba.ru/download/53/"><span style=" font-size:8.25pt; font-weight:600; text-decoration: underline; color:#0000ff;">Tips_Macro_Get_All_TXT_Text.xls</span></a><span style=" font-size:8.25pt;"> (37,5 KiB, 4 435 скачиваний)</span></p></body></html>