<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Файл долго фильтрует строки/тормозит при фильтрации </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Довольно часто у пользователей после продолжительной работы в файле возникает проблема: при изменении условия фильтрации(<span style=" font-weight:600;">Данные(Data)</span> -<span style=" font-weight:600;">Фильтр(Filter)</span>) файл задумывается на минуту, а порой и не на одну. В этой статье я решил рассмотреть несколько причин подобного поведения файла и как их устранить. При этом описанные методы так же справедливы и для случаев, когда файл тормозит не только при фильтрации, но и при других изменениях на листе:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Большое количество формул и функций на листах<br />Самая частая причина - наличие большого количества формул на листе. Это могут быть и <a href="http://www.excel-vba.ru/chto-umeet-excel/kak-najti-znachenie-v-drugoj-tablice-ili-sila-vpr/"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">ВПР(VLOOKUP)</span></a> с большим диапазоном данных и <a href="http://www.excel-vba.ru/chto-umeet-excel/funkciya-summesli-a-tak-zhe-summesli-po-dvum-kriteriyam/"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">СУММПРОИЗВ(SUMPRODUCT)</span></a>, и любые другие в разных сочетаниях. Так же значительно тормозить файл могут формулы массива, даже если они не сложные. Добавить тормозов в этом случае могут еще и так называемые &quot;летучие&quot; функции, среди которых чаще других в файлах используются: <span style=" font-weight:600;">ДВССЫЛ(INDIRECT)</span>, <span style=" font-weight:600;">СМЕЩ(OFFSET)</span>, <span style=" font-weight:600;">ЯЧЕЙКА(CELL)</span>. Почему летучие и чем они плохи? Обычно функции пересчитываются только в том случае, если изменена сама функция или любой аргумент этой функции(иными словами только если изменены ячейки, которые влияют на результат функции). Летучие же функции пересчитываются при любом изменении в книге(в том числе сортировка и фильтрация), независимо от того, повлияет ли это на расчет самой функции.<br />Поэтому если файл напичкан формулами и тормозит, то первое, что надо сделать это найти те формулы, расчеты которых больше не нужны и преобразовать их в значения: <a href="http://www.excel-vba.ru/chto-umeet-excel/kak-udalit-v-yachejke-formulu-ostaviv-znacheniya/"><span style=" text-decoration: underline; color:#0000ff;">Как удалить в ячейке формулу, оставив значения?</span></a>. Оптимальный вариант: сделать копию файла, заменить все формулы значениями и просматривать данные в нем. Так же можно заменить ту часть формул, расчеты которых не нужны для выполнения текущей задачи.<br />Если этот вариант не подходит, то необходимо убедиться, а нет ли летучих функций? Это можно сделать элементарно при помощи поиска: <span style=" font-weight:600;">Ctrl</span>+<span style=" font-weight:600;">F</span>, найти(find what) -Имя функции, кнопка <span style=" font-weight:600;">Параметры(Options&gt;&gt;)</span> -снять галку с <span style=" font-weight:600;">Ячейка целиком(Match case)</span>. В этом случае надо попробовать оптимизировать расчеты, отказавшись от таких функций. Как правило в большинстве случаев их можно заменить другими функциями, но это потребует знания самих функций.<br />Так же следует помнить, что функции и формулы могут быть не просто на листе, а так же содержаться в именованных диапазонах: <a href="http://www.excel-vba.ru/chto-umeet-excel/imenovannye-diapazony/"><span style=" text-decoration: underline; color:#0000ff;">Именованные диапазоны</span></a>. Как пример таких формул: <a href="http://www.excel-vba.ru/chto-umeet-excel/dinamicheskie-imenovannye-diapazony/"><span style=" text-decoration: underline; color:#0000ff;">Динамические именованные диапазоны</span></a>. Поэтому так же следует проверить наличие именованных диапазонов и удалить все неиспользуемые. С осторожностью удаляйте такие имена - как правило, если плохо в этом ориентируетесь удалять их можно <span style=" font-weight:600;">только на копиях файлов и только после того, как все формулы в книге </span><a href="http://www.excel-vba.ru/chto-umeet-excel/kak-udalit-v-yachejke-formulu-ostaviv-znacheniya/"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">замените значениями</span></a></li>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><br /></p>
<hr />
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Наличие условного форматирования на листе<br />Если в листе есть много условий условного форматирования, это вполне может приводить к медленной работе файла не только при изменения условий фильтрации, но и вообще при любом действии на листе - изменение данных в ячейках, сортировка, пересчет формул и т.д. Происходит это потому, что условное форматирование накладывает формат поверх реального и определяется на основании условий, которые могут определяться расположением и видимостью строк на листе. Поэтому следует убедиться в наличии/отсутствии условного форматирования и понять - а так ли оно нужно в этом файле? Если не знаете где искать условное форматирование: <a href="http://www.excel-vba.ru/chto-umeet-excel/osnovnye-ponyatiya-uslovnogo-formatirovaniya-i-kak-ego-sozdat/"><span style=" text-decoration: underline; color:#0000ff;">Основные понятия условного форматирования и как его создать</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разбиение на печатные страницы<br />Очень сильно может замедлить работу файла разбиение листа на печатные страницы, особенно если рабочий диапазон(UsedRange) листа довольно большой. Почему этот режим тормозит? Потому что при каждом изменении на листе Excel будет просматривать каждую строку и столбец и обращаясь при этом к настройкам печати(принтера), перерисовывая границы печати на листе.<br />Кто установил эти границы, если я сам этого не делал? По умолчанию после вывода листа на печать, независимо от настроек книги или принтера, Excel отображает линии разбиения листа Excel на печатные листы и не убирает их.<br />Убрать печатные страницы можно через параметры:<br />Excel 2003:<br /><span style=" font-weight:600;">Сервис</span> -<span style=" font-weight:600;">Параметры</span> -вкладка <span style=" font-weight:600;">Вид</span> -<span style=" font-weight:600;">Авторазбиение на страницы</span><br />Excel 2007:<br /><span style=" font-weight:600;">Кнопка Офис</span> -<span style=" font-weight:600;">Параметры Excel(Excel options)</span> -вкладка <span style=" font-weight:600;">Дополнительно(Advanced)</span> -<span style=" font-weight:600;">Показывать разбиение на страницы(Show page breaks)</span><br />Excel 2010-2013:<br /><span style=" font-weight:600;">Файл</span> -<span style=" font-weight:600;">Параметры(Options)</span> -вкладка <span style=" font-weight:600;">Дополнительно(Advanced)</span> -<span style=" font-weight:600;">Показывать разбиение на страницы(Show page breaks)</span></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Структура/Группировка данных<br />Как ни странно, но на фильтр очень сильно влияет наличие структуры/группировки на листе. Устанавливается группировка через вкладку <span style=" font-weight:600;">Данные(Data)</span> -<span style=" font-weight:600;">Группировать(Group)</span> или <span style=" font-weight:600;">Данные(Data)</span> -<span style=" font-weight:600;">Промежуточные итоги(Subtotal)</span>.<br />При этом тормоза в файле могу проявиться не сразу, а после добавления определенного количества строк или столбцов.<br />Делается группировка обычно для возможности компактно расположить на листе данные, относящиеся к определенной группе или категории. И это действительно удобно, но не стоит увлекаться. Если файл стал тормозить - попробуйте создать его копию и удалить всю структуру и группировки: <span style=" font-weight:600;">Данные(Data)</span> -<span style=" font-weight:600;">Разгруппировать(Ungroup)</span> -<span style=" font-weight:600;">Удалить структуру(Clear Outline)</span>. Если это поможет - стоит задуматься: а так ли нужна была структура?</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ну и конечно, все эти варианты могут сойтись в одном файле. В таком случае в файле достаточно будет меньшее количество каждого компонента для получения коктейля &quot;Глубинный тормоз&quot; :)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Так же советую ознакомиться со статьей: <a href="http://www.excel-vba.ru/chto-umeet-excel/kak-umenshit-razmer-fajla/"><span style=" text-decoration: underline; color:#0000ff;">Как уменьшить размер файла</span></a>. Она тоже может помочь с устранением тормозов.</p></body></html>