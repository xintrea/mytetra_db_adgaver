<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">Автоматическая загрузка из Excel средствами SSIS- проще простого</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="post-body-487889018865058534"></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Задача организовать периодическийимпорт из выгружаемых файлов Excelв таблицу MS SQL server.Старые файлы для архива необходимо оставить.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="more"></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Данную задачу легко решить,используя стандартные средства SSIS.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="1.png"><img src="1.png" /></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">1.Поток данных</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">2. Задача сценарий, дляпереименования файлов.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">В потоке данных выбираем«Источник Excel”</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://1.bp.blogspot.com/-IzCmIzngx88/TzldH5zk4aI/AAAAAAAAADY/iFWsiiNE324/s1600/3-2.JPG"><img src="2.png" width="320" height="141" /></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">В данном источнике выбираем  наш файл.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">В сервер назначения указываем нашMS SQL Server, таблицу назначения,сопоставляем поля источника и назначения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">В объекте «сценарий» добавимтекст скрипта по переименованию файла, я выбрал на языке VB:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">      </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">       Rename(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;c:\TestExcel1.xls&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;c:\TestExcel1_&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;">+ Convert.ToString(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Date</span><span style=" font-family:'Courier New'; font-size:10pt;">.Now.Year()) _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">                                         + </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;_&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;"> + Convert.ToString(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Date</span><span style=" font-family:'Courier New'; font-size:10pt;">.Now.Month()) _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">                                                  + </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;_&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;"> + Convert.ToString(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Date</span><span style=" font-family:'Courier New'; font-size:10pt;">.Now.Day()) + </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;.xls&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">        </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Catch</span><span style=" font-family:'Courier New'; font-size:10pt;"> ex </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">As</span><span style=" font-family:'Courier New'; font-size:10pt;"> Exception</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">            </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">My</span><span style=" font-family:'Courier New'; font-size:10pt;">.Computer.FileSystem.WriteAllText(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;C:\load_from_excel_error.log&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;">,Convert.ToString(Now()) + </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot; - Ошибка переименования файла или файла нет&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;"> + vbCrLf, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">True</span><span style=" font-family:'Courier New'; font-size:10pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">        </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">End</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">После этого наш пакет SSIS долженработать и иметь следующий результата:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">1  .</span><span style=" font-family:'DejaVu Sans'; font-size:7pt;">       </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Загружаетиз файла Excel в БД MS SQL данные</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">2   .</span><span style=" font-family:'DejaVu Sans'; font-size:7pt;">     </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Старыйфайл Excel переименовывается.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Все. Дальше можно настроитьразличные исключения, или поправить согласно вашим требованиям. Удачи.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Автор:</span><a href="https://www.blogger.com/profile/17569018659041670317"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">Вячеслав</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;">на</span><a href="http://dbasimple.blogspot.com/2012/02/excel-ssis.html"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">23:00</span></a><a href="https://www.blogger.com/email-post.g?blogID=5048447696442176834&amp;postID=487889018865058534"><img src="3.png" width="18" height="13" /></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans'; font-size:11pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="___plusone_0"></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Я</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">рлыки:</span><a href="http://dbasimple.blogspot.com/search/label/Excel"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">Excel</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;">                                              ,                                            </span><a href="http://dbasimple.blogspot.com/search/label/SSIS%20%D0%BF%D0%B0%D0%BA%D0%B5%D1%82"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">SSIS пакет</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="comments"></a><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">1</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;"> комментарий                                    :                                  </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="5.png" /></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Анонимный</span><a href="http://dbasimple.blogspot.com/2012/02/excel-ssis.html?showComment=1531124580301#c8108239309593594148"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">9 июля 2018 г., 11:23</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Коллега, каким образом можно импортировать бинарные данные как содержимое файла ексель, с целью вставки всего бинарного содержимого в поле varbinary(max) как прикрепленный файл? Столкнулся с необходимостью импорта нескольких тысяч файлов в виде поля data в моей бд crm, потом эта запись будет подтянута на страницу с задачами и прикрепленным файлом к активности</span></p></body></html>