<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">GetAssocTool - Получение пути к программе, асоциированной с расширением имени файла</span><br />Задаем интересующий тип файлов,<br />получаем путь к приложению по-умолчанию для открытия этого расширения.<br /><br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">ext <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=INPUTBOX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">inputbox</span></a> <span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;Введите расширение имени файла:&quot;</span><span style=" color:#000000;">)</span><br />Path <span style=" color:#000000;">=</span> GetAssocTool<span style=" color:#000000;">(</span>ext<span style=" color:#000000;">)</span><br />Name <span style=" color:#000000;">=</span> GetFileNameFromPath<span style=" color:#000000;">(</span>Path<span style=" color:#000000;">)</span><br /><br />msgbox <span style=" color:#a52a2a;">&quot;Расширение: &quot;</span> <span style=" color:#000000;">&amp;</span> ext <span style=" color:#000000;">&amp;</span> vbLf <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;Имя файла: &quot;</span> <span style=" color:#000000;">&amp;</span> Name <span style=" color:#000000;">&amp;</span> vbLf <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;Путь: &quot;</span> <span style=" color:#000000;">&amp;</span> Path<br /><br /><br /><span style=" font-weight:600; color:#0000ff;">Function</span> GetAssocTool<span style=" color:#000000;">(</span>ext<span style=" color:#000000;">)</span><br />    <span style=" font-style:italic; color:#008000;">'Получение пути к приложению, с которым ассоциировано расширение имени файла</span><br />    <span style=" font-weight:600; color:#0000ff;">if</span> <a href="http://www.google.com/search?q=LEFT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">left</span></a><span style=" color:#000000;">(</span>ext,<span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&lt;&gt;</span> <span style=" color:#a52a2a;">&quot;.&quot;</span> <span style=" font-weight:600; color:#0000ff;">then</span> ext <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;.&quot;</span> <span style=" color:#000000;">&amp;</span> ext<br />    <span style=" font-weight:600; color:#0000ff;">if</span> GetOSFamily<span style=" color:#000000;">()</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;NT&quot;</span> <span style=" font-weight:600; color:#0000ff;">then</span> GetAssocTool <span style=" color:#000000;">=</span> GetAssocTool_XP<span style=" color:#000000;">(</span>ext<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">else</span> GetAssocTool <span style=" color:#000000;">=</span> GetAssocTool_Vista<span style=" color:#000000;">(</span>ext<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><br /><span style=" font-weight:600; color:#0000ff;">Function</span> GetAssocTool_Vista<span style=" color:#000000;">(</span>ext<span style=" color:#000000;">)</span><br />    user_key <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\&quot;</span> <span style=" color:#000000;">&amp;</span> ext <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\UserChoice\Progid&quot;</span><br /><br />    <span style=" font-weight:600; color:#0000ff;">set</span> oShell <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;WScript.Shell&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">resume</span> <span style=" font-weight:600; color:#0000ff;">next</span><br />    progID <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.RegRead(</span>user_key<span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">goto</span> <span style=" color:#a52a2a;">0</span><br /><br />    <span style=" font-weight:600; color:#0000ff;">if</span> progid <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;&quot;</span> <span style=" font-weight:600; color:#0000ff;">then</span> progID <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.RegRead(</span><span style=" color:#a52a2a;">&quot;HKCR\&quot;</span> <span style=" color:#000000;">&amp;</span> ext <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\&quot;</span><span style=" color:#000000;">)</span><br /><br />    comm <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.RegRead(</span><span style=" color:#a52a2a;">&quot;HKCR\&quot;</span> <span style=" color:#000000;">&amp;</span> progID <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\shell\open\command\&quot;</span><span style=" color:#000000;">)</span><br /><br />    GetAssocTool_Vista <span style=" color:#000000;">=</span> ParsePathFromCommandLine<span style=" color:#000000;">(</span>comm<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><br /><span style=" font-weight:600; color:#0000ff;">Function</span> GetAssocTool_XP<span style=" color:#000000;">(</span>ext<span style=" color:#000000;">)</span><br />    curSID <span style=" color:#000000;">=</span> GetCurrentSID<span style=" color:#000000;">()</span><br />    <span style=" font-weight:600; color:#0000ff;">set</span> oShell <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;WScript.Shell&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">resume</span> <span style=" font-weight:600; color:#0000ff;">next</span><br />    EXE_Name <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.RegRead(</span><span style=" color:#a52a2a;">&quot;HKEY_USERS\&quot;</span> <span style=" color:#000000;">&amp;</span> curSID <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.txt\Application&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">goto</span> <span style=" color:#a52a2a;">0</span><br />    <span style=" font-weight:600; color:#0000ff;">if</span> EXE_Name <span style=" color:#000000;">&lt;&gt;</span> <span style=" color:#a52a2a;">&quot;&quot;</span> <span style=" font-weight:600; color:#0000ff;">then</span><br />        comm <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.RegRead(</span><span style=" color:#a52a2a;">&quot;HKCR\Applications\&quot;</span> <span style=" color:#000000;">&amp;</span> EXE_Name <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\shell\open\command\&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">else</span><br />        progID <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.RegRead(</span><span style=" color:#a52a2a;">&quot;HKCR\&quot;</span> <span style=" color:#000000;">&amp;</span> ext <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\&quot;</span><span style=" color:#000000;">)</span><br />        comm <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.RegRead(</span><span style=" color:#a52a2a;">&quot;HKCR\&quot;</span> <span style=" color:#000000;">&amp;</span> progID <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\shell\open\command\&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">end</span> <span style=" font-weight:600; color:#0000ff;">if</span><br /><br />    GetAssocTool_XP <span style=" color:#000000;">=</span> ParsePathFromCommandLine<span style=" color:#000000;">(</span>comm<span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><br /><br /><span style=" font-weight:600; color:#0000ff;">Function</span> ParsePathFromCommandLine<span style=" color:#000000;">(</span>comm<span style=" color:#000000;">)</span><br />    <span style=" font-style:italic; color:#008000;">'Получает путь из командной строки, если кроме него заданы дополнительные аргументы; убирает кавычки</span><br /><br />    <span style=" font-weight:600; color:#0000ff;">If</span> <a href="http://www.google.com/search?q=LEFT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Left</span></a><span style=" color:#000000;">(</span>comm, <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;&quot;&quot;&quot;</span> <span style=" font-weight:600; color:#0000ff;">Then</span><br />        ParsePathFromCommandLine <span style=" color:#000000;">=</span> Mid<span style=" color:#000000;">(</span>comm, <span style=" color:#a52a2a;">2</span>, <a href="http://www.google.com/search?q=INSTR+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">InStr</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">2</span>, comm, <span style=" color:#a52a2a;">&quot;&quot;&quot;&quot;</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">-</span> <span style=" color:#a52a2a;">2</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Else</span><br />        ParsePathFromCommandLine <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=SPLIT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Split</span></a><span style=" color:#000000;">(</span>comm<span style=" color:#000000;">)(</span><span style=" color:#a52a2a;">0</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">If</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><br /><br /><span style=" font-weight:600; color:#0000ff;">Function</span> GetFileNameFromPath<span style=" color:#000000;">(</span>sPath<span style=" color:#000000;">)</span><br />    <span style=" font-style:italic; color:#008000;">'Преобразование пути в имя файла</span><br /><br />    <span style=" font-weight:600; color:#0000ff;">if</span> <a href="http://www.google.com/search?q=INSTR+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">instr</span></a><span style=" color:#000000;">(</span>sPath,<span style=" color:#a52a2a;">&quot;\&quot;</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">then</span> GetFileNameFromPath <span style=" color:#000000;">=</span> sPath: <span style=" font-weight:600; color:#0000ff;">Exit</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br />    GetFileNameFromPath <span style=" color:#000000;">=</span> Mid<span style=" color:#000000;">(</span>sPath, <a href="http://www.google.com/search?q=INSTRREV+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">InStrRev</span></a><span style=" color:#000000;">(</span>sPath, <span style=" color:#a52a2a;">&quot;\&quot;</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><br /><br /><span style=" font-weight:600; color:#0000ff;">Function</span> GetCurrentSID<span style=" color:#000000;">()</span><br />    <span style=" font-style:italic; color:#008000;">'Получить SID текущего пользователя</span><br /><br />    <span style=" font-weight:600; color:#0000ff;">Set</span> oNetwork <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;WScript.Network&quot;</span><span style=" color:#000000;">)</span><br />    sUserName <span style=" color:#000000;">=</span> oNetwork<span style=" color:#000000;">.UserName</span><br />    sDomain <span style=" color:#000000;">=</span> oNetwork<span style=" color:#000000;">.UserDomain</span><br /><br />    <span style=" font-weight:600; color:#0000ff;">Set</span> oWMI <span style=" color:#000000;">=</span> GetObject<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;winmgmts:\root\cimv2&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Set</span> colSIDs <span style=" color:#000000;">=</span> oWMI<span style=" color:#000000;">.ExecQuery(</span><span style=" color:#a52a2a;">&quot;SELECT * FROM Win32_UserAccount WHERE Caption='&quot;</span> <span style=" color:#000000;">&amp;</span> sDomain <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\\&quot;</span> <span style=" color:#000000;">&amp;</span> sUserName <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;'&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">For</span> <span style=" font-weight:600; color:#0000ff;">each</span> oSID <span style=" font-weight:600; color:#0000ff;">in</span> colSIDs<br />        GetCurrentSID <span style=" color:#000000;">=</span> oSID<span style=" color:#000000;">.SID</span><br />    <span style=" font-weight:600; color:#0000ff;">Next</span><br />    <span style=" font-weight:600; color:#0000ff;">Set</span> oWMI <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span>: <span style=" font-weight:600; color:#0000ff;">Set</span> colSIDs <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><br /><br /><span style=" font-weight:600; color:#0000ff;">Function</span> GetOSFamily<span style=" color:#000000;">()</span><br />    <span style=" font-style:italic; color:#008000;">' Семейство ОС</span><br />    <span style=" font-weight:600; color:#0000ff;">set</span> oShell <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;WScript.Shell&quot;</span><span style=" color:#000000;">)</span><br />    OSVersion <span style=" color:#000000;">=</span> oShell<span style=" color:#000000;">.RegRead(</span><span style=" color:#a52a2a;">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\CurrentVersion&quot;</span><span style=" color:#000000;">)</span><br /><br />    <span style=" font-weight:600; color:#0000ff;">if</span> <span style=" color:#cd6a5a;">cint</span><span style=" color:#000000;">(</span><a href="http://www.google.com/search?q=LEFT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">left</span></a><span style=" color:#000000;">(</span>OSVersion,<span style=" color:#a52a2a;">1</span><span style=" color:#000000;">))</span> <span style=" color:#000000;">&lt;</span> <span style=" color:#a52a2a;">6</span> <span style=" font-weight:600; color:#0000ff;">then</span> GetOSFamily <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;NT&quot;</span> <span style=" font-weight:600; color:#0000ff;">else</span> GetOSFamily <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;Vista&quot;</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br />  </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Вложения:</span></p></body></html>