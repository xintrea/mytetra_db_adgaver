<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/WebQueryRange"><span style=" text-decoration: underline; color:#0000ff;">Функция VBA для выполнения веб-запроса (Web Query)</span></a><span style=" font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/taxonomy/term/14"><span style=" text-decoration: underline; color:#0000ff;">Макросы VBA Excel</span></a></li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/sheets_and_ranges"><span style=" text-decoration: underline; color:#0000ff;">Работа с диапазонами ячеек и листами</span></a></li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/internet/query"><span style=" text-decoration: underline; color:#0000ff;">Веб-запрос</span></a></li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/hyperlinks"><span style=" text-decoration: underline; color:#0000ff;">Гиперссылки</span></a></li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/internet"><span style=" text-decoration: underline; color:#0000ff;">Интернет</span></a> </li></ul></td></tr></table>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Функция GetQueryRange предназначена для автоматизации загрузки данных с веб-страниц.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Например, нам надо </span><span style=" font-size:8.25pt; font-weight:600;">из макроса Excel получить данные с нескольких однотипных страниц сайта</span><span style=" font-size:8.25pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Самый простой способ достичь этого - </span><span style=" font-size:8.25pt; font-weight:600;">выполнять почти идентичные веб-запросы (где незначительно отличаться будет только URL страницы),<br />каждый раз анализируя данные, загруженные веб-запросом на лист Excel</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Поскольку количество обращений ко мне, с просьбами сделать </span><a href="http://excelvba.ru/category/internet/query"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">программу загрузки данных из интернета</span></a><span style=" font-size:8.25pt;">, с каждым днём растёт, я решил сделать для этих целей универсальную функцию:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ПримерИспользования()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Dim</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ra </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:8.25pt;"> Range: </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ra = GetQueryRange(</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;http://ExcelVBA.ru/&quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;">, 6)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    Debug.</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ra.Address    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#008000;">' переменная ra содержит ссылку на диапазон ячеек $A$1:$C$15,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#008000;">' содержащий данные 6-й таблицы главной страницы сайта ExcelVBA.ru</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:8.25pt; color:#008000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ra = GetQueryRange(</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;http://excelvba.ru/sitemap.xml&quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    Debug.</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ra.Address    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#008000;">' теперь переменная ra содержит ссылку на диапазон ячеек $A$1:$D$502,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#008000;">' содержащий данные карты сайта ExcelVBA.ru</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:8.25pt; color:#008000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Sub</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">При запуске функции, </span><span style=" font-size:8.25pt; font-weight:600;">создаётся скрытый лист с именем «tmpWQ»</span><span style=" font-size:8.25pt;"> (если такой лист уже есть - используется существующий), и </span><span style=" font-size:8.25pt; font-weight:600;">на этом листе выполняется веб-запрос к указанному сайту</span><span style=" font-size:8.25pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">В качестве параметра можно задать номер интересующей нас таблицы сайта.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Номер (или номера) требуемых страниц можно узнать, записав макрорекордером код веб-запроса к нужной веб-странице.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Функция загружает данные на лист в формате HTML, - соответственно, мы можем получить доступ к гиперссылкам в результатах веб-запроса.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">В большинстве случаев, эту функцию требуется использовать внутри цикла, формируя в теле цикла очередной URL, затем выполняя запрос к сформированному URL, получая необходимые данные с листа Excel, и т.д. для каждой из ссылок:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ЗагрузкаСпискаТемСФорума_ПланетаExcel()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Dim</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ra </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:8.25pt;"> Range, cell </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:8.25pt;"> Range, n </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Long</span><span style=" font-family:'monospace'; font-size:8.25pt;">: </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">For</span><span style=" font-family:'monospace'; font-size:8.25pt;"> i = 1 </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">To</span><span style=" font-family:'monospace'; font-size:8.25pt;"> 10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#008000;">' формируем ссылку</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        URL$ = </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;http://www.planetaexcel.ru/forum.php?forum_id=129&amp;page_forum=&quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;"> &amp; i</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ra = GetQueryRange(URL$, 6)    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#008000;">' выполняем веб-запрос</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:8.25pt; color:#008000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#008000;">' перебирая ячейки таблицы-результата, выводим список тем в окно Immediate</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">For</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Each</span><span style=" font-family:'monospace'; font-size:8.25pt;"> cell </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">In</span><span style=" font-family:'monospace'; font-size:8.25pt;"> ra.Columns(2).Cells</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">            </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:8.25pt;"> cell.Hyperlinks.Count </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">                n = n + 1: Debug.</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;Тема №&quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;"> &amp; n, cell.Text</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">                Debug.</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;Ссылка на тему: &quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;"> &amp; cell.Hyperlinks(1).Address: Debug.</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Print</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">            </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Next</span><span style=" font-family:'monospace'; font-size:8.25pt;"> cell</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Next</span><span style=" font-family:'monospace'; font-size:8.25pt;"> i</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Sub</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Скриншот результата этого макроса:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image19809.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Код функции GetQueryRange:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Function</span><span style=" font-family:'monospace'; font-size:8.25pt;"> GetQueryRange(</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:8.25pt;"> SearchLink$, </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Optional</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:8.25pt;"> Tables$) </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:8.25pt;"> Range</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Next</span><span style=" font-family:'monospace'; font-size:8.25pt;">: Err.Clear</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Dim</span><span style=" font-family:'monospace'; font-size:8.25pt;"> tmpSheet </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:8.25pt;"> Worksheet: </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:8.25pt;"> tmpSheet = ThisWorkbook.Worksheets(</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;tmpWQ&quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:8.25pt;"> tmpSheet </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Is</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Nothing</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        Application.ScreenUpdating = </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">False</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:8.25pt;"> tmpSheet = ThisWorkbook.Worksheets.Add</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        tmpSheet.Name = </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;tmpWQ&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        tmpSheet.Visible = xlSheetVeryHidden</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:8.25pt;"> tmpSheet </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Is</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Nothing</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        msg$ = </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;Не удалось добавить скрытый лист «tmpWQ» в файл программы&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        MsgBox msg, vbCritical, </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;Невозможно выполнить запрос к сайту&quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;">: </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    tmpSheet.Cells.Delete: DoEvents: Err.Clear</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">With</span><span style=" font-family:'monospace'; font-size:8.25pt;"> tmpSheet.QueryTables.Add(</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;URL;&quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;"> &amp; SearchLink$, tmpSheet.Range(</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#800000;">&quot;A1&quot;</span><span style=" font-family:'monospace'; font-size:8.25pt;">))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:8.25pt;"> Len(Tables$) </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">            .WebSelectionType = xlSpecifiedTables</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">            .WebTables = Tables$</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">            .WebSelectionType = xlEntirePage</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        .FillAdjacentFormulas = </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">False</span><span style=" font-family:'monospace'; font-size:8.25pt;">: .PreserveFormatting = </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        .RefreshOnFileOpen = </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">False</span><span style=" font-family:'monospace'; font-size:8.25pt;">: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        .WebFormatting = xlWebFormattingAll</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        .Refresh BackgroundQuery:=</span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">False</span><span style=" font-family:'monospace'; font-size:8.25pt;">: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:8.25pt;"> Err = 0 </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Then</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:8.25pt;"> GetQueryRange = tmpSheet.UsedRange</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">        .Delete: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt;">    </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">With</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:8.25pt;"> </span><span style=" font-family:'monospace'; font-size:8.25pt; color:#000080;">Function</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">43675 просмотров </li></ul></td>
<td></td></tr></table></body></html>