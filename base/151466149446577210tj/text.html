<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">Смена владельца и прав на папку и ее содержимое, в которой запущен батник</span> (Full Access &lt;-&gt; Read Only)<br />Автор: <span style=" font-weight:600; color:#800080;">Dragokas</span><br /><br />1) <span style=" font-weight:600; font-style:italic;">RO.cmd</span> (ReadOnly) - делает все файлы и папки доступными только для чтения и выполнения.<br />Дополнительно разрешается в текущей папке - создавать файлы.<br />Все остальные операции, в т.ч. и создание файлов в подкаталогах - запрещено.<br /><br />2) <span style=" font-weight:600; font-style:italic;">FA.cmd</span> (FullAccess) - восстанавливает полный доступ для всех пользователей.<br /><br />Для нормальной работы в ОС Windows Vista, Win 7 батник нужно запускать правой кнопкой мыши <span style=" font-weight:600;">&quot;От имени Администратора&quot;</span>.<br /><br /><span style=" font-weight:600;">Как пользоваться:</span><br /><span style=" font-weight:600; color:#ff0000;">Соблюдайте правила: з</span><span style=" font-weight:600; color:#ff0000;">апускать батник только из той папки, в которой нужно ограничить доступ (RO.cmd) или получить полные права (FA.cmd).</span><span style=" font-weight:600;"><br /></span><span style=" font-weight:600; color:#ff0000;">Работает рекурсивно для всех подкаталогов, начиная </span><span style=" font-weight:600; text-decoration: underline; color:#ff0000;">с каталога, в котором находится батник.</span><br /><br />Для корректной работы потребуется утилита из состава Microsoft Support Tools - ICACLS<br />(включена в ОС Windows Server 2003, начиная с SP2).<br /><br /><span style=" font-weight:600;">Поддержка:</span><br />Скрипт протестирован в средах английской и русской локализаций, а также:<br />1) Windows XP SP2 (требуется утилита ICACLS). ICACLS из состава Windows 7 несовместим с XP.<br />2) Windows Server 2003 SP2<br />3) Windows 7 SP1<br /><br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#0000ff;">Сохранять в кодировке OEM-866.</span><br /><br /><span style=" font-weight:600;">FA.cmd</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Код (DOS): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#33cc33;">@</span><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> off<br /><a href="http://www.ss64.com/nt/if.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">if</span></a> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">1</span>&quot;==&quot;&quot; <span style=" color:#33cc33;">(</span><br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Echo</span></a> Working...<br /><a href="http://www.ss64.com/nt/call.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">Call</span></a> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~dpnx0</span>&quot; 0 1<span style=" color:#33cc33;">&gt;</span><a href="http://www.ss64.com/nt/nul.html"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">nul</span></a> 2<span style=" color:#33cc33;">&gt;&amp;</span>1<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Echo</span></a> Ready...<br /><a href="http://www.ss64.com/nt/goto.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">Goto</span></a> :<span style=" font-weight:600; color:#b100b1;">eof</span><br /><span style=" color:#33cc33;">)</span><br /><br /><a href="http://www.ss64.com/nt/setlocal.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Setlocal</span></a> Enableextensions<br /><br /><a href="http://www.ss64.com/nt/set.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Set</span></a> Cur=<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~dp0</span><br /><a href="http://www.ss64.com/nt/set.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Set</span></a> Cur=<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur:~0,-1</span><span style=" color:#33cc33;">%</span><br /><br />takeown /f &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /r /d y<br /><br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /grant All:f /T /C<br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /grant Все:f /T /C</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">RO.cmd</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Код (DOS): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#33cc33;">@</span><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> off<br /><a href="http://www.ss64.com/nt/if.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">if</span></a> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">1</span>&quot;==&quot;&quot; <span style=" color:#33cc33;">(</span><br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Echo</span></a> Working...<br /><a href="http://www.ss64.com/nt/call.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">Call</span></a> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~dpnx0</span>&quot; 0 1<span style=" color:#33cc33;">&gt;</span><a href="http://www.ss64.com/nt/nul.html"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">nul</span></a> 2<span style=" color:#33cc33;">&gt;&amp;</span>1<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Echo</span></a> Ready...<br /><a href="http://www.ss64.com/nt/goto.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">Goto</span></a> :<span style=" font-weight:600; color:#b100b1;">eof</span><br /><span style=" color:#33cc33;">)</span><br /><br /><a href="http://www.ss64.com/nt/setlocal.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Setlocal</span></a> Enableextensions<br /><br /><a href="http://www.ss64.com/nt/set.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Set</span></a> Cur=<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~dp0</span><br /><a href="http://www.ss64.com/nt/set.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">Set</span></a> Cur=<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur:~0,-1</span><span style=" color:#33cc33;">%</span><br /><br />takeown /f &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /r /d y<br /><br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /deny All:<span style=" color:#33cc33;">(</span>DE,WDAC,WO,AS,WD,AD,WEA,DC,WA<span style=" color:#33cc33;">)</span> /T /C<br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /deny Все:<span style=" color:#33cc33;">(</span>DE,WDAC,WO,WD,AS,AD,WEA,DC,WA<span style=" color:#33cc33;">)</span> /T /C<br /><br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /grant All:<span style=" color:#33cc33;">(</span>RC,S,GR,GW,GE,<a href="http://www.ss64.com/nt/rd.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">RD</span></a>,REA,X,RA<span style=" color:#33cc33;">)</span> /T /C<br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /grant Все:<span style=" color:#33cc33;">(</span>RC,S,GR,GW,GE,<a href="http://www.ss64.com/nt/rd.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">RD</span></a>,REA,X,RA<span style=" color:#33cc33;">)</span> /T /C<br /><br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /grant All:<span style=" color:#33cc33;">(</span>WD<span style=" color:#33cc33;">)</span> /C<br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Cur</span><span style=" color:#33cc33;">%</span>&quot; /grant Все:<span style=" color:#33cc33;">(</span>WD<span style=" color:#33cc33;">)</span> /C<br /><br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~dpnx0</span>&quot; /grant:r Все:f /C<br />icacls &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~dpnx0</span>&quot; /grant:r All:f /C</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В коде использован метод двойного запуска скрипта исключительно для упрощения<br />перенаправления потока вывода в NUL.<br />Метод &quot;обворачивания&quot; скобками приводил к синтаксическим ошибкам в силу<br />некоторых особенностей работы утилиты ICACLS. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Вложения:</span> </p></body></html>