<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<html>
<div itemprop="text" id="text_a35902214" class="post-text"><p>Чтобы 
пройти через все папки, выполните следующие действия:
Пройдите один раз через все основные папки в Outlook, а затем для каждой
 основной папки пройдите через каждую подпапку. Если у вас больше 
филиалов, то угадайте, что вам нужно добавить дополнительные уровни в 
код «для каждой папки3 в папке2.folders». Также в условии if вы можете 
проверить дату отправки почты и перейти от новейшего к самому старому. 
Установите <code class="prettyprint-override prettyprinted" style=""><span class="pln">oMsg</span><span class="pun">.</span><span class="pln">display</span></code>, чтобы узнать, какая почта проверяется.</p>
<p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="typ">Public</span><span class="pln"> </span><span class="typ">Sub</span><span class="pln"> FORWARD_Mail_STAT_IN</span><span class="pun">()</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Dim</span><span class="pln"> </span><span class="typ">Session</span><span class="pln"> </span><span class="typ">As</span><span class="pln"> </span><span class="typ">Outlook</span><span class="pun">.</span><span class="typ">NameSpace</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Dim</span><span class="pln"> oOutLookObject </span><span class="typ">As</span><span class="pln"> </span><span class="typ">New</span><span class="pln"> </span><span class="typ">Outlook</span><span class="pun">.</span><span class="typ">Application</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Dim</span><span class="pln"> olNameSpace </span><span class="typ">As</span><span class="pln"> </span><span class="typ">NameSpace</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Dim</span><span class="pln"> oItem </span><span class="typ">As</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Dim</span><span class="pln"> oMsg </span><span class="typ">As</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Dim</span><span class="pln"> searchkey </span><span class="typ">As</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Set</span><span class="pln"> oOutLookObject </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CreateObject</span><span class="pun">(</span><span class="str">"Outlook.Application"</span><span class="pun">)</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Set</span><span class="pln"> oItem </span><span class="pun">=</span><span class="pln"> oOutLookObject</span><span class="pun">.</span><span class="typ">CreateItem</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Set</span><span class="pln"> olNameSpace </span><span class="pun">=</span><span class="pln"> oOutLookObject</span><span class="pun">.</span><span class="typ">GetNamespace</span><span class="pun">(</span><span class="str">"MAPI"</span><span class="pun">)</span><span class="pln"> </p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Set</span><span class="pln"> </span><span class="typ">Session</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Application</span><span class="pun">.</span><span class="typ">Session</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">Set</span><span class="pln"> </span><span class="typ">Folders</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="typ">Folders</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"></span><span class="typ">For</span><span class="pln"> </span><span class="typ">Each</span><span class="pln"> </span><span class="typ">Folder</span><span class="pln"> </span><span class="typ">In</span><span class="pln"> </span><span class="typ">Folders</span><span class="pln"> </span><span class="str">'main folders in Outlook </p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">     xxx = Folder.Name </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      For Each Folder2 In Folder.Folders '</span><span class="pln">all the subfolders </span><span class="kwd">from</span><span class="pln"> a main folder </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      yyy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Folder2</span><span class="pun">.</span><span class="typ">Name</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      </span><span class="typ">Set</span><span class="pln"> oFolder </span><span class="pun">=</span><span class="pln"> olNameSpace</span><span class="pun">.</span><span class="typ">Folders</span><span class="pun">(</span><span class="pln">xxx</span><span class="pun">).</span><span class="typ">Folders</span><span class="pun">(</span><span class="pln">yyy</span><span class="pun">)</span><span class="pln"> </span><span class="str">'in each folder we search all the emails </p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">       For Z = oFolder.Items.Count To 1 Step -1 '</span><span class="pln"> </span><span class="typ">For</span><span class="pln"> Z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="typ">To</span><span class="pln"> oFolder</span><span class="pun">.</span><span class="typ">Items</span><span class="pun">.</span><span class="typ">Count</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        </span><span class="typ">With</span><span class="pln"> oFolder</span><span class="pun">.</span><span class="typ">Items</span><span class="pun">(</span><span class="pln">Z</span><span class="pun">)</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        </span><span class="typ">Set</span><span class="pln"> oMsg </span><span class="pun">=</span><span class="pln"> oFolder</span><span class="pun">.</span><span class="typ">Items</span><span class="pun">(</span><span class="pln">Z</span><span class="pun">)</span><span class="pln"> </p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        </span><span class="typ">If</span><span class="pln"> </span><span class="typ">Format</span><span class="pun">(</span><span class="pln">oMsg</span><span class="pun">.</span><span class="typ">SentOn</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mm/dd/yyyy"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Format</span><span class="pun">(</span><span class="typ">Date</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mm/dd/yyyy"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">And</span><span class="pln"> </span><span class="typ">InStr</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LCase</span><span class="pun">(</span><span class="pln">oMsg</span><span class="pun">.</span><span class="typ">Subject</span><span class="pun">),</span><span class="pln"> searchkey</span><span class="pun">,</span><span class="pln"> vbTextCompare</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="typ">Then</span><span class="pln"> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">oMsg</span><span class="pun">.</span><span class="pln">display </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">         </span><span class="str">' insert code </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">         End If </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">         End With </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        Next Z </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      Next Folder2 </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">     Next Folder </span></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
</body>
</html></p></body></html>