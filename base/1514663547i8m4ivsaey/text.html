<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td></td>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/Array2worksheet"><span style=" text-decoration: underline; color:#0000ff;">Перенос двумерного массива на лист Excel</span></a> </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/taxonomy/term/14"><span style=" text-decoration: underline; color:#0000ff;">Макросы VBA Excel</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/sheets_and_ranges"><span style=" text-decoration: underline; color:#0000ff;">Работа с диапазонами ячеек и листами</span></a></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/arrays"><span style=" text-decoration: underline; color:#0000ff;">Обработка массивов</span></a> </li></ul></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функция Array2worksheet позволяет быстро сформировать лист на основании данных из двумерного массива</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> Array2worksheet(</span><span style=" font-family:'monospace'; color:#000080;">ByRef</span><span style=" font-family:'monospace';"> sh </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> Worksheet, </span><span style=" font-family:'monospace'; color:#000080;">ByVal</span><span style=" font-family:'monospace';"> Arr, </span><span style=" font-family:'monospace'; color:#000080;">ByVal</span><span style=" font-family:'monospace';"> ColumnsNames)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Получает двумерный массив Arr с данными,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' и массив заголовков столбцов ColumnsNames.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Заносит данные из массива на лист sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 1) &gt; sh.Rows.Count - 1 </span><span style=" font-family:'monospace'; color:#000080;">Or</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 2) &gt; sh.Columns.Count </span><span style=" font-family:'monospace'; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        MsgBox </span><span style=" font-family:'monospace'; color:#800000;">&quot;Массив не влезет на лист &quot;</span><span style=" font-family:'monospace';"> &amp; sh.Name, vbCritical, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">               </span><span style=" font-family:'monospace'; color:#800000;">&quot;Размеры массива: &quot;</span><span style=" font-family:'monospace';"> &amp; </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 1) &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot;*&quot;</span><span style=" font-family:'monospace';"> &amp; </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 2): </span><span style=" font-family:'monospace'; color:#000080;">End</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">With</span><span style=" font-family:'monospace';"> sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .UsedRange.Clear</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        ColumnsNamesCount = </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(ColumnsNames) - </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(ColumnsNames) + 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .Range(</span><span style=" font-family:'monospace'; color:#800000;">&quot;a1&quot;</span><span style=" font-family:'monospace';">).Resize(, ColumnsNamesCount).Value = ColumnsNames</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .Range(</span><span style=" font-family:'monospace'; color:#800000;">&quot;a1&quot;</span><span style=" font-family:'monospace';">).Resize(, ColumnsNamesCount).Interior.ColorIndex = 15</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .Range(</span><span style=" font-family:'monospace'; color:#800000;">&quot;a2&quot;</span><span style=" font-family:'monospace';">).Resize(</span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 1), </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 2)).Value = Arr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .UsedRange.EntireColumn.AutoFit</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">With</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> ПримерИспользованияФункции_Array2worksheet()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' формируем двумерный массив, и заполняем его данными</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">ReDim</span><span style=" font-family:'monospace';"> MyArr(1 </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> 20, 1 </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> 3)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">For</span><span style=" font-family:'monospace';"> i = 1 </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> 20: </span><span style=" font-family:'monospace'; color:#000080;">For</span><span style=" font-family:'monospace';"> j = 1 </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> 3: MyArr(i, j) = </span><span style=" font-family:'monospace'; color:#800000;">&quot;Ячейка &quot;</span><span style=" font-family:'monospace';"> &amp; i &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot; * &quot;</span><span style=" font-family:'monospace';"> &amp; j: </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';"> j: </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';"> i</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' создаём новую книгу, а в ней - лист для массива</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Dim</span><span style=" font-family:'monospace';"> sh </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> Worksheet: </span><span style=" font-family:'monospace'; color:#000080;">Set</span><span style=" font-family:'monospace';"> sh = Workbooks.Add(-4167).Worksheets(1): sh.Name = </span><span style=" font-family:'monospace'; color:#800000;">&quot;Массив&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' заносим данные из массива MyArr на лист sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    Array2worksheet sh, MyArr, Array(</span><span style=" font-family:'monospace'; color:#800000;">&quot;Столбец 1&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;Столбец 2&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;Столбец 3&quot;</span><span style=" font-family:'monospace';">)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Несколько модернизированный вариант функции - вставку на лист можно начинать с любой выбранной ячейки:</p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> Array2worksheetEx(</span><span style=" font-family:'monospace'; color:#000080;">ByRef</span><span style=" font-family:'monospace';"> FirstCell </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> Range, </span><span style=" font-family:'monospace'; color:#000080;">ByVal</span><span style=" font-family:'monospace';"> Arr, </span><span style=" font-family:'monospace'; color:#000080;">ByVal</span><span style=" font-family:'monospace';"> ColumnsNames)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Получает двумерный массив Arr с данными, и массив заголовков столбцов ColumnsNames.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Заносит данные из массива на лист, начиная с ячейки FirstCell</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Dim</span><span style=" font-family:'monospace';"> sh </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> Worksheet: </span><span style=" font-family:'monospace'; color:#000080;">Set</span><span style=" font-family:'monospace';"> sh = FirstCell.Worksheet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 1) &gt; sh.Rows.Count - FirstCell.Row </span><span style=" font-family:'monospace'; color:#000080;">Or</span><span style=" font-family:'monospace';"> _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">       </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 2) &gt; sh.Columns.Count - FirstCell.Column </span><span style=" font-family:'monospace'; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        MsgBox </span><span style=" font-family:'monospace'; color:#800000;">&quot;Массив не влезет на лист &quot;</span><span style=" font-family:'monospace';"> &amp; sh.Name, vbCritical, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">               </span><span style=" font-family:'monospace'; color:#800000;">&quot;Размеры массива: &quot;</span><span style=" font-family:'monospace';"> &amp; </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 1) &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot;*&quot;</span><span style=" font-family:'monospace';"> &amp; </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 2): </span><span style=" font-family:'monospace'; color:#000080;">End</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    ColumnsNamesCount = </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(ColumnsNames) - </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(ColumnsNames) + 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">On</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Error</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Resume</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">With</span><span style=" font-family:'monospace';"> FirstCell.Resize(1, ColumnsNamesCount)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .ClearContents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        Intersect(sh.Range((FirstCell.Row + 1) &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot;:&quot;</span><span style=" font-family:'monospace';"> &amp; sh.Rows.Count), _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                  sh.UsedRange, .EntireColumn).ClearContents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .Value = ColumnsNames</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .Interior.ColorIndex = 15: .Font.Bold = </span><span style=" font-family:'monospace'; color:#000080;">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        FirstCell.Offset(1).Resize(</span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 1), </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(Arr, 2)).Value = Arr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .EntireColumn.AutoFit</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">With</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">29844 просмотра</li></ul></td></tr></table></body></html>