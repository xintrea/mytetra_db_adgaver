<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Win32 API в VBA</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Win32 API - это функции, которые находятся в библиотеках Windows. Все программирование под Windows, неважно на каком языке, в конце концов сводится к вызову этих функцмй. Когда вы используете MsgBox на Visual Basic, вы вызываете функцию-оболочку в интерпретаторе. На самом деле будет вызвана фукнция WinAPI MessageBoxA, показывающая диалоговое окно. Функции WinAPI можно вызывать и напрямую, без помощи встроенных средств языка. Реализации API в разных версиях Windows отличаются. Некоторые функции могут не работать в Windows 98 или 95. Подробную информацию о каждой функции и ее параметрах можно найти в MSDN. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для того, чтобы использовать функции Win 32 API их необходимо объявить, используя оператор <span style=" font-weight:600;">Declare</span>. <br /><br /><span style=" font-family:'Courier New,courier';">Declare Function GetCurrentDirectory Lib &quot;kernel32&quot; Alias &quot;GetCurrentDirectoryA&quot; (ByVal buffer As String, ByVal nSize As Long) As Long </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таким образом мы объявили функцию GetCurrentDirectory, которая возвращает текущий каталог. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рассмотрим синтаксис оператора Declare подробнее. Есть два варианта синтаксиса: для функции и для процедуры. (то что в скобках необязательно) <br /><br /><span style=" font-family:'Courier New,courier';">[Public или Private] Declare Sub имя_процедуры lib &quot;имя_динамической_библиотеки&quot; [Alias &quot;псевдоним&quot;] [(параметры)] <br /><br />[Public или Private] Declare Function имя_функции lib &quot;имя_динамической_библиотеки&quot; [Alias &quot;псевдоним&quot;] [(параметры)] [as тип возврата] </span><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для использования функции нужно знать библиотеку, где она находится, имя функции, и все ее параметры. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пример использования: <span style=" font-family:'Courier New,courier';"><br /><br />Sub APIDemo()<br />  Dim TextBuffer As String<br />  Dim TextLen As Long<br />  TextBuffer = String(256, 0)<br />  TextLen = GetCurrentDirectory(TextBuffer, Len(TextBuffer))<br />  TextBuffer = Left(TextBuffer, TextLen)<br />  MsgBox (TextBuffer)<br />End Sub </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Объявляем переменные. TextBuffer = String(256, 0) - строка длиной 256 символов, заполненная нулями. В результате выполнения функции получаем длину строки в TextLen и саму строку в TextBuffer. Строка будет в формате C, поэтому обрезаем лишние нулевые символы функцией Left. </p></body></html>