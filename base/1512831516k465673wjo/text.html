<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы уже знаете основные объекты VBA Excel и действия с ними. Пора переходить к настоящей автоматизации. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> <br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:15px; font-weight:600;">Циклы</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Циклы - повторяющиеся действия. Бывает нужно сделать одно и то же действие определенное количество раз (например, на пяти листах вставить столбец с одинаковыми данными или заголовком), а бывает, что нужно делать какое-то действие &quot;до тех пор, пока ...&quot; (например, пока не найдется строка с нужными данными). В VBA для двух этих случаев есть два цикла: &quot;<span style=" font-style:italic;">for</span>&quot; - для повторения действий заданное число раз, и &quot;<span style=" font-style:italic;">while</span>&quot; - для повторения действий &quot;до тех пор, пока ...&quot;. Разница между двумя циклами только одна: в первом случае вы знаете, сколько раз надо повторить цикл, а во втором - не знаете, но знаете, когда нужно остановиться. Есть и другие циклы, но их можно легко заменить этими двумя. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Цикл for</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Возьмем наш пример: нужно на пять листов вставить, например, первый столбец, пустой. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    For i=1 to 5</span>                           ' присваивает значения переменной i в первый раз 1, </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                                            ' затем прибавляя по 1 с каждым новым заходом в </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                                            ' цикл. Значение 5 будет последним. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">         <span style=" font-style:italic;">Sheets(i).Activate  </span>           ' активируем очередной лист </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">         <span style=" font-style:italic;">Columns(1).Insert  </span>           ' вставляем первый столбец </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    Next i    </span>                               ' конец цикла, то есть конец списка действий, </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                                            ' которые нужно сделать 5 раз подряд </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Цикл While</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Цикл <span style=" font-style:italic;">While</span> используется чаще, чем <span style=" font-style:italic;">For</span>, потому что часто мы не знаем, сколько раз нужно сделать какое-то действие. Он используется, например, при поиске строчки с заданными критериями. Рассмотрим такой пример: в столбцах есть данные - фамилия (1 столбец), имя (2 столбец), отчество (3), год рождения (4). Нам нужно найти Иванова и, например, удалить его из базы. Допустим, мы знаем, что такой человек один. Тогда программа может быть такой: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    i=2</span>        ' определяем, с какой строки начинается база (в первой строке расположены заголовки) </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    Do While Cells(i,1)&lt;&gt;&quot;Иванов&quot; </span>                 ' делать до тех пор, пока </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    i=i+1  </span>                                                          ' фамилия&lt;&gt;Иванов </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    Loop  </span>                                   </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В итоге цикл закончится на искомой строчке. После этого можно делать с этой строчкой всё, что угодно. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Или, может быть, мы не знаем, сколько Ивановых в нашей базе и хотим удалить их всех. Здесь нам понадобится условный оператор <span style=" font-style:italic;">If</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Оператор If</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Условный оператор If (если) называется так, потому что проверяет выполнение условия. Принцип его работы понять очень просто: если условие выполняется, то делаем так, иначе делаем так. Рассмотрим наш пример: нам нужно пробежать по всей базе, то есть до тех пор, пока строчки не пусты, т.е: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    Do While Cells(i,1)&lt;&gt;&quot;&quot;</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Заметим, что важно, чтобы не было пропусков. Если в вашей базе есть строки с пустыми ячейками, то можно указывать более сложное условие, например  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-style:italic;">Do While</span> <span style=" font-style:italic;">Сells(i,1)&lt;&gt;&quot;&quot; and Сells(i+1,1)&lt;&gt;&quot;&quot; and Сells(i+2,1)&lt;&gt;&quot;&quot;</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">то есть нужно, чтобы три строки подряд были пустыми в первом столбце. Или </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-style:italic;">Do While</span> <span style=" font-style:italic;">Сells(i,1)&lt;&gt;&quot;&quot; and Сells(i,2)&lt;&gt;&quot;&quot; and Сells(i,3)&lt;&gt;&quot;&quot;</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">то есть нужно, чтобы в первом, втором и третьем столбцах строки было пусто. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Воспользуемся этим условием </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">    i=2</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-style:italic;">Do While</span> <span style=" font-style:italic;">Сells(i,1)&lt;&gt;&quot;&quot; and Сells(i,2)&lt;&gt;&quot;&quot; and Сells(i,3)&lt;&gt;&quot;&quot;</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      <span style=" font-style:italic;">  If Cells(i,1)=&quot;Иванов&quot; then </span>    ' Если в строке Иванов </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">          <span style=" font-style:italic;">  Rows(i).Delete    </span>              ' тогда удаляем эту строку </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">          <span style=" font-style:italic;">  i=i-1  </span>                              ' возвращаемся на строку выше </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        <span style=" font-style:italic;">End If</span>                                ' закрываем условие </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">      <span style=" font-style:italic;">  i=i+1  </span>                             ' переходим к следующей строке </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-style:italic;">Loop</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обрати внимание на необходимость возвращаться на строку выше при удалении строки. В программе мы указываем номер строки, а переходим к следующей, прибавляя единичку. Если удалить строку номер 5, то на её место &quot;въедут&quot; данные шестой строки, став снова пятой. Но так как эти данные мы не просмотрели, придется зайти в строку №5 снова. Чтобы это сделать, после удаления отнимаем единичку, потом при переходе прибавляем единичку и попадаем в строку с тем же номером. </p></body></html>