<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td width="100%" style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Изменение размеров элементов управления внутри форм с изменяемыми границами </span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Интерфейс пользователя, популяризированный компанией Microsoft, быстро завоевал пользователей своим чрезвычайным удобством. Главным принципом организации этого интерфейса можно считать то, что каждое приложение состоит из одного или более окон. Мы можем открыть несколько приложений и работать с ними одновременно. При этом одним из замечательных свойств окон является возможность их произвольного размещения на экране монитора. <br />    В этой статье мы затронем одну незначительную, но, на наш взгляд, все же важную тему – изменение размеров элементов управления внутри форм с изменяемыми границами. Стандартный набор функций окна не позволяет автоматически контролировать размеры элементов, принадлежащих форме, поэтому реализация задачи ложится на плечи программиста. На первый взгляд задача может показаться слишком простой, но ее практическое решение обнаруживает ряд важных нюансов, которые необходимо знать. <br />    Статья ориентированна на пользователей достаточно знакомых со средой разработки VB-приложений. Поэтому мы не будем останавливаться на инструкциях по добавлению в формы меню и элементов управления. Все изложенное касается исключительно решения поставленной задачи. <br />    Для начала создадим каркас приложения. К сожалению, обойтись без этих первичных приготовлений нельзя, но в целях экономии вашего времени к статье прилагается уже готовый проект-каркас созданный в среде VB 6.0. <br />     <br />    Итак, создайте стандартный exe-проект. В единственную форму проекта Form1 добавьте хотя бы один элемент меню. Определите для формы следующие свойства: <br />     <br />    ScrollBars = false <br />    BorderStyle = 2 ‘Sizeable <br />     <br />    Теперь необходимо позаботиться о главных героях нашей статьи – элементах управления. Добавьте на форму текстовое поле Text1 и кнопку Button1. Расположите их так, чтобы текстовое поле занимало практически всю площадь формы, оставляя только место внизу для кнопки. Свойства Top и Left установите равными 0. Меню и элементы управления не будут играть никакой практической роли, – для нас будут важны лишь их размеры. Запустите проект. Результатом должно быть нечто похожее на Рис 1. <br />     <br /></span><img src="image18961.png" style="vertical-align: top;" /><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />     <br />     <br />    А теперь попробуйте изменить размеры формы. Все элементы управления остаются на своих местах и при своих размерах. Для того чтобы элементы правильно позиционировались на форме, необходимо добавить в обработку события изменения размера формы соответствующий код. Мы должны закрепить некоторые параметры элементов управления относительно размеров формы-контейнера. Вычислите, например, разницу следующих свойств Form1.Width – Form1.Text1.Width. Число, которое мы получим – это разница между шириной формы и шириной текстового поля. Запомните его, для нас обозначим его как А. Очевидно, что при любых размерах формы эта разница должна оставаться постоянной. <br />    Аналогично определим разницу между высотой окна и высотой текстового поля: Form1.Height – Form1.Text1.Height. Эту разницу запомним как число В. Теперь добавьте в код формы следующий обработчик события изменения размера окна: <br />     <br />    Private Sub Form_Resize() <br />        <br />       Text1.Width = Me.Width - А <br />       Text1.Height = Me.Height - В <br />        <br />    End Sub <br />     <br />    Не забудьте вместо А и В вставить реальные значения, которые у Вас получились. Благодаря обработчику изменение размеров формы будет приводить к соответствующим изменениям в параметрах текстового поля. <br />    Запустите проект и снова поэкспериментируйте с изменением размеров окна. Размеры текстового окна изменяются правильно, а вот кнопка никак не реагирует. Что ж уважим и кнопку. Размеры кнопки можно оставлять постоянными, а вот ее положение по вертикали необходимо изменять при изменении размеров окна. Найдем еще одну разницу Form1.Height – Form1.Button1.Top. <br />    Для чего мы его вычисли, думаю пояснять не нужно. Запомним число как С. Модифицируйте обработчик события Resize следующим образом: <br />     <br />    Private Sub Form_Resize() <br />        <br />       Text1.Width = Me.Width - А <br />       Text1.Height = Me.Height - В <br />       Button1.Top = Me.Height - C <br />     <br />    End Sub <br />     <br />    Запустите проект. Теперь как бы все нормально, но это, к сожалению, до поры до времени. Вот тут и начинаются те самые нюансы, о которых было сказано в начале статьи. Таких нюансов можно по началу не заметить, но в процессе реального использования рано или поздно они все равно «всплывают». <br />    Попробуйте уменьшить размеры окна до совсем малых размеров. Возникает ошибка, когда мы пытаемся присвоить свойствам элементов отрицательные значения. Ширина окна должна быть достаточно для размещения кнопки с учетом расстояний до краев формы, т.е. не меньше, чем Button1.Width + TextWDiff. Что касается высоты, то нужно учесть, что кнопка не должна «залазить» на текстовое поле. Для этого необходимо оставить для нее место, равное ее высоте, а также зарезервировать место для текстового поля. Пускай, для простоты, эта величина будет равняться 2B. <br />    Чтобы меньше использовать условные обозначения, определим дополнительные переменные. Новый вариант обработчика имеет следующий вид: <br />     <br />    Private Sub Form_Resize() <br />        <br />       Dim TextWDiff As Integer <br />       Dim TextHDiff As Integer <br />       Dim ButtTDiff As Integer <br />        <br />       TextWDiff = А <br />       TextHDiff = В <br />       ButtTDiff = С <br />        <br />       If Me.Height &lt; 2 * В Then Me.Height = 2 * В <br />       If Me.Width &lt; Button1.Width + TextWDiff Then Me.Width = _ <br />          Button1.Width + TextWDiff <br />     <br />       Text1.Width = Me.Width - TextWDiff <br />       Text1.Height = Me.Height - TextHDiff <br />       Button1.Top = Me.Height - ButtTDiff <br />        <br />    End Sub <br />     <br />    Переходим к следующему нюансу. Попробуйте сначала максимизировать, а потом свернуть дочернее окно. Максимизация проходит нормально, а вот с минимизацией возникают проблемы – ошибка, происходящая потому, что изменять размеры окна, когда форма свернута или развернута нельзя. Когда мы разворачиваем форму, высота достаточна для вмещения текстового поля и кнопки, поэтому обработчик не изменяет размер формы, а вот при минимизации условие выполняется и происходит ошибка. Так как размеры элементов в свернутой форме не имеют для нас значения, можно отказаться от обработки вообще, вставив в обработчик первую после определений строчку: <br />     <br />    If Me.WindowState = 1 Then Exit Sub <br />     <br />    Все возможные вариации пользователя с размерами окна учтены. Форму можно расширять, вытягивать, сворачивать, в общем, делать с ней все, что заблагорассудится. Но есть еще одно действие пользователя, которое хотя и влияет на размеры на размеры формы косвенно, но может свести на нет все наши старания. <br />    Предлагаю провести следующий эксперимент. Запустите проект, и измените настройки рабочего стола, в частности увеличите высоту окна заголовка, размер рамки активного окна и высоту меню. Посмотрите на Рис 2. <br />     <br /></span><img src="image3159.png" style="vertical-align: top;" /><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />     <br />    Кнопка на половину закрыта, а правой рамки текстового поля не видно, так как оно “вылезло” за рамки окна. Изменяя настройки внешнего вида окна, мы фактически увеличили размер косметических элементов и, ровно на столько же уменьшили размеры полезной площади формы-контейнера. Ширина рамки, высота меню и окна заголовка, все это входит в общие размеры формы. С другой стороны координаты (0,0) располагаются в левом верхнем углу полезной площади. <br />    Пользователь имеет полное право изменить эти настройки. Приведенный на Рис 2 пример, возможно, несколько преувеличен, но вы можете сами убедиться, что вполне нормальные схемы настроек рабочего стола подразумевают небольшую разницу этих величин. Сравните, например, «Обычную» схему и схемы «Баклажан» или «Розовая». А что уж говорить про схемы для людей с плохим зрением. <br />    Получается, что числа А, В, С не постоянны. Разберемся, из каких величин они состоят. Число А состоит из двойного размера рамок окна и той разницы, которую вы сами предполагаете. Мы специально установили свойство Left равным 0, чтобы разница состояла только из рамок самого окна. Изменяя ширину рамки активного окна, вы оставляете меньше площади для текстового поля. Именно поэтому при постоянной величине А, правая рамка поля отсекается. <br />    Разница В состоит из рамок окна, высоты окна заголовка, высоты меню и места, выделенного под кнопку. Наконец, разница С состоит из той же переменной части, что и высота текстового поля и места, выделенного под поле. <br />    Для определения настроек рабочего стола можно воспользоваться специальной функцией API – GetSystemMetrics. Внесите ее определение в отдельный модуль. <br />     <br />    Public Declare Function GetSystemMetrics Lib _ <br />       &quot;user32&quot; (ByVal nIndex As Long) As Long <br />    Public Const SM_CXFRAME = 32 <br />    Public Const SM_CYFRAME = 33 <br />    Public Const SM_CYCAPTION = 4 <br />    Public Const SM_CYMENU = 15 <br />     <br />    Вынесение функции в независимый модуль сделано для того, чтобы возможным был вызов функции из окна отладки. <br />    Тут приведено также определение некоторых констант, которые функция принимает в качестве аргумента. Функция возвращает размерность в соответствии с указанной константой. Возвращаемый размер всегда измеряется в пикселях. Константы SM_CXFRAME и SM_CYFRAME определяют соответственно размер вертикальной и горизонтальной рамки окна. Нужно учесть, что размеры в VB по умолчанию задаются в твипах. При этом один пиксель равен 15-и твипам. <br />    Замените в обработчике определение переменной TextWDiff на следующее: <br />     <br />    TextWDiff = GetSystemMetrics(SM_CXFRAME) * 15 * 2 <br />     <br />    Теперь при каждом изменении ширины окна величина А будет заново вычисляться как двойной размер рамки окна. <br />     <br />    Значение остальных констант, которые функция GetSystemMetrics принимает в качестве аргумента, следующее: <br />     <br />    SM_CYCAPTION – высота окна заголовка; <br />    SM_CYMENU – высота меню; <br />     <br />    В окне отладки (Ctrl+G) впишите следующую строчку (одной строкой): <br />     <br />    ? (GetSystemMetrics(SM_CYCAPTION)+GetSystemMetrics(SM_CYMENU)+ 2* GetSystemMetrics (SM_CYFRAME))*15 <br />     <br />    Результатом будет изменяемая составляющая числа В. Теперь, отняв от В полученное число, получим постоянную составляющую D. Определение переменной TextHDiff заменим на: <br />     <br />    TextHDiff = D + 15 * (GetSystemMetrics(SM_CYCAPTION) + 2 _ <br />       GetSystemMetrics(SM_CYFRAME)) <br />     <br />    Разницу С можно теперь вычислить по-другому. Определим ее как расстояние между нижней границей текстового поля и верхним углом кнопки. Вычислите С как Form1.Button1.Top – Form1.Text1.Height. Теперь обработчик события Resize будет выглядеть так: <br />     <br />    Private Sub Form_Resize() <br />        <br />       Dim TextWDiff As Integer <br />       Dim TextHDiff As Integer <br />       Dim ButtTDiff As Integer <br />        <br />       TextWDiff = GetSystemMetrics(SM_CXFRAME) * 15 * 2 <br />       TextHDiff = D + 15 * (GetSystemMetrics(SM_CYCAPTION) + _ <br />          GetSystemMetrics(SM_CYMENU) + _ <br />          2*GetSystemMetrics(SM_CYFRAME)) <br />       ButtTDiff = С <br />        <br />       If Me.WindowState = 1 Then Exit Sub <br />        <br />       If Me.Height &lt; 2 * В Then Me.Height = 2 * В <br />       If Me.Width &lt; Button1.Width + TextWDiff Then Me.Width = _ <br />          Button1.Width + TextWDiff <br />        <br />       Text1.Width = Me.Width - TextWDiff <br />       Text1.Height = Me.Height - TextHDiff <br />       Button1.Top = Text1.Height + ButtTDiff <br />        <br />    End Sub <br />     <br />    На Рис. 3 показан внешний вид формы после внесенных изменений в настройки рабочего стола. Теперь все верно. <br />     <br /></span><img src="image17720.png" style="vertical-align: top;" /><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"><br />     <br />    Напоследок рассмотрим еще один вариант расположения элементов управления. Предположим, что кнопка Button1 всегда должна располагаться по центру формы. Для решения этой задачи нужно знать полезную ширину формы и ширину кнопки. Зная текущую ширину формы, мы можем определить свойство кнопки Left. Вставьте в обработчик следующую строку: <br />     <br />    Button1.Left = (Me.Width - TextWDiff - Button1.Width) / 2 <br />     <br />    Как бы вы не изменяли теперь размеры формы, кнопка всегда будет оставаться посередине. <br />    Что же, теперь все нюансы учтены, осталось подвести итоги. <br />    Для изменения размеров элементов управления внутри формы с изменяемыми границами необходимо обрабатывать событие формы Resize. Изменяемые размеры элементов управления вычисляются от ширины и высоты формы. Разница между этими размерами состоит из переменной и постоянной составляющих. <br />    Переменная составляющая включает размеры стандартных частей, входящих в саму форму и зависящих от настроек рабочего стола. Определить эти размеры можно с помощью функции API – GetSystemMetrics с использованием в качестве аргумента специальных констант с префиксом «SM_». <br />    Необходимо ограничивать минимальные размеры формы так, чтобы при обработке события изменения границ, параметрам элементов управления не присваивались отрицательные значения, а сами элементы не накладывались друг на друга. <br />    При сворачивании формы, обрабатывать событие изменения границ формы не стоит, так как может возникнуть ошибка в момент ограничения размеров окна. <br />     <br />    </span><a href="http://vbnet.ru/articles/zip/resize.zip"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Примеры</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Источник: http://www.vbnet.ru/</span><span style=" font-size:8.25pt;"> </span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">  </span></p></body></html>