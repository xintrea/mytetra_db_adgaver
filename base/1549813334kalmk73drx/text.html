<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image15958.png" /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">pio777</span></p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Попробуйте:<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#8b0000;">sp_configure</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'show advanced options'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">reconfigure</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">with</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">override</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">go</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />После этого должно заработать...<br /><br />[/src]</p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />После этого заработало всё: OPENDATASOURCE и linkedserver.<br />И про OPENQUERY тоже совет был полезный - касательно прав дступа.<br /><br />привожу полный листинг того, что сделал что бы заработало:<br /></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Подключаем EXCEL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#808080;">---</span><span style=" font-family:'Courier New,courier'; color:#008000;">-------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Вариант 1 через Прилинкованный сервер</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#808080;">---</span><span style=" font-family:'Courier New,courier'; color:#008000;">-------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 1 проверяем версию</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">select</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff00ff;">@@Version</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 2 Проверяем зарегистированные драйверы, для x64 должен быть &quot;Microsoft.ACE.OLEDB.12.0&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">EXEC</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#8b0000;">sp_enum_oledb_providers</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 3 Разрешаем работу драйвера (если они зарегистированы)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">EXEC</span><span style=" font-family:'Courier New,courier';"> master</span><span style=" font-family:'Courier New,courier'; color:#808080;">.</span><span style=" font-family:'Courier New,courier';">dbo</span><span style=" font-family:'Courier New,courier'; color:#808080;">.</span><span style=" font-family:'Courier New,courier';">sp_MSset_oledb_prop N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Microsoft.ACE.OLEDB.12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'AllowInProcess'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> 0 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">EXEC</span><span style=" font-family:'Courier New,courier';"> master</span><span style=" font-family:'Courier New,courier'; color:#808080;">.</span><span style=" font-family:'Courier New,courier';">dbo</span><span style=" font-family:'Courier New,courier'; color:#808080;">.</span><span style=" font-family:'Courier New,courier';">sp_MSset_oledb_prop N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Microsoft.ACE.OLEDB.12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'DynamicParameters'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> 0 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 4. включаем xp_cmdshell для работы с файлами</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">begin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">EXEC</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#8b0000;">sp_configure</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'xp_cmdshell'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">reconfigure</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">with</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">override</span><span style=" font-family:'Courier New,courier'; color:#808080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 4.1 'Ad Hoc Distributed Queries' включаем распределенные нерегламентированные запросы </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">begin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">EXEC</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#8b0000;">sp_configure</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Ad Hoc Distributed Queries'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">reconfigure</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">with</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">override</span><span style=" font-family:'Courier New,courier'; color:#808080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 4.2 включаем 'show advanced options' </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">begin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">EXEC</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#8b0000;">sp_configure</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'show advanced options'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">reconfigure</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">with</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">override</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 4.3 'sp_addlinkedsrvlogin - FALSE' пароли для подключения к связанному серверу не используются</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">begin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">EXEC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">exec</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#8b0000;">sp_addlinkedsrvlogin</span><span style=" font-family:'Courier New,courier';"> N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'LS_EXCEL'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'False'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 5. создаём прилинкованный сервер</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">EXEC</span><span style=" font-family:'Courier New,courier';"> master</span><span style=" font-family:'Courier New,courier'; color:#808080;">.</span><span style=" font-family:'Courier New,courier';">dbo</span><span style=" font-family:'Courier New,courier'; color:#808080;">.</span><span style=" font-family:'Courier New,courier'; color:#8b0000;">sp_addlinkedserver</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      @server = N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'LS_EXCEL'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      @srvproduct=N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'ms ace 12'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      @provider=N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Microsoft.ACE.OLEDB.12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      @datasrc=N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'c:\data\MySheet3.xls'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      @provstr=N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Excel 12.0;'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 6. В свойствах Linked Server в графе безопасность ставим &quot;Устанавливать без контекста безопасности&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 7. Проверяем через Management Studio-&gt;Server Objects-&gt;Linked Server-&gt;Test Connection есть ли связь с созданным сервером.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 8. Проверяем доступность файла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">exec</span><span style=" font-family:'Courier New,courier';"> master</span><span style=" font-family:'Courier New,courier'; color:#808080;">..</span><span style=" font-family:'Courier New,courier'; color:#8b0000;">xp_cmdshell</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'dir c:\data\MySheet3.xls'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#ff0000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- 9. Пробуем считать файлы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">SELECT</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">*</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">[</span><span style=" font-family:'Courier New,courier';">LS_EXCEL</span><span style=" font-family:'Courier New,courier'; color:#808080;">]...[</span><span style=" font-family:'Courier New,courier';">Range</span><span style=" font-family:'Courier New,courier'; color:#808080;">]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">или</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">SELECT</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">*</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">[</span><span style=" font-family:'Courier New,courier';">LS_EXCEL</span><span style=" font-family:'Courier New,courier'; color:#808080;">]...[</span><span style=" font-family:'Courier New,courier';">Range$</span><span style=" font-family:'Courier New,courier'; color:#808080;">]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#808080;">---</span><span style=" font-family:'Courier New,courier'; color:#008000;">-------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#808080;">---</span><span style=" font-family:'Courier New,courier'; color:#008000;">-------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Вариант 2 через OPENDATASOURCE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#808080;">---</span><span style=" font-family:'Courier New,courier'; color:#008000;">-------------------------------------</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">select</span><span style=" font-family:'Courier New,courier'; color:#808080;">*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">OPENDATASOURCE</span><span style=" font-family:'Courier New,courier'; color:#808080;">(</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Microsoft.ACE.OLEDB.12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Data Source=c:\data\MySheet3.xls;Extended Properties=EXCEL 12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">)...[</span><span style=" font-family:'Courier New,courier';">Range$</span><span style=" font-family:'Courier New,courier'; color:#808080;">];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">или</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">select</span><span style=" font-family:'Courier New,courier'; color:#808080;">*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">OPENDATASOURCE</span><span style=" font-family:'Courier New,courier'; color:#808080;">(</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Microsoft.ACE.OLEDB.12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Data Source=c:\data\MySheet3.xls;Extended Properties=EXCEL 12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">)...[</span><span style=" font-family:'Courier New,courier';">Range</span><span style=" font-family:'Courier New,courier'; color:#808080;">]</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#808080;">---</span><span style=" font-family:'Courier New,courier'; color:#008000;">-------------------------------------</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#008000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#008000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#008000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Так же опобликую здесь (что было потом где искать) чтение и запись в файл:<br /><br /></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Пример чтения и записи в файл</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#008000;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Чтение из файла</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- https://www.sql.ru/forum/actualthread.aspx?tid=971400&amp;hl=dbf</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Вариант № 1.</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#008000;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">select</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">*</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">OpenDataSource</span><span style=" font-family:'Courier New,courier'; color:#808080;">(</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Microsoft.ACE.OLEDB.12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Data Source=c:\SEND_MAIL_RZD\;Extended Properties=&quot;text;HDR=No;FMT=Delimited&quot;'</span><span style=" font-family:'Courier New,courier'; color:#808080;">)...[</span><span style=" font-family:'Courier New,courier';">kont2013</span><span style=" font-family:'Courier New,courier'; color:#808080;">-</span><span style=" font-family:'Courier New,courier';">03</span><span style=" font-family:'Courier New,courier'; color:#808080;">-</span><span style=" font-family:'Courier New,courier';">05#txt</span><span style=" font-family:'Courier New,courier'; color:#808080;">]</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">select</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">*</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">OpenDataSource</span><span style=" font-family:'Courier New,courier'; color:#808080;">(</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Microsoft.ACE.OLEDB.12.0'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'Data Source=c:\SEND_MAIL_RZD\;Extended Properties=&quot;text;HDR=No;FMT=Delimited&quot;'</span><span style=" font-family:'Courier New,courier'; color:#808080;">)...[</span><span style=" font-family:'Courier New,courier';">vagotv#txt</span><span style=" font-family:'Courier New,courier'; color:#808080;">]</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- где </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Microsoft.ACE.OLEDB.12.0 - драйвер</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Data Source=c:\SEND_MAIL_RZD\;Extended Properties=&quot;text;HDR=No;FMT=Delimited&quot; -- строка инициализации</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- kont2013-03-05#txt -- файл.</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#008000;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Вариант № 2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- http://msdn.microsoft.com/ru-ru/library/ms190312(v=sql.105).aspx</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">SELECT</span><span style=" font-family:'Courier New,courier';"> a</span><span style=" font-family:'Courier New,courier'; color:#808080;">.*</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">OPENROWSET</span><span style=" font-family:'Courier New,courier'; color:#808080;">(</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">BULK</span><span style=" font-family:'Courier New,courier';"> N</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'c:\SEND_MAIL_RZD\values.txt'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> FORMATFILE = </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'c:\SEND_MAIL_RZD\values.fmt'</span><span style=" font-family:'Courier New,courier'; color:#808080;">)</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">AS</span><span style=" font-family:'Courier New,courier';"> a</span><span style=" font-family:'Courier New,courier'; color:#808080;">;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#808080;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">SELECT</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">*</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">OPENROWSET</span><span style=" font-family:'Courier New,courier'; color:#808080;">(</span><span style=" font-family:'Courier New,courier'; color:#0000ff;">BULK</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'c:\SEND_MAIL_RZD\values.txt'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">)</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">AS</span><span style=" font-family:'Courier New,courier';"> x</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Вариант № 2 BULK INSERT -- см справку по BULK INSERT </span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#008000;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">BULK</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">INSERT</span><span style=" font-family:'Courier New,courier';"> AdventureWorks2008R2</span><span style=" font-family:'Courier New,courier'; color:#808080;">.</span><span style=" font-family:'Courier New,courier';">Sales</span><span style=" font-family:'Courier New,courier'; color:#808080;">.</span><span style=" font-family:'Courier New,courier';">SalesOrderDetail </span><span style=" font-family:'Courier New,courier'; color:#008000;">-- таблица должна существовать</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">select</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">*</span><span style=" font-family:'Courier New,courier';">    </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">FROM</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'С:\SEND_MAIL_RZD\kont2013-03-05.txt'</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">WITH</span><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#808080;">(</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">         FIELDTERMINATOR =</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">' |'</span><span style=" font-family:'Courier New,courier'; color:#808080;">,</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#008000;">-- признак конца столбца (если есть)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">         ROWTERMINATOR =</span><span style=" font-family:'Courier New,courier'; color:#ff0000;">' |\n'</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#008000;">-- признак конца строки</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; color:#808080;">)</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#808080;"><br /></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; color:#808080;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#008000;">-- Запись в файл</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">DECLARE</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#008000;">-- объявление переменных</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">@cmd_v </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">varchar</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#808080;">(</span><span style=" font-family:'Courier New,courier';">1024</span><span style=" font-family:'Courier New,courier'; color:#808080;">)</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#008000;">-- строка для команды </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">SET</span><span style=" font-family:'Courier New,courier';">  @cmd_v  = </span><span style=" font-family:'Courier New,courier'; color:#ff0000;">'bcp &quot;SELECT ftransport_namber FROM VSTO2EXP.dbo.vw_TransportUnitMonitor where TUMDisabled_code = 0 AND TUMUnitType = ''V''&quot; queryout C:\SEND_MAIL_RZD\vag.txt -c -C1251 -T'</span><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; color:#0000ff;">exec</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#8b0000;">xp_cmdshell</span><span style=" font-family:'Courier New,courier';"> @cmd_v </span></pre></body></html>