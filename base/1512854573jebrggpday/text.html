<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Сжатие БД</span> </p>
<p style="-qt-paragraph-type:empty; margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.sql.ru/forum/actualthread.aspx?bid=4&amp;tid=36726"><span style=" text-decoration: underline; color:#0000ff;">Топик, в котором создавался данный FAQ</span></a><br /><a href="http://www.sql.ru/forum/actualthread.aspx?bid=4&amp;tid=35635"><span style=" text-decoration: underline; color:#0000ff;">Сжатие базы, помогите!!!</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Опубликовано: 28 июн 03<br />Рейтинг: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.addthis.com/bookmark.php?v=250&amp;username=xa-4cb75b821386eec8"><span style=" text-decoration: underline; color:#0000ff;">Добавить в закладки и поделиться</span></a> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><a href="http://www.sql.ru/faq/faq_topic.aspx?fid=155#add-comment"><span style=" text-decoration: underline; color:#0000ff;">Оценить и прокомменитировать</span></a><br /><a href="http://www.sql.ru/faq/faq_topic.aspx?fid=155#"><span style=" text-decoration: underline; color:#0000ff;">Распечатать статью</span></a><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Автор: Нуф-Нуф, посетители форума<br />Прислал: Нуф-Нуф (Иван Потёмкин) </p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; text-decoration: underline;">Вопросы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Q1: Из-за чего растет размер файла БД?<br />Q2: За счет чего размер файла БД уменьшается при сжатии? <br />Q3: Зачем необходимо сжимать БД?<br />Q4: Как часто необходимо сжимать БД?<br />Q5: Как вообще сжимать БД?<br />Q6: Как сжать БД из VBA-кода моего Проекта?<br />Q7: Что еще можно сделать и почему так делать не надо?<br />Q8: Что еще следует иметь в виду по данному вопросу?<br /><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; text-decoration: underline;">Ответы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;"><br /><br />Q1. Из-за чего растет размер файла БД?</span><br /><br />1.1. При удалении данных в таблицах БД записи из файла БД не удаляются, а просто помечается как удаленные (удаляются логически). Т.е. стертые данные так и лежат в базе, в результате файл по мере работы постепенно растет;<br /><br />1.2. При внесении изменений в формы, отчеты, запросы и т.п. прежние копии редактируемых объектов, по аналогии с записями в таблицах (см. выше), удаляются логически, но не физически, что так же приводит к &quot;распуханию&quot; файла БД;<br /><br />1.3. Access во время выполнения Проекта активно пользуется Скрытыми таблицами Проекта (БД), поэтому рост размеров файла БД может наблюдаться даже в MDE/ADE-файлах (редактировать формы, отчеты и т.п. в которых невозможно), не содержащих таблицы с данными пользователя;<br /><br />1.4. Распухание БД возможно, если при выполнении каких-либо задач создаются временные таблицы (например, при формировании сложных отчетов), а затем данные временные таблицы уничтожаются. Уничтожаются они так же логически (просто помечаются как удаленные).<br /><br /><span style=" font-weight:600;">Q2. За счет чего размер файла БД уменьшается при сжатии?</span><br /><br />При сжатии из файла БД физически удаляются записи и объекты БД, помеченные как &quot;удаленные&quot; (логически удаленные).<br /><br /><span style=" font-weight:600;">Q3. Зачем необходимо сжимать БД?</span><br /><br />3.1. Для повышения производительности Проекта (быстродействия БД). Во время сжатия Access не только физически удаляет логически удаленные записи, что само по себе увеличивает производительность (отпадает необходимость фильтровать действительные данные от логически удаленных данных), но и дефрагментирует таблицы, в результате чего увеличивается скорость доступа к данным;<br /><br />3.2. Для повышения надежности БД. На основе эмпирических данных замечено, что регулярное сжатие (и соответственно, восстановление) БД повышает &quot;иммунитет&quot; Проекта к глюкам;<br /><br />3.3. В некоторых случаях сжатие/восстановление БД просто необходимо. Если БД &quot;упала&quot;, то первым делом необходимо сделать ее (уже упавшей) резервную копию и вторым шагом произвести сжатие/восстановление; <br /><br />3.4. В качестве профилактических мер после неких форс-мажорных обстоятельств. Например, если во время работы БД был выключен свет, либо пользователь сам выключил компьютер, не закрыв БД, либо произошло &quot;падение&quot; сети в момент работы БД и т.п. <br /><br />3.5. Заново создается статистика по таблицам (количество записей в таблицах, наличие и типы связей, присутствие индексов и т.п.), которая в дальнейшем будет использована Оптимизатором выполнения запросов. Кроме того, сбрасывается флаг компиляции запросов, что приводит при первом следующем выполнении запроса к новому построению плана выполнения запроса, но уже с учетом обновленной статистики, что увеличивает скорость выполнения запросов. Этот пункт можно считать единственным минусом сжатия/восстановления БД, так как на построение плана запроса требуется некоторое время (небольшое). <br /><br /><span style=" font-weight:600;">Q4. Как часто необходимо сжимать БД?</span><br /><br />Теоретически, сжимать БД необходимо при каждом закрытии БД. Практически это не всегда целесообразно, т.к. занимает определенное время и в некоторых случаях отрицательно сказывается на производительности БД в момент первого выполнения запросов (см. Пункт 3.5). <br />Оптимальным вариантом является некий график сжатия БД: раз в день, раз в два дня, раз в неделю и т.п., который определяется исходя из: 1) Количества одновременно работающих с БД пользователей, 2) размеров БД, 3) из частоты обновления данных в БД (удаление, добавление, редактирование записей) и т.п.<br /><br /><span style=" font-weight:600;">Q5. Как сжимать БД?</span><br /><br />5.1. Через меню: Сервис/Служебные программы/Сжать и восстановить базу данных;<br /><br />5.2. Через меню: Сервис/Параметры/Вкладка &quot;ОБЩИЕ&quot;/Флаг &quot;Сжимать при закрытии&quot;. С помощью данной настройки можно организовать автоматическое сжатие БД при каждом ее закрытии. Действие данного флажка относится только к открытой базе данных, при этом подключенные (прилинкованные) базы данных сжаты не будут. Как сжать прилинкованную БД см. Вопрос/Ответ Q6;<br /><br />5.3. Через преобразование БД к предыдущей версии БД (Сервис/Служебные программы/Преобразовать базу данных…) с последующим преобразованием полученного файла к текущей версии БД. Данный способ наиболее эффективен для сжатия БД после внесения изменений в его интерфейсную часть (редактирование форм, отчетов, кода и т.п.), так как иногда удается обнаружить ряд скрытых ошибок, зачастую возникших из-за сбоев самого Access, а так же физически удалить из файла БД логически удаленные объекты.<br /><br />5.4. Через импорт в пустой (новый) файл БД. По преследуемым целям схож с предыдущим пунктом.<br /><br />5.5. Через выполнение запуска Access в командной строке со специальными параметрами. Например: <br /></p>
<p style=" margin-top:1px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12px;">&quot;C:\Program Files\Microsoft Office\Office\Msaccess.exe&quot; &quot;С:\Мои документы\MyDB.mdb&quot; /Excl /Compact</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />5.6. Через VBA-код, при этом можно использовать несколько различных технологий программного сжатия БД (См. ответы на вопросы Q6 и Q7).<br /><br />5.7. C помощью утилиты <a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;295334"><span style=" text-decoration: underline; color:#0000ff;">JetComp.exe</span></a>, которая помимо сжатия умеет также восстанавливать некоторые повреждения .mdb-файлов, которые невозможно исправить средствами MS Access. Справку по параметрам командной строки jetcomp.exe можно получить с помощью<br /></p>
<p style=" margin-top:1px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12px;">jetcomp.exe /?</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Q6. Как сжать БД из VBA-кода моего Проекта?</span><br /><br /><span style=" text-decoration: underline;">6.1 - Вариант 1</span><br /><br />Можно <span style=" font-weight:600;">программно</span> нажать кнопку &quot;Сжать и восстановить базу данных&quot; (меню Сервис/Служебные программы). Этот вариант является наиболее простым, но в то же время наименее гибким из предложенных далее, а также обладает рядом серьезных недостатков (см. ниже):<br /><br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Public</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span><span style=" font-family:'New';"> AutoCompact() </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">With</span><span style=" font-family:'New';"> CommandBars.Add(, </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span><span style=" font-family:'New';">, , True) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    .Controls.Add </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span><span style=" font-family:'New';">, </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">2071</span><span style=" font-family:'New';">, , , True </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    .Visible = True </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    .Controls(</span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span><span style=" font-family:'New';">).SetFocus </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    DoEvents </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">SendKeys</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#008080;">&quot;~&quot;</span><span style=" font-family:'New';"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">With</span><span style=" font-family:'New';"> </span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Достоинства:<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функция позволяет сжать текущую БД (базу данных, в которой выполняется VBA-код, вызывающий сжатие). Данный вариант является единственным вариантом, позволяющим сжимать текущую не закрытую БД. Не смотря на это, авторы FAQ настоятельно рекомендуют ознакомиться с пунктом 6.4, где рассмотрен более гибкий и надежный вариант реализации сжатия текущей БД;<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пример сообщает о наличии подобного варианта &quot;программного сжатия БД&quot; и раскрывает его недостатки.<br /><br />Недостатки:<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сжатие происходит только текущей БД (базы, в котором выполняется код), таким образом, если БД разделена на Интерфейсную часть и часть с Данными (см. Вопрос/Ответ Q8.3), то будет сжата только Интерфейсная часть в которой выполняется код, а часть с Данными останется несжатой;<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">БД после сжатия перезапускается (открывается повторно);<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После последней строки в функции не должно быть никакого дополнительного кода, т.к. это может привести либо к невозможности выполнить сжатие, либо к невозможности выполнить данный дополнительный код;<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Метод не дает программного контроля над выполняемым сжатием, т.е. невозможно отследить (перехватить) и обработать соответствующим способом ошибки, которые могут возникнуть в процессе сжатия БД.<br /><br /><span style=" text-decoration: underline;">6.2. Вариант 2</span><br /><br />Сжатие через DAO-метод <span style=" font-weight:600;">DBEngine.CompactDatabase</span>.<br />Данный метод сжатия наиболее предпочтителен для MDB/MDE форматов БД расположенных &quot;настольно&quot; (без сети) или для сетевых БД, организованных по технологии &quot;Файл-Сервер&quot;. Основным условием является доступность (подключение) Библиотеки DAO.<br />Метод <span style=" font-weight:600;">не пригоден</span> для сжатия текущей БД (базы данных, в которой выполняется процедура сжатия), но прекрасно подходит для разделенных БД (см. Пункт 8.3). Для сжатия базы данных, в которой выполняется программный код, инициирующий данное сжатие, можно воспользоваться Вариантом 1 (см пункт 6.1) или, что намного лучше, Отдельным процессом, который и произведет данное сжатие (см. пункт 6.4). Кроме того можно попытаться воспользоваться (на свой страх и риск) вариантом, приведенным в Пункте 7.2<br /><br />Сжатие производится следующим образом:<br /><br />- если к БД подключаются несколько пользователей, то перед сжатием БД необходимо убедиться, что ни один пользователь не подключен к базе. В противном случае система сгенерирует перехватываемую ошибку и сжатие БД выполнено не будет;<br /><br />- сформировать полный путь к сжимаемой БД и полный путь к новому (временному) файлу, в который сжатая БД будет записана;<br /><br />- сжать БД;<br /><br />- скопировать новый (появившийся в результате сжатия БД) файл на место старого (копирование под именем, которое принадлежало старому файлу);<br /><br />- удалить новый (временный) файл.<br /><br />В качестве примера можно привести два варианта реализации сжатия БД DAO-методом, отличающихся способами манипулирования файлами:<br /><br /><span style=" font-style:italic;">6.2.1. Пример 1</span><br /><br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'ФУНКЦИЯ СЖАТИЯ БД DAO-Методом'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  gflngCompactDatabase(...)'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'ВХОДНЫЕ ПАРАМЕТРЫ ФУНКЦИИ:'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  CompactingDBPathAndName - строковый параметр, задающий ПОЛНЫЙ ПУТЬ (путь + имя файла)'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     к сжимаемой БД.'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  BackupBeforeCompactDB - необязательный логический параметр, указывающий на'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     необходимость сделать перед сжатием резервную копию сжимаемой БД (резервная'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     копия выкладывается в файл с именем </span><span style=" font-family:'New'; color:#008080;">&quot;ИмяСжимаемогоФайла_Backup&quot;</span><span style=" font-family:'New'; color:#000000;">). При'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     отсутствии параметра резервное копирование не производится.'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'ВОЗВРАЩАЕМОЕ ФУНКЦИЕЙ ЗНАЧЕНИЕ:'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  = 0, если сжатие произведено;'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  = Номеру возникшей ошибки, если выполнить сжатие не удалось.'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'ОСОБЕННОСТИ:'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  Для выполнения процедуры сжатия автоматически создается временный файл'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     с именем </span><span style=" font-family:'New'; color:#008080;">&quot;ПолныйПуть\ИмяСжимаемогоФайла_Temp&quot;</span><span style=" font-family:'New'; color:#000000;">.'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  Резервное копирование, выполнение которого определяется параметром </span><span style=" font-family:'New'; color:#008080;">&quot;BackupBeforeCompactDB&quot;</span><span style=" font-family:'New'; color:#000000;">,'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     производится в файл с именем </span><span style=" font-family:'New'; color:#008080;">&quot;ПолныйПуть\ИмяСжимаемогоФайла_Backup&quot;</span><span style=" font-family:'New'; color:#000000;">), при'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     этом старая копия резерва перезаписывается новой (фактически удаляется).'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  В случае, если сжимаемая БД открыта, то файл БД не будет скопирован (соответствующая'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     ошибка появится в момент копирования БД).'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Public</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span><span style=" font-family:'New';"> gflngCompactDatabase( _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">CompactingDBPathAndName </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">String</span><span style=" font-family:'New';">, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">Optional BackupBeforeCompactDB </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Boolean</span><span style=" font-family:'New';"> = False) </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Dim</span><span style=" font-family:'New';"> strTempFile </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">On</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Error</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">GoTo</span><span style=" font-family:'New';"> ErrHandler</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Формируем имя для временного (</span><span style=" font-family:'New'; color:#008080;">&quot;принимающего&quot;</span><span style=" font-family:'New'; color:#000000;">) файла'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  strTempFile = Left(CompactingDBPathAndName, (Len(CompactingDBPathAndName) - </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">4</span><span style=" font-family:'New';">)) &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#008080;">&quot;_Temp&quot;</span><span style=" font-family:'New';"> &amp; Right(CompactingDBPathAndName, </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">4</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Создаем (если надо) резервную копию файла БД перед сжатием'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> BackupBeforeCompactDB = True _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Then</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">FileCopy</span><span style=" font-family:'New';"> CompactingDBPathAndName, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  Left(CompactingDBPathAndName, (Len(CompactingDBPathAndName) - </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">4</span><span style=" font-family:'New';">)) &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#008080;">&quot;_Backup&quot;</span><span style=" font-family:'New';"> &amp; Right(CompactingDBPathAndName, </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">4</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Сжимаем файл БД (с перезаписью сжатого файла в новый файл)'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  DBEngine.CompactDatabase CompactingDBPathAndName, strTempFile, dbLangCyrillic</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Перезаписываем сжатый (временный файл) на место несжатого (старого файла)'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">FileCopy</span><span style=" font-family:'New';"> strTempFile, CompactingDBPathAndName</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Удаляем временный файл'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Kill</span><span style=" font-family:'New';"> strTempFile</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Exit</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">ErrHandler:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'обрабатываем возможные ошибки'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  gflngCompactDatabase = Err.Number</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  Err.Clear: </span><span style=" font-family:'New'; color:#0000ff;">Exit</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Достоинства:<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для манипулирования файлами (получения имени для временного файла и копирование файла) функция использует стандартные команды Access и не требует наличия на компьютере библиотеки &quot;Microsoft Scripting Runtime&quot; (SCRRUN.DLL), которая (как показывает практика) может отсутствовать;<br /><br />Недостатки:<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для получения имени временного файла функция добавляет к имени сжимаемого файла суффикс &quot;_Temp&quot; (&quot;ПолныйПуть\ИмяСжимаемойБД_Temp&quot;), поэтому в случае, если имеется рабочая БД с подобным именем, то по окончании процесса сжатия она будет удалена. Данный недостаток удается избежать либо приняв правило &quot;Не присваивать рабочим файлам БД имени, оканчивающегося на '_Temp'&quot;, либо изменив функцию (заменить добавление суффикса &quot;_Temp&quot; на путь и имя файла, специально отведенного для сжатия БД), либо воспользовавшись технологией, приведенной в следующем Примере:<br /><br /><span style=" font-style:italic;">6.2.2. Пример 2</span><br /><br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'ФУНКЦИЯ СЖАТИЯ БД DAO-Методом с использованием FileSystemObject для манипулирования файлами '</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  gflngCompactDatabaseFSO(...)'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'ВХОДНЫЕ ПАРАМЕТРЫ ФУНКЦИИ:'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  CompactingDBPathAndName - строковый параметр, задающий ПОЛНЫЙ ПУТЬ (путь + имя файла)'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     к сжимаемой БД.'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  BackupBeforeCompactDB - необязательный логический параметр, указывающий на'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     необходимость сделать перед сжатием резервную копию сжимаемой БД (резервная'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     копия выкладывается в файл с именем </span><span style=" font-family:'New'; color:#008080;">&quot;ИмяСжимаемогоФайла_Backup&quot;</span><span style=" font-family:'New'; color:#000000;">). При'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     отсутствии параметра резервное копирование не производится.'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'ВОЗВРАЩАЕМОЕ ФУНКЦИЕЙ ЗНАЧЕНИЕ:'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  = 0, если сжатие произведено;'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  = Номеру возникшей ошибки, если выполнить сжатие не удалось.'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'ОСОБЕННОСТИ:'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  Резервное копирование, выполнение которого определяется параметром </span><span style=" font-family:'New'; color:#008080;">&quot;BackupBeforeCompactDB&quot;</span><span style=" font-family:'New'; color:#000000;">,'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     производится в файл с именем </span><span style=" font-family:'New'; color:#008080;">&quot;ПолныйПуть\ИмяСжимаемогоФайла_Backup&quot;</span><span style=" font-family:'New'; color:#000000;">), при'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     этом старая копия резерва перезаписывается новой (фактически удаляется).'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'  В случае, если сжимаемая БД открыта, то файл БД будет скопирован и соответствующая'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'     ошибка появится только в момент сжатия БД.'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Public</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span><span style=" font-family:'New';"> gflngCompactDatabaseFSO( _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">CompactingDBPathAndName </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">String</span><span style=" font-family:'New';">, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">Optional BackupBeforeCompactDB </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Boolean</span><span style=" font-family:'New';"> = False) </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">On</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Error</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">GoTo</span><span style=" font-family:'New';"> ErrHandler</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Dim</span><span style=" font-family:'New';"> strTempFile </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Dim</span><span style=" font-family:'New';"> objFileSystem </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Object</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Создаем объект Файловой системы '</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Set</span><span style=" font-family:'New';"> objFileSystem = CreateObject(</span><span style=" font-family:'New'; color:#008080;">&quot;Scripting.FileSystemObject&quot;</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Создаем (если надо) резервную копию файла БД перед сжатием'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> BackupBeforeCompactDB = True _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Then</span><span style=" font-family:'New';"> objFileSystem.CopyFile CompactingDBPathAndName, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  Left(CompactingDBPathAndName, (Len(CompactingDBPathAndName) - </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">4</span><span style=" font-family:'New';">)) &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#008080;">&quot;_Backup&quot;</span><span style=" font-family:'New';"> &amp; Right(CompactingDBPathAndName, </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">4</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Получаем имя для временного (</span><span style=" font-family:'New'; color:#008080;">&quot;принимающего&quot;</span><span style=" font-family:'New'; color:#000000;">) файла'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  strTempFile = objFileSystem.GetTempName</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Сжимаем файл БД (с перезаписью сжатого файла в новый файл)'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  DBEngine.CompactDatabase CompactingDBPathAndName, strTempFile, dbLangCyrillic</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Перезаписываем сжатый (временный файл) на место несжатого (старого файла)'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  objFileSystem.CopyFile strTempFile, CompactingDBPathAndName, True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Удаляем временный файл'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Kill</span><span style=" font-family:'New';"> strTempFile</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Уничтожаем объект Файловой системы'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Set</span><span style=" font-family:'New';"> objFileSystem = </span><span style=" font-family:'New'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Exit</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">ErrHandler:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'обрабатываем возможные ошибки'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  gflngCompactDatabaseFSO = Err.Number</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  Err.Clear: </span><span style=" font-family:'New'; color:#0000ff;">Exit</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Достоинства:<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для получения имени временного файла функция использует специальный метод объекта FileSystemObject, генерирующий уникальное имя для файла, что исключает возможность перезаписать (фактически удалить) какой-либо существующий файл. <br /><br />Недостатки:<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для манипулирования файлами (получения имени для временного файла и копирование файла) функция использует библиотеку &quot;Microsoft Scripting Runtime&quot; (SCRRUN.DLL), которая (как показывает практика) может отсутствовать на компьютере. Данный недостаток удается избежать воспользовавшись предыдущим примером DAO-реализации сжатия БД (пункт 6.2.1).<br /><br /><span style=" text-decoration: underline;">6.3. Вариант 3</span><br /><br />Сжатие через JRO-метод (&quot;расширение&quot; ADO) JRO.JetEngine.<br />Данный метод сжатия наиболее предпочтителен для ADP/ADE форматов БД, обычно не использующих DAO-библиотеку.<br /><br />Сжатие производится следующим образом:<br /><br />- Отключаем от базы данных клиента, с которого запускается процедура сжатия. На данном этапе отладки необходимо убедиться, что все соединения, рекордсеты и т.п. закрыты, т.е. ldb-файл базы данных отсутствует. <br /><br />- Проверяем, подключен ли кто-нибудь еще к базе данных, что можно сделать двумя вариантами:<br /><br />1) Проверить наличие .ldb файла <br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> DIR(полный путь к ldb файлу)&lt;&gt;</span><span style=" font-family:'New'; color:#008080;">&quot;&quot;</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">then</span><span style=" font-family:'New';"> ...</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />2) Использовать метод ADO OpenSchema для получения информации о подключенных пользователях (если есть файл рабочей группы) или машинах (в данном примере именно так, где имя машины - 10 символов). Вариант более гибкий, т.к. можно узнать, кто именно блокирует файл (в данном примере проверяем подключен кто-то или нет, но из полученного рекордсета легко можно забрать и реальные имена пользователей/машин). <br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Dim</span><span style=" font-family:'New';"> cnn </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> ADODB.Connection, rst </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> ADODB.Recordset</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Dim</span><span style=" font-family:'New';"> je </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">New</span><span style=" font-family:'New';"> JRO.JetEngine </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Dim</span><span style=" font-family:'New';"> lngConnected </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Long</span><span style=" font-family:'New';">, strCurPCName </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">String</span><span style=" font-family:'New';">, strBE </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">String</span><span style=" font-family:'New';">, strBETemp </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Const</span><span style=" font-family:'New';"> adhcUsers = </span><span style=" font-family:'New'; color:#008080;">&quot;{947bb102-5d43-11d1-bdbf-00c04fb92675}&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">strBE = </span><span style=" font-family:'New'; color:#008080;">&quot;Полный путь к файлу БД&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">strBETemp = </span><span style=" font-family:'New'; color:#008080;">&quot;Полный путь к новому (сжатому) файлу БД&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Set</span><span style=" font-family:'New';"> cnn = </span><span style=" font-family:'New'; color:#0000ff;">New</span><span style=" font-family:'New';"> ADODB.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  cnn.Provider = </span><span style=" font-family:'New'; color:#008080;">&quot;Microsoft.Jet.OLEDB.4.0&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  cnn.</span><span style=" font-family:'New'; color:#0000ff;">Open</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#008080;">&quot;Data Source=&quot;</span><span style=" font-family:'New';"> &amp; strBE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#000000;">'Используем элемент Connection Control (Jet версии не младше 4.0) для'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#000000;">'запрета подключения новых пользователей.'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  cnn.Properties(</span><span style=" font-family:'New'; color:#008080;">&quot;Jet OLEDB:Connection Control&quot;</span><span style=" font-family:'New';">) = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Set</span><span style=" font-family:'New';"> rst = cnn.OpenSchema(Schema:=adSchemaProviderSpecific, SchemaID:=adhcUsers)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">' strCurPCName - имя машины, с которой запускается процедура'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  strCurPCName = Environ(</span><span style=" font-family:'New'; color:#008080;">&quot;COMPUTERNAME&quot;</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">With</span><span style=" font-family:'New';"> rst</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">          </span><span style=" font-family:'New'; color:#0000ff;">Do</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Until</span><span style=" font-family:'New';"> .EOF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">          </span><span style=" font-family:'New'; color:#000000;">' Считаем кол-во подключенных машин, исключая машину, с которой</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">          </span><span style=" font-family:'New'; color:#000000;">' запущена процедура. Наверняка вычленить реальное имя машины из</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">          </span><span style=" font-family:'New'; color:#000000;">' этого поля можно более красивым и правильным способом, мне просто</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">          </span><span style=" font-family:'New'; color:#000000;">' лень было, у меня и так работает:-)'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">              </span><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Not</span><span style=" font-family:'New';"> strCurPCName = Left(.Fields(</span><span style=" font-family:'New'; font-weight:600; color:#00008b;">0</span><span style=" font-family:'New';">), </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">10</span><span style=" font-family:'New';">) </span><span style=" font-family:'New'; color:#0000ff;">Then</span><span style=" font-family:'New';"> lngConnected = lngConnected + </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">              .MoveNext</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">          </span><span style=" font-family:'New'; color:#0000ff;">Loop</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> lngConnected &gt; </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">0</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">         </span><span style=" font-family:'New'; color:#000000;">' База данных заблокирована другим пользователем-&gt;сжать не удастся</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">         </span><span style=" font-family:'New'; color:#000000;">' -&gt; выходим любым приемлемым способом, не забыв закрыть rst и cnn'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#000000;">' База не заблокирована -&gt; переходим к сжатию. Вариант с принудительным</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#000000;">' отключением пользователей здесь не рассматривается, т.к. лично я</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#000000;">' считаю его приемлемым только в аварийных случаях.'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#000000;">'Закрываем открытый ранее рекордсет'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Not</span><span style=" font-family:'New';"> rst </span><span style=" font-family:'New'; color:#0000ff;">Is</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Nothing</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Then</span><span style=" font-family:'New';"> rst.</span><span style=" font-family:'New'; color:#0000ff;">Close</span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Set</span><span style=" font-family:'New';"> rst=</span><span style=" font-family:'New'; color:#0000ff;">nothing</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />- Производим сжатие, при этом должна быть подключена библиотека Microsoft Jet and Replication Objects x.x Library (JRO)<br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' Проверяем наличие временного файла (возможно остался</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' от предыдущей неудачной попытки сжатия) и удаляем его</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> Dir(strBETemp) &lt;&gt; </span><span style=" font-family:'New'; color:#008080;">&quot;&quot;</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Then</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Kill</span><span style=" font-family:'New';"> strBETemp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' Закрываем объект cnn, открытый в п.2, иначе сжать данные не получится'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">Set</span><span style=" font-family:'New';"> cnn=</span><span style=" font-family:'New'; color:#0000ff;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' Сжимаем'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    je.CompactDatabase </span><span style=" font-family:'New'; color:#008080;">&quot;Data Source=&quot;</span><span style=" font-family:'New';"> &amp; strBE &amp; </span><span style=" font-family:'New'; color:#008080;">&quot;;&quot;</span><span style=" font-family:'New';">, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">        </span><span style=" font-family:'New'; color:#008080;">&quot;Data Source=&quot;</span><span style=" font-family:'New';"> &amp; strBETemp &amp; </span><span style=" font-family:'New'; color:#008080;">&quot;;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' Маловероятно, но гипотетически за время сжатия, </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' кто-нибудь мог подключиться к файлу БД, поэтому можно еще раз</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' проверить наличие подключенных пользователей (см. пример выше),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' если никто не подключен, то удаляем старый файл и</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' переименовываем новый сжатый файл. Если кто-то все-таки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' успел открыть БД, то просто выходим, оставляя временный</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">' сжатый файл. Добавить обработку такой ситуации по вкусу.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">Kill</span><span style=" font-family:'New';"> strBE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">Name</span><span style=" font-family:'New';"> strBETemp </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> strBE</span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">Set</span><span style=" font-family:'New';"> je = </span><span style=" font-family:'New'; color:#0000ff;">Nothing</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" text-decoration: underline;">6.4. Вариант 4</span><br /><br />Вынесение в отдельный процесс кода, сжимающего БД, что позволяет сжать любые базы данных (в том числе и ту, которая инициировала процесс сжатия БД). Данный вариант является наиболее предпочтительным и гибким решением, позволяющим комбинировать рассмотренные ранее варианты программного сжатия БД, а также производить дополнительное обслуживание баз данных.<br /><br />Как это работает:<br /><br />База данных, в которой выполняется код (Клиентская часть или Неразделенная БД), перед закрытием (возможно, не при каждом закрытии: См. Вопрос/Ответ Q4) вызывает другую программу, которая производит все необходимые действия по обслуживанию БД.<br />В приведенном ниже примере в качестве обслуживающих действий выполняется сжатие Вызвавшей БД и Дополнительной БД, при этом в качестве Сервис-Провайдера используется Access.<br /><br />Для реализации описанного механизма:<br /><br />- Создайте новую базу данных с именем &quot;DBServiceProvaider.mdb&quot;, в которой создайте форму. Скопируйте в модуль формы следующий код:<br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Const</span><span style=" font-family:'New';"> TimeDelay </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Long</span><span style=" font-family:'New';"> = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">250</span><span style=" font-family:'New';">     </span><span style=" font-family:'New'; color:#000000;">'задержка в миллисекундах между неудачными попытками сжатия'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Const</span><span style=" font-family:'New';"> MaxIterations </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Long</span><span style=" font-family:'New';"> = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">10</span><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#000000;">'количество повторов сжатия при неудачных попытках сжатия'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Dim</span><span style=" font-family:'New';"> mlngStep </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Long</span><span style=" font-family:'New';">              </span><span style=" font-family:'New'; color:#000000;">'номер текущего выполняемого шага'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Private</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Sub</span><span style=" font-family:'New';"> Form_Load()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Me</span><span style=" font-family:'New';">.TimerInterval = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span><span style=" font-family:'New';">            </span><span style=" font-family:'New'; color:#000000;">'запускаем таймер'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#0000ff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Private</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Sub</span><span style=" font-family:'New';"> Form_Timer()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Me</span><span style=" font-family:'New';">.TimerInterval = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">0</span><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#000000;">'останавливаем таймер (исключаем повторное событие в момент сжатия)'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Select</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Case</span><span style=" font-family:'New';"> mlngStep</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Case</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">0</span><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">'Первый шаг </span><span style=" font-family:'New'; color:#008080;">&quot;Обслуживания БД&quot;</span><span style=" font-family:'New'; color:#000000;">'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">Call</span><span style=" font-family:'New';"> gsTryToCompactDB(</span><span style=" font-family:'New'; color:#008080;">&quot;C:\Тест\MyDB1.mdb&quot;</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Case</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">'Второй шаг </span><span style=" font-family:'New'; color:#008080;">&quot;Обслуживания БД&quot;</span><span style=" font-family:'New'; color:#000000;">'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">Call</span><span style=" font-family:'New';"> gsTryToCompactDB(</span><span style=" font-family:'New'; color:#008080;">&quot;C:\Тест\MyDB2.mdb&quot;</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#000000;">'Case N    ''N-ный шаг </span><span style=" font-family:'New'; color:#008080;">&quot;Обслуживания БД&quot;</span><span style=" font-family:'New'; color:#000000;">'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">'Действия по обслуживанию БД...'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">'Приращиваем значение mlngStep для выполнения следующего шага обслуживания'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">'Запускаем таймер для выполнения следующего шага'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Case</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">2</span><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#000000;">'заключительный шаг (N+1), заканчивающий выполнение Проекта </span><span style=" font-family:'New'; color:#008080;">&quot;Обслуживания БД&quot;</span><span style=" font-family:'New'; color:#000000;">'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    MsgBox </span><span style=" font-family:'New'; color:#008080;">&quot;Обслуживание завершено!&quot;</span><span style=" font-family:'New';">, vbInformation</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    DoCmd.Quit</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Select</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#0000ff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Private</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span><span style=" font-family:'New';"> gsTryToCompactDB(CompactingDB </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">String</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Dim</span><span style=" font-family:'New';"> lngUserAnswer </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">Static</span><span style=" font-family:'New';"> lngIterationCnt </span><span style=" font-family:'New'; color:#0000ff;">As</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> gflngCompactDatabase(CompactingDB) = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">0</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Then</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#000000;">'сжимаем БД и проверяем, получилось ли'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#000000;">'если сжатие произошло...'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    mlngStep = mlngStep + </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    lngIterationCnt = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">Me</span><span style=" font-family:'New';">.TimerInterval = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#000000;">'если сжатие не произошло (возникла ошибка)...'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">If</span><span style=" font-family:'New';"> lngIterationCnt &lt;= MaxIterations </span><span style=" font-family:'New'; color:#0000ff;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      lngIterationCnt = lngIterationCnt + </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">Me</span><span style=" font-family:'New';">.TimerInterval = TimeDelay</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      lngIterationCnt = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      lngUserAnswer = MsgBox( _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#008080;">&quot;В данный момент не получается сжать файл '&quot;</span><span style=" font-family:'New';"> &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      CompactingDB &amp; </span><span style=" font-family:'New'; color:#008080;">&quot;'.&quot;</span><span style=" font-family:'New';"> &amp; vbNewLine &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#008080;">&quot;Попытаться сжать данный файл еще раз?&quot;</span><span style=" font-family:'New';">, _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      vbExclamation + vbYesNoCancel, </span><span style=" font-family:'New'; color:#008080;">&quot;Не удается сжать БД&quot;</span><span style=" font-family:'New';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">Select</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Case</span><span style=" font-family:'New';"> lngUserAnswer</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">Case</span><span style=" font-family:'New';"> vbYes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">        </span><span style=" font-family:'New'; color:#0000ff;">Me</span><span style=" font-family:'New';">.TimerInterval = TimeDelay</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">Case</span><span style=" font-family:'New';"> vbNo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">        mlngStep = mlngStep + </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">        </span><span style=" font-family:'New'; color:#0000ff;">Me</span><span style=" font-family:'New';">.TimerInterval = </span><span style=" font-family:'New'; font-weight:600; color:#00008b;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">Case</span><span style=" font-family:'New';"> vbCancel</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">        DoCmd.Quit </span><span style=" font-family:'New'; color:#000000;">'Выход из Acces'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">      </span><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Select</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  </span><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">If</span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#0000ff;">End</span><span style=" font-family:'New';"> </span><span style=" font-family:'New'; color:#0000ff;">Function</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратите внимание, что в процедуре <span style=" font-weight:600;">Private Sub Form_Timer()</span> указан путь к двум сжимаемым БД, который необходимо настроить в соответствии с именами и размещением сжимаемых БД на машине.<br /><br />- сохраните форму и укажите ее имя в качестве автоматически открываемой формы (Меню Сервис\Параметры запуска\Вывод формы или страницы);<br /><br />- создайте модуль и разместите в нем функцию, приведенную в Пункте 6.2.1 (можно воспользоваться и Примером из пункта 6.2.2, соответствующим образом откорректировав процедуру gsTryToCompactDB());<br /><br />- подключите DAO-библиотеку (в случае, если еще не подключена), откомпилируйте код и закройте созданную &quot;DBServiceProvaider.mdb&quot;;<br /><br />- откройте базу, из которой будет вызываться созданный нами &quot;Провайдер Обслуживания БД&quot;, и добавьте в соответствующее место (например, на кнопку &quot;Выход&quot;, или на событие выгрузки главной формы проекта) код:<br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  Shell </span><span style=" font-family:'New'; color:#008080;">&quot;C:\Program Files\Microsoft Office\Office\Msaccess.exe &quot;</span><span style=" font-family:'New';"> &amp; _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">    </span><span style=" font-family:'New'; color:#008080;">&quot;&quot;&quot;C:\Тест\DBServiceProvaider.mdb&quot;&quot;&quot;</span><span style=" font-family:'New';">, vbMaximizedFocus</span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">  DoCmd.Quit</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратите внимание, что сначала указывается полный путь к исполнимому файлу Access, а затем полный путь к созданной &quot;DBServiceProvaider.mdb&quot;, при этом как тот, так и другой необходимо указать в соответствии с расположением файлов на машине.<br /><br />Следует отметить, что процедура <span style=" font-weight:600;">Private Sub Form_Timer()</span> может содержать сколько угодно шагов, направленных на обслуживание БД. <br /><br />Код приведен в качестве упрощенного примера и призван показать в общих чертах пути реализации приведенной концепции.<br /><br /><span style=" font-weight:600;">7. Что еще можно сделать и почему так делать не надо?</span><br /><br />7.1. Можно <span style=" font-weight:600;">Программно</span> нажать кнопку &quot;Сжать и восстановить базу данных&quot;. Один из наиболее работоспособных вариантов подобного способа сжатия описан в Пункте 6.1. Здесь рассмотрен вариант выполнения аналогичных действий всего лишь одной командой (только для Access 200x):<br /><br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Для Англоязычной версии Access'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">CommandBars(</span><span style=" font-family:'New'; color:#008080;">&quot;Menu Bar&quot;</span><span style=" font-family:'New';">).Controls(</span><span style=" font-family:'New'; color:#008080;">&quot;Tools&quot;</span><span style=" font-family:'New';">). _ </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">Controls(</span><span style=" font-family:'New'; color:#008080;">&quot;Database utilities&quot;</span><span style=" font-family:'New';">).Controls(</span><span style=" font-family:'New'; color:#008080;">&quot;Compact and repair database...&quot;</span><span style=" font-family:'New';">). _ </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">accDoDefaultAction</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#000000;">'Для Русскоязычной версии Access'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px; font-family:'New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">CommandBars(</span><span style=" font-family:'New'; color:#008080;">&quot;Menu Bar&quot;</span><span style=" font-family:'New';">).Controls(</span><span style=" font-family:'New'; color:#008080;">&quot;С&amp;ервис&quot;</span><span style=" font-family:'New';">). _ </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">Controls(</span><span style=" font-family:'New'; color:#008080;">&quot;&amp;Служебные программы&quot;</span><span style=" font-family:'New';">).Controls(</span><span style=" font-family:'New'; color:#008080;">&quot;С&amp;жать и восстановить базу данных&quot;</span><span style=" font-family:'New';">). _ </span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">accDoDefaultAction</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Из приведенного примера видно, что код должен соответствовать локализованной версии Access, именно поэтому использовать данный способ не рекомендуется.<br /><br />Здесь же можно привести несколько видоизмененную версию описываемого способа сжатия БД:<br /><br /></p>
<table border="0" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="10" bgcolor="#fffaed">
<tr>
<td>
<p style=" margin-top:1px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New'; color:#ff0000;">'Обращение к панели инструментов через индексы'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">CommandBars(</span><span style=" font-family:'New'; font-weight:600; color:#00008b;">40</span><span style=" font-family:'New';">).Controls(</span><span style=" font-family:'New'; font-weight:600; color:#00008b;">12</span><span style=" font-family:'New';">). _ </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">Controls(</span><span style=" font-family:'New'; font-weight:600; color:#00008b;">7</span><span style=" font-family:'New';">).Controls(</span><span style=" font-family:'New'; font-weight:600; color:#00008b;">2</span><span style=" font-family:'New';">). _ </span></p>
<p style=" margin-top:0px; margin-bottom:1px; margin-left:1px; margin-right:1px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'New';">accDoDefaultAction</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Данный вариант не зависит от локализации Access и работает в версиях 2000 и XP, но гарантировать невозможно, что в следующих версиях индексы останутся прежними, а значит, что приложение использующее данный код в следующих версиях останется работоспособным.<br /><br />Кроме рассмотренных особенностей использования данного способа сюда можно отнести и все сказанное в пункте 6.1<br /><br />7.2. Попытаться сжать Текущую БД (базу данных, в которой выполняется код, инициирующий сжатие) можно на основе метода, описанного в Пункте 6.2.2, при этом следует внести изменения в алгоритм выполнения сжатия:<br /><br />- скопировать текущую (исполняемую) БД во временный файл;<br /><br />- сжать временный файл в другой временный файл;<br /><br />- полученный сжатый временный файл скопировать на место текущего (выполняемого) файла.<br /><br />Данная методика, так же как и методика, описанная в Пункте 7.1, приведена здесь с целью ознакомления со всеми возможными вариантами сжатия БД и настоятельно не рекомендуется к реальному применению! Причин несколько. Во-первых, не всегда получается подменить (перезаписать) файл открытой БД. Во-вторых, если подмена будет &quot;удачной&quot; (система позволит перезаписать файл открытой БД), то это может обернуться полным разрушением БД. В-третьих, читаем Help: &quot;CompactDatabase Method: Copies and compacts a <span style=" font-weight:600;">closed database</span>...&quot;, т.е. сжимать можно только закрытую (не используемую) БД.<br /><br /><span style=" font-weight:600;">8. Что еще следует иметь в виду по данному вопросу?</span><br /><br />8.1. Перед сжатием БД рекомендуется создавать резервную копию сжимаемого файла. В случае если сжатие производится после некой аварийной ситуации (см. Пункты 3.3 и 3.4), то данная рекомендация превращается в жесткое требование;<br /><br />8.2. Как уже было указано в пункте 6, во время сжатия к БД не должны быть подключены пользователи;<br /><br />8.3. К вопросу о сжатии БД, повышающем скорость выполнения и &quot;глюкоустойчивость&quot; Проекта, можно добавить рекомендацию разделять БД на несколько частей, ключевыми из которых являются &quot;Интерфейсная часть&quot; (формы, отчеты, запросы, модули и т.п.) и &quot;Часть с Данными&quot; (таблицы). Данная рекомендация основана на многих причинах, выходящих за рамки FAQ;<br /><br />8.4. Во время сжатия БД Автоматические Счетчики в таблицах, генерирующие Последовательные значения при добавлении записей, так же &quot;сжимаются&quot; - принимают значения равные Максимальному значению счетчика в столбце + 1;<br /><br />8.5. После сжатия БД рекомендуется выполнять дефрагментацию диска (по мере возможности), что положительно сказывается на производительности Проекта уже на системном уровне (скорость доступа к дефрагментированному файлу выше, нежели скорость доступа к файлу, разбросанному по диску).<br /><br />Проследить за ходом рассуждений по данному FAQ, и, соответственно, за дополнительной информацией, можно обратившись к следующим Топикам:<br /></p></body></html>