<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/SearchArray"><span style=" text-decoration: underline; color:#0000ff;">Быстрый поиск в двумерном массиве</span></a> </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/taxonomy/term/14"><span style=" text-decoration: underline; color:#0000ff;">Макросы VBA Excel</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/strings"><span style=" text-decoration: underline; color:#0000ff;">Текстовые строки</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/arrays"><span style=" text-decoration: underline; color:#0000ff;">Обработка массивов</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/Excel/search"><span style=" text-decoration: underline; color:#0000ff;">Поиск в Excel</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/array"><span style=" text-decoration: underline; color:#0000ff;">Массивы</span></a></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/string"><span style=" text-decoration: underline; color:#0000ff;">текстовые строки</span></a> </li></ul></td></tr></table>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">В данной статье показаны 2 способа быстрого поиска значений в двумерных массивах.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Поскольку искомое значение может встретиться в нескольких строках обрабатываемого двумерного массива,</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">оба способа получают на выходе отфильтрованный двумерный массив.</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Способы формирования отфильтрованных массивов - разные:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">первый способ использует <a href="http://excelvba.ru/code/ArrAutofilter"><span style=" text-decoration: underline; color:#0000ff;">функцию ArrAutofilterEx</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">второй способ - функцию <span style=" font-weight:600;">ArraySearchResults</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Основные отличия и особенности этих 2 способов поиска:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ArrAutofilterEx </span>позволяет задавать несколько критериев поиска (фильтрации)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ArrAutofilterEx </span>ищет вхождение искомого текста в значения заданных столбцов (неточное совпадение)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ArrAutofilterEx </span>при каждом вызове заново в цикле перебирает все элементы массива,<br />соответственно, <span style=" font-weight:600; font-style:italic;">при поиске 10 значений время работы кода увеличивается в 10 раз</span></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ArraySearchResults </span>позволяет использовать фильтрацию массива только по одному столбцу</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ArraySearchResults </span>ищет совпадение искомого текста со значением столбца (точное совпадение)</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ArraySearchResults </span>производит поиск в заранее сформированной текстовой строке<br />Таким образом, перебираются все ячейки массива в цикле только один раз, и <span style=" font-weight:600; font-style:italic;">поиск 100 значений в массиве займёт ненамного больше времени, чем поиск 1 значения</span>.</li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Примеры поиска в огромных массивах:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Поиск с использованием ArrAutofilterEx </span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> ПримерМедленногоПоискаВМассиве()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    t = Timer</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    ИскомоеЗначение$ = 560</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    СтолбецДляПоиска&amp; = 3</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' загружаем массив с листа</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    arr = [a1:d30000].Value</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' укорачиваем массив Arr, оставляя лишь те строки,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' где в заданном столбце есть искомое значение</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">On</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Error</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Resume</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';">: Err.Clear</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    resArr = ArrAutofilterEx(arr, СтолбецДляПоиска&amp; &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot;=&quot;</span><span style=" font-family:'monospace';"> &amp; ИскомоеЗначение$)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' проверяем возвращеное функцией значение на наличие результатов поиска</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> Err </span><span style=" font-family:'monospace'; color:#000080;">Then</span><span style=" font-family:'monospace';"> Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Такие строки в массиве не найдены&quot;</span><span style=" font-family:'monospace';">: </span><span style=" font-family:'monospace'; color:#000080;">Exit</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' выводим из отфильтрованных строк значения первого столбца</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">For</span><span style=" font-family:'monospace';"> i = </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(resArr) </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(resArr)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Результат - строка &quot;</span><span style=" font-family:'monospace';"> &amp; i &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot; из &quot;</span><span style=" font-family:'monospace';"> &amp; </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(resArr) &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot;: &quot;</span><span style=" font-family:'monospace';">, resArr(i, 1)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';"> i</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Время: &quot;</span><span style=" font-family:'monospace';"> &amp; Timer - t &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot; сек.&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Поиск с использованием ArraySearchResults</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> ПримерБыстрогоПоискаВМассиве()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    t = Timer</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    ИскомоеЗначение$ = 560</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    СтолбецДляПоиска&amp; = 3</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' загружаем массив с листа</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    arr = [a1:d30000].Value</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' формируем строку поиска</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    ss$ = SearchString(arr, СтолбецДляПоиска&amp;)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' укорачиваем массив Arr, оставляя лишь те строки,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' где в заданном столбце есть искомое значение</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    resArr = ArraySearchResults(arr, ss$, ИскомоеЗначение$)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' проверяем возвращеное функцией значение на наличие результатов поиска</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Not</span><span style=" font-family:'monospace';"> IsArray(resArr) </span><span style=" font-family:'monospace'; color:#000080;">Then</span><span style=" font-family:'monospace';"> Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Такие строки в массиве не найдены&quot;</span><span style=" font-family:'monospace';">: </span><span style=" font-family:'monospace'; color:#000080;">Exit</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' выводим из отфильтрованных строк значения первого столбца</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">For</span><span style=" font-family:'monospace';"> i = </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(resArr) </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(resArr)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Результат - строка &quot;</span><span style=" font-family:'monospace';"> &amp; i &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot; из &quot;</span><span style=" font-family:'monospace';"> &amp; </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(resArr) &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot;: &quot;</span><span style=" font-family:'monospace';">, resArr(i, 1)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';"> i</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Время: &quot;</span><span style=" font-family:'monospace';"> &amp; Timer - t &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot; сек.&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код функции <span style=" font-weight:600;">ArraySearchResults:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Function</span><span style=" font-family:'monospace';"> ArraySearchResults(</span><span style=" font-family:'monospace'; color:#000080;">ByRef</span><span style=" font-family:'monospace';"> arr, </span><span style=" font-family:'monospace'; color:#000080;">ByRef</span><span style=" font-family:'monospace';"> searchStr </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">String</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#000080;">ByVal</span><span style=" font-family:'monospace';"> txt </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">String</span><span style=" font-family:'monospace';">, _</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                            </span><span style=" font-family:'monospace'; color:#000080;">Optional</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">ByVal</span><span style=" font-family:'monospace';"> Sep </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">String</span><span style=" font-family:'monospace';"> = </span><span style=" font-family:'monospace'; color:#800000;">&quot;%$%&quot;</span><span style=" font-family:'monospace';">) </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Variant</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' функция получает в качестве параметров массив Arr,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' и заранее сформированную строку SearchString из значений ячеек нужного столбца массива</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' По этой строке SearchString функция ищет строки массива, в которые встречается значение txt,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' и возвращает усечённый массив, содержащий только подходящие строки</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Поиск ведётся по ТОЧНОМУ совпадению значений</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#008000;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    ro&amp; = 0: spl = Split(searchStr, Sep &amp; txt &amp; Sep)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(spl) = 0 </span><span style=" font-family:'monospace'; color:#000080;">Then</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Exit</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Function</span><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' нет в массиве нужных строк</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' перебираем результаты поиска, вычисляя номера строк в исходном массиве</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">For</span><span style=" font-family:'monospace';"> i = </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(spl) </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(spl) - 1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        txt = spl(i): ro&amp; = ro&amp; + 1 + (Len(spl(i)) - Len(Replace(spl(i), Sep, </span><span style=" font-family:'monospace'; color:#800000;">&quot;&quot;</span><span style=" font-family:'monospace';">))) / Len(Sep) \ 2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        spl(i) = ro&amp;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';"> i</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' подготавливаем массив для результатов:</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' по ширине - как исходный, по высоте - содержащий столько строк, сколько найдено совпадений</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">ReDim</span><span style=" font-family:'monospace';"> resArr(1 </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(spl), </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(arr, 2) </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(arr, 2))</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' заполняем новый массив</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">For</span><span style=" font-family:'monospace';"> i = </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(spl) </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(spl) - 1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        </span><span style=" font-family:'monospace'; color:#000080;">For</span><span style=" font-family:'monospace';"> j = </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(arr, 2) </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(arr, 2)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            resArr(i + 1, j) = arr(spl(i), j)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';"> j</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';"> i</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    ArraySearchResults = resArr</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Function</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Function</span><span style=" font-family:'monospace';"> SearchString(</span><span style=" font-family:'monospace'; color:#000080;">ByRef</span><span style=" font-family:'monospace';"> arr, </span><span style=" font-family:'monospace'; color:#000080;">ByVal</span><span style=" font-family:'monospace';"> ArrayColumn </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Long</span><span style=" font-family:'monospace';">, _</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">                      </span><span style=" font-family:'monospace'; color:#000080;">Optional</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">ByVal</span><span style=" font-family:'monospace';"> Sep </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">String</span><span style=" font-family:'monospace';"> = </span><span style=" font-family:'monospace'; color:#800000;">&quot;%$%&quot;</span><span style=" font-family:'monospace';">) </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">String</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Объединяет все значения из столбца ArrayColumn массива Arr в одну текстовую строку,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' в качестве разделителя элементов используя строку Sep</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Для ускорения конкатенации длинных строк используются</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' промежуточные переменные buffer$ и buffer2$</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    buffer$ = </span><span style=" font-family:'monospace'; color:#800000;">&quot;&quot;</span><span style=" font-family:'monospace';">: buffer2$ = </span><span style=" font-family:'monospace'; color:#800000;">&quot;&quot;</span><span style=" font-family:'monospace';">: Sep2$ = Sep$ &amp; Sep$: </span><span style=" font-family:'monospace'; color:#000080;">Const</span><span style=" font-family:'monospace';"> BufferLen&amp; = 6000</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">On</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Error</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Resume</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';">: Err.Clear: SearchString = Sep2$</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> ArrayColumn &gt; </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(arr, 2) </span><span style=" font-family:'monospace'; color:#000080;">Or</span><span style=" font-family:'monospace';"> ArrayColumn &lt; </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(arr, 2) </span><span style=" font-family:'monospace'; color:#000080;">Then</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Exit</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Function</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">For</span><span style=" font-family:'monospace';"> i = </span><span style=" font-family:'monospace'; color:#000080;">LBound</span><span style=" font-family:'monospace';">(arr) </span><span style=" font-family:'monospace'; color:#000080;">To</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">UBound</span><span style=" font-family:'monospace';">(arr)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        buffer$ = buffer$ &amp; Trim$(arr(i, ArrayColumn)) &amp; Sep2$</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> Len(buffer$) &gt; BufferLen&amp; </span><span style=" font-family:'monospace'; color:#000080;">Then</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            buffer2$ = buffer2$ &amp; buffer$: buffer$ = </span><span style=" font-family:'monospace'; color:#800000;">&quot;&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">            </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> Len(buffer2$) &gt; BufferLen&amp; * 20 </span><span style=" font-family:'monospace'; color:#000080;">Then</span><span style=" font-family:'monospace';"> _</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">               SearchString = SearchString &amp; buffer2$: buffer2$ = </span><span style=" font-family:'monospace'; color:#800000;">&quot;&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        </span><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">If</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Next</span><span style=" font-family:'monospace';"> i</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    SearchString = SearchString &amp; buffer2$ &amp; buffer$</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Function</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При поиске только одного значения время работы обоих макросов поиска не сильно отличается - но обычно функция ArraySearchResults оказывается немного быстрее. </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">39421 просмотр </li></ul></td>
<td></td></tr></table></body></html>