<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="container"></a><a href="https://analitica.jimdo.com/%D0%BF%D1%80%D0%BE%D0%B4%D0%B2%D0%B8%D0%BD%D1%83%D1%82%D0%BE%D0%B5/%D0%B2%D0%BE-%D0%B2%D1%80%D0%B5%D0%BC%D1%8F-%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BC%D0%B0%D0%BA%D1%80%D0%BE%D1%81%D0%B0/"><span style=" text-decoration: underline; color:#0000ff;">a</span></a><span style=" text-decoration: underline; color:#0000ff;">nalitica.jimdo.com</span> </p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="reader-title"></a><span style=" font-size:xx-large; font-weight:600;">У</span><span style=" font-size:xx-large; font-weight:600;">казание на файл в процессе выполнения макроса</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="reader-credits"></a>3-4 минуты </p>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="moz-reader-content"></a>Робот еще не может заменить человека полностью, поэтому бывают ситуации, когда человеку нужно вносить какие-то корректировки прямо в процесс выполнения макроса. Как это сделать? </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="cc-m-8351359085"></a>Представим ситуацию, когда макрос в процессе своего выполнения использует какой-то файл, который либо называется всё время по-разному, либо лежит всё время в разных папках. Что делать? Прописать заранее его в макрос в такой ситуации мы не можем, а переименовывать каждый раз или переписывать путь в теле макроса лень или просто невозможно по каким-либо причинам. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В таком случае очень удобно сделать так, чтобы в процессе выполнения макрос запрашивал бы у вас выбрать его через стандартное окно выбора файла. Как это сделать? </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы вы понимали, чего от вас ожидается, сначала лучше вывести msgbox, например, такой: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">   MsgBox (&quot;Выберите нужный файл&quot;)</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Затем нужно запомнить выбранный файл. Точнее в переменную помещается полное имя файла, т.е. включая весь путь: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">   bfName = Application.GetOpenFilename()</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И после этого нам остается только открыть его: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">   Workbooks.Open(bfName)</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В принципе, после того, как вы получили полное имя нужного файла, вы можете и не открывать его, а сделать что-то другое. Всё на ваше усмотрение. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По такому же принципу работает метод Application.GetSaveAsFilename(). Если в процессе работы макроса какой-то файл нужно сохранить и путь и имя файла нужно каждый раз задавать вручную, то удобно использовать этот метод. Он так же вызывает стандартное окно, записывает указанный пользователем путь в переменную, а потом под этим именем нужно сохранить файл: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">   bfName = Application.GetSaveAsFilename()</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">   Workbooks.SaveAs(bfName)</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="cc-m-8351359785"></a>Есть и другие способы &quot;общения&quot; пользователя с макросом. Например, очень полезным может оказаться окно подтверждения действия. Например, если макрос безвозвратно удаляет какие-то данные или если какое-то действие нужно делать не на всех перебираемых объектах (например, изменять не все <a href="https://analitica.jimdo.com/продвинутое/кубы-и-сводные-таблицы/"><span style=" text-decoration: underline; color:#0000ff;">кубы</span></a>). Особенно это полезно, когда программист и пользователь макроса - разные люди. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Итак, окно подтверждения вызывается так: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If MsgBox(&quot;Вы уверены, что хотите удалить все данные?&quot;, vbYesNo, &quot;Confirm&quot;) = vbYes Then </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    MsgBox (&quot;ok, i will do&quot;)   ' т.е. код, выполняемый, если человек подтвердил выполнение </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Else </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    MsgBox (&quot;I will sleep&quot;)   ' действие, если человек отменил выполнение.  </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End If </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обычно при отмене действия выдается просто сообщение о том, что макрос не будет выполнен и затем выход из программы. Но подобную конструкцию можно использовать и для получения макросом ответов на другие вопросы. Например, если существует кусок кода, который не всегда нужно выполнять. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>