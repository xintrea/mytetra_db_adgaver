<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">Перемещение базы данных tempdb в MS SQL Server 2012</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">		</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">			Опубликовано </span><a href="http://tavalik.ru/peremeshhenie-bd-tempdb/"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">13.08.2014</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> автором </span><a href="http://tavalik.ru/author/admin/"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">Виталий Онянов</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;">				</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">			</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Системная база данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> служит рабочим пространством для хранения временных объектов, таких как временные таблицы, промежуточные результаты вычислений, временные хранимые процедуры, результаты буферов и сортировки, внутренние объекты, создаваемые компонентой Database Engine и пр. Кроме того, все изменения данных в базах данных, в которых используются транзакции изоляции моментальных снимков с зафиксированным чтением и транзакции изоляции моментальных снимков, а также изменения данных для таких операций, как операции с индексами в сети, множественные активные результирующие наборы (режим MARS) и триггеры AFTER также хранятся в системной базе данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">. Таким образом, данная база данных используется системой довольно активно, и возможно получить значительный прирост производительности путем переноса файлов базы данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> на отдельный дисковый накопитель, более быстрый </span><a href="https://ru.wikipedia.org/wiki/SSD"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">SSD-диск</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> или даже </span><a href="https://ru.wikipedia.org/wiki/RAM_drive"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">RAM-диск</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;">. О перемещении системной базы данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> в MS SQL Server 2012 (справедливо для более ранних версий) и пойдет речь в данной статье.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="more-5572"></a><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">1</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">. Указание каталога хранения файлов базы данных tempdb во время установки  MS SQL Server 2012</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Указать отдельный каталог расположения файлов базы данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">, можно еще на стадии установки MS SQL Server 2012, на странице настройки компоненты Database Engine на вкладке «</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Каталоги данных</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">» (Data Directories).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tavalik.ru/wp-content/uploads/2014/08/peremeshhenie-bd-tempdb_01.png"><img src="2.png" width="640" height="480" /></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Подробнее про установку MS SQL Server 2012 можно прочить </span><a href="http://tavalik.ru/ustanovka-microsoft-sql-server-2012/"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">здесь</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;">.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">2. Изменения каталога хранения файлов базы данных tempdb для существующего экземплялра MS SQL Server</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Если же имеется уже установленный экземпляр MS SQL Server, то изменить каталог хранения файлов базы данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> не удастся с помощью стандартных средств </span><a href="http://tavalik.ru/detach-attach-bd-ms-sql-server-2012/"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">отсоединение и присоединение базы данных</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;">. В этом случае поможет инструкция </span><a href="http://msdn.microsoft.com/ru-ru/library/bb522469.aspx"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">ALTER DATABASE</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> языка Transact-SQL. Подключимся к экземпляру MS SQL Server, для которого необходимо выполнить изменения, с помощью программы  </span><a href="http://tavalik.ru/sql-server-management-studio/"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">«</span></a><a href="http://tavalik.ru/sql-server-management-studio/"><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic; text-decoration: underline; color:#0000ff;">SQL Server Management Studio</span></a><a href="http://tavalik.ru/sql-server-management-studio/"><span style=" font-family:'DejaVu Sans'; font-size:11pt; text-decoration: underline; color:#0000ff;">»</span></a><span style=" font-family:'DejaVu Sans'; font-size:11pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tavalik.ru/wp-content/uploads/2014/08/peremeshhenie-bd-tempdb_02.png"><img src="3.png" width="640" height="400" /></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Просмотрим текущее расположение файлов базы данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">. Для этого в обозревателе объектов (Object Explorer) раскроем вкладки «</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Базы данных</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">» (Databases) — «</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Системные базы данных</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">» (System Databases). Кликнем правой кнопкой мыши по базе данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> и в контекстном меню выберем пункт «</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Свойства</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">» (Properties).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tavalik.ru/wp-content/uploads/2014/08/peremeshhenie-bd-tempdb_03.png"><img src="4.png" width="640" height="400" /></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">В открывшемся окне свойств перейдем на вкладку «</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Файлы</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">» (Files), где можно увидеть имена файлов (File Name), логические имена файлов (Logical Name) и путь расположения каждого из файлов (Path).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tavalik.ru/wp-content/uploads/2014/08/peremeshhenie-bd-tempdb_04.png"><img src="5.png" width="640" height="274" /></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Для того чтобы изменить путь расположения необходимо выполнить запрос:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#0000ff;">USE master</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#000000;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; background-color:#eff0f1;">GO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; background-color:#eff0f1;">ALTER DATABASE </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#008080;">tempdb</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#0000ff;">MODIFY FILE</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> (</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#008080;">NAME</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> = </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#008080;">tempdev</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;">, </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#0000ff;">FILENAME</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> = </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#ff0000;">'E:\SQL_Temp\tempdb.mdf'</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#0000ff;">GO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#0000ff;">ALTER DATABASE</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#008080;">tempdb</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#0000ff;">MODIFY FILE</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> (</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#008080;">NAME</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> = </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#008080;">templog</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;">, </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#0000ff;">FILENAME</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;"> = </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#ff0000;">'E:\SQL_Temp\templog.ldf'</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-size:11pt; color:#0000ff;">GO</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans'; font-size:11pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Где </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">E:\SQL_Temp\</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> новый путь расположения файлов базы данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">. Каталоги файла данных базы — файла </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb.mdf</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> (или файлов, если их несколько) и файла журнала транзакций — </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb.ldf</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> могут различаться и, соответственно, могут быть изменены независимо. Для того чтобы выполнить запрос, необходимо нажать кнопку на панели задач «</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Создать запрос</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">» (New Query), в окне нового запроса ввести текст запроса и нажать кнопку «</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Выполнить</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">» (Execute), расположенную там же, на панели задач.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tavalik.ru/wp-content/uploads/2014/08/peremeshhenie-bd-tempdb_05.png"><img src="6.png" width="640" height="400" /></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">После чего необходимо перезапустить экземпляр SQL Server. Сделать это можно, здесь же, кликнув правой кнопкой мыши по имени сервера в обозревателе объектов, и выбрав в контекстном меню пункт «</span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-style:italic;">Перезапустить</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">» (Restart).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tavalik.ru/wp-content/uploads/2014/08/peremeshhenie-bd-tempdb_06.png"><img src="7.png" width="640" height="400" /></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">Если теперь вызвать свойства базы данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;">, можно увидеть, что путь расположения файлов изменился.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tavalik.ru/wp-content/uploads/2014/08/peremeshhenie-bd-tempdb_07.png"><img src="8.png" width="640" height="274" /></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">При старте SQL Server база данных </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> создается каждый раз заново. Поэтому из старого каталога файлы </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb.mdf</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> и </span><span style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:600;">tempdb.ldf</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> необходимо удалить вручную.</span></p></body></html>