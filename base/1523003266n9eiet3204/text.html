<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<html>
<table width="100%" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td colspan="2" style="padding-left:10pt;padding-right:10pt" width="85%" bgcolor="#8EC0D8"><h2><a name="tab"><b>Чтиво - программирование на Visual Basic</b></a></h2>
<ol font="" style="font-size:10pt">
<a href="http://vbrus.narod.ru/Info3.htm#00"> 00. Знакомимся с историей языка Бэйсик - Visual Basic </a><br>
<a href="http://vbrus.narod.ru/Info.htm#1"> 01. Как перезагрузить или выключить компьютер в Windows XP? - Visual Basic </a><br>
<a href="http://vbrus.narod.ru/Info.htm#2"> 02. Узнаем путь к Windows и о функции Environ - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info.htm#3"> 03. Работа с файлами - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info.htm#4"> 04. Работа с папками - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info.htm#5"> 05. Как узнать имя компьютера и имя пользователя? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info.htm#6"> 06. Как изменить имя компьютера? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info.htm#7"> 07. Работа с числами, шрифтом, текстом, TextBox'om и RichTextBox'om - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info.htm#8"> 08. Интернет - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info.htm#9"> 09. Использование Winsock контрола - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info.htm#10"> 10. Как заставить Winsock работать с несколькими соединениями? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#11"> 11. Узнаем свой IP адрес - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#12"> 12. Определение имени или IP-адреса удаленного компьютера - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info2.htm#13">13. Как заполнить ComboBox всеми шрифтами, которые установленны в системе? - Visual Basic</a><br>  
<a href="http://vbrus.narod.ru/Info2.htm#14">14. Как заполнить ComboBox буквами доступных дисков? - Visual Basic</a><br>  
<a href="http://vbrus.narod.ru/Info2.htm#15">15. Изменение высоты ниспадающей части элемента ComboBox - Visual Basic</a><br>   
<a href="http://vbrus.narod.ru/Info2.htm#16">16. Cкриншот экрана, формы или контрола - Visual Basic</a><br>     
<a href="http://vbrus.narod.ru/Info2.htm#17">17. Выделить кусок картинки - Visual Basic</a><br>   
<a href="http://vbrus.narod.ru/Info2.htm#18">18. Изменение фона рабочего стола Windows - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#19">19. Скопировать содержимое PictureBox в буфер обмена - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info2.htm#20">20. Преобразование и форматирования данных (функции) - Visual Basic</a><br>   
<a href="http://vbrus.narod.ru/Info2.htm#21">21. Программно переключить клавиатуру с русского на английский и обратно - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info2.htm#22">22. Работа с системным треем - Visual Basic</a><br>  
<a href="http://vbrus.narod.ru/Info2.htm#23">23. Как извлечь иконку из файла? - Visual Basic </a><br> 
<a href="http://vbrus.narod.ru/Info2.htm#24">23. Как сменить курсор на "песочные часы" и обратно? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#25">25. Как узнать количество свободной оперативной памяти? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#26">26. Как узнать сколько процессоров в компьютере? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#27">27. Как узнать сколько работает ваш компьютер? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#28">28. Как управлять консолью под vb6? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#29">29. Пишем трейнер на Visual Basic - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info2.htm#30">30. Зашифрованные пароли - Visual Basic</a><br>  
<a href="http://vbrus.narod.ru/Info2.htm#31">31. Как завершить указанный процесс - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info2.htm#32">32. Управление событиями в комбоксе - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#33">33. Как содержимое формы или Picture выкинуть на принтер? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#34">34. Ошибки при замене десятичного разделителя - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#35">35. Как определить длину файла (все версии Visual Basic)</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#36">36. Управление длиной элемента списка ComboBox - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#37">37. Увеличение и уменьшение даты с помощью клавиш [+] и [-] - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#38">38. Как перетащить элементы из одного списка в другой - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#39">39. Создание нового контекстного меню - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#40">40. Для тех, кто занимается геометрическими расчетами - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#41">41. Копирование областей памяти в DOS - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#42">42. Сортировка содержимого ListView - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#43">43. Быстрый поиск в массивах, листбоксах и  комбобоксах - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#44">44. Сделать картинку светлей или темней - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#45">45. Как загрузить текст из файла в ListBox?  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#46">46. Формы в виде текста!  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#47">47. Как выполнять код пока кнопка нажата  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#48">48. КАК работать с ресурсами, файлы ресурсов (*.RES)  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#49">49. Как узнать полный путь к программе, зная её h, именно hWnd  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#50">50. Форма сверху всех - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#51">51. Как перетаскивать окно не за заголовок - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#52">52. Как ловить нажатия на клавиши вне вашей программы - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#53">53. Форматирование и копирование дискет через функции API - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#54">54. Ярылык для загрузки последнего рабочего проекта в Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#55">55. Постоянно возникающий вопрос у тех, кто пишет блокнот. Функция Command - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#56">56. Создание временных файлов - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#57">57. Быстрый поиск а базе данных - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#58">58. Заперетить юзеру закрывать форму - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#59">59. Как просто отформатировать и округлить число - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#60">60. Перевод денежных сумм из цифp в 'прописью'  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#61">61. Как запретить запуск второй копии программы   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#62">62. Работа с Дисководом. Открыть/закрыть дверцу CD/DVD-ROM. Узнать инфо о CD-ROM и.т.д. </a><br>
<a href="http://vbrus.narod.ru/Info2.htm#63">63. Работа с Word. Создание, открытие, форматирование, закрытие и сохранение - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#64">64. Работа с Word. Добавление текста в документ Word - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#65">65. Работа с Word. Добавление текста в документ Word (Продолжение) - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#66">66. Работа с Word. Работа с таблицами в Word (часть 1) - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#67">67. Работа с Word. Работа с таблицами в Word (часть 2) - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#68">68. Работа с Word. Работа с таблицами в Word (часть 3) - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#69">69. Сортировка методом Шелла - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#70">70. Работа с Word. Работа с графическими объектами в Word (часть 1) - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#71">71. Работа с Word. Работа с графическими объектами в Word (часть 2) - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#72">72. Использование Visual 
Basic 6.0 для управления внешними устройствами и приём внешней 
информации (температура, давление, напряжение, ток и т.п.) через LPT 
порт</a><br>

<a href="http://vbrus.narod.ru/Info2.htm#73">73. Как написать игру на Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#74">74. Как расшарить программно ресурс (несколько способов) - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#75">75. Как узнать сколько памяти жрет указанный процесс? - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#76">76. Создание плагина для Winamp - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#77">77. Проигрыватель файлов AVI и WAV - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#78">78. Как защитить свою программу от взломщиков - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#79">79. Как запустить Screen saver?  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info2.htm#80">80. Использование специальной клавиши клавиатуры   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#81">81. Работа с Мышью и Клавиатурой  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#82">82. Работа с десктопом/окнами   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#83">83. Как сделать форму прозрачной?   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#84">84. Как сделать сканер портов?   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#85">85. Получить список запущенных приложений/процессов   - Visual Basic</a><br>

<a href="http://vbrus.narod.ru/Info3.htm#86">86. Коды функциональных клавиш   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#87">87. Получить описание любого файла: exe, dll или…   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#88">88. Получение списка расширений, зарегистрированных в системе файлов   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#89">89. Получение сведений о зарегистрированных типах файлов в системе   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#90">90. Запуск сервисов Панели Управления   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#91">91. Возвращение путей различных каталогов(рабочий стол, папка шрифтов, меню кнопки ПУСК и т.д)   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#92">92. Добавить ссылку или удалить все ссылки в меню Пуск&gt;Документы   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#93">93. Получить адрес переменной в памяти - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#94">94. Получение информации о Windows, используя GetSystemInfo   - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#95">95. Очистить/показать содержимое корзины  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#96">96. Как воспроизвести звук и видео  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#97">97. Проиграть Avi-файл в Picture Box  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#98">98. Поиск окна  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#99">99. Создание своего контрола  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#100">100. Как создать ActiveX Control за 21 минуту на Microsoft Visual Basic  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#101">101. WithEvents - добавление новых свойств к стандартным контролам  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#102">102. 88 советов по оптимизации приложения  - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#103">103. Как проиграть MP3 из VB  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#104">104. Работа с Excel  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#105">105. Типы диаграмм VBA  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#106">106. Как сделать паузу в ВБ  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#107">107. Как программно создать Button или другой элемент управления  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#108">108. Как сделать паузу без использования API и Таймера  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#109">109. Опять запрещаем диспетчер задач :)  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#110">110. Как сделать ProgressBar с процентами?  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#111">111. Ограничить переменную до определенного количества символов  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#112">112. Узнаем имя своей программы  - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#113">113. Как сделать вдавленную кнопку? - Visual Basic</a><br> 
<a href="http://vbrus.narod.ru/Info3.htm#114">114. Как сделать название кнопки не по центру - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#115">115. Извращаемся над кнопкой пуск - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#116">116. Установить дату и время на компьютере - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#117">117. Получить список пользователей Windows - Visual Basic</a><br>
<a href="http://vbrus.narod.ru/Info3.htm#118">118. Полезные материалы  - Visual Basic</a><br> 


  </ol></td></tr><tr>
    <td valign="bottom" width="60%" height="13" bgcolor="#8EC0D8"></td>
    <td valign="bottom" width="35%" bgcolor="#8EC0D8"><p width="13" height="13" align="right"></p></td>
    <td width="15%"></td>
  </tr>
</tbody></table>

 

<table width="100%" cellspacing="0" cellpadding="0" border="0">
  <tbody><tr>
    <td valign="top" width="50%" height="22" bgcolor="#8EC0D8"></td>
    <td valign="top" width="35%" height="22" bgcolor="#8EC0D8"><p width="13" height="13" align="right"></p></td>
    <td valign="top" width="15%" height="22"></td>
  </tr>
  <tr>
    <td colspan="2" style="padding-left:10pt;padding-right:10pt" width="85%" bgcolor="#8EC0D8">

    




    <h2><a name="1"><b>01. Как перезагрузить или выключить компьютер в Windows XP? - Visual Basic</b></a></h2>
    <ol font="" style="font-size:10pt">
      Dim strComputer As String <br>
      strComputer = "."<br>
      Set objWMIService = GetObject("winmgmts:" &amp; 
"{impersonationLevel=impersonate, (Shutdown)}!\\" &amp; strComputer 
&amp; "\root\cimv2")<br>
      Set colOperatingSystems = objWMIService.ExecQuery( "Select * from Win32_OperatingSystem")<br>
      For Each ObjOperatingSystem In colOperatingSystems<br>
      ObjOperatingSystem.Reboot ' Для перезагрузки<br>
      Next<br>
	и…<br>
      Dim strComputer As String<br>
      strComputer = "."<br>
      Set objWMIService = GetObject("winmgmts:" &amp; 
"{impersonationLevel=impersonate,(Shutdown)}!\\" &amp; strComputer &amp;
 "\root\cimv2")<br>
      Set colOperatingSystems = objWMIService.ExecQuery( "Select * from Win32_OperatingSystem")<br>
      For Each ObjOperatingSystem In colOperatingSystems<br>
      ObjOperatingSystem.ShutDown 'Для выключения<br>
      Next<br>
      <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх </a> </ol> 

             
             

    <h2><a name="2"><b>02. Узнаем путь к Windows и о функции Environ - Visual Basic</b></a></h2>
    <ol font="" style="font-size:10pt">
         Text1.Text = Environ("windir")' вот и все!<br>
         <br>
         Но это ещё не всё! Также с помощью этой функции можно получить следующие перменные:<br>
         MsgBox Environ ("TMP") 'директория временных файлов TEMP <br>
         MsgBox Environ ("BLASTER") 'координаты звуковой карты <br>
         MsgBox Environ ("PATH") 'пути, объявленные в autoexec.bat<br>
         
      <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх </a> </ol>

             
      <h2><a name="3"><b>03. Работа с файлами</b></a></h2>
    <ol font="" style="font-size:10pt">
    
   
  <b>3.1 Копируем файл - Visual Basic</b><br>
  <b>3.2 Удаляем файл с диска - Visual Basic</b><br>
  <b>3.3 Перемещаем файл - Visual Basic</b><br>
  <b>3.4 Переименовываем файл - Visual Basic</b><br>
  <b>3.5 Устанавливаем атрибуты файла(скрытый, только для чтения и тд.)</b><br>
  <b>3.6 Открыть любой файл, директорию - Visual Basic</b><br>
  <b>3.7 Существует ли файл? - Visual Basic</b><br>
  <b>3.8 Получить размер файла - Visual Basic</b><br>
  <b>3.9 Как получить имя файла или его расширение, зная полный путь файлау - Visual Basic</b><br>
  
  <b>3.10 Удаление файла в корзину - Visual Basic</b><br>
  <b>3.11 Функция для изменения расширения файла - Visual Basic</b><br>
 
  <b>3.12 Сравнить два файла на идентичность - Visual Basiс</b><br>
  <b>3.13 Хотите знать, какие файлы скопированы в память? - Visual Basic</b><br>
  <br><br>  
     
 <b>3.1 Копируем файл<br></b>
 =================================================== <br>
 
 допустим у нас есть один файлик с именем 1.txt в папке C:\1\ , а нам нужно скопировать его в C:\2\ .<br>
  Все просто, пишем следующие:<br>
Filecopy "C:\1\1.txt","C:\2\1.txt"<br>
(*Внимание! Если в каталоге 2 уже находиться файлик с именем 1.txt , то он будет заменен на 1.txt из каталога 1 !!!)<br>
<br>

<b>2 способ API!</b><br>
обычно я делаю через API:
<br><br>
Private Declare Function CopyFile Lib "kernel32.dll" Alias "CopyFileA" 
(ByVal lpExistingFileName As String, ByVal lpNewFileName As String, 
ByVal bFailIfExists As Long) As Long
<br><br>
Private Sub Command1_Click()<br>
' Скопируем файл C:\1.txt в D:\1.txt.<br>
Dim retval As Long  ' возвращаемое значение<br>
' копируем файл<br>
retval = CopyFile("C:\1.txt", "D:\1.txt", 1)<br>
If retval = 0 Then  ' если ошибка<br>
  MsgBox "Не могу скопировать"<br>
Else  ' если все нормально<br>
 MsgBox "Файл скопирован."<br>
End If<br>
End Sub<br>
<br>
<b>3.2 Удаляем файл с диска<br></b>
 =================================================== <br>
 
Например мы хотим удалить файл 1.txt из корневой диска C:<br>
Пишем:<br>
Kill ("C:\1.txt")<br>
<br>
<b>2 способ API!</b><br>
Private Declare Function DeleteFile Lib "kernel32.dll" Alias "DeleteFileA" (ByVal lpFileName As String) As Long
<br><br>
Private Sub Command1_Click()<br>
' Удаляем файл C:\Samples\anyfile.txt<br>
Dim retval As Long  ' возвращаемое значение<br>
<br>
retval = DeleteFile("C:\1.txt")<br>
If retval = 1 Then MsgBox "Файл успешно удален."<br>
End Sub<br>
<br>

<b>3.3 Перемещаем файл<br></b>
 =================================================== <br>
для этого мы используем два оператора сразу. Например нам нужно переместить файл 1.txt из C:\ в C:\2\ . Пишем:<br>
Filecopy "C:\1.txt","C:\2\1.txt"<br>
Kill ("C:\1.txt")
<br><br>
<b>2 способ API!</b><br>
Private Declare Function MoveFile Lib "kernel32.dll" Alias "MoveFileA" 
(ByVal lpExistingFileName As String, ByVal lpNewFileName As String) As 
Long
<br>
<br>
Private Sub Command1_Click()<br>
Dim retval As Long  ' возвращаемое значение<br>
<br>
retval = MoveFile("C:\1.txt", "C:\2\1.txt")<br>
If retval = 1 Then<br>
MsgBox "Успешно переместился )"<br>
Else<br>
MsgBox "Не успешно переместился )"<br>
End If<br>
End Sub<br>

<br>
<b>3.4 Переименовываем файл<br></b>
 =================================================== <br>
Надо переименовать файл 1.txt находящийся в C:\ на 2.txt .<br>
Пишем:<br>
Filecopy "C:\1.txt","C:\2.txt"<br>
Kill ("C:\1.txt")<br>
<br> 
<b>2 способ API!</b><br>

Private Declare Function MoveFile Lib "kernel32.dll" Alias "MoveFileA" 
(ByVal lpExistingFileName As String, ByVal lpNewFileName As String) As 
Long
<br><br>
Private Sub Command1_Click()<br>
Dim retval As Long  ' возвращаемое значение<br>
<br>
retval = MoveFile("C:\1.txt", "C:\2.txt")<br>
If retval = 1 Then<br>
MsgBox "Успешно переименовался )"<br>
Else<br>
MsgBox "Не успешно переименовался )"<br>
End If<br>
End Sub<br>
<br>
<b>3.5 Устанавливаем атрибуты файла(скрытый, только для чтения и тд.)<br></b>
 =================================================== <br>
 Для этого используем оператор setattr.<br>
Пишем:<br>
Setattr "C:\1.txt" , vbHidden - теперь файл 1.txt стал скрытым. <br>
Чтобы изменить сразу несколько параметров нужно ставить "+" между каждым значением:<br>
Setattr "C:\1.txt",vbHidden+vbReadOnly -Теперь файл скрытый и только для чтения.<br>
<br>
<br>

<b>3.6 Открыть любой файл, директорию - Visual Basic<br></b>
 =================================================== <br>

' Под Windos NT: <br>
Shell "cmd /X /C start c:\mydoc\example.doc"<br>
' Под Windos 9x:<br>
Shell "start c:\mydoc\example.doc"<br>
<br>
' через API<br>
Private Declare Function ShellExecute Lib "shell32.dll" Alias 
"ShellExecuteA" (ByVal hWnd As Long, ByVal lpOperation As String, ByVal 
lpFile As String, ByVal lpParameters As String, ByVal lpDirectory As 
String, ByVal nShowCmd As Long) As Long<br>
<br>
Private Sub Command1_Click()<br>
ShellExecute 0, vbNullString, "C:\" &amp; sFile, vbNullString, vbNullString, vbNormalFocus<br>
End Su<br><br>

<b>3.7 Существует ли файл? - Visual Basic<br></b>
 =================================================== <br>
 
'1. Возвращает 1(файл существует) или 0 (файла нет)<br>
<br>
Private Declare Function PathFileExists Lib "shlwapi.dll" Alias "PathFileExistsA" (ByVal pszPath As String) As Long<br>
MsgBox PathFileExists("c:\autoexec.bat")<br>
<br>
'2. Возвращает True(файл существует) или False(файла нет)<br>
<br>
Private Declare Function PathFileExists Lib "shlwapi.dll" Alias "PathFileExistsA" (ByVal pszPath As String) As Long<br>
Public Function DoesFileExist(ByVal strPath As String) As Boolean<br>
DoesFileExist = PathFileExists(strPath)<br>
End Function<br>
MsgBox DoesFileExist("c:\autoexec.bat")<br><br>


<b>3.8 Получить размер файла - Visual Basic<br></b>
 =================================================== <br>
 
Размер файла можно определить двумя путями:<br>
<br>
1. Если файл можно открыть функцией OPEN, то можно воспользоваться функцией LOF<br>
<br>
Dim FileFree As Integer<br>
Dim FileSize As Long<br>
FileFree = FreeFile<br>
Open "C:\WIN\GENERAL.TXT" For Input As FileFree<br>
FileSize = LOF(FileFree)<br>
Close FileFree<br>
<br>
2. Используя функцию FileLen<br>
<br>
Dim lFileSize As Long<br>
FileSize = FileLen("C:\WIN\GENERAL.TXT")<br><br>


<b>3.9 Как получить имя файла или его расширение, зная полный путь файлау - Visual Basic<br></b>
 =================================================== <br>
 
Private Function Spliting(sFullPath As String, point As String)<br>
Dim str1() As String<br>
str1 = Split(sFullPath, point)<br>
Spliting = str1(UBound(str1))<br>
End Function<br><br>

<b>3.10 Удаление файла в корзину - Visual Basic<br></b>
=================================================== <br>
Private Type SHFILEOPSTRUCT<br>
hwnd As Long<br>
wFunc As Long<br>
pFrom As String<br>
pTo As String<br>
fFlags As Integer<br>
fAnyOperationsAborted As Long<br>
hNameMappings As Long<br>
lpszProgressTitle As Long<br>
End Type<br>
Private Declare Function SHFileOperation Lib "shell32.dll" Alias "SHFileOperationA" (lpFileOp As SHFILEOPSTRUCT) As Long<br>
Private Const FO_DELETE = &amp;H3<br>
Private Const FOF_ALLOWUNDO = &amp;H40<br>
Private Const FOF_NOCONFIRMATION = &amp;H10<br>
Private Const FOF_SILENT = &amp;H4<br>
<br>
Sub SendFileToRecycleBin(FileName As String, Optional Confirm As Boolean = True, Optional Silent As Boolean = False)<br>
Dim FileOp As SHFILEOPSTRUCT<br>
With FileOp<br>
.wFunc = FO_DELETE<br>
.pFrom = FileName<br>
.fFlags = FOF_ALLOWUNDO<br>
If Not Confirm Then .fFlags = .fFlags + FOF_NOCONFIRMATION<br>
If Silent Then .fFlags = .fFlags + FOF_SILENT<br>
End With<br>
SHFileOperation FileOp<br>
End Sub<br>
<br>
Private Sub Command1_Click()<br>
SendFileToRecycleBin "C:\1.txt", False<br>
SendFileToRecycleBin "C:\11.txt", True<br>
End Sub<br>
<br>
Private Sub Form_Load()<br>
Dim FN As Integer<br>
FN = FreeFile<br>
Dim FName As String<br>
FName = "C:\1.txt"<br>
Open FName For Output As #FN<br>
Print #FN, ""<br>
Close #FN<br>
FName = "C:\11.txt"<br>
Open FName For Output As #FN<br>
Print #FN, ""<br>
Close #FN<br>
End Sub<br><br>

<b>3. 11 Функция для изменения расширения файла - Visual Basic<br></b>
=================================================== <br>
Function ChangeFileExtension(FileName As String, Extension As String, Optional AddIfMissing As Boolean) As String<br>
Dim i As Long<br>
For i = Len(FileName) To 1 Step -1<br>
Select Case Mid$(FileName, i, 1)<br>
Case "."<br>
ChangeFileExtension = Left$(FileName, i) &amp; Extension<br>
Exit Function<br>
Case ":", "\"<br>
Exit For<br>
End Select<br>
Next<br>
If AddIfMissing Then<br>
ChangeFileExtension = FileName &amp; "." &amp; Extension<br>
Else<br>
ChangeFileExtension = FileName<br>
End If<br>
End Function<br>
<br>
Private Sub Command1_Click()<br>
MsgBox ChangeFileExtension("ggg.htm", "txt")<br>
MsgBox ChangeFileExtension("ggg", "txt", True)<br>
End Sub<br><br>

<b>3.12 Сравнить два файла на идентичность - Visual Basic<br></b>
=================================================== <br>
Private Sub Form_Load()<br>
'замените пути файлов, которые вы хотите сравнить<br>
Open "C:\1\convert1bmp.htm" For Binary As #1<br>
Open "C:\1\convert2bmp.htm" For Binary As #2<br>
issame% = True<br>
If LOF(1) &lt;&gt; LOF(2) Then<br>
issame% = False<br>
Else<br>
whole&amp; = LOF(1) \ 10000<br>
part&amp; = LOF(1) Mod 10000<br>
buffer1$ = String$(10000, 0)<br>
buffer2$ = String$(10000, 0)<br>
start&amp; = 1<br>
For X&amp; = 1 To whole&amp;<br>
Get #1, start&amp;, buffer1$<br>
Get #2, start&amp;, buffer2$<br>
If buffer1$ &lt;&gt; buffer2$ Then<br>
issame% = False<br>
Exit For<br>
End If<br>
start&amp; = start&amp; + 10000<br>
Next<br>
buffer1$ = String$(part&amp;, 0)<br>
buffer2$ = String$(part&amp;, 0)<br>
Get #1, start&amp;, buffer1$<br>
Get #2, start&amp;, buffer2$<br>
If buffer1$ &lt;&gt; buffer2$ Then issame% = False<br>
End If<br>
Close<br>
If issame% Then<br>
MsgBox "Файлы идентичны", 64, "Info"<br>
Else<br>
MsgBox "Файлы НЕ идентичны", 16, "Info"<br>
End If<br>
End Sub<br>
<br>

<b>3.13 Хотите знать, какие файлы скопированы в память? - Visual Basic<br></b>
=================================================== <br>
Добавьте на форму элемент CommandButton и ListBox.<br>
Вставьте код, запустите. Затем переключитесь в Проводник, выберите несколько файлов, скопируйте их.<br>
Затем перейдите в вашу программу и нажмите на кнопку. <br>
<br>
Private Const CF_HDROP = 15<br>
Private Type POINT<br>
x As Long<br>
y As Long<br>
End Type<br>
Private Type DROPFILES<br>
pFiles As Long<br>
pt As POINT<br>
fNC As Long<br>
fWide As Long<br>
End Type<br>
Private Declare Function GlobalSize Lib "kernel32" (ByVal hMem As Long) As Long<br>
Private Declare Function GlobalLock Lib "kernel32" (ByVal hMem As Long) As Long<br>
Private Declare Function GlobalUnlock Lib "kernel32" (ByVal hMem As Long) As Long<br>
Private Declare Function OpenClipboard Lib "user32" (ByVal hwnd As Long) As Long<br>
Private Declare Function CloseClipboard Lib "user32" () As Long<br>
Private Declare Function GetClipboardData Lib "user32" (ByVal wFormat As Long) As Long<br>
Private Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" (Destination As Any, Source As Any, ByVal Length As Long)<br>
<br>
Private Sub ShowFilesOnClipboard()<br>
Dim lHandle As Long<br>
Dim lpResults As Long<br>
Dim lRet As Long<br>
Dim df As DROPFILES<br>
Dim strDest As String<br>
Dim lBufferSize As Long<br>
Dim arBuffer() As Byte<br>
Dim vNames As Variant<br>
Dim i As Long<br>
<br>
If OpenClipboard(0) Then<br>
lHandle = GetClipboardData(CF_HDROP)<br>
' If you don't find a CF_HDROP, you don't want to process anything<br>
If lHandle &gt; 0 Then<br>
lpResults = GlobalLock(lHandle)<br>
<br>
lBufferSize = GlobalSize(lpResults)<br>
ReDim arBuffer(0 To lBufferSize)<br>
<br>
CopyMemory df, ByVal lpResults, Len(df)<br>
Call CopyMemory(arBuffer(0), ByVal lpResults + df.pFiles, (lBufferSize - Len(df)))<br>
<br>
If df.fWide = 1 Then<br>
' it is wide chars--unicode<br>
strDest = arBuffer<br>
Else<br>
strDest = StrConv(arBuffer, vbUnicode)<br>
End If<br>
GlobalUnlock lHandle<br>
vNames = Split(strDest, vbNullChar)<br>
i = 0<br>
While Len(vNames(i)) &gt; 0<br>
List1.AddItem vNames(i)<br>
i = i + 1<br>
Wend<br>
End If<br>
End If<br>
CloseClipboard<br>
End Sub<br>
<br>
Private Sub Command1_Click()<br>
List1.Clear<br>
Call ShowFilesOnClipboard<br>
End Sub<br>
    <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх </a> </ol>
         
                        
    <h2><a name="4"><b>04. Работа с папками - Visual Basic</b></a></h2>
    <ol font="" style="font-size:10pt">
  <b>4.1 Как удалить каталог? - Visual Basic</b><br>
  <b>4.2 Создание директории - Visual Basic</b><br>
  <b>4.3 Выводим список всех папок с подпапками - Visual Basic</b><br>
  <b>4.4 Как показать стандартный диалог выбора каталога? - Visual Basic</b><br>
  <b>4.5 Создание многоуровневых каталогов - Visual Basic</b><br>
  <b>4.6 Как проверить, существует ли директория? - Visual Basic?</b><br>
  <b>4.7 Получить размер директории - Visual Basic</b><br> 
  <b>4.8 Определить, имеет ли папка подпапки - Visual Basic</b><br> 
  <b>4.9 Узнать путь к текущей рабочей папке - Visual Basic</b><br> 
  
  <br><br>  
     
<b>4.1 Как удалить каталог? - Visual Basic</b><br>
=================================================== <br>
Private Declare Function RemoveDirectory&amp; Lib "kernel32" Alias "RemoveDirectoryA" (ByVal lpPathName As String)<br>
' Удаление каталога (пустого!)<br>
PathName$ = "D:\t" <br>   
code&amp; = RemoveDirectory(PathName)<br>
If code&amp; = 0 Then<br>
' операция удаления не была выполнена<br>
Else<br>
' каталог удален<br>
End If<br>
<br>

<b>4.2 Создание директории - Visual Basic</b><br>
=================================================== <br>
 Sub MakeDir(dirname As String)<br>
Dim i As Long, path As String<br>
Do<br>
 i = InStr(i + 1, dirname &amp; "\", "\")<br>
 path = Left$(dirname, i - 1)<br>
 If Right$(path, 1) &lt;&gt; ":" And Dir$(path, vbDirectory) = "" Then<br>
 MkDir path<br>
 End If<br>
 Loop Until i &gt;= Len(dirname)<br>
 End Sub<br>
<br>
 
 Private Sub Command1_Click()<br>
 Call MakeDir("C:\Aleks_Soft\1\2\3\")<br>
 End Sub<br>
 <br>
<b>4.3 Выводим список всех папок с подпапками - Visual Basic</b><br>
=================================================== <br>
На форму кинем 2 текстовых поля и кнопку, имя первого текстового поля: 
StartText, имя второго текстового поля OutText и сделай свойство 
Multiline=true, имя кнопки: CmdStart<br>
Далее пишим код в кнопке:<br>
<br>
Static running As Boolean<br>
Dim AllDirs As New Collection<br>
Dim next_dir As Integer<br>
Dim dir_name As String<br>
Dim sub_dir As String<br>
Dim i As Integer<br>
Dim txt As String<br>
If running Then<br>
running = False<br>
CmdStart.Enabled = False<br>
CmdStart.Caption = "Stopping"<br>
Else<br>
running = True<br>
MousePointer = vbHourglass<br>
CmdStart.Caption = "Stop"<br>
OutText.Text = ""<br>
DoEvents<br>
next_dir = 1<br>
AllDirs.Add StartText.Text<br>
Do While next_dir &lt;= AllDirs.Count<br>
dir_name = AllDirs(next_dir)<br>
next_dir = next_dir + 1<br>
sub_dir = Dir$(dir_name &amp; "\*", vbDirectory)<br>
Do While sub_dir &lt;&gt; ""<br>
If UCase$(sub_dir) &lt;&gt; "PAGEFILE.SYS" And sub_dir &lt;&gt; "." And sub_dir &lt;&gt; ".." Then<br>
sub_dir = dir_name &amp; "\" &amp; sub_dir<br>
On Error Resume Next<br>
If GetAttr(sub_dir) And vbDirectory Then AllDirs.Add sub_dir <br>
End If<br>
sub_dir = Dir$(, vbDirectory)<br>
Loop<br>
DoEvents<br>
If Not running Then Exit Do<br>
Loop<br>
txt = ""<br>
For i = 1 To AllDirs.Count<br>
txt = txt &amp; AllDirs(i) &amp; vbCrLf<br>
Next i<br>
OutText.Text = txt<br>
MousePointer = vbDefault<br>
unning = False<br>
End If<br>
<br>
Теперь запустим прогу, в текстовом поле StartText пишим: C:\windows, и жмем на кнопку и ждем!!!
<br><br>
<b>4.4 Как показать стандартный диалог выбора каталога? - Visual Basic</b><br>
=================================================== <br>
Private Type BrowseInfo <br>
    hwndOwner As Long<br>
    pIDLRoot As Long<br>
    pszDisplayName As Long<br>
    lpszTitle As String<br>
    ulFlags As Long<br>
    lpfnCallback As Long<br>
    lParam As Long<br>
    iImage As Long<br>
End Type<br><br>


Dim strPath As String<br>
    Private Declare Function SHBrowseForFolder Lib "shell32" (lpbi As BrowseInfo) As Long<br>
    Private Declare Function SHGetPathFromIDList Lib "shell32" (ByVal pidList As Long, ByVal lpBuffer As String) As Long<br>
    Private Declare Sub CoTaskMemFree Lib "ole32.dll" (ByVal hMem As Long)<br><br>

Public Function BrowseForFolder(hwndOwner As Long, sPrompt As String) As String<br>
    Const BIF_RETURNONLYFSDIRS = 1, MAX_PATH = 260<br>
    Dim intNull As Integer, lngIdList As Long<br>
    Dim udtBI As BrowseInfo<br><br>

With udtBI<br>
        .hwndOwner = hwndOwner<br>
        .lpszTitle = sPrompt<br>
        .ulFlags = BIF_RETURNONLYFSDIRS<br>
End With<br>
    lngIdList = SHBrowseForFolder(udtBI)<br>
    If lngIdList Then<br>
        strPath = String$(MAX_PATH, 0)<br>
        SHGetPathFromIDList lngIdList, strPath<br>
        CoTaskMemFree lngIdList<br>
        intNull = InStr(strPath, vbNullChar)<br>
        If intNull Then strPath = Left$(strPath, intNull - 1)<br>
    End If<br>
    BrowseForFolder = strPath<br>
End Function<br><br>

Private Sub Command1_Click()<br>
    BrowseForFolder Me.hWnd, "Hi, Select ... "<br>
    Print strPath<br>
End Sub<br><br>


<b>4.5 Создание многоуровневых каталогов - Visual Basic</b><br>
=================================================== <br>
         Иногда приходится анализировать наличие указанного каталога (к 
примеру, при установке вашей программы на жесткий диск) и создавать 
новый при его отсутствия. Для этого можно использовать, например, такую 
процедуру: 
<br><br>

Sub CreateLongDir(sDir As String)<br>
  Dim sBuild As String, sDirTmp As String, i As Integer<br>
  '<br>
  sDirTmp = sDir &amp; "\"<br>
  i = InStr (sDirTmp, ":")<br>
  If i &gt; 0 Then    ' задано имя диска<br>
    sBuild = Left$(sDirTmp, i)      ' имя текущего каталога<br>
    sDirTmp = Mid$(sDirTmp, i + 1)<br>
  Else<br>
    sBuild = ""    ' имя текущего каталога<br>
  End If<br>
  Do ' проверка-создание вложенных каталогов<br>
    i = InStr (2, sDirTmp, "\")<br>
    If i = 0 Then Exit Do<br>
    sBuild = sBuild &amp; Left$(sDir, i - 1)<br>
    sDirTmp = Mid$(sDirTmp, i)<br>
    If Dir$(sBuild, 16) = "" Then   'нет такого каталога<br>
      MkDir sBuild    ' создание каталога<br>
    End If<br>
  Loop<br>
End Sub<br><br>

Sub Test () ' примеры обращения<br>
  ' полное имя каталога с именем диска<br>
  Call CreateLongDir("C:\Tests\TestDir\NewDir")<br>
  ' полное имя каталога в текущем диске<br>
  Call CreateLongDir("\Current\TestDir\NewDir")<br>
  ' имя нового каталога относительно текущего каталога<br>
  Call CreateLongDir("Current\TestDir\NewDir")<br>
End Sub<br>
<br><br>
Здесь крайне важно дать правильное описание имени каталога при обращении
 к CreateLongDir (в соответствии с правилами обращения к функциям VB: 
MkDir, ChDir, RmDir, Dir): <br><br>

<b>4.6 Как проверить, существует ли директория? - Visual Basic?</b><br>
=================================================== <br>
Иногда необходимо проверить, существует ли папка. Данная функция 
возвращает True - если папка существует, и False - если такой папки на 
компьютере нет. В данную функцию передается строковая переменная, 
содержащая полный путь к директории(папке). <br>
<br>
Public Function FolderExists(ByVal strPathName As String) As Boolean<br>
Dim DirectoryFound As String<br>
Const errPathNotFound As Integer = 76<br>
On Error GoTo 0<br>
DirectoryFound = Dir(strPathName, vbDirectory)<br>
If (Len(DirectoryFound) = 0 Or Err = errPathNotFound) Then<br>
FolderExists = False<br>
Else<br>
FolderExists = True<br>
End If<br>
End Function<br>
Private Sub Command1_Click()<br>
'MsgBox FolderExists("D:\Basic")<br>
If FolderExists("D:\Basic\Module1") = False Then<br>
MsgBox "Такая папка не существует"<br>
Else<br>
MsgBox "Такая папка существует"<br>
End If<br>
End Sub<br><br>

<b>4.7 Получить размер директории - Visual Basic</b><br>
=================================================== <br>
Const MAX_PATH = 260<br>
Private Type FILETIME<br>
dwLowDateTime As Long<br>
dwHighDateTime As Long<br>
End Type<br>
Private Type WIN32_FIND_DATA<br>
dwFileAttributes As Long<br>
ftCreationTime As FILETIME<br>
ftLastAccessTime As FILETIME<br>
ftLastWriteTime As FILETIME<br>
nFileSizeHigh As Long<br>
nFileSizeLow As Long<br>
dwReserved0 As Long<br>
dwReserved1 As Long<br>
cFileName As String * MAX_PATH<br>
cAlternate As String * 14<br>
End Type<br>
Private Declare Function FindFirstFile Lib "kernel32" Alias "FindFirstFileA" (ByVal lpFileName As String, lpFindFileData As<br> WIN32_FIND_DATA) As Long<br>
Private Declare Function FindNextFile Lib "kernel32" Alias 
"FindNextFileA" (ByVal hFindFile As Long, lpFindFileData As 
WIN32_FIND_DATA)<br> As Long<br>
Private Declare Function FindClose Lib "kernel32" (ByVal hFindFile As Long) As Long<br>
<br>
Public Function SizeOf(ByVal DirPath As String) As Double<br>
Dim hFind As Long<br>
Dim fdata As WIN32_FIND_DATA<br>
Dim dblSize As Double<br>
Dim sName As String<br>
Dim x As Long<br>
On Error Resume Next<br>
x = GetAttr(DirPath)<br>
If Err Then SizeOf = 0: Exit Function<br>
If (x And vbDirectory) = vbDirectory Then<br>
dblSize = 0<br>
Err.Clear<br>
sName = Dir$(EndSlash(DirPath) &amp; "*.*", vbSystem Or vbHidden Or vbDirectory)<br>
If Err.Number = 0 Then<br>
hFind = FindFirstFile(EndSlash(DirPath) &amp; "*.*", fdata)<br>
If hFind = 0 Then Exit Function<br>
Do<br>
If (fdata.dwFileAttributes And vbDirectory) = vbDirectory Then<br>
sName = Left$(fdata.cFileName, InStr(fdata.cFileName, vbNullChar) - 1)<br>
If sName &lt;&gt; "." And sName &lt;&gt; ".." Then<br>
dblSize = dblSize + SizeOf(EndSlash(DirPath) &amp; sName)<br>
End If<br>
Else<br>
dblSize = dblSize + fdata.nFileSizeHigh * 65536 + fdata.nFileSizeLow<br>
End If<br>
DoEvents<br>
Loop While FindNextFile(hFind, fdata) &lt;&gt; 0<br>
hFind = FindClose(hFind)<br>
End If<br>
Else<br>
On Error Resume Next<br>
dblSize = FileLen(DirPath)<br>
End If<br>
SizeOf = dblSize<br>
End Function<br>
Private Function EndSlash(ByVal PathIn As String) As String<br>
If Right$(PathIn, 1) = "\" Then<br>
EndSlash = PathIn<br>
Else<br>
EndSlash = PathIn &amp; "\"<br>
End If<br>
End Function<br>
<br>
Private Sub Form_Load()<br>
'Замените 'D:\Basic' той директорией, размер которой хотите узнать<br>
MsgBox SizeOf("D:\Basic") / 1000000<br>
End Sub<br><br>

<b>4.8 Определить, имеет ли папка подпапки - Visual Basic</b><br>
=================================================== <br>
Private Const MAX_PATH = 260<br>
Private Type SHFILEINFO<br>
hIcon As Long<br>
iIcon As Long<br>
dwAttributes As Long<br>
szDisplayName As String * MAX_PATH<br>
szTypeName As String * 80<br>
End Type<br>
Private Declare Function SHGetFileInfo Lib "Shell32" Alias 
"SHGetFileInfoA" (ByVal pszPath As Any, ByVal dwFileAttributes As Long, 
psfi As SHFILEINFO, ByVal cbFileInfo As Long, ByVal uFlags As Long) As 
Long<br>
<br>
Function FolderHasSubFolders(ByVal sPath As String) As Boolean<br>
Const SFGAO_HASSUBFOLDER = &amp;H80000000<br>
Const SHGFI_ATTRIBUTES = &amp;H800<br>
Dim FInfo As SHFILEINFO<br>
SHGetFileInfo sPath, 0, FInfo, Len(FInfo), SHGFI_ATTRIBUTES<br>
FolderHasSubFolders = (FInfo.dwAttributes And SFGAO_HASSUBFOLDER)<br>
End Function<br>
<br>
Private Sub Command1_Click()<br>
MsgBox FolderHasSubFolders("C:\Program Files")<br>
MsgBox FolderHasSubFolders("C:\Program Files\NetMeeting")<br>
End Sub<br><br>
<b>4.9 Узнать путь к текущей рабочей папке - Visual Basic</b><br>
=================================================== <br>
MsgBox CurDir
      <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх  </a> </ol>

                          
      
 <h2><a name="5"><b>05. Как узнать имя компьютера и имя пользователя?</b></a></h2>
    <ol font="" style="font-size:10pt">
    
    Private Declare Function GetComputerNameA Lib "kernel32" (ByVal lpBuffer As String, nSize As Long) As Long<br>
    Private Declare Function WNetGetUserA Lib "mpr.dll" (ByVal lpName As
 String, ByVal lpUserName As String, lpnLength As Long) As Long<br>
    Function GetComputerName() As String<br>
    Dim sBuffer As String * 255<br>
    If GetComputerNameA(sBuffer, 255&amp;) &lt;&gt; 0 Then<br>
    GetComputerName = Left$(sBuffer, InStr(sBuffer, vbNullChar) - 1)<br>
    End If<br>
    End Function<br>
    Function GetUserName() As String<br>
    Dim sUserNameBuff As String * 255<br>
    sUserNameBuff = Space(255)<br>
    Call WNetGetUserA(vbNullString, sUserNameBuff, 255&amp;)<br>
    GetUserName = Left$(sUserNameBuff, InStr(sUserNameBuff, vbNullChar) - 1)<br>
    End Function<br>
<br>
    Private Sub Command1_Click()<br>
    MsgBox GetComputerName, 64, "ComputerName"<br>
    MsgBox GetUserName, 64, "GetUserName"<br>
    End Sub<br>
      <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх </a>  </ol>
    
             
   <h2><a name="6"><b>06. Как изменить имя компьютера?</b></a></h2>
    <ol font="" style="font-size:10pt">
'добавьте модуль<br>
 Declare Function SetComputerName Lib "kernel32" Alias "SetComputerNameA" (ByVal lpComputerName As String) As Long<br>
'добавьте кнопку<br>
 a$ = "Hello World"<br>
b&amp; = SetComputerName(a$)<br>

      <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх </a> </ol>
   
      
      
      
          <h2><a name="7"><b>07. Работа с числами, шрифтом, текстом, TextBox'om и RichTextBox'om - Visual Basic</b></a></h2>
    <ol font="" style="font-size:10pt">
    <b>7.1  Загрузить текстовой файл в TextBox, сохранить текстовой файл из TextBox'а - Visual Basic</b><br>
    <b>7.2  Определение координат позиции курсора в TextBox - Visual Basic</b><br>
    <b>7.3  Как узнать сколько слов в TextBox - Visual Basic</b><br>
    <b>7.4  Как сделать первую букву каждого слова заглавной? - Visual Basic</b><br>
    <b>7.5  Запретить ввод определенных символов - Visual Basic</b><br>
    <b>7.6  Добавить новую линию в существующий текст элемента TextBox - Visual Basic</b><br>
    <b>7.7  Как очистить все TextBox'ы на форме? - Visual Basic</b><br>
    <b>7.8  Как вернуться на то же место, при потере фокуса? - Visual Basic</b><br> 
    <b>7.9  Как можно заблокировать стандартное контекстное меню элемента TextBox? - Visual Basic</b><br> 
    <b>7.10 Проверить тип вводимой информации - Visual Basic</b><br> 
    <b>7.11 Скрыть/показать мигающий курсор в Text Box - Visual Basic</b><br> 
    <b>7.12 Убрать двойные пробелы во всем тексте - Visual Basic</b><br> 
    <b>7.13 Скролинг текста - Visual Basic</b><br> 
    <b>7.14 Получение содержимого n-ой строки в Multiline TextBox. - Visual Basic</b><br>
    <b>7.15 Подсчитать количество определенных символов в тексте - Visual Basic</b><br> 
    <b>7.16 Определение кодировки русского текста - Visual Basic</b><br> 
    <b>7.17 Очистка строки от ненужных символов - Visual Basic</b><br> 
    <b>7.18 Преобразование WIN в ASCII текст  - Visual Basic</b><br> 
    <b>7.19 ANSCII в Win   - Visual Basic</b><br> 
    <b>7.20 Как осуществить замену в TextBox? - Visual Basic</b><br>
    <b>7.21  Как сделать Undo или Отменить в TextBox? - Visual Basic</b><br> 
   <b>7.22  Как уместить в TextBox больше 64 kb текста? - Visual Basic</b><br> 
   <b>7.23  Cвойства TextBox'a. - Visual Basic</b><br> 
   <b>7.24  Компонент RichTextBox. - Visual Basic</b><br> 
   <b>7.25  Как найти и выделить текст в RichTextBox - Visual Basic</b><br> 
   <b>7.26  Определение строки, на которой находится курсор.  - Visual Basic</b><br> 
   <b>7.27  Определить количество строк в TextBox'е.   - Visual Basic</b><br> 
   <b>7.28  Проверка орфографии.   - Visual Basic</b><br>  
   <b>7.29  Является ли строковая переменная e-mail-адресом.  - Visual Basic</b><br>  
   <b>7.30  Перекодировка текста: Rus-Lat  - Visual Basic</b><br>
   <b>7.31  Перекодировка текста из DOS в Windows формат - Visual Basic</b><br> 
   <b>7.32  Послать строковое сообщение в другую программу - Visual Basic</b><br>  
   <b>7.33  Захват текста из любого текстового поля - Visual Basic</b><br> 
   <b>7.34  Форматирование числа при выводе (заполнение до определенной длины) - Visual Basic</b><br> 
   <b>7.35  Примеры работы с датами - Visual Basic</b><br> 
   <b>7.36  Определить кодировку текста (Dos или Win) - Visual Basic</b><br> 
   <b>7.37  Вертикальное/горизонтальное написание в элементе Label - Visual Basic</b><br> 
   <b>7.38  Как получить короткий путь("c:\progra~1") файла если имеется длинный  - Visual Basic</b><br> 
   <b>7.39  Как вывести кавычки в MsgBox? - Visual Basic</b><br>
   <b>7.40  Как узнать ASCLL код символа? - Visual Basic</b><br>
   <b>7.41  Как узнать количество символов в строке? - Visual Basic</b><br>
   <b>7.42 Как преобразовать буквы в нижний или верхний регистр? - Visual Basic</b><br>
   <b>7.43 MsgBox впереди всех - Visual Basic</b><br>
   <b>7.44 Как в MsgBox вывести или записать в переменную данные столбиком? - Visual Basic</b><br>
   <b>7.45 Операции "копировать", "вырезать", "вставить"  - Visual Basic</b><br>
   <b>7.46 3D-текст на форме  - Visual Basic</b><br>
   <b>7.47 Как вывести символ &amp; в Label - Visual Basic</b><br>
   <b>7.48 Постоянно возникающий вопрос у тех, кто пишет блокнот. Функция Command - Visual Basic</b><br>
   <b>7.49 Ввод в TextBox только цифр - Visual Basic</b><br>
   <b>7.50 Как сделать вывод только  заглавных букв в TextBox - Visual Basic</b><br>
   
<br><br>
    <b>7.1 Загрузить текстовой файл в TextBox, сохранить текстовой файл из TextBox'а - Visual Basic</b><br>
    ====================================================<br>
    	Зугрузить текстовой файл в TextBox:<br>
    	Dim FN as Integer <br>
	FN = FREEFILE <br>
	Dim FName as String <br>
	FName = "C:\tmp\index.txt" <br>
	Open FName For Input As #FN <br>
	Text1.Text = Input(LOF(FN), #FN) <br>
	Close #FN <br>
	<br>
	Сохранить текстовой файл из TextBox'а:<br>
	Dim FN as Integer <br>
	FN = FREEFILE <br>
	Dim FName as String <br>
	FName = "C:\tmp\index.txt" <br>
	Open FName For Output As #FN <br>
	Print #FN, Text1.Text <br>
	Close #FN<br>
	<br>
	<b>7.2 Определение координат позиции курсора в TextBox - Visual Basic</b><br>
 ====================================================<br>
	Private Type POINTAPI <br>
	X As Long <br>
	Y As Long <br>
	End Type <br>
	Private Declare Function GetCaretPos Lib "user32" (lpPoint As POINTAPI) As Long <br>
	<br>
	Private Sub Text1_KeyPress(KeyAscii As Integer) <br>
	Dim XPos As Long <br>
	Dim YPos As Long <br>
	XPos = GetTCursX <br>
	YPos = GetTCursY <br>
	Me.Caption = "X: " &amp; XPos &amp; " Y: " &amp; YPos <br>
	End Sub <br>
	Public Function GetTCursX() As Long <br>
	Dim pt As POINTAPI <br>
	GetCaretPos pt <br>
	GetTCursX = pt.X <br>
	End Function <br>
	Public Function GetTCursY() As Long <br>
	Dim pt As POINTAPI <br>
	GetCaretPos pt <br>
	GetTCursY = pt.Y <br>
	End Function<br>
 	<br>
	<b>7.3 Как узнать сколько слов в TextBox - Visual Basic</b><br>
	 ====================================================<br>
	MsgBox (UBound(Split(Text1.Text)) + 1)<br>
	<br>
	<b>7.4 Как сделать первую букву каждого слова заглавной?</b><br>
 ====================================================<br>
	Private Function ccProperCase(MySourceControl As Control)<br>
	On Error GoTo ErrH<br>
	Dim strString As String<br>
	strString = MySourceControl.Text<br>
	If IsNull(strString) Then Exit Function<br>
	strString = StrConv(strString, vbProperCase)<br>
	MySourceControl.SelStart = Len(strString)<br>
	MySourceControl.Text = strString<br>
	Exit Function<br>
	ErrH:<br>
	MsgBox "Error at ccProperCase:::- " &amp; Err.Number &amp; " - " &amp; Err.Description, vbCritical<br>
	Exit Function<br>
	End Function<br>
	<br>
	Private Sub Text1_Change()<br>
	Call ccProperCase(Text1)<br>
	End Sub<br>
	<br>
    	<b>7.5 Запретить ввод определенных символов - Visual Basic</b><br>
    	 ====================================================<br>
    	Private Sub Text1_KeyPress(KeyAscii As Integer)<br> 
	Dim sTemplate As String <br>
	'Replace the '!@#$%^&amp;*()_+= ' какие символы игнорировать<br> 
	sTemplate = "!@#$%^&amp;*()_+=" <br>
	If InStr(1, sTemplate, Chr(KeyAscii)) &gt; 0 Then KeyAscii = 0 <br>
	End Sub<br>
	<br>
	Если тебе, например надо запретить ввод букв и разрешить только ввод цифр, то смотри ниже как это делается:<br>
	Private Sub txtSum_KeyPress(KeyAscii As Integer) <br>
	KeyAscii = Only_Number(KeyAscii) <br>
	End Sub <br>
	Function Only_Number(theParam As Integer)<br> 
	If InStr("1234567890" &amp; Chr(8), Chr(theParam)) &gt; 0 Then<br> 
	Only_Number = theParam <br>
	Else <br>
	Only_Number = 0 <br>
	End If <br>
	End Function<br>
	<br>
	<b>7.6 Добавить новую линию в существующий текст элемента TextBox - Visual Basic</b><br>
	 ====================================================<br>
	Добавьте Command Button и TextBox на форму. <br>
	<br>
	Private Sub Command1_Click() 
	Dim NewText As String <br>
	With Text1 <br>
	'replace 'My New Text' with the Text you want to add<br>
	NewText = "My New Text" <br>
	.SelStart = Len(.Text) <br>
	.SelText = vbNewLine &amp; NewText <br>
	End With <br>
	<br>
	End Sub <br>
	Private Sub Form_Load() <br>
	Text1.Text = "My Initial Text" <br>
	End Sub<br><br>
	<b>7.7 Как очистить все TextBox'ы на форме? - Visual Basic</b><br>
	 ====================================================<br>
	Добавьте на форму несколько элементов TextBox и CommandButton. <br>
	<br>
	Private Sub Command1_Click() <br>
	Dim Contrl As Control <br>
	For Each Contrl In Form1.Controls<br> 
	If (TypeOf Contrl Is TextBox) Then Contrl.Text = "" <br>
	Next Contrl <br>
	End Sub<br>
	<br>
	<b>7.8 Как вернуться на то же место, при потере фокуса? - Visual Basic</b><br>
	 ====================================================<br>
	Dim x <br>
	Private Sub Text1_GotFocus() <br>
	On Error Resume Next <br>
	Text1.SelStart = x <br>
	End Sub <br>
	<br>
	Private Sub Text1_LostFocus() <br>
	x = Text1.SelStart<br> 
	End Sub<br>
	<br>
	<b>7.9 Как можно заблокировать стандартное контекстное меню элемента TextBox? - Visual Basic</b><br>
	 ====================================================<br>
	'Расположите на форме TextBox, а также создайте невидимое меню mnuText и как минимум одно подменю. <br>
	'Запустите проект, нажмите правой клавишей мыши на TextBox'е... <br>
	Private Declare Function LockWindowUpdate Lib "User32" (ByVal hwndLock As Long) As Long <br>
	Private Sub Text1_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single) <br>
	If Button = vbRightButton Then <br>
	LockWindowUpdate Text1.hWnd <br>
	Text1.Enabled = False <br>
	DoEvents <br>
	PopupMenu mnuText <br>
	Text1.Enabled = True<br> 
	LockWindowUpdate 0&amp; <br>
	End If <br>
	End Sub<br><br>
	<b>7.10 Проверить тип вводимой информации - Visual Basic</b><br>
	 ====================================================<br>
 	Простая проверка регистра, буква или цифра, используя API. <br>
	Добавить Text Box на форму. <br>
	Private Declare Function IsCharUpper Lib "user32" Alias "IsCharUpperA" (ByVal cChar As Byte) As Long <br>
	Private Declare Function IsCharLower Lib "user32" Alias "IsCharLowerA" (ByVal cChar As Byte) As Long <br>
	Private Declare Function IsCharAlpha Lib "user32" Alias "IsCharAlphaA" (ByVal cChar As Byte) As Long <br>
	Private Declare Function IsCharAlphaNumeric Lib "user32" Alias "IsCharAlphaNumericA" (ByVal cChar As Byte) As Long <br>
	Private Sub Text1_KeyPress(KeyAscii As Integer) <br>
	'1 - True, 0 - False <br>
	MsgBox "Upper Case: " &amp; IsCharUpper(KeyAscii) &amp; " Lower Case: "
 &amp; IsCharLower(KeyAscii) &amp; " Alpha: " &amp; 
IsCharAlpha(KeyAscii) &amp; " Alpha or Numeric: " &amp; 
IsCharAlphaNumeric(KeyAscii) <br>
	End Sub<br><br>
	<b>7.11 Скрыть/показать мигающий курсор в Text Box - Visual Basic</b><br>
	 ====================================================<br>
	Private Declare Function HideCaret Lib "user32" (ByVal hwnd As Long) As Long <br>
	Private Declare Function ShowCaret&amp; Lib "user32" (ByVal hwnd As Long) <br>
	Private Sub CheckCaret() <br>
	If Check1.Value = vbChecked Then <br>
	ShowCaret (Text1.hwnd) <br>
	Else <br>
	HideCaret (Text1.hwnd) <br>
	End If <br>
	End Sub <br>
	Private Sub Form_Load() <br>
	Check1.Value = 1 <br>
	End Sub <br>
	Private Sub Text1_Change() <br>
	CheckCaret <br>
	End Sub <br>
	Private Sub Text1_GotFocus()<br> 
	CheckCaret <br>
	End Sub<br><br>
	<b>7.12 Убрать двойные пробелы во всем тексте - Visual Basic</b><br>
	 ====================================================<br>
Данная функция в качестве входного параметра принимает любую текстовую 
строку (содержимое TextBox или RichTextBox), убирает все двойные пробелы
 и возвращает обновленный текст. Для пояснения действия данной функции 
добавьте на форму элемент TextBox, элемент CommandButton. Скопируйте 
следующий текст, запустите проект. В текстовом поле наберите любой 
текст, оставляя двойные пробелы между буквами или словами. Затем нажмите
 на кнопку.<br>
<br>
Public Function SquishSpaces(ByVal strText As String) As String <br>
Const TWO_SPACES As String = " " <br>
Dim intPos As Integer <br>
Dim strTemp As String <br>
intPos = InStr(1, strText, TWO_SPACES, vbBinaryCompare<br>
Do While intPos &gt; 0 <br>
strTemp = LTrim$(Mid$(strText, intPos + 1)) <br>
strText = Left$(strText, intPos) &amp; strTemp <br>
intPos = InStr(1, strText, TWO_SPACES, vbBinaryCompare) <br>
Loop <br>
SquishSpaces = strText <br>
End Function <br>
Private Sub Command1_Click() <br>
Text1.Text = SquishSpaces(Text1.Text)<br>
'RichTextBox1.Text = SquishSpaces(RichTextBox1.Text) <br>
End Sub<br><br>
<b>7.13 Скролинг текста - Visual Basic</b><br>
====================================================<br>
'Расположите на форме элемент CommandButton, элемент TextBox, элемент Timer. <br>
Dim strText As String <br>
Private Sub Command1_Click() <br>
strText = String(30, " ") + "Visual Basic" <br>
Timer1.Interval = 100 <br>
Timer1.Enabled = True <br>
End Sub<br>
<br>
Private Sub Form_Load() <br>
Command1.Caption = "Начать скролинг" <br>
With Text1 <br>
.Font = "Courier New Cyr"<br> 
.FontSize = 12 <br>
.Width = 3400 <br>
End With <br>
End Sub<br>
<br>
 
Private Sub Timer1_Timer() <br>
strText = Mid(strText, 2) &amp; Left(strText, 1) <br>
Text1 = strText <br>
End Sub<br><br>

<b>7.14 Получение содержимого n-ой строки в Multiline TextBox. - Visual Basic</b><br>
====================================================<br>
Расположите на форме элемент CommandButton и элемент TextBox. <br>
Установите свойство Multiline элемента TextBox как True. <br>
Синтаксис вызова функции прост: GetLine(НазваниеОкна.hWnd, НомерСтроки). <br>
Данный пример (при нажатии на кнопку) покажет содержимое 2-й строки элемента <br><br>
<br>

Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" 
(ByVal hWnd As Long, ByVal msg As Long, ByVal wp As Long, lp As Any) As 
Long <br>
Const EM_LINEINDEX = &amp;HBB <br>
Const EM_LINELENGTH = &amp;HC1 <br>
Const EM_GETLINE = &amp;HC4 <br>
Public Function GetLine(hWnd As Long, Line As Long) As String <br>
Dim sBuf As String, nLen As Long, nIndex As Long <br>
nIndex = SendMessage(hWnd, EM_LINEINDEX, Line - 1, ByVal 0&amp;) <br>
If nIndex &lt; 0 Or Line &lt;= 0 Then Exit Function<br> 
nLen = SendMessage(hWnd, EM_LINELENGTH, nIndex, ByVal 0&amp;) <br>
sBuf = Space(nLen + 1) <br>
Mid$(sBuf, 1, 1) = Chr$(nLen And &amp;HFF) <br>
Mid$(sBuf, 2, 1) = Chr$(nLen \ 256) <br>
SendMessage hWnd, EM_GETLINE, Line - 1, ByVal sBuf <br>
GetLine = Left$(sBuf, nLen) <br>
End Function<br><br>

Private Sub Form_Load() <br>
Text1.Text = "1111111" &amp; vbCrLf &amp; "22222" &amp; vbCrLf &amp; "3333" &amp; vbCrLf &amp; "4444" <br>
End Sub<br><br>

Private Sub Command1_Click() <br>
MsgBox GetLine(Text1.hWnd, 2) <br>
End Sub <br><br>

<b>7.15 Подсчитать количество определенных символов в тексте. - Visual Basic</b><br>
====================================================<br>
Данный пример покажет, сколько раз встречается буква Н в данном выражении. <br>
Вместо Н вы можете использовать любое строковое выражение.<br>
<br>

Private Sub Form_Load() 
myString = "в данном примере несколько букв н, а точнее - " <br>
tempString = Split(myString, "н") <br>
MsgBox "в данном примере несколько букв н, а точнее - " &amp; UBound(tempString) <br>
tempString = Split(myString, "нн") <br>
MsgBox "в данном примере " &amp; UBound(tempString) &amp; " раз встречается выражение нн" <br>
End Sub<br><br>


<b>7.16 Определение кодировки русского текста. - Visual Basic </b><br>
====================================================<br>

Определение кодировки текста<br><br>
 

'пpовеpяем тип кодиpовки ANSI или ASCII <br>
'беpем пеpвые 1000 байт еcли это возможно. Hевозможно - меньше.<br>
l&amp; = Len(rtbView.Text)<br>
If l&amp; &gt; 1000 Then l&amp; = 1000<br>
'копиpyем yчаcток текcта из RichTextBox в пеpеменнyю, иначе тоpмоз обеcпечен<br>
s$ = Left$(rtbView.Text, l&amp;)<br>
'обнyляем флажки<br>
fdo% = 0<br>
fwo% = 0<br>
'пpоcматpиваем кycок текcта<br>
For n% = 1 To l&amp;<br>

'вытаcкиваем очеpедной cимвол<br>
c$ = Mid$(s$, n%, 1)<br>
'еcли это pyccкая "о" в DOS кодиpовке то инкpементиpyем cчетчик<br>
If c$ = Chr$(174) Then fdo% = fdo% + 1<br>
'еcли это pyccкая "о" в Win кодиpовке то инкpементиpyем cчетчик<br>
If c$ = Chr$(238) Then fwo% = fwo% + 1<br>
<br>
Next<br>
<br>
'ycтанавливаем в конфиге тип пpоcмотpа по дефолтy<br>
If fdo% &gt; fwo% Then 'это явно ДОC-текcт<br>
Else 'это явно Win-текcт<br><br>

<b>7.17 Очистка строки от ненужных символов - Visual Basic  </b><br>
====================================================<br>
Иногда бывает полезно иметь функцию, которая очищает строку от 
нежелательных символов. Эта маленькая функция принимает в качестве 
параметров строку для очистки и символ, от которого ее надо очистить: 
<br>
Function StringCleaner(s As String,  Search As String) As String <br>
                Dim i As Integer, res As String <br>
                res = s <br>
                Do While InStr(res, Search) <br>
                        i = InStr(res, Search) <br>
                        res = Left(res, i - 1) &amp;  Mid(res, i + 1) <br>
                Loop <br>
                StringCleaner = res <br>
End Function <br><br>

<b>7.18 Преобразование WIN в ASCII текст - Visual Basic </b><br>
====================================================<br>
Q: Пишу на VB 4 некую задачу. Имеются данные, котоpые нужно хpанить во 
внешних файлах в фоpмате ASCII. Какой пpоцедуpой можно их откpыть и 
считать. 
 <br>A: Alexander Shherbakov <br><br>

   Dim sTemp As String, sRes As String <br>
     Open "file.txt" For Input As #1 <br>
         While Not EOF(1) <br>
             Line Input #1, sTemp <br>
             sRes = sRes &amp; sTemp &amp; Chr$(13) &amp; Chr$(10) <br>
         Wend <br>
     Close #1 <br><br>


 
Hамного быcтpее и пpоще бyдет: <br><br>

   Dim File As String, CF As String <br>
   'объявим пеpеменнyю для имени файла и его cодеpжимого <br>
   File = "d:\ca.log" <br>
   'ycтановим имя файла и пyть <br>
   Open File For Binary As #1 <br>
   'откpоем файл для чтения <br>
      CF = Input(FileLen(File), 1) <br>
      'загpyзить в пеpеменyю CF вcе cодеpжимое файла <br>
   Close #1 <br>
   'закpыть файл <br>

<br>
У этого метода еcть пpеимyщеcтва и недоcтатки. Пpеимyщеcтво в том, что 
загpyзка идет быcтpее чем пpи поcтpочном чтении. Hаконец можно гpyзить 
бинаpные файлы. А недоcтаток в том, что немного cложнее cделать Пpогpеcc
 баp (хотя по идее, бей файл на 100 кycков и поочеpедно гpyзи каждый, 
неcложно). Во вcяком cлyчае я юзаю именно этот метод. <br>

P.S. Пpовеpил. У меня этим методом 144 кила гpyзятcя за 9 cекyнд. <br>
 Конечно тоpмоз, но пpи поcтpочном чтении это бyдет на поpядок дольше. <br><br>
<b>7.19 ANSCII - Win  - Visual Basic </b><br>
====================================================<br>
 Q: Как сделать пpеобpазование в кодиpовку Windows. Функции OemToAnsi* и AnsiToOem* из Win32 API <br>
 A: Vladimir Kann <br>
 OemToChar и CharToOem <br><br>
 
 А поподробнее можно, если можно с примером <br><br>
 

Declare Function OemToChar Lib "user32" Alias "OemToCharA" (ByVal lpszSrc As <br>
String, ByVal lpszDst As String) As Long <br>
Declare Function CharToOem Lib "user32" Alias "CharToOemA" (ByVal lpszSrc As <br>
String, ByVal lpszDst As String) As Long <br><br>


стpоки д.б. одинаковой длины, т.е. пpинимающую стpоку можно забить пpобелами: <br><br>

in$="OEM" <br>
out$=SPACE(LEN(in$)) <br>
OemToChar in$,out$ <br><br>


 <br>
A: Nick Egorov <br>
 А поподробнее можно, если можно с примером <br>
 <br>
Да пожалуйста: <br>
 <br>

Public Function ToAnsi(S As String) As String <br>
    Dim Buffer As String * 1000 <br>
    OemToCharBuff S, Buffer, Len(S) <br>
    ToAnsi = Trim(Buffer) <br>
End Function <br>
Declare Function OemToCharBuff Lib "user32" Alias "OemToCharBuffA" (ByVal <br>
lpszSrc As String, ByVal lpszDst As String, ByVal cchDstLength As Long) As Long <br>

<br>
 
Как тут в эхе заметили, можно писать вместо <br>
<br>
Dim Buffer As String * 1000 <br>

Dim Buffer As String <br>
Set Buffer = String( Len(S), 32) <br>
<br>

Аналогичная функция CharToOemBuff конвертит из ANSI в OEM (DOS). <br><br>

A: Andrey Fedorov <br>
IMHO а так проще: <br><br>

Declare Function OemToChar Lib "user32" Alias "OemToCharA" _ <br>
        (ByVal lpszSrc As String, ByVal lpszDst As String) As Long <br>
<br>
Public Function ToAnsi(S As String) As String <br>
    Dim ss As String <br>
    ss = s: OemToCharBuff s, ss: ToAnsi = ss <br>
End Function <br><br>
<b>7.20 Как осуществить замену в TextBox? - Visual Basic</b><br>
====================================================<br>
Например вам нужно, чтобы при нажатие на кнопку все символы  например 
"," превратился в ".". Для этого киньте TextBox на форму и 1 кнопку и 
вот код к кнопке:
<br><br>
Text1.Text = Replace(Text1.Text, ",", ".")<br><br>
<b>7.21 Как сделать Undo или Отменить в TextBox? - Visual Basic</b><br>
====================================================<br>
Как осуществить отмену в TextBox в Visual Basic, ответ прост:)<br>
Кинь на форму 1 кнопку и текстовое поле, вот код:<br><br>
'Свойство TextBox Multiline установите в True <br>
Option Explicit <br>
Private Declare Function SendMessage Lib   "user32" Alias "SendMessageA"
  (ByVal hWnd As Long,  ByVal wMsg As Long,   ByVal wParam As Long,  
lParam As Any) As Long <br>
Const EM_UNDO = &amp;HC7 <br><br>

Private Sub Command1_Click() <br>
SendMessage Text1.hWnd, EM_UNDO, &amp;O0, &amp;O0 <br>
End Sub<br><br>

<b>7.22 Как уместить в TextBox больше 64 kb текста? - Visual Basic</b><br>
====================================================<br>
'Нужно поместить на форму TextBox, назвать его txtMain,<br>
'установить его свойство Multiline как True,<br>
'а свойство ScroolBars, как 1-Horizontal.<br>
'А также рядом с TextBox'ом нарисовать вертикальный ScroolBar с именем vsbText.<br>
<br>
Private Text()<br>
Private Const LineNum = 15<br><br>

Private Sub Form_Load()<br>
    Dim i<br>

    Open "C:\Alexey\МОИ ПРОГРАММЫ\Winapi\win32api.txt" For Input As #1 Len = 1024<br>
        Do Until EOF(1)<br>
            i = i + 1<br>
            ReDim Preserve Text(i + LineNum)<br>
            Line Input #1, Text(i)<br>
        Loop<br>
    Close #1<br>

With vsbText<br>
    .Min = 1<br>
    .Max = i<br>
    .SmallChange = 1<br>
    .LargeChange = i \ 10<br>
End With<br>

End Sub<br>
<br>
Private Sub vsbText_Change()<br>
    Dim i As Integer<br>
    Dim Temp<br>
    For i = vsbText.Value To vsbText.Value + LineNum<br>
        Temp = Temp + Text(i) + vbCrLf<br>
    Next i<br>

    txtMain.Text = Temp<br>
End Sub<br><br>

  <b>7.23 Cвойства TextBox'a - Visual Basic</b><br>
    ====================================================<br>
SelLegth SelStart SelText<br>
<br>
Часто возникают ситуации, когда при использовании TextBox необходимо, 
что бы при перемещении на него фокуса, текст находящийся в нем 
маркировался. Или же при при перемещении на него фокуса, (или добавлении
 в него другого текста) курсор сразу должен перемещаться в конец 
имеющегося в TextBox - е текста. Или же иметь возможность для дальнейщих
 Ваших операций с маркированным текстом. Все это, позволяют сделать 
некоторые свойства TextBox-а – SelLegth, SelStart и SelText. 
Рассмотрим оба случая. <br>
Первый случай - при перемещении фокуса на TextBox, текст находящийся в 
нем маркировался. Для этого необходимо в процедуру Text1_GotFocus 
вставить следующий код: 
<br><br>
Private Sub Text1_GotFocus()<br>

'Определяем начальное положение текста <br>

Text1.SelStart = 0<br>

'Маркируем всю длину текста, вычисляя его спомощью оператора Len <br>

Text1.SelLength = Len(Text1.Text) End Sub<br>

Второй случай - - при перемещении фокуса на TextBox, (или добавлении в 
него другого текста) курсор должен перемещаться в конец имеющегося в 
TextBox - е текста. Для этого необходимо в процедуру Text1_GotFocus 
вставить следующий код: 
<br>
Private Sub Text1_GotFocus() 
<br>
'Определяем длинну имеющегося текста и присваиваем это позиции начала следующего текста 
<br>
Text1.SelStart = CLng(Len(Text1.Text)) End Sub
<br>
Третий случай - возможность обработки маркированного текста. Для этого можно использовать одну строку кода. 
<br>
Dim strMarkText As String 
<br>
'Присваиваем переменной strMarkText текст маркированный в TextBox 
<br>
strMarkText = Text1.SelText<br><br>

	<b>7.24 Компонент RichTextBox - Visual Basic</b><br>
	 ====================================================<br>
	 Элемент RichTextBox представляет собой усовершенствованное текстовое 
окно, с помощью которого вы можете создавать полноценные файлы в формате
 RTF, в которых вы можете как угодно форматировать внешний вид своего 
документа: расставлять переносы, выделять текст различными шрифтами, 
менять гарнитуру текста и т.д. 
Подключается данный контрол очень просто: через меню Project | 
Components. установите флажок на строчке Microsoft Rich Textbox Control 
6.0 и у вас на панели Toolbox появится значок этого компонента. Затем вы
 размещаете данный контрол на вашей форме... и все. 
<br><br>
Вставить рисунок<br>
Private Sub Command1_Click() <br>
a = RichTextBox1.SelStart <br>
RichTextBox1.OLEObjects.Add , , "D:\4\add_pictures_to_richtextbox\smile.bmp" <br>
RichTextBox1.SelStart = a + 1 <br>
RichTextBox1.SetFocus <br>
End Sub <br>
Private Sub Form_Load() <br>
RichTextBox1.OLEObjects.Clear <br>
End Sub <br>
Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer) <br>
RichTextBox1.OLEObjects.Clear <br>
End Sub <br>
<br>
Выделить текст жирным шрифтом <br>
RichTextBox1.SelBold = True <br>
<br>
Выделить текст курсивом <br>
RichTextBox1.SelItalic = True <br><br>

Выделить текст подчеркнутым шрифтом <br>
RichTextBox1.SelUnderline = True <br>
<br>
Просмотр текста в виде простого текста <br>
MsgBox RichTextBox1.Text <br>
<br>
Просмотр текста в виде RTF <br>
MsgBox RichTextBox1.TextRTF <br>
<br>
Загрузить файл <br>
RichTextBox1.LoadFile App.Path &amp; "\RTFText.rtf", rtfRTF <br>
<br>
или<br>
RichTextBox1.LoadFile App.Path &amp; "\RTFText.rtf", rtfText<br><br>
	 
	 	<b>7.25 Как найти и выделить текст в RichTextBox? - Visual Basic</b><br>
 ====================================================<br>
	 Во многих приложениях есть функция поиска и выделения ключевых слов в 
текстовом окошке. В Visual Basic элемент управления RichTextBox 
позволяет использовать эту возможность.
<br><br>
Создайте новый проект. Form1 создастся поумолчанию.
<br><br>

Поместите на Form1 кнопку и RichTextBox. Установите свойство Text у 
RichTextBox в "This is an example of finding text in a rich text box."
<br><br>

Добавьте следующий код в секцию General Declarations формы Form1:<br>
      Option Explicit<br>
<br>
      Private Sub Command1_Click()<br>
        HighlightWords RichTextBox1, "text", vbRed<br>
      End Sub<br>
<br>
      Private Function HighlightWords(rtb As RichTextBox, sFindString As String,       lColor As Long)    As Integer<br>
<br>
        Dim lFoundPos As Long           'Позиция первого найденного<br>
                                        'символа<br>
        Dim lFindLength As Long         'Длина искомой строки<br>
        Dim lOriginalSelStart As Long<br>
        Dim lOriginalSelLength As Long<br>
        Dim iMatchCount As Integer      'Количество найденных<br>
<br>
        'Сохраняем текущее местоположение и длину<br>
        lOriginalSelStart = rtb.SelStart<br>
        lOriginalSelLength = rtb.SelLength<br>
<br>
        'Сохраняем длину строки, которую будем искать<br>
        lFindLength = Len(sFindString)<br>
<br>
        'Пытаемся найти первое совпадение<br>
        lFoundPos = rtb.Find(sFindString, 0, , rtfNoHighlight)<br>
        While lFoundPos &gt;= 0   'While lFoundPos &gt;= 0  
&lt;-------------------- Должно быть. Иначе при поиске пропускается 
первый символ, так как отсчет идет с нуля.<br>
          iMatchCount = iMatchCount + 1<br>
<br>
          rtb.SelStart = lFoundPos<br>
          'Как только Вы измените SelStart, то свойство SelLength<br>
          'установится в 0<br>
          rtb.SelLength = lFindLength<br>
          rtb.SelColor = lColor<br>
<br>
          'Пытаемся найти следующее совпадение<br>
          lFoundPos = rtb.Find(sFindString, _<br>
            lFoundPos + lFindLength, , rtfNoHighlight)<br>
        Wend<br>
<br>
        'Восстанавливаем первоначальное местоположение<br>
        'и длину<br>
        rtb.SelStart = lOriginalSelStart<br>
        rtb.SelLength = lOriginalSelLength<br>
<br>
        'Возвращаем количество совпадений<br>
        HighlightWords = iMatchCount<br>
<br>
      End Function<br><br>


	     <b>7.26 Определение строки, на которой находится курсор. - Visual Basic</b><br>
    ====================================================<br>
	 На самом деле определение строки, на которой находится курсор, не вызывает никаких трудностей. <br>
У элемента RichTextBox существует метод GetLineFromChar, который и отвечает на вопрос этой страницы. <br>
Непонятно только, почему разработчики не предусмотрели определение позиции курсора на строке. <br>
Ответ на этот вопрос остается открытым. <br><br>
Private Sub Command1_Click() <br>
MsgBox RichTextBox1.GetLineFromChar(RichTextBox1.SelStart) + 1 <br>
End Sub <br><br>
<b>7.27 Определить количество строк в TextBox'е.  - Visual Basic</b><br>
====================================================<br>
	 Добавьте TextBox (установите значение MultiLine=True) и CommandButton. <br>
Private Declare Function SendMessageLong Lib "user32" Alias 
"SendMessageA" (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As 
Long, ByVal lParam As Long) As Long <br>
Const EM_GETLINECOUNT = &amp;HBA <br>
Private Sub Command1_Click() <br>
Dim lngLineCount As Long <br>
On Error Resume Next <br>
lngLineCount = SendMessageLong(Text1.hwnd, EM_GETLINECOUNT, 0&amp;, 0&amp;) <br>
MsgBox lngLineCount <br>
End Sub <br><br>


   <b>7.28 Проверка орфографии - Visual Basic</b><br>
    ====================================================<br>
    Хотелось ли вам добавить возможность проверки орфографии вашего TextBox'а? <br>
Такое возможно, если на вашем компьютере установлен MsWord. <br>
<br>
Private Sub Command1_Click() <br>
Text1 = SpellCheck(Text1) <br>
End Sub <br>
<br>
Public Function SpellCheck(ByVal IncorrectText$) As String <br>
Dim Word As Object, retText$ <br>
On Error Resume Next <br>
'Создать объект и загрузить Word <br>
Set Word = CreateObject("Word.Basic") <br>
'Показать Word и вставить в него ваш текст <br>
Word.AppShow <br>
Word.FileNew <br>
Word.Insert IncorrectText <br>
'Запустить проверку орфографии <br>
Word.ToolsSpelling <br>
Word.EditSelectAll <br>
'Выделить текст и загрузить его обратно в TextBox <br>
retText = Word.Selection$() <br>
SpellCheck = Left$(retText, Len(retText) - 1) <br>
'Закрыть файл в Word и вернуться в Visual Basic. <br>
Word.FileClose 2 <br>
Show <br>
'Освободить память от объекта word <br>
Set Word = Nothing <br>
End Function<br><br>

    <b>7.29 Является ли строковая переменная e-mail-адресом. - Visual Basic</b><br>
    ====================================================<br>
    Является ли строковая переменная e-mail-адресом. <br>
Этот код использует VBScript.dll - Вы можете загрузить его с www.microsoft.com/msdownload/vbscript/scripting.asp <br>
Добавьте Microsoft VBScript Regular Expressions reference в ваш проект 
(выберите Project-&gt;References, поставьте галочку на Microsoft 
VBScript Regular Expressions CheckBox и нажмите OK). <br>
RegExp - тип переменной, которую вы хотите проверить: Email-адрес, телефонный номер, любой другой формат. <br>
<br>
<br>
Private Sub Form_Load() <br>
Dim myReg As RegExp <br>
Dim email As String <br>
Set myReg = New RegExp <br>
myReg.IgnoreCase = True <br>
myReg.Pattern = "^[\w-\.]+@\w+\.\w+$" <br>
'replace "myName@domain.ru" любым адресом <br>
email = "myName@domain.ru" <br>
MsgBox "Результат проверки: " &amp; myReg.Test(email) <br>
Unload Me <br>
End Sub<br><br>


    <b>7.30 Перекодировка текста: Rus-Lat - Visual Basic</b><br>
    ====================================================<br>
    Данный пример переводит текст, набранный в одной раскладке клавиатуры в другую. Например из Ghbdtn получить Привет. <br>
<br>
Private Function Replace_letters(InputStr As String) As String<br>
enStr = ";@#$^&amp;QWERTYUIOP{}ASDFGHJKL:" &amp; Chr(34) &amp; 
"ZXCVBNM&lt;&gt;?qwertyuiop[]asdfghjkl;'zxcvbnm,./" &amp; Chr(34) &amp; 
"№;:?ЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЯЧСМИТЬБЮ,йцукенгшщзхъфывапролдэжячсмитьбю."<br>
rusStr = Chr(34) &amp; 
"№;:?ЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЯЧСМИТЬБЮ,йцукенгшщзхъфывапролджэячсмитьбю."
 &amp; ";@#$^&amp;QWERTYUIOP{}ASDFGHJKL:" &amp; Chr(34) &amp; 
"ZXCVBNM&lt;&gt;?qwertyuiop[]asdfghjkl;'zxcvbnm,./"<br>
Dim i As Integer, pos As Integer, temp As String<br>
For i = 1 To Len(InputStr)<br>
temp = Mid$(InputStr, i, 1)<br>
pos = InStr(1, enStr, temp, vbBinaryCompare)<br>
If pos &lt;&gt; 0 Then<br>
Replace_letters = Replace_letters &amp; Mid$(rusStr, pos, 1)<br>
Else<br>
Replace_letters = Replace_letters &amp; temp<br>
End If<br>
Next i<br>
End Function<br>
<br>
Private Sub Form_Load()<br>
MsgBox Replace_letters("Dctv ghbdtn")<br>
End Sub<br><br>

<b>7.31 Перекодировка текста из DOS в Windows формат - Visual Basic</b><br>
    ====================================================<br>
Если Вам нужно конвертировать текст формата DOS в Windows (1251), то в API есть на этот случай хорошая функция: OemToChar.
<br><br>
Объявляется она так:
<br><br>
Public Declare Function OemToChar Lib "user32" Alias "OemToCharA" (ByVal lpszSrc As String, ByVal lpszDst As String) As Long
<br><br>
Используют её следующим образом:<br>
Dim l_lReturn as Long<br>
Dim l_sSource as String 'исходный текст<br>
Dim l_sDestination as String 'возвращаемый текст<br>
l_lReturn = oemtochar(l_sSource, l_sDestination)<br>
<br>
Кроме этой полезной функции в API имеется и обратная её функция: 
CharToOem. Она служит для выполнения той же работы, только наоборот, 
т.е.Windows (1251) в DOS.
<br><br>
Declare Function CharToOem Lib "user32" Alias "CharToOemA" (ByVal lpszSrc As String, ByVal lpszDst As String) As Long <br>  
<br>

<b>7.32 Послать строковое сообщение в другую программу - Visual Basic</b><br>
 ====================================================<br> 
 Откройте заранее стандартное приложение "Блокнот". В VB-проекте 
расположите на форме 1 CommandButton. Добавьте следующий код, запустите 
проект и нажмите на кнопку...
<br><br>
Private Sub Command1_Click()<br>
AppActivate ("Безымянный")<br>
SendKeys ("Привет из VB!!!")<br>
End Sub<br>
<br>
"{Up}"<br>
"{TAB}"<br>
"{ENTER}"<br>
"{End}"<br>
"+{Home}"<br>
"{Left}"<br><br>
 
     <b>7.33 Захват текста из любого текстового поля - Visual Basic</b><br>
    ====================================================<br>
    Хотелось ли вам захватить текст из текстового поля любого приложения? Данный код поможет вам в решении этой проблемы.<br>
<br>
Вам необходимо разместить на форме элемент Timer. <br>
<br>
'to get the foreground window<br>
Private Declare Function GetForegroundWindow Lib "user32" () As Long<br>
'to send a message system<br>
Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" 
(ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, lParam As
 Any) As Long<br>
'to get the cursor position<br>
Private Declare Function GetCursorPos Lib "user32" (lpPoint As POINTAPI) As Long<br>
'to get the window from a point (y,x)<br>
Private Declare Function WindowFromPoint Lib "user32" (ByVal xPoint As Long, ByVal yPoint As Long) As Long<br>
'to get the window text<br>
Private Declare Function GetWindowText Lib "user32" Alias 
"GetWindowTextA" (ByVal hwnd As Long, ByVal lpString As String, ByVal 
cch As Long) As Long<br>
'to get the class name (edit,combobox etc..)<br>
Private Declare Function GetClassName Lib "user32" Alias "GetClassNameA"
 (ByVal hwnd As Long, ByVal lpClassName As String, ByVal nMaxCount As 
Long) As Long<br>
Public strBuffer As String ' the string to append to the file that has all the text "grabed"<br>
Public iEnum As Integer ' the file integer to open and write (I/O)<br>
Public hJanelaCima As Long ' the window wich the user has the mouse over<br>
Public hJanelaAntiga As Long ' the ancient window, to controlo if thereґs a new window or not<br>
'constants to grab the text<br>
Private Const WM_GETTEXT = &amp;HD<br>
Private Const WM_GETTEXTLENGTH = &amp;HE<br>
'type for the GetCursorPos API<br>
Private Type POINTAPI<br>
x As Long<br>
y As Long<br>
End Type<br>
<br>
Private Sub Form_Load()<br>
'when starting the program, print date and time of the new logging...<br>
strBuffer = "=============================================================" &amp; vbCrLf<br>
strBuffer = strBuffer &amp; "Date of log: " &amp; Format(Date, "YYYY-MM-DD") &amp; vbCrLf<br>
strBuffer = strBuffer &amp; "Started logging at: " &amp; Format(Time$, "HH:MM") &amp; vbCrLf<br>
strBuffer = strBuffer &amp; "=============================================================" &amp; vbCrLf<br>
iEnum = FreeFile<br>
'append it in the file<br>
Open "C:\testes.txt" For Append As #iEnum<br>
Print #iEnum, strBuffer<br>
Close #iEnum<br>
strBuffer = ""<br>
'enable the timer...<br>
Timer1.Interval = 100<br>
Timer1.Enabled = True<br>
End Sub<br>
<br>
Private Sub Timer1_Timer()<br>
Dim ptCursor As POINTAPI ' the cursor type variable<br>
Dim texto_janela As String ' the window text<br>
Dim rc As Long<br>
Dim nome_classe As String ' the class name<br>
Dim fenster As Long ' the foreground window.. in deutsh.. ich wisse deutshe auch...<br>
fenster = GetForegroundWindow ' get the window where user is<br>
'create string objects<br>
texto_janela = String(100, Chr(0))<br>
nome_classe = String(100, Chr(0))<br>
Call GetCursorPos(ptCursor) ' get the cursor position<br>
'get the window(handle) where the user has the mouse<br>
hJanelaCima = WindowFromPoint(ptCursor.x, ptCursor.y)<br>
'get the window text and class name<br>
rc = GetWindowText(fenster, texto_janela, Len(texto_janela))<br>
rc = GetClassName(hJanelaCima, nome_classe, 100)<br>
'format the assholes...<br>
texto_janela = Left(texto_janela, InStr(texto_janela, Chr(0)) - 1)<br>
nome_classe = Left(nome_classe, InStr(nome_classe, Chr(0)) - 1)<br>
Debug.Print nome_classe<br>
' check the class names... i tried some like WinWord and VB, but didnґt worked..<br>
<br>
'If nome_classe = "Edit" Or nome_classe = "_WwG" Or nome_classe = 
"Internet Explorer_Server" Or nome_classe = "RichEdit20A" Or nome_classe
 = "VbaWindow" Then<br>
'if this is the same window, forget<br>
If hJanelaCima = hJanelaAntiga Then Exit Sub<br>
'thereґs no text? Out!<br>
If WindowText(hJanelaCima) = Empty Then Exit Sub<br>
'put the ancient window handle, with the current one<br>
hJanelaAntiga = hJanelaCima<br>
'build string with time and the text grabed with WindowText<br>
strBuffer = Time$ &amp; " - " &amp; texto_janela &amp; vbCrLf<br>
strBuffer = strBuffer &amp; WindowText(hJanelaCima) &amp; vbCrLf<br>
'append to the file<br>
Open "C:\testes.txt" For Append As #iEnum<br>
Print #iEnum, strBuffer<br>
Close #iEnum<br>
<br>
'End If<br>
End Sub<br>
<br>
'grab the text window with this function.. argument- the window handle<br>
Public Function WindowText(window_hwnd As Long) As String<br>
Dim txtlen As Long<br>
Dim txt As String<br>
If window_hwnd = 0 Then Exit Function<br>
'send the message to get the text lenght<br>
txtlen = SendMessage(window_hwnd, WM_GETTEXTLENGTH, 0, 0)<br>
If txtlen = 0 Then Exit Function<br>
txtlen = txtlen + 1<br>
txt = Space$(txtlen)<br>
'send the message to get the text<br>
txtlen = SendMessage(window_hwnd, WM_GETTEXT, txtlen, ByVal txt)<br>
'put that on the function<br>
WindowText = Left$(txt, txtlen)<br>
End Function<br><br>

    <b>7.34 Форматирование числа при выводе (заполнение до определенной длины) - Visual Basic</b><br>
    ====================================================<br>
    Пример применения функции String<br>
<br>
Иногда бывает полезно выводить числовую информацию с фиксированным 
числом знаков, заполняя левые позиции нулями. Для этого можно 
воспользоваться следующей функцией:
<br><br>
Function PadToString(myValue, Digits) As String<br>
PadToString = String(Digits - Len(myValue), "0") &amp; myValue<br>
End Function<br>
<br>
Сделав, например, такое обращение<br>
<br>
NewStr = PadToString(1978, 8)<br>
<br>
вы получите строковую переменную 00001978. Обратите внимание, что Digits и myValue — переменные типа Variant.<br><br>
       
       
<b>7.35 Примеры работы с датами - Visual Basic</b><br>
====================================================<br>
Небольшое примечание: если в качестве входного параметра указано 
(Optional dteDate As Date), то вызов функции можно осуществлять как 
НазваниеФункции() - то есть можно оставлять пустые скобки. Например 
MsgBox FirstOfQuarter()
<br><br>
Список функций<br>
Определение первого/последнего дня текущего квартала<br>
Определение первого/последнего дня месяца<br>
Определение первого/последнего дня следующего месяца<br>
Определение первого/последнего дня предыдущего месяца<br>
Определение первого/последнего дня текущей недели<br>
Опредение номера дня в году (2 января = 2, 3 февраля = 34)<br>
Данная функция определяет рабочий день или нет<br>
Возвращение последнего рабочего дня в текущем месяце<br>
Функция определения полных лет со дня рождения<br>
Вычисление разницы в годах между двумя датами<br>
Определение високосности года<br>
<br>
Определение первого дня текущего квартала<br>
Function FirstOfQuarter(Optional dteDate As Date) As Date<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
FirstOfQuarter = DateSerial(Year(dteDate), Int((Month(dteDate) - 1) / 3) * 3 + 1, 1)<br>
End Function<br>
<br>
Определение последнего дня текущего квартала<br>
Function LastOfQuarter(Optional dteDate As Date) As Date<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
LastOfQuarter = DateSerial(Year(Date), Int((Month(Date) - 1) / 3) * 3 + 4, 0)<br>
End Function<br>
<br>
Определение первого дня месяца<br>
Function FirstOfMonth(Optional dteDate As Date) As Date<br>
'если параметр dteDate = 0 то для вычисления берется текущая дата<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
FirstOfMonth = DateSerial(Year(dteDate), Month(dteDate), 1)<br>
End Function<br>
<br>
Определение последнего дня месяца<br>
Function LastOfMonth(Optional dteDate As Date) As Date<br>
'если параметр dteDate = 0 то для вычисления берется текущая дата<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
'Ищется первый день следующего месяца, и вычитается один день<br>
LastOfMonth = DateSerial(Year(dteDate), Month(dteDate) + 1, 1) - 1<br>
End Function<br>
<br>
Определение первого дня следующего месяца<br>
Function FirstOfNextMonth(Optional dteDate As Date) As Date<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
FirstOfNextMonth = DateSerial(Year(dteDate), Month(dteDate) + 1, 1)<br>
End Function<br>
<br>
Определение последнего дня следующего месяца<br>
Function LastOfNextMonth(Optional dteDate As Date) As Date<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
LastOfNextMonth = DateSerial(Year(dteDate), Month(dteDate) + 2, 0)<br>
End Function<br>
<br>
Определение первого дня предыдущего месяца<br>
Function FirstOfPreviousMonth(Optional dteDate As Date) As Date<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
FirstOfPreviousMonth = DateSerial(Year(dteDate), Month(dteDate) - 1, 1)<br>
End Function<br>
<br>
Определение последнего дня предыдущего месяца<br>
Function LastOfPreviousMonth(Optional dteDate As Date) As Date<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
LastOfPreviousMonth = DateSerial(Year(dteDate), Month(dteDate), 0)<br>
End Function<br>
<br>
Определение первого дня текущей недели<br>
Function StartOfWeek(D As Variant, Optional FirstWeekday As Integer) As Variant '<br>
'Пример: MsgBox StartOfWeek(Date)<br>
If IsMissing(FirstWeekday) Then 'Sunday is the assumed first day of week.<br>
StartOfWeek = D - Weekday(D) + 1<br>
Else<br>
StartOfWeek = D - Weekday(D, FirstWeekday) + 1<br>
End If<br>
End Function<br>
<br>
Определение последнего дня текущей недели<br>
Function EndOfWeek(D As Variant, Optional FirstWeekday As Integer) As Variant<br>
'Пример: MsgBox EndOfWeek(Date)<br>
If IsMissing(FirstWeekday) Then 'Sunday is the assumed first day of week.<br>
EndOfWeek = D - Weekday(D) + 7<br>
Else<br>
EndOfWeek = D - Weekday(D, FirstWeekday) + 7<br>
End If<br>
End Function<br>
<br>
Опредение номера дня в году (2 января = 2, 3 февраля = 34)<br>
Function DayOfYear(Optional dteDate As Date) As Long<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
DayOfYear = Abs(DateDiff("d", dteDate, DateSerial(Year(dteDate) - 1, 12, 31)))<br>
End Function<br>
<br>
Данная функция определяет: рабочий день или нет<br>
Примечание: Дни с понедельника по пятницу считаются рабочими<br>
<br>
Function IsWorkday(Optional dteDate As Date) As Boolean<br>
If CLng(dteDate) = 0 Then<br>
dteDate = Date<br>
End If<br>
Select Case Weekday(dteDate)<br>
Case vbMonday To vbFriday<br>
IsWorkday = True<br>
Case Else<br>
IsWorkday = False<br>
End Select<br>
End Function<br>
<br>
Функция возвращает последний рабочий день в текущем месяце (Понедельник-Пятница)<br>
Function LastBusDay(D As Variant) As Variant<br>
'Пример: MsgBox LastBusDay(Date)<br>
Dim D2 As Variant<br>
If VarType(D) &lt;&gt; 7 Then<br>
LastBusDay = Null<br>
Else<br>
D2 = DateSerial(Year(D), Month(D) + 1, 0)<br>
Do While Weekday(D2) = 1 Or Weekday(D2) = 7<br>
D2 = D2 - 1<br>
Loop<br>
LastBusDay = D2<br>
End If<br>
End Function<br>
<br>
Функция определения полных лет со дня рождения<br>
Function CalcAge(dteBirthdate As Date) As Long<br>
'В качестве параметра dteBirthdate необходимо задать дату рождения<br>
'Пример: MsgBox CalcAge("09/03/75")<br>
Dim lngAge As Long<br>
If Not IsDate(dteBirthdate) Then<br>
dteBirthdate = Date<br>
End If<br>
'Проверить, чтобы в качестве входного параметра не была задана дата в будущем<br>
If dteBirthdate &gt; Date Then<br>
dteBirthdate = Date<br>
End If<br>
'Подсчет разницы в годях между текущей датой и датой рождения<br>
lngAge = DateDiff("yyyy", dteBirthdate, Date)<br>
'Вычитается один год, если в этом году дня рождения еще не было<br>
If DateSerial(Year(Date), Month(dteBirthdate), Day(dteBirthdate)) &gt; Date Then<br>
lngAge = lngAge - 1<br>
End If<br>
CalcAge = lngAge<br>
End Function<br>
<br>
Вычисление разницы в годах между двумя датами<br>
Естественно, что значение Bdate должно быть меньше параметра DateToday<br>
<br>
Function Age(Bdate, DateToday) As Integer<br>
If Month(DateToday) &lt; Month(Bdate) Or (Month(DateToday) = Month(Bdate) And Day(DateToday) &lt; Day(Bdate)) Then<br>
Age = Year(DateToday) - Year(Bdate) - 1<br>
Else<br>
Age = Year(DateToday) - Year(Bdate)<br>
End If<br>
End Function<br>
<br>
Определение високосности года<br>
Function LeapYear(YYYY As Integer) As Integer<br>
'Функция возвращает -1, если указанный входной параметр (год) является високосным<br>
'Пример: MsgBox LeapYear(1996)<br>
LeapYear = YYYY Mod 4 = 0 And (YYYY Mod 100 &lt;&gt; 0 Or YYYY Mod 400 = 0)<br>
End Function<br>
<br>
Function LeapYear2(YYYY As Integer) As Integer<br>
'Функция возвращает -1, если указанный входной параметр (год) является високосным<br>
'Пример: MsgBox LeapYear(1996)<br>
LeapYear2 = Month(DateSerial(YYYY, 2, 29)) = 2<br>
End Function<br>
<br>
Function IsLeapYear(DateIn As Date) As Boolean<br>
'Функция возвращает True, если год в указанной дате является високосным<br>
'Проверка: MsgBox IsLeapYear("01/01/00")<br>
If IsDate("29/02/" &amp; Format(DateIn, "yyyy")) = True Then<br>
IsLeapYear = True<br>
End If<br>
End Function    <br><br>
    
    <b>7.36 Определить кодировку текста (Dos или Win) - Visual Basic</b><br>
    ====================================================<br>
    Предположим, вы загружаете тестовой документ в TextBox. При 
изменении содержимого тестового блока вы можете узнать тип кодировки 
текста (Dos или Win) 
<br><br>
Private Sub Text1_Change()<br>
'пpовеpяем тип кодиpовки ANSI или ASCII<br>
'беpем пеpвые 1000 байт еcли это возможно. Hевозможно - меньше.<br>
l&amp; = Len(Text1.Text)<br>
If l&amp; &gt; 1000 Then l&amp; = 1000<br>
'копиpyем yчаcток текcта в пеpеменнyю, иначе тоpмоз обеcпечен<br>
s$ = Left$(Text1.Text, l&amp;)<br>
'обнyляем флажки<br>
fdo% = 0<br>
fwo% = 0<br>
'пpоcматpиваем кycок текcта<br>
For n% = 1 To l&amp;<br>
'вытаcкиваем очеpедной cимвол<br>
c$ = Mid$(s$, n%, 1)<br>
'еcли это pyccкая "о" в DOS кодиpовке то инкpементиpyем cчетчик<br>
If c$ = Chr$(174) Then fdo% = fdo% + 1<br>
'еcли это pyccкая "о" в Win кодиpовке то инкpементиpyем cчетчик<br>
If c$ = Chr$(238) Then fwo% = fwo% + 1<br>
Next<br>
'ycтанавливаем в конфиге тип пpоcмотpа по дефолтy<br>
If fdo% &gt; fwo% Then 'это явно ДОC-текcт<br>
MsgBox "DOS"<br>
Else 'это явно Win-текcт<br>
MsgBox "WIN"<br>
End If<br>
End Sub <br>

        <br>
    
    <b>7.37 Вертикальное/горизонтальное написание в элементе Label - Visual Basic</b><br>
    ====================================================<br>
Расположите на форме элемент CommandButton а также элемент Label<br>
<br>
Private Function Vertical_Horizontal(ByVal nStr As String) As String<br>
Dim MyStr As String, i As Integer<br>
Static Vert As Boolean<br>
If Vert = False Then<br>
For i = 1 To Len(nStr)<br>
If i Then<br>
MyStr = MyStr + Mid$(nStr, i, 1) &amp; vbCrLf<br>
Else<br>
MyStr = MyStr + Mid$(nStr, i, 1)<br>
End If<br>
Next<br>
Vertical_Horizontal = MyStr<br>
Vert = True<br>
Else<br>
For i = 1 To Len(nStr) Step 3<br>
MyStr = MyStr + Mid$(nStr, i, 1)<br>
Next<br>
Vertical_Horizontal = MyStr<br>
Vert = False<br>
End If<br>
End Function<br>
<br>
Private Sub Command1_Click()<br>
Label1.AutoSize = True<br>
Label1.Caption = Vertical_Horizontal(Label1.Caption)<br>
End Sub<br>
<br>
'© 2001 by Alexander Anikin<br>
'/www.i.com.ua/~aka<br>

    <br>
    
    <b>7.38 Получение длинного и короткого имени файла/директории - Visual Basic</b><br>
    ====================================================<br>
    например: ("c:\Program Files" ==&gt;"c:\progra~1")<br><br>
<br>
<b>Способ 1 </b><br>
'Как мне получить короткое имя файла или как мне получить длинное имя <br>
'файла, зная короткое.<br>
<br>
Private Const MAX_PATH&amp; = 260<br>
Private Const INVALID_HANDLE_VALUE = -1<br>
<br>
Private Type FILETIME<br>
    dwLowDateTime As Long<br>
    dwHighDateTime As Long<br>
End Type<br>
<br>
Private Type WIN32_FIND_DATA<br>
    dwFileAttributes As Long<br>
    ftCreationTime As FILETIME<br>
    ftLastAccessTime As FILETIME<br>
    ftLastWriteTime As FILETIME<br>
    nFileSizeHigh As Long<br>
    nFileSizeLow As Long<br>
    dwReservedЇ As Long<br>
    dwReserved1 As Long<br>
    cFileName As String * MAX_PATH<br>
    cAlternate As String * 14<br>
End Type<br>
<br>
Private Declare Function apiFindFirstFile Lib "kernel32" Alias 
"FindFirstFileA" (ByVal lpFileName As String, lpFindFileData As 
WIN32_FIND_DATA) As Long
<br>Private Declare Function apiFindClose Lib "kernel32" Alias "FindClose" (ByVal hFindFile As Long) As Long
<br>Private Declare Function apiGetShortPathName Lib "kernel32" Alias 
"GetShortPathNameA" (ByVal lpszLongPath As String, ByVal lpszShortPath 
As String, ByVal cchBuffer As Long) As Long
<br>
Function fGetShortName(ByVal stLongPath As String) As String<br>
    Dim stShortPath As String<br>
    Dim lngBuffer As Long, lngRet As Long<br>
    <br>
    stShortPath = String$(MAX_PATH, 0)<br>
    lngBuffer = Len(stShortPath)<br>
    lngRet = apiGetShortPathName(stLongPath, stShortPath, lngBuffer)<br>
    fGetShortName = Left(stShortPath, lngRet)<br>
End Function<br>
<br>
Function fGetLongName(ByVal strFilename As String) As String<br>
    Dim lpFindFileData As WIN32_FIND_DATA<br>
    Dim strPath As String, lngRet As Long<br>
    Dim strFile As String, lngx As Long, lngY As Long<br>
    Dim strTmp As String<br>
    <br>
    strTmp = ""<br>
    Do While Not lngRet = INVALID_HANDLE_VALUE<br>
        lngRet = apiFindFirstFile(strFilename, lpFindFileData)<br>
        strFile = Left$(lpFindFileData.cFileName, InStr(lpFindFileData.cFileName, vbNullChar) - 1)<br>
        If Len(strFilename) &gt; 2 Then<br>
            strTmp = strFile &amp; "\" &amp; strTmp<br>
            strFilename = fParseDir(strFilename)<br>
        Else<br>
            strTmp = strFilename &amp; "\" &amp; strTmp<br>
        Exit Do<br>
        End If<br>
    Loop<br>
    fGetLongName = Left$(strTmp, Len(strTmp) - 1)<br>
    lngY = apiFindClose(lngRet)<br>
End Function<br>
<br>
Private Function fParseDir(strInFile As String) As String<br>
    Dim intLen As Long, boolFound As Boolean<br>
    Dim i As Integer, F As String, strDir As String<br>
    <br>
    intLen = Len(strInFile)<br>
    If intLen &gt; 0 Then<br>
        boolFound = False<br>
        For i = intLen To 1 Step -1<br>
            If Mid$(strInFile, i, 1) = "\" Then<br>
                F = Mid$(strInFile, i + 1)<br>
                strDir = Left$(strInFile, i - 1)<br>
                boolFound = True<br>
                Exit For<br>
            End If<br>
        Next i<br>
    End If<br>
    If boolFound Then<br>
        fParseDir = strDir<br>
    Else<br>
        fParseDir = strInFile<br>
    End If<br>
End Function<br>
<br>
Private Sub Command1_Click()<br>
    Dim fShort<br>
    <br>
    fShort = fGetShortName("C:\Program Files")<br>
    MsgBox fShort<br>
    fShort = fGetLongName(fShort)<br>
    MsgBox fShort<br>
End Sub<br>
<br>
<b>Способ 2 </b><br>
Функция GetShortName в качестве входного параметра принимает длинное имя файла и возвращает DOS-имя файла <br>
<br>
Private Declare Function GetShortPathName Lib "kernel32.dll" Alias 
"GetShortPathNameA" (ByVal lpszLongPath As String, ByVal lpszShortPath 
As String, ByVal cchBuffer As Long) As Long
<br>Private Function GetShortName(lName As String) As String<br>
Dim DosName As String<br>
Dim LenOfDosName As Long<br>
DosName = Space(256)<br>
LenOfDosName = GetShortPathName(lName, DosName, 256)<br>
GetShortName = Left$(DosName, LenOfDosName)<br>
End Function<br>
<br>
Private Sub Form_Load()<br>
Dim LongName As String<br>
LongName = "C:\Program Files\Internet Explorer\Iexplore.exe"<br>
MsgBox GetShortName(LongName)<br>
End Sub<br><br>

<b>7.39  Как вывести кавычки в MsgBox? - Visual Basic</b><br>
====================================================<br>
нужно использовать функцию Chr и иметь при сибе таблицу ASCLL кодов<br>
ASCLL код кавычки имеет номер в десятичной системе 34.<br>
<br>
MsgBox Chr(34) &amp; "ИНФОРМАЦИЯ" &amp; Chr(34)<br><br>

<b>7.40  Как узнать ASCLL код символа? - Visual Basic</b><br>
====================================================<br>
Dim x As Byte<br>
x = Asc("A")'x - будет равен 65<br>
MsgBox x<br><br>

<b>7.41 Как узнать количество символов в строке? - Visual Basic</b><br>
====================================================<br>
Dim x As Integer<br>
x = Len("ПРИВЕТ") 'x - будет равен 6-ти<br>
MsgBox x<br><br>

<b>7.42 Как преобразовать буквы в нижний или верхний регистр? - Visual Basic</b><br>
====================================================<br>
в нижний регистр:<br>
Dim x As String<br>
x = LCase("ПРИВЕТ") 'x - будет равен: привет<br>
MsgBox x<br>
<br>
в верхний регистр:<br>
Dim x As String<br>
x = UCase("привет")'x - будет равен: ПРИВЕТ<br>
MsgBox x<br><br>

<b>7.43 MsgBox - выше всех - Visual Basic</b><br>
====================================================<br>
'ответ:<br>
MsgBox "Ааааа я впереди всех!!!", vbSystemModal<br><br>


<b>7.44 Как в MsgBox вывести или записать в переменную данные столбиком? - Visual Basic</b><br>
====================================================<br>
Можно это осуществить несколькоми способами:<br>
<br>
<u>пример 1 (с помощью VbNewLine)</u>:<br>

dim stroka as string<br>
stroka="Привет " &amp; VbNewLine &amp; "Как дела?"<br>
MsgBox stroka<br>
<br>
или записать сразу в MsgBox <br>
MsgBox "Привет " &amp; VbNewLine &amp; "Как дела?"<br><br>

<u>пример 2 (с помощью vbCrLf)</u>:<br>
dim stroka as string<br>
stroka="Привет " &amp; vbCrLf &amp; "Как дела?"<br>
MsgBox stroka<br><br>

<u>пример 3 (с помощью Chr(10)</u>:<br>
Dim stroka As String<br>
stroka = "Привет " &amp; Chr(10) &amp; "Как дела?"<br>
MsgBox stroka<br><br>

<u>пример 4 (с помощью Chr(13)</u>:<br>
Dim stroka As String<br>
stroka = "Привет " &amp; Chr(13) &amp; "Как дела?"<br>
MsgBox stroka<br><br>

<b>7.45 Операции "копировать", "вырезать", "вставить"  - Visual Basic</b><br>
====================================================<br><br>
Для работы с Clipboard используется объект - Clipboard и свойство Form. <br>
Вставьте в проект меню с тремя пунктами mnuEditCopy, mnuEditCut и mnuEditPaste. <br>
Данные примеры применимы для TextBox'а. Для RichTextBox'а вместо SelText используйте SelRtf.<br> 
<br>
'"копировать" <br>
Private Sub mnuEditCopy_Click() <br>
On Error Resume Next <br>
Clipboard.Clear <br>
Clipboard.SetText frmMain.Text1.SelText <br>
End Sub<br>
<br>
'"вырезать" <br>
Private Sub mnuEditCut_Click() <br>
On Error Resume Next <br>
Clipboard.Clear <br>
Clipboard.SetText frmMain.Text1.SelText <br>
frmMain.Text1.SelText = vbNullString <br>
End Sub<br>
<br>
'"вставить" <br>
Private Sub mnuEditPaste_Click() <br>
On Error Resume Next <br>
frmMain.Text1.SelText = Clipboard.GetText <br>
End Sub<br><br>

<b>7.46 3D-текст на форме  - Visual Basic</b><br>
====================================================<br><br>

'Установите свойство формы AutoRedraw как True<br>
Private Sub Form_Load() <br>
Dim ShadowX <br>
Dim ShadowY <br>
ScaleMode = 3 <br>
ForeColor = "&amp;H808080" <br>
ShadowY = 5 <br>
ShadowX = 5 <br>
For I = 0 To 5 <br>
CurrentX = ShadowX + I <br>
CurrentY = ShadowY + I <br>
If I = 5 Then Form1.ForeColor = vbWhite <br>
Form1.Print "3D Text!!!" <br>
Next <br>
End Sub<br><br>

<b>7.47 Как вывести символ &amp; в Label - Visual Basic</b><br>
====================================================<br><br>

Если Вы хотите выывести символ «&amp;» на экран, установите свойство 
"UseMnemonic" в False. Это свойство бывает полезно, когда, например, 
Labelы используются для вывода данных из баз данных. Также Вы можете 
вывести символ "&amp;" в свойстве Caption, написав &amp;&amp;.
или<br>
Label1.Caption = "Маша " + Chr(38) + Chr(38) + " Саша"<br><br>

<b>7.48 Постоянно возникающий вопрос у тех, кто пишет блокнот. Функция Command - Visual Basic</b><br>
====================================================<br><br>
Вопрос,<br>
допустим я сделал блокнот, и мне нужно чтобы когда я открывал например TXT файл с помощью 2ой кнопки мыши, Открыть с помощью...<br>
и после того как я указал в окне выбора программ, свою программу чтобы 
когда я нажал на кнопку ОК, не просто тупо октрылася моя программа,<br>
а чтобы в текстовом поле этой программы появился путь к этому файл.<br>
<br>
Ответ<br>
Используй функцию Command<br>
<br>
Пример<br>
Кинь на форму 1 TextBox и в загрузку формы, помести код:<br>
<br>
Text1.text = Command<br>
<br>
теперь скомпилируй программу<br>
и открой какойнибудь файл указав на свою программу<br>
при загрузке программы в переменную Command записывается путь того файла который ты открыл через свою прогу<br><br>
<br>

<b>7.49   Ввод в TextBox только цифр - Visual Basic</b><br>
====================================================<br>
Private Sub Text1_KeyPress(KeyAscii As Integer) <br>
 If KeyAscii &lt; Asc(0) Or KeyAscii &gt; Asc(9) Then<br>
 KeyAscii = 0<br>
 Beep     ' звуковой сигнал при ошибке<br>
 End If <br>
End Sub <br>
<br><br>
<b>7.50  Как сделать вывод только  заглавных букв в TextBox - Visual Basic</b><br>
====================================================<br>

Private Sub Text1_KeyPress(KeyAscii As Integer)<br>
Dim char<br>
char = Chr(KeyAscii)<br>
KeyAscii = Asc(UCase(char))<br>
End Sub<br>
      <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх </a> </ol>
          
              
       
              
    <h2><a name="8"><b>08. Интернет</b></a></h2>
    <ol font="" style="font-size:10pt">

         
         <b>8.1 Узнать есть ли активное соединение с Интернетом - Visual Basic</b><br>
         <b>8.2 Программно отсоединиться от Интернета - Visual Basic</b><br>
         <b>8.3 Запуск почты и Интернета из VB - Visual Basic</b><br>
         <b>8.4 Как сохранить содержимое web-страницы на диск? - Visual Basic</b><br>
         <b>8.5 Получение сведений из URL. - Visual Basic</b><br>
         <b>8.6 Является ли строковая переменная e-mail-адресом. - Visual Basic</b><br> 
         <b>8.7 Загружаем файл из интернета - Visual Basic</b><br>   
         <b>8.8 Загружаем любой файл из интернета без использования WinSock - Visual Basic</b><br> 
  	 <b>8.9 Советы по использованию компонента WebBrowser - Visual Basic</b><br>  
         <b>8.10 Как вытащить все ссылки из htm-страницы - Visual Basic</b><br>  
         <b>8.11 Создать ссылку на страницу в Интернете - Visual Basic</b><br>
         <b>8.12 Определить дату изменения web-страницы - Visual Basic</b><br>
         
         <b>8.13 Является ли строковая переменная e-mail-адресом - Visual Basic</b><br>
         <b>8.14 Имя текущего соединения с инетом - Visual Basic</b><br>
         <b>8.15 Получение списка всех интернет-соединений - Visual Basic</b><br>
          <b>8.16 Запрещение запуска дополнительных окон IE - Visual Basic</b><br>
          <b>8.17 Прокси сервер на VB - Visual Basic</b><br>
          <b>8.18 Как установить/сменить IP адресс в локальной сети - Visual Basic</b><br>
          <b>8.19 Как отправлять сообщения и файлы через Mail - Visual Basic</b><br>
         <br> <b>8.1 Узнать есть ли активное соединение с Интернетом - Visual Basic</b><br>
         
   'Добавьте модуль <br>

  Private Declare Function RasEnumConnections Lib "RasApi32.dll" Alias 
"RasEnumConnectionsA" (lpRasCon As Any, lpcb As Long, lpcConnections As 
Long) As Long<br>
  Private Declare Function RasGetConnectStatus Lib "RasApi32.dll" Alias 
"RasGetConnectStatusA" (ByVal hRasCon As Long, lpStatus As Any) As Long<br>
     Private Const RAS95_MaxEntryName = 256<br>
     Private Const RAS95_MaxDeviceType = 16<br>
     Private Const RAS95_MaxDeviceName = 32<br>
     Private Type RASCONN95<br>
     dwSize As Long<br>
     hRasCon As Long<br>
     szEntryName(RAS95_MaxEntryName) As Byte<br>
     szDeviceType(RAS95_MaxDeviceType) As Byte<br>
     szDeviceName(RAS95_MaxDeviceName) As Byte<br>
     End Type<br>
     Private Type RASCONNSTATUS95<br>
     dwSize As Long<br>
     RasConnState As Long<br>
     dwError As Long<br>
     szDeviceType(RAS95_MaxDeviceType) As Byte<br>
     szDeviceName(RAS95_MaxDeviceName) As Byte<br>
     End Type<br>
     Public Function IsConnected() As Boolean<br>
     Dim TRasCon(255) As RASCONN95<br>
     Dim lg As Long<br>
     Dim lpcon As Long<br>
     Dim RetVal As Long<br>
     Dim Tstatus As RASCONNSTATUS95<br>
     TRasCon(0).dwSize = 412<br>
     lg = 256 * TRasCon(0).dwSize<br>
     RetVal = RasEnumConnections(TRasCon(0), lg, lpcon)<br>
     Tstatus.dwSize = 160<br>
     RetVal = RasGetConnectStatus(TRasCon(0).hRasCon, Tstatus)<br>
     If Tstatus.RasConnState = &amp;H2000 Then<br>
     IsConnected = True<br>
     Else<br>
     IsConnected = False<br>
     End If<br>
     End Function<br><br>

      Private Sub Command1_Click()<br>
        'если есть соединение, то IsConnected() = True, иначе False<br>
        Select Case IsConnected()<br>
        Case False<br>
        MsgBox "Интернет не подключен"<br>
        Case True<br>
        MsgBox "Интернет включен"<br>
        End Select<br>
        End Sub<br><br>
        
<b>8.2 Программно отсоединиться от Интернета - Visual Basic</b><br>
            
     'Добавьте в модуль<br>
     Const RAS_MAXENTRYNAME As Integer = 256<br>
     Const RAS_MAXDEVICETYPE As Integer = 16<br>
     Const RAS_MAXDEVICENAME As Integer = 128<br>
     Const RAS_RASCONNSIZE As Integer = 412<br>
     Const ERROR_SUCCESS = 0&amp;<br>
     Private Type RasEntryName<br>
     dwSize As Long<br>
     szEntryName(RAS_MAXENTRYNAME) As Byte<br>
     End Type<br>
     Private Type RasConn<br>
     dwSize As Long<br>
     hRasConn As Long<br>
     szEntryName(RAS_MAXENTRYNAME) As Byte<br>
     szDeviceType(RAS_MAXDEVICETYPE) As Byte<br>
     szDeviceName(RAS_MAXDEVICENAME) As Byte<br>
     End Type<br>
     Private Declare Function RasEnumConnections Lib "RasApi32.dll" 
Alias "RasEnumConnectionsA" (lpRasConn As Any, lpcb As Long, 
lpcConnections As Long) As Long<br>
     Private Declare Function RasHangUp Lib "RasApi32.dll" Alias "RasHangUpA" (ByVal hRasConn As Long) As Long<br>
     Private gstrISPName As String<br>
     Public ReturnCode As Long<br>
     Public Sub HangUp()<br>
     Dim i As Long<br>
     Dim lpRasConn(255) As RasConn<br>
     Dim lpcb As Long<br>
     Dim lpcConnections As Long<br>
     Dim hRasConn As Long<br>
     lpRasConn(0).dwSize = RAS_RASCONNSIZE<br>
     lpcb = RAS_MAXENTRYNAME * lpRasConn(0).dwSize<br>
     lpcConnections = 0<br>
     ReturnCode = RasEnumConnections(lpRasConn(0), lpcb, lpcConnections)<br>
     If ReturnCode = ERROR_SUCCESS Then<br>
     For i = 0 To lpcConnections - 1<br>
     If Trim(ByteToString(lpRasConn(i).szEntryName)) = Trim(gstrISPName) Then<br>
     hRasConn = lpRasConn(i).hRasConn<br>
     ReturnCode = RasHangUp(ByVal hRasConn)<br>
     End If<br>
     Next i<br>
     End If<br>
     End Sub<br>
     Public Function ByteToString(bytString() As Byte) As String<br>
     Dim i As Integer<br>
     ByteToString = ""<br>
     i = 0<br>
     While bytString(i) = 0&amp;<br>
     ByteToString = ByteToString &amp; Chr(bytString(i))<br>
     i = i + 1<br>
     Wend<br>
     End Function<br>
     'добавьте кнопку<br>
     Private Sub Command1_Click()<br>
     Call HangUp<br>
     End Sub<br><br>
         
     <b>8.3 Запуск почты и Интернета из VB - Visual Basic </b><br>    
         
     ' Добавьте на форму 2 элемента Label, скопируйте и вставьте на форму следующий код:<br>
 
     Private Declare Function ShellExecute&amp; Lib "shell32.dll" Alias 
"ShellExecuteA" (ByVal hwnd As Long, ByVal lpOperation As String, ByVal 
lpFile As String, ByVal lpParameters As String, ByVal lpDirectory As 
String, ByVal nShowCmd As Long) <br> 
     Private Sub Form_Load() <br> 
     Label1.Caption = "http://VBrus.narod.ru" <br> 
     Label2.Caption = "VBrus@yandex.ru"<br>  
     End Sub <br> <br> 
     Private Sub Label1_Click() <br> 
     Call ShellExecute(0, "Open", Label1.Caption, "", "c:\", 1) <br> <br> 

     End Sub <br><br>  
     Private Sub Label2_Click()<br>  
     Call ShellExecute(0, "Open", "mailto:" + Label2.Caption + "?Subject=" + "Письмо с сайта", "", "", 1) <br> 
     End Sub<br> <br> 
<b>8.4 Как сохранить содержимое web-страницы на диск?</b><br>
        Расположите на форме элемент Inet (меню Project|Components - Microsoft Internet Transfer Control 6.0). <br><br>

 Private Sub Form_Load() <br>
        Dim b() As Byte <br>
        'установить протокол HTTP <br>
        Inet1.Protocol = icHTTP <br>
        'установить скачиваемый адрес <br>
        Inet1.URL = "http://VBrus.narod.ru" <br>
        'загрузить данные HTML-страницы в массив <br>
        b() = Inet1.OpenURL(Inet1.URL, icByteArray)<br> 
        'создать файл на диске и записать в него информацию <br>
        Open "c:\test.htm" For Binary Access Write As #1 <br>
        Put #1, , b() <br>
        Close #1 <br>
        End Sub <br>

        Вариант 2.<br>

        Расположите на форме элемент CommandButton.<br>
  	Private Declare Function URLDownloadToFile Lib "urlmon" Alias 
"URLDownloadToFileA" (ByVal pCaller As Long, ByVal szURL As String, 
ByVal szFileName As String, ByVal dwReserved As Long, ByVal lpfnCB As 
Long) As Long <br>
        Public Function DownloadFile(URL As String, LocalFilename As String) As Boolean <br>
        Dim lngRetVal As Long <br>
        lngRetVal = URLDownloadToFile(0, URL, LocalFilename, 0, 0) <br>
        If lngRetVal = 0 Then DownloadFile = True <br>
        End Function <br>
        Private Sub Command1_Click() <br>
        DownloadFile "http://VBrus.narod.ru", "c:\VBrus.narod_ru.htm" 
        End Sub<br>
        
   <br><b>8.5 Получение сведений из URL. - Visual Basic</b><br>
         Данная функция возвращает различные компоненты web-страницы. <br>

     Включая "host", "port", "user", "pass", "path" и "query"<br><br>


     Private Type typURL 'http://sit:sitter@proxy.spiderit.net:881/prox/proxycfg.php3?openpage <br>
     Protocol As String 'какой протокол (http://, ftp:// или другой) <br>
     ServerName As String 'имя сервера (proxy.spiderit.net) <br>
     Filename As String 'имя страницы (proxycfg.php3) <br>
     Dir As String 'директория (/prox/) <br>
     Filepath As String 'путь файла (/prox/proxycfg.php3) <br>
     Username As String 'имя пользователя (sit) <br>
     Password As String 'пароль (sitter) <br>
     Query As String 'строка запроса (openpage) <br>
     ServerPort As Integer 'порт сервера (881) <br>
     End Type <br>
     Const strNOCONTENT As String = "NOCONTENT"<br> 
     Const intDEFAULTPORT As Integer = 80 <br>
     Private Function ParseURL(URL As String) As typURL <br>
     Dim strTemp As String <br>
     Dim strServerAuth As String <br>
Dim strServerNPort As String <br>
Dim strAuth As String <br>
strTemp = URL <br>
If (InStr(1, strTemp, "://") &gt; 0) Then <br>
ParseURL.Protocol = Left(strTemp, InStr(1, strTemp, "://") - 1) <br>
strTemp = Right(strTemp, Len(strTemp) - (Len(ParseURL.Protocol) + 3)) 'delete protocol + :// <br>
Else <br>
ParseURL.Protocol = strNOCONTENT <br>
End If <br>
If (InStr(1, strTemp, "/") &gt; 0) Then <br>
strServerAuth = Left(strTemp, InStr(1, strTemp, "/") - 1) <br>
strTemp = Right(strTemp, Len(strTemp) - (Len(strServerAuth) + 1)) <br>
Else <br>
strServerAuth = strTemp <br>
strTemp = "/" <br>
End If<br>


If (InStr(1, strServerAuth, "@") &gt; 0) Then <br>
strAuth = Left(strServerAuth, InStr(1, strServerAuth, "@") - 1) <br>
strServerNPort = Right(strServerAuth, Len(strServerAuth) - (Len(strAuth) + 1)) <br>
Else <br>
strAuth = "" <br>
strServerNPort = strServerAuth<br> 
End If<br>
If (InStr(1, strAuth, ":") &gt; 0) And (Len(strAuth) &gt; 0) Then <br>
ParseURL.Username = Left(strAuth, InStr(1, strAuth, ":") - 1) <br>
ParseURL.Password = Right(strAuth, Len(strAuth) - InStr(1, strAuth, ":")) <br>
ElseIf (InStr(1, strAuth, ":") &lt;&gt; 0) Then <br>
ParseURL.Username = strAuth <br>
ParseURL.Password = strNOCONTENT <br>
Else <br>
ParseURL.Username = strNOCONTENT <br>
ParseURL.Password = strNOCONTENT <br>
End If<br>
If (InStr(1, strServerNPort, ":") &gt; 0) Then <br>
ParseURL.ServerPort = Int(Right(strServerNPort, Len(strServerNPort) - InStr(1, strServerNPort, ":"))) <br>
ParseURL.ServerName = Left(strServerNPort, InStr(1, strServerNPort, ":") - 1) <br>
Else <br>
ParseURL.ServerPort = intDEFAULTPORT <br>
ParseURL.ServerName = strServerNPort <br>
End If<br>
If (InStr(1, strTemp, "?") &gt; 0) Then <br>
ParseURL.Query = Right(strTemp, Len(strTemp) - InStr(1, strTemp, "?")) <br>
strTemp = Left(strTemp, InStr(1, strTemp, "?") - 1) <br>
Else <br>
ParseURL.Query = strNOCONTENT <br>
End If<br>
For i = Len(strTemp) To 1 Step -1 <br>
If (Mid(strTemp, i, 1) = "/") Then <br>
ParseURL.Filename = Right(strTemp, Len(strTemp) - i) <br>
ParseURL.Dir = Left(strTemp, i) <br>
If Not (Left(ParseURL.Dir, 1) = "/") Then <br>
ParseURL.Dir = "/" &amp; ParseURL.Dir <br>
End If <br>
Exit For <br>
End If <br>
Next<br>
ParseURL.Filepath = "/" &amp; strTemp <br>
If Not (Left(ParseURL.Filepath, 1) = "/") Then <br>
ParseURL.Filepath = "/" &amp; ParseURL.Filepath <br>
End If<br>
End Function <br><br>

 
Private Sub Form_Load() <br>
Const strURL As String = "http://sit:sitter@proxy.spiderit.net:881/prox/proxycfg.php3?openpage"<br>
msgtext = ParseURL(strURL).Protocol &amp; vbCrLf <br>
msgtext = msgtext &amp; ParseURL(strURL).Username &amp; vbCrLf<br> 
msgtext = msgtext &amp; ParseURL(strURL).Password &amp; vbCrLf <br>
msgtext = msgtext &amp; ParseURL(strURL).ServerName &amp; vbCrLf <br>
msgtext = msgtext &amp; ParseURL(strURL).ServerPort &amp; vbCrLf <br>
msgtext = msgtext &amp; ParseURL(strURL).Filepath &amp; vbCrLf <br>
msgtext = msgtext &amp; ParseURL(strURL).Dir &amp; vbCrLf <br>
msgtext = msgtext &amp; ParseURL(strURL).Filename &amp; vbCrLf <br>
msgtext = msgtext &amp; ParseURL(strURL).Query &amp; vbCrLf <br>
MsgBox msgtext, vbInformation <br>
End Sub<br><br>
<b>8.6 Является ли строковая переменная e-mail-адресом.</b><br>
         Этот код использует VBScript.dll - Вы можете загрузить его с www.microsoft.com/msdownload/vbscript/scripting.asp <br>

Добавьте Microsoft VBScript Regular Expressions reference в ваш проект 
(выберите Project-&gt;References, поставьте галочку на Microsoft 
VBScript Regular Expressions CheckBox и нажмите OK). <br>
RegExp - тип переменной, которую вы хотите проверить: Email-адрес, телефонный номер, любой другой формат. <br><br>


Private Sub Form_Load() <br>
Dim myReg As RegExp <br>
Dim email As String <br>
Set myReg = New RegExp <br>
myReg.IgnoreCase = True <br>
myReg.Pattern = "^[\w-\.]+@\w+\.\w+$" <br>
'replace "myName@domain.ru" любым адресом <br>
email = "myName@domain.ru" <br>
MsgBox "Результат проверки: " &amp; myReg.Test(email) <br>
Unload Me <br>
End Sub<br><br>
<b>8.7 Загружаем файл из интернета - Visual Basic</b><br>  
         Маленькая функция, показывающая, как Ваше приложение может 
скачивать из интернета файлы. На вход функции достаточно подать URL и 
имя скачиваемого файла.<br>  <br>  

Public Sub DLFiles(strUrl As String, fileName As String) <br>  
    On Error Resume Next<br>  
    Dim b() As <br>  
Byte<br>  
    Inet1.Cancel <br>  
    Inet1.Protocol = icHTTP <br>  
    Inet1.URL = strUrl <br>  
    b() = Inet1.OpenURL(, icByteArray) <br>  

    Open fileName For Binary Access Write As #1 <br>  
    Put #1, , b() <br>  
    Close #1 <br>  
End Sub <br> <br>  

<b>8.8 Загружаем любой файл из интернета без использования WinSock - Visual Basic</b><br> 
ps: работает 100%, проверял:) как на Windows Vista так и на XP<br>
 'МОДУЛЬ<br>
 Public Declare Function URLDownloadToFile Lib "urlmon" Alias 
"URLDownloadToFileA" (ByVal pCaller As Long, ByVal szURL As String, 
ByVal szFileName As String, ByVal dwReserved As Long, ByVal lpfnCB As 
Long) As Long
<br>
<br>
'ФОРМА<br>
Call URLDownloadToFile(0, "http://vbrus.narod.ru/Info.htm", "c:\Info.htm", 0, 0)<br>

<br> <b>8.9 Советы по использованию компонента WebBrowser - Visual Basic</b><br>

Прежде всего, вы можете создать проект с использованием компонента 
WebBrowser, используя для этой цели VB Application Wizard. Для этого 
войдите в меню File | New Project и выберите VB Application Wizard. 
Нажмите несколько раз Next, и когда программа спросит вас "Do you want 
your user to be able to access the Internet from your application" смело
 нажимайте Yes. Можно сразу нажать кнопку Finish. В ваше приложение 
будет добавлена возможность навигации по Интернету, используя созданный 
вами проект. 
<br><br>
Расположите на основной форме CommandButton и впишите в него следующий код:
<br><br>
frmBrowser.Show<br><br>

Некоторые возможности компонента WebBrowser у вас автоматически 
добавятся, и вы сами потом можете на досуге в них разобраться. Я а же 
предлагаю вам добавить в ваш проект возможности, которые автоматически 
не были добавлены Мастером Создания Приложений. 
<br><br>
Процесс, показывающий процесс загрузки веб-страницы<br>
Private Sub WebBrowser1_ProgressChange(ByVal Progress As Long, ByVal ProgressMax As Long)<br>
On Error Resume Next<br>
PBar.Max = ProgressMax<br>
If Progress = -1 Then<br>
Exit Sub<br>
Else<br>
If Progress &lt;&gt; ProgressMax Then<br>
PBar.Value = Progress<br>
progresslbl.Caption = Str(Round((Progress / ProgressMax) * 100)) &amp; pert<br>
Else<br>
PBar.Value = ProgressMax<br>
progresslbl.Caption = Str(Round((Progress / ProgressMax) * 100)) &amp; pert<br>
Exit Sub<br>
End If<br>
End If<br>
End Sub<br><br>

или такой вариант.<br><br>

Private Sub WebBrowser1_ProgressChange(ByVal Progress As Long, ByVal ProgressMax As Long)<br>
On Error Resume Next<br>
If Progress = -1 Then ProgressBar1.Value = 100<br>
If Progress &gt; 0 And ProgressMax &gt; 0 Then<br>
ProgressBar1.Value = Progress * 100 / ProgressMax<br>
End If<br>
Exit Sub<br>
End Sub
<br><br>
или такой вариант.<br><br>

Private Sub WebBrowser1_ProgressChange(ByVal Progress As Long, ByVal ProgressMax As Long)<br>
On Error Resume Next<br>
ProgressBar1.Max = ProgressMax<br>
ProgressBar1.Value = Progress<br>
ProgressBar1.Refresh<br>
End Sub<br>
<br>
Просмотр содержимого веб-страницы "В виде HTML"<br>
2 варианта. Загрузите оба варианта, и посмотрите, что каждый код загружает...<br>
<br>
Text1 = WebBrowser1.Document.documentelement.innerhtml<br>
Text2 = WebBrowser1.Document.Body.innerhtml<br>
<br>
Вызвать окно "Печать"<br>
On Error Resume Next<br>
WebBrowser1.ExecWB OLECMDID_PRINT, OLECMDEXECOPT_DODEFAULT<br>
<br>
Добавить в ComboBox URL после загрузки<br>
Private Sub WebBrowser1_DocumentComplete(ByVal pDisp As Object, URL As Variant)<br>
Combo1.Text = URL<br>
End Sub<br>
<br>
Навигация на узел в сети<br>
WebBrowser1.Navigate "about:blank" 'пустая страница<br>
<br>
WebBrowser1.Navigate "http://sharig.webzone.ru"<br>
<br>
Запрет на посещение определенных узлов в Инете<br>
Private Sub WebBrowser1_BeforeNavigate2(ByVal pDisp As Object, URL As 
Variant, Flags As Variant, TargetFrameName As Variant, PostData As 
Variant, Headers As Variant, Cancel As Boolean)<br>
If InStr(1, URL, "playboy.com") Then<br>
Cancel = True<br>
MsgBox "Sorry, that site is restricted!"<br>
End If<br>
End Sub<br>
<br>
Ожидание загрузки страницы<br>
Do Until WebBrowser1.ReadyState = READYSTATE_COMPLETE<br>
DoEvents<br>
Loop<br>
<br>
Получить данные о загруженной странице<br>
MsgBox WebBrowser1.LocationName 'узнать имя загруженного файла (что-то типа "inet18_webbrowser.htm")<br>
<br>
MsgBox WebBrowser1.LocationURL 'получить URL загруженной страницы<br>
<br>
Вызвать окно "Сохранить как..."<br>
WebBrowser1.ExecWB OLECMDID_SAVEAS, OLECMDEXECOPT_DODEFAULT<br>
<br>
Что-то непонятное...<br>
Private Sub WebBrowser1_SetSecureLockIcon(ByVal SecureLockIcon As Long)<br>
If SecureLockIcon &lt;&gt; 0 Then<br>
imgSecure.Picture = "D:\garbage\ICON\2\face00.ico" 'path to secure icon<br>
Else<br>
imgSecure.Picture = "D:\garbage\ICON\2\face01.ico" 'path to unsecure icon<br>
End If<br>
End Sub<br><br>

Private Sub WebBrowser1_WindowClosing(ByVal IsChildWindow As Boolean, Cancel As Boolean)<br>
If MsgBox("This webpage is trying to close your browser window." &amp; 
vbCrLf &amp; vbCrLf &amp; "Are you sure you want to close it?", vbYesNo,
 "BAPNet") = vbYes Then<br>
Unload Me<br>
Cancel = True<br>
ElseIf vbNo Then<br>
Cancel = True<br>
End If<br>
End Sub<br>

<br> <b>8.10 Как вытащить все ссылки из htm-страницы - Visual Basic</b><br>

В одном из многочисленных примеров по работе с компонентом WebBrowser я 
натолкнулся на пример, как можно вытащить все ссылки из любого *.htm 
файла, находящегося как в интернете, так и локально на жестком диске. 
Честно говоря, моя жизнь после нахождения данного примера очень 
облегчилась, поскольку я часто работаю с инетом, со ссылками.
<br><br>
Нажатие на первую кнопку покажет, как можно вытащить все ссылки из 
файла, а нажатие на вторую кнопку - как можно вытащить ссылки только 
определенного типа.
<br><br>
Но для начала вам надо установить через меню Project | References ссылку на Microsoft Internet Control.
<br><br>
ПРИМЕР 1<br><br>

Также вам необходимо расположить на форме 2 элемента CommandButton и элемент ListBox.<br>
<br>
Private IEBroj1 As SHDocVw.InternetExplorer<br>
Private Sub Form_Load()<br>
Set IEBroj1 = New SHDocVw.InternetExplorer<br>
End Sub<br>
Private Sub Form_Unload(Cancel As Integer)<br>
IEBroj1.Quit<br>
Set IEBroj1 = Nothing<br>
End<br>
End Sub<br>
<br>
Function Delay(Pause As Single)<br>
Dim Start As Single<br>
Start = Timer<br>
Do While Timer &lt; Start + Pause<br>
DoEvents<br>
Loop<br>
End Function<br>
<br>
Private Sub Command1_Click()<br>
List1.Clear<br>
Dim x<br>
IEBroj1.Navigate "C:\1\index.htm"<br>
Delay 3 'задержа необходима для загрузки страницы<br>
'иногда требуется увеличить время загрузки до 30 секунд.<br>
For i = 1 To IEBroj1.Document.links.length - 1<br>
List1.AddItem IEBroj1.Document.links(i).href<br>
Next<br>
End Sub<br>
<br>
Private Sub Command2_Click()<br>
List1.Clear<br>
Dim x<br>
IEBroj1.Navigate "C:\1\index.htm"<br>
Delay 3<br>
For i = 1 To IEBroj1.Document.links.length - 1<br>
If InStr(1, IEBroj1.Document.links(i).href, ".asp") &lt;&gt; 0 Or 
InStr(1, IEBroj1.Document.links(i).href, ".htm") &lt;&gt; 0 Then<br>
List1.AddItem IEBroj1.Document.links(i).href<br>
End If<br>
Next<br>
End Sub<br>

<br> <b>8.11 Создать ссылку на страницу в Интернете - Visual Basic</b><br>
Данный пример разместит на рабочем столе ярлык на сайт RusEdu.info (при 
условии, что ваш путь к рабочему столу = "C:\WIN\Рабочий стол"). <br><br>
Sub CreateInternetShortCut(URLFile As String, URLTarget As String)<br>
Dim intFreeFile As Integer<br>
intFreeFile = FreeFile<br>
Open URLFile For Output As intFreeFile<br>
Print #intFreeFile, "[InternetShortcut]"<br>
Print #intFreeFile, "URL=" &amp; URLTarget<br>
Close intFreeFile<br>
End Sub<br>
<br>
Private Sub Form_Load()<br>
CreateInternetShortCut "C:\WIN\Рабочий стол\test.url", "http://rusedu.info"<br>
End Sub<br>

 <br> <b>8.12 Определить дату изменения web-страницы - Visual Basic</b><br>
 
 Зазместите на форме компонент Inet и элемент CommandButton. <br>
<br>
Public Function PageLastModified(URL As String) As String<br>
Dim strHeader As String<br>
Inet1.Protocol = icHTTP<br>
On Error Resume Next<br>
Inet1.OpenURL (URL)<br>
If Err.Number &gt; 0 Then Exit Function<br>
strHeader = Inet1.GetHeader("Last-modified")<br>
PageLastModified = strHeader<br>
End Function<br>
<br>
Private Sub Command1_Click()<br>
MsgBox PageLastModified("http://sharig.webzone.ru/IndexMainTopic.htm") <br>
End Sub<br> 

<br> <b>8.13 Является ли строковая переменная e-mail-адресом - Visual Basic</b><br>

Этот код использует VBScript.dll<br>
Вы можете загрузить его с www.microsoft.com/msdownload/vbscript/scripting.asp<br>
<br>
Добавьте Microsoft VBScript Regular Expressions reference в ваш проект 
(выберите Project-&gt;References, поставьте галочку на Microsoft 
VBScript Regular Expressions CheckBox и нажмите OK).
<br><br>
RegExp - тип переменной, которую вы хотите проверить: Email-адрес, телефонный номер, любой другой формат. 
<br><br>
Private Sub Form_Load()<br>
Dim myReg As RegExp<br>
Dim email As String<br>
Set myReg = New RegExp<br>
myReg.IgnoreCase = True<br>
myReg.Pattern = "^[\w-\.]+@\w+\.\w+$"<br>
'replace "myName@domain.ru" любым адресом<br>
email = "myName@domain.ru"<br>
MsgBox "Результат проверки: " &amp; myReg.Test(email)<br>
Unload Me<br>
End Sub<br>
<br> <b>8.14 Имя текущего соединения с инетом - Visual Basic</b><br>
'Расположите на форме элемент CommandButton.<br>
<br>
Private Const RAS_MAXENTRYNAME As Integer = 256<br>
Private Const RAS_MAXDEVICETYPE As Integer = 16<br>
Private Const RAS_MAXDEVICENAME As Integer = 128<br>
Private Const RAS_RASCONNSIZE As Integer = 412<br>
Private Type RASCONN<br>
dwSize As Long<br>
hRasConn As Long<br>
szEntryName(RAS_MAXENTRYNAME) As Byte<br>
szDeviceType(RAS_MAXDEVICETYPE) As Byte<br>
szDeviceName(RAS_MAXDEVICENAME) As Byte<br>
End Type<br>
Private Declare Function RasEnumConnections Lib "rasapi32.dll" Alias 
"RasEnumConnectionsA" (udtRasConn As Any, lpcb As Long, lpcConnections 
As Long) As Long
<br>
Private Sub Command1_Click()<br>
Dim udtRasConn(255) As RASCONN, countConn As Long<br>
Dim Ret As Long, b As Long<br>
udtRasConn(0).dwSize = RAS_RASCONNSIZE<br>
Ret = RasEnumConnections(udtRasConn(0), RAS_MAXENTRYNAME * udtRasConn(0).dwSize, countConn)<br>
If Ret = 0 Then<br>
For b = 0 To countConn - 1<br>
MsgBox "Текущее соединение: " &amp; StrConv(udtRasConn(b).szEntryName(), vbUnicode)<br>
Next b<br>
End If<br>
End Sub<br>
<br> <b>8.15 Получение списка всех интернет-соединений - Visual Basic</b><br>
Добавьте на форму CommandButton и ListBox. Вставьте следующий код, 
запустите программу на выполнение. В ListBox'е вы получите имена всех 
интернет-соединений. При нажатии на CommandButton на форме будет 
напечатано имя интернет-соединения по умолчанию. 
<br><br>
Const REG_NONE = 0&amp;<br>
Const REG_SZ = 1&amp;<br>
Const REG_EXPAND_SZ = 2&amp;<br>
Const REG_BINARY = 3&amp;<br>
Const REG_DWORD = 4&amp;<br>
Const REG_DWORD_LITTLE_ENDIAN = 4&amp;<br>
Const REG_DWORD_BIG_ENDIAN = 5&amp;<br>
Const REG_LINK = 6&amp;<br>
Const REG_MULTI_SZ = 7&amp;<br>
Const REG_RESOURCE_LIST = 8&amp;<br>
Const REG_FULL_RESOURCE_DESCRIPTOR = 9&amp;<br>
Const REG_RESOURCE_REQUIREMENTS_LIST = 10&amp;<br>
<br>
Public rgeEntry$<br>
Public rgeDataType&amp;<br>
Public rgeValue$<br>
Public rgeMainKey&amp;<br>
Public rgeSubKey$<br>
<br>
Const KEY_QUERY_VALUE = &amp;H1&amp;<br>
Const KEY_SET_VALUE = &amp;H2&amp;<br>
Const KEY_CREATE_SUB_KEY = &amp;H4&amp;<br>
Const KEY_ENUMERATE_SUB_KEYS = &amp;H8&amp;<br>
Const KEY_NOTIFY = &amp;H10&amp;<br>
Const KEY_CREATE_LINK = &amp;H20&amp;<br>
Const READ_CONTROL = &amp;H20000<br>
Const WRITE_DAC = &amp;H40000<br>
Const WRITE_OWNER = &amp;H80000<br>
Const SYNCHRONIZE = &amp;H100000<br>
Const STANDARD_RIGHTS_REQUIRED = &amp;HF0000<br>
Const STANDARD_RIGHTS_READ = READ_CONTROL<br>
Const STANDARD_RIGHTS_WRITE = READ_CONTROL<br>
Const STANDARD_RIGHTS_EXECUTE = READ_CONTROL<br>
Const KEY_READ = STANDARD_RIGHTS_READ Or KEY_QUERY_VALUE Or KEY_ENUMERATE_SUB_KEYS Or KEY_NOTIFY<br>
Const KEY_WRITE = STANDARD_RIGHTS_WRITE Or KEY_SET_VALUE Or KEY_CREATE_SUB_KEY<br>
Const KEY_EXECUTE = KEY_READ<br>
Private Type FILETIME<br>
lLowDateTime As Long<br>
lHighDateTime As Long<br>
End Type<br>
Const HKEY_CLASSES_ROOT = &amp;H80000000<br>
Const HKEY_CURRENT_USER = &amp;H80000001<br>
Const HKEY_LOCAL_MACHINE = &amp;H80000002<br>
Const HKEY_USERS = &amp;H80000003<br>
Const HKEY_PERFORMANCE_DATA = &amp;H80000004<br>
Const HKEY_CURRENT_CONFIG = &amp;H80000005<br>
Const HKEY_DYN_DATA = &amp;H80000006<br>
<br>
Private Declare Function RegOpenKeyEx&amp; Lib "advapi32.dll" Alias 
"RegOpenKeyExA" (ByVal hKey&amp;, ByVal lpszSubKey$, dwOptions&amp;, 
ByVal samDesired&amp;, lpHKey&amp;)<br>
Private Declare Function RegCloseKey&amp; Lib "advapi32.dll" (ByVal hKey&amp;)<br>
Private Declare Function RegQueryValueEx&amp; Lib "advapi32.dll" Alias 
"RegQueryValueExA" (ByVal hKey&amp;, ByVal lpszValueName$, ByVal 
lpdwRes&amp;, lpdwType&amp;, ByVal lpDataBuff$, nSize&amp;)<br>
Private Declare Function RegEnumKeyEx&amp; Lib "advapi32.dll" Alias 
"RegEnumKeyExA" (ByVal hKey&amp;, ByVal dwIndex&amp;, ByVal lpname$, 
lpcbName&amp;, ByVal lpReserved&amp;, ByVal lpClass$, lpcbClass&amp;, 
lpftLastWriteTime As FILETIME)<br>
Private Declare Function RegQueryInfoKey&amp; Lib "advapi32.dll" Alias 
"RegQueryInfoKeyA" (ByVal hKey&amp;, ByVal lpClass$, lpcbClass&amp;, 
ByVal lpReserved&amp;, lpcSubKeys&amp;, lpcbMaxSubKeyLen&amp;, 
lpcbMaxClassLen&amp;, lpcValues&amp;, lpcbMaxValueNameLen&amp;, 
lpcbMaxValueLen&amp;, lpcbSecurityDescriptor&amp;, lpftLastWriteTime As 
FILETIME)<br>
<br>
Public Function GetRegValue(keyroot As Variant, subkey As Variant, valname As String)<br>
Const KEY_ALL_ACCESS As Long = &amp;HF0063<br>
Const ERROR_SUCCESS As Long = 0<br>
Const REG_SZ As Long = 1<br>
Dim hsubkey As Long, dwType As Long, sz As Long<br>
Dim R As Long<br>
R = RegOpenKeyEx(keyroot, subkey, 0, KEY_ALL_ACCESS, hsubkey)<br>
sz = 256<br>
v$ = String$(sz, 0)<br>
R = RegQueryValueEx(hsubkey, valname, 0, dwType, ByVal v$, sz)<br>
If R = ERROR_SUCCESS And dwType = REG_SZ Then<br>
retval = Left$(v$, sz)<br>
GetRegValue = retval<br>
Else<br>
retval = "--Not String--"<br>
End If<br>
R = RegCloseKey(hsubkey)<br>
End Function<br>
Public Sub rgeClear()<br>
rgeMainKey = 0<br>
rgeSubKey = ""<br>
rgeValue = ""<br>
rgeDataType = 0<br>
rgeEntry = ""<br>
End Sub<br>
Function RegEnumKeys&amp;(bFullEnumeration As Boolean)<br>
Dim sRoot$, sRoot2$<br>
Dim lRtn&amp;<br>
Dim hKey&amp;<br>
Dim strucLastWriteTime As FILETIME<br>
Dim sSubKeyName$<br>
Dim sClassString$<br>
Dim lLenSubKey&amp;<br>
Dim lLenClass&amp;<br>
Dim lKeyIndx&amp;<br>
Dim lRet&amp;<br>
Dim hKey2&amp;<br>
Dim sSubKey2$<br>
Dim sNewKey$<br>
Dim sClassName$<br>
Dim lClassLen&amp;<br>
Dim lSubKeys&amp;<br>
Dim lMaxSubKey&amp;<br>
Dim sMaxSubKey$<br>
Dim lMaxClass&amp;<br>
Dim sMaxClass$<br>
Dim lValues&amp;<br>
Dim lMaxValueName&amp;<br>
Dim lMaxValueData&amp;<br>
Dim lSecurityDesc&amp;<br>
lRtn = RegOpenKeyEx(rgeMainKey, rgeSubKey, 0&amp;, KEY_READ, hKey)<br>
sClassName = Space$(255)<br>
lClassLen = CLng(Len(sClassName))<br>
lRet = RegQueryInfoKey(hKey, sClassName, lClassLen, 0&amp;, lSubKeys, lMaxSubKey, _<br>
lMaxClass, lValues, lMaxValueName, lMaxValueData, lSecurityDesc, strucLastWriteTime)<br>
sMaxSubKey = Space$(lMaxSubKey + 1)<br>
sMaxClass = Space$(lMaxClass + 1)<br>
lKeyIndx = 0&amp;<br>
Do While lRtn = ERROR_SUCCESS<br>
ReTryKeyEnumeration:<br>
sSubKeyName = sMaxSubKey<br>
lLenSubKey = lMaxSubKey<br>
sClassString = sMaxClass<br>
lLenClass = lMaxClass<br>
lRtn = RegEnumKeyEx(hKey, lKeyIndx, sSubKeyName, lLenSubKey, 0&amp;, sClassString, _<br>
lLenClass, strucLastWriteTime)<br>
If InStr(sSubKeyName, Chr$(0)) &gt; 1 Then<br>
sSubKeyName = Left$(sSubKeyName, InStr(sSubKeyName, Chr$(0)) - 1)<br>
End If<br>
If lRtn = ERROR_SUCCESS Then<br>
Form1.List1.AddItem sSubKeyName<br>
lNewKey = lNewKey + 1<br>
sNewKey = "A" &amp; Format$(lNewKey, "000000")<br>
If bFullEnumeration = True Then<br>
sSubKey2 = sSubKeyName<br>
If rgeSubKey &lt;&gt; "" Then<br>
sSubKey2 = Trim(rgeSubKey) &amp; "\" &amp; sSubKeyName<br>
End If<br>
lRet = RegOpenKeyEx(rgeMainKey, sSubKey2, 0&amp;, KEY_READ, hKey2)<br>
Else<br>
Exit Do<br>
End If<br>
lKeyIndx = lKeyIndx + 1<br>
ElseIf lRtn = ERROR_MORE_DATA Then<br>
lMaxSubKey = lMaxSubKey + 5<br>
lMaxClass = lMaxClass + 5<br>
sMaxSubKey = Space$(lMaxSubKey + 1)<br>
sMaxClass = Space$(lMaxClass + 1)<br>
GoTo ReTryKeyEnumeration<br>
ElseIf lRtn = ERROR_NO_MORE_ITEMS Then<br>
lRtn = ERROR_SUCCESS<br>
Exit Do<br>
Exit Do<br>
End If<br>
Loop<br>
RegEnumKeys = lRtn<br>
lRtn = RegCloseKey(hKey)<br>
End Function<br>
<br>
Private Sub Form_Load()<br>
rgeMainKey = HKEY_CURRENT_USER<br>
rgeSubKey$ = "RemoteAccess\Profile"<br>
RegEnumKeys True<br>
End Sub<br>
Private Sub Command1_Click()<br>
Print GetRegValue(HKEY_CURRENT_USER, "RemoteAccess", "Default")<br>
End Sub<br>

<br> <b>8.16 Запрещение запуска дополнительных окон IE</b><br>
Данный пример запретит запуск дополнительных окон броузера 
ИнтернетЭксплорер. Этот пример хорош для борьбы с рекламными окошками, 
запускаемыми автоматически на тех или иных сайтах.
<br><br>
Что делает пример: 1) программа при запуске определяет количество 
запущенных окон InternetExplorer'а. 2) во время работы программа 
проводит мониторинг запущенных процессов, 3) и если запущено очередное 
окно Internet Explorer'а программа его закроет.
<br><br>
Ну а кнопка вам понадобится, если вы захотите отключить/снова включить процесс мониторинга.
<br><br>
Пример подробно описан, но... на английском языке.
<br><br>
Установите на форме компонент Label, компонент Timer и CommandButton. 
Также в этом примере вам понадобится дополнительный модуль.
<br><br>
'КОД МОДУЛЯ:
<br><br>
Public Type WI<br>
TitleBarText As String<br>
TitleBarLen As Integer<br>
hWnd As Long<br>
End Type<br>
Public Declare Function GetWindowTextLength Lib "user32.dll" Alias "GetWindowTextLengthA" (ByVal hWnd As Long) As Long<br>
Public Declare Function EnumWindows Lib "user32.dll" (ByVal lpEnumFunc As Long, ByVal lParam As Long) As Long<br>
Public Declare Function GetWindowText Lib "user32.dll" Alias 
"GetWindowTextA" (ByVal hWnd As Long, ByVal lpString As String, ByVal 
nMaxCount As Long) As Long<br>
Public WinNum As Integer 'holds the number of windows examined<br>
Public CurrentWindows(299) As WI 'holds information about all of the currently open windows<br>
<br>
Public Function EnumWindowsProc(ByVal hWnd As Long, ByVal lParam As Long) As Long<br>
Dim WinInfo As WI 'holds information about the window currently being examined<br>
Dim retval As Long 'holds the return value<br>
Dim X As Integer<br>
<br>
WinInfo.TitleBarLen = GetWindowTextLength(hWnd) + 1 'find the length of 
the title bar text of the window currently being examined<br>
If WinInfo.TitleBarLen &gt; 0 And Len(hWnd) &gt; 1 Then 'if the title 
bar text of the window currently being examined is at least one 
character long AND the window's handle is &gt; 1<br>
WinInfo.TitleBarText = Space(WinInfo.TitleBarLen) 'initialize the variable that will hold the title bar text<br>
retval = GetWindowText(hWnd, WinInfo.TitleBarText, WinInfo.TitleBarLen) 
'retreive the title bar text of the window currently being examined<br>
WinInfo.hWnd = hWnd 'holds the value of this window's handle<br>
CurrentWindows(WinNum).hWnd = WinInfo.hWnd 'store this window's handle in the current windows array<br>
CurrentWindows(WinNum).TitleBarText = WinInfo.TitleBarText 'store this window's title bar text in the current windows array<br>
WinNum = WinNum + 1 'increment the window counter<br>
End If<br>
EnumWindowsProc = 1 'continue enumeration of windows<br>
End Function<br>
<br>
'КОД ФОРМЫ<br>
<br>
Option Explicit<br>
<br>
Private Declare Function PostMessage Lib "user32" Alias "PostMessageA" 
(ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, ByVal 
lParam As Long) As Long<br>
Private Const WM_CLOSE = &amp;H10<br>
Dim ExistingIEWindows(49) As Long 'holds the handles of all of the currently existing IE windows (50 max)<br>
Dim Flash As Integer 'holds the value that determines if the status text should flash<br>
<br>
Private Sub Command1_Click()<br>
If Command1.Caption = "Отключить мониторинг" Then<br>
Timer1.Enabled = False<br>
Command1.Caption = "Включить мониторинг"<br>
Else<br>
Timer1.Enabled = True<br>
End If<br>
End Sub<br>
<br>
Private Sub Form_Load()<br>
Timer1.Interval = 100<br>
Command1.Caption = "Отключить мониторинг"<br>
Dim X As Integer 'loop variable<br>
Label1.Caption = "Initializing..."<br>
Flash = 0<br>
For X = 0 To 49 'reset/initialize the existing IE windows array<br>
ExistingIEWindows(X) = 0<br>
Next<br>
Call GetExistingIEWindows<br>
End Sub<br>
<br>
Private Sub GetExistingIEWindows() 'this sub checks to see if any IE windows are currently open, and "remembers" them if so.<br>
Dim retval As Long 'holds the return value<br>
Dim X As Integer, Y As Integer 'loop variables<br>
Label1.Caption = "Examining currently active system windows..."<br>
WinNum = 0 'initialize number of windows to zero<br>
For X = 0 To 199 'reset/initialize the current windows array<br>
CurrentWindows(X).hWnd = 0<br>
CurrentWindows(X).TitleBarLen = 0<br>
CurrentWindows(X).TitleBarText = ""<br>
Next<br>
retval = EnumWindows(AddressOf EnumWindowsProc, 0) 'enumerate all open windows<br>
Y = 0<br>
For X = 0 To WinNum - 1 'for each window that is currently open<br>
If InStr(1, CurrentWindows(X).TitleBarText, "Microsoft Internet 
Explorer", vbTextCompare) &gt; 0 Then 'if this window is an IE window...<br>
Label1.Caption = "Storing IE window handle..."<br>
ExistingIEWindows(Y) = CurrentWindows(X).hWnd 'add this window to the list of existing IE windows<br>
Y = Y + 1<br>
End If<br>
Next<br>
If Y &gt; 0 Then 'if any of the existing system windows are IE windows<br>
Label1.Caption = "Enabling popup monitoring..."<br>
Timer1.Enabled = True 'enable the timer that checks for any new IE windows<br>
Label1.Caption = "Monitoring for new IE windows..."<br>
Else 'if none of the existing system windows are IE windows<br>
Label1.Caption = "No IE windows found!"<br>
MsgBox "There are currently no IE windows open!" &amp; vbLf &amp; vbLf 
&amp; "Please start Internet Explorer before running this program.", 
vbExclamation + vbOKOnly, "Error" 'if no IE windows are found, display 
an error message<br>
End 'exit this program<br>
End If<br>
End Sub<br>
<br>
Private Sub Timer1_Timer()<br>
Dim retval As Long 'holds the return value<br>
Dim X As Integer, Y As Integer 'loop variables<br>
Dim KillCount As Integer 'holds the value that determines if the current window should be killed<br>
WinNum = 0 'initialize number of windows to zero<br>
For X = 0 To 199 'reset/initialize the current windows array<br>
CurrentWindows(X).hWnd = 0<br>
CurrentWindows(X).TitleBarLen = 0<br>
CurrentWindows(X).TitleBarText = ""<br>
Next<br>
retval = EnumWindows(AddressOf EnumWindowsProc, 0) 'enumerate all open windows<br>
For X = 0 To WinNum - 1 'for each window that is currently open<br>
If InStr(1, CurrentWindows(X).TitleBarText, "Microsoft Internet 
Explorer", vbTextCompare) &gt; 0 Then 'if this window is an IE window...<br>
KillCount = 0<br>
For Y = 0 To 49<br>
If ExistingIEWindows(Y) &lt;&gt; 0 Then 'if array value holds a valid handle<br>
If ExistingIEWindows(Y) = CurrentWindows(X).hWnd Then 'if the window 
currently being examined matches any of the existing IE windows<br>
KillCount = KillCount + 1 'increment<br>
End If<br>
End If<br>
Next<br>
If KillCount = 0 Then 'if an IE window that did not previously exist was found<br>
retval = PostMessage(CurrentWindows(X).hWnd, WM_CLOSE, ByVal CLng(0), 
ByVal CLng(0)) 'post the window close message to the newly created IE 
window's message queue<br>
End If<br>
End If<br>
Next<br>
Flash = Flash + 1 'increment the flash value<br>
If Flash = 5 Then 'make the status label flash every 0.5 seconds<br>
Flash = 0<br>
If Label1.Visible = True Then<br>
Label1.Visible = False<br>
Else<br>
Label1.Visible = True<br>
End If<br>
End If<br>
End Sub<br><br>
<b>8.17 Proxy Server на VB - Visual Basic</b><br>
<a href="http://proxy.oflameron.ru/"><u>proxy.oflameron.ru - Proxy на Visual Basic</u></a><br>
Онлайн учебник - прокси-сервер на Visual Basic. Курсовик<br><br>

<b>8.18 Как установить/сменить IP адресс в локальной сети - Visual Basic</b><br>
<a href="http://vbrus.narod.ru/Primers/Lan/IP876.zip"><u>http://vbrus.narod.ru/Primers/Lan/IP876.zip - Скачать примеp</u></a><br>
<br>
<b>8.19 Как отправлять сообщения и файлы через Mail - Visual Basic</b><br>
<a href="http://vbrus.narod.ru/Primers/Lan/smtp.rar"><u>Скачать пример</u></a><br>

      <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх </a>  </ol>
          
                
            <h2><a name="9"><b>09. Использование Winsock контрола</b></a></h2>
    <ol font="" style="font-size:10pt">
      
       
       <b> Использование компонента Winsock</b><br> 

Компонент WinSock позволяет соединиться с удаленной машиной и обменяться с ней данными, используя UDP (User Datagram Protocol)<br>
 
или TCP (Transmission Control Protocol). Оба протокола могут быть 
использованы при создании клиент-серверных приложений. Также, как и 
Timer control, WinSock control является невидимым во время выполнения 
программы.<br> 
 <br> 
 
Как им пользоваться?<br> 
<br> 
- cоздать приложение-клиент, которое будет собирать информацию перед отсылкой ее на центральный сервер; <br> 
- cоздать приложение-сервер, которое будет выполнять роль сборщика и хранителя информации от различных клиентских приложений;<br> 
- создать "chat"-приложение.<br> <br> 
 
 
Выбор протокола<br> 
<br> 
Когда планируется использование а WinSock, необходимо решить какой 
протокол будет использоваться - TCP или UDP. Основное отличие между ними
 заключается в способе организации связи:<br> 
Соединение основанное на TCP протоколе, похоже на телефонное - 
пользователь сначала должен установить соединение, прежде чем что-либо 
передавать. <br> 
Соединение основанное на UDP протоколе, похоже на передачу голосом, 
сообщение передается от одного компьютера к другому, но не ясно, слышат 
ли они друг друга. Вдобавок, максимальный размер предаваемых данных 
устанавливается сетью. <br> 
Возможности приложения которое Вы создаете будет зависеть от протокола, 
который Вы изберете. Вот несколько вопросов которые могут помочь Вам 
выбрать подходящий протокол: Будет ли приложение требовать уведомления 
от сервера или клиента, когда данные передаются или получаются?<br> 
Если будет, то TCP протокол требует установленного соединения между передатчиком и приемником данных.<br>
 
Будут ли передаваемые данные достаточно тяжелыми (например изображения 
или звуковые файлы)? Если соединение было установлено, TCP протокол 
будет его поддерживать и гарантируется целостность передаваемых данных. 
Такое соединение, из-за потребности в большем количестве вычислительных 
ресурсов, может сделать его более медленным.<br> 
Будут ли данные передаваться порциями или за одну сессию? Например, если
 Вы создаете приложение, которое сообщает каким-то компьютерам, о том, 
что какие-то задачи уже выполнены, то UDP протокол более подходящий. UDP
 протокол также блучше подходит для передачи небольшого количества 
данных.<br> 
 <br> <br> 
 
Установка протокола<br> 
<br> 
 
Чтобы установить протокол, который будет использовать ваше приложение Вы
 должны в дизайн-тайме в окне свойств выбрать свойство Protocol<br> 
и установить его sckTCPProtocol или sckUDPProtocol. Это можно также сделать программно:<br> 
Winsock1.Protocol = sckTCPProtocol<br> 
Определение имени компьютера.<br> 
Чтобы установить связь с удаленным компьютером, Вы должны знать либо его IP-адресс, либо его имя.<br> <br> 
 
 
Основы TCP соединения<br> 

Когда создается приложение, которое использует TCP протокол первое, что 
Вы должны решить, это чем будет ваше приложение клиентом или сервером. 
Если Вы создаете приложение-сервер, значит ваше приложение будет слушать
 указанный порт. Когда приложение-клиент подаст запрос на соедиение, 
приложение-сервер может принять запрос и таким образом установить 
соедиенеие. Если соединение установлено, приложение-клиент и приложение 
сервер могут свободно обмениваться данными.<br> 
Следующие шаги позволят Вам создать элементарное приложение-сервер:<br> <br> 
 
 
Для создания TCP сервера<br> <br> 

 
   Создайте новый Standard EXE проект.<br> 
   Замените имя формы по умолчанию на frmServer.<br> 
   В свойстве формы caption наберите "TCP Server"<br> 
   В меню Project\Components добавьте Microsoft Winsock Conrol 6.0<br> 
   Перетащите иконку компонента Winsock с панели инструментов и разместите ее на форме; измените имя компонента на tcpServer.<br> 
Добавьте на форму два Текстбокс элемента. В свойстве Name первого текстового поля наберите txtSendData, а второго txtOutput.<br> 
Добавьте в форму следующий код:<br> <br> <br> 

   Private Sub Form_Load()<br> 
    'Задать номер порта по которому будет осуществляться<br> 
   'обмен данными, присвоив значение свойству LocalPort<br> 
   'Вызвать метод Listen.<br> 
   tcpServer.LocalPort = 1001<br> 
   tcpServer.Listen<br> 
   frmClient.Show 'Показать форму клиента<br> 
   End Sub<br> <br> <br> 
   
   Private Sub tcpServer_ConnectionRequest (ByVal requestID As Long)<br> 
   ' Проверяется свойство State, было ли завершено<br> 
   ' предыдущее соединение. Если не завершено,<br> 
   ' то перед установлением нового соединения,<br> 
   ' старое закрывается принудительно.<br> 
   If tcpServer.State &lt;&gt; sckClosed Then tcpServer.Close<br> 
   ' Принятие запроса Accept с параметром requestID<br> 
   ' на установление соедиения.<br> 
   tcpServer.Accept requestID<br> 
   End Sub<br> <br> 
   
   Private Sub txtSendData_Change()<br> 
   ' Текстовое поле txtSendData<br> 
   ' содержит данные для передачи. Все символы,<br> 
   ' которые будут вводиться в это текстовое поле, будут единой<br> 
   ' строкой посылаться приложению-клиенту, используя метод SendData.<br> 
   tcpServer.SendData txtSendData.Text<br> 
   End Sub<br> <br> 
   
   Private Sub tcpServer_DataArrival (ByVal bytesTotal As Long)<br> 
   ' Декларируется переменная-буфер для получаемых данных.<br> 
   ' Вызывается метод GetData и свойству Text<br> 
   ' текстового поля txtOutput, присваивается значение переменной-<br> 
   ' буфера.<br> <br> 
   Dim strData As String<br> 
   tcpServer.GetData strData<br> 
   txtOutput.Text = strData<br> 
   End Sub<br> <br> <br> 


Описанные выше действия, выполненные Вами, приведут к созданию простого 
приложения-сервера. Но для того чтобы полностью выполнить задачу, 
необходимо создать еще и приложение-клиент.<br> <br> 
 
 
Для создания TCP приложения-клиента<br> <br> 

Добавьте новую форму в проект и назовите ее frmClient.<br> 
И змените свойство формы caption на "TCP Client". <br> 
Перетащите и разместите компонент Winsock на форму и измените его свойство name на "tcpClient".<br> 
   Добавьте два Текстбокс-контрола на форму frmClient.<br> 
   Имя первого установите txtSend, а второго txtOutput.<br> 
   Перетащите на форму CommandButton и установите его свойство name в "cmdConnect".<br> 
   Измените свойство caption этой кнопки на "Connect".<br> 
Добавьте следующий код в форму.<br> 
Важно!!! Будьте внимательны при установке свойства RemoteHost. Оно должно соответствовать либо IP-адресу вашего компьютера,<br>
 
либо его "Дружественному имени" (см. Пуск\Настройка\Панель 
управления\Сеть) выберите вкладку "Идентификация". Текст из поля "Имя 
компьютера" и будет так называемым дружественным именем, которым можно 
заменять IP-адрес. Сам же IP-адрес, можно посмотреть, если выбрать 
закладку "Конфигурация" в списке выбрать TCP/IP, нажать кнопку 
"Свойства" и выбрать закладку IP-адрес.<br> 
<br> 
Private Sub Form_Load()<br> 
   ' Имя Winsock-компонента tcpClient.<br> 
   ' Указывая имя удаленного компьютера можно<br> 
   ' указывать IP-адрес (например: "121.111.1.1") или<br> 
   ' дружественное имя, как в нижеприведенном коде.<br> 
   tcpClient.RemoteHost = "RemoteComputerName" 'или "121.111.1.1"<br> 
   tcpClient.RemotePort = 1001<br> 
End Sub<br> <br> 

Private Sub cmdConnect_Click()<br> 
   ' Вызвать метод Connect для создания соединения<br> 
   tcpClient.Connect<br> 
End Sub<br> <br> 

Private Sub txtSend_Change()<br> 
   tcpClient.SendData txtSend.Text<br> 
End Sub<br> <br> 

Private Sub tcpClient_DataArrival (ByVal bytesTotal As Long)<br> 
   Dim strData As String<br> 
   tcpClient.GetData strData<br> 
   txtOutput.Text = strData<br> 
End Sub<br> <br> <br> 


Сохраните проект в отдельной директории.<br> 
Код приведенный выше - это простейшее клиент-серверное приложение. Чтобы
 попробовать, как это все работает на одной машине в связке, имитирующей
 межмашинное соединение, значение свойства RemoteHost приложения-клиента
 должно соответствовать дружественному имени или IP-адресу вашего 
компьютера. Запустите проект и нажмите кнопку "Connect". После этого 
наберите текст внутри текстового поля txtSendData на каждой форме и 
убедитесь, что тот же самый текст появится в текстовом поле txtOutput 
другой формы.<br> 
Если Вы хотите, попробовать, как приложения будут осуществлять связь 
между двумя компьютерами, то Вам прийдется произвести следующие 
действия: <br> 
   Удалить из кода формы приложения-сервера строку frmClient.Show.<br> 
   В окне Project Explorer щелкнуть правой кнопкой мыши на форме 
frmClient.frm и в появившемся меню выбрать Remove frmClient.frm после 
чего сохранить проект под именем Server1.<br> 
   Открыть первый вариант проекта и таким же образом удалить из проекта уже форму frmServer.frm.<br> 
   Создать exe модуль для frmClient-а и переписать его на удаленный компьютер и запустить его там.<br> 
Примечание: если на удаленном компьютере не установлен VB будьте готовы к тому, что вам потребуется переписать<br> 
на него из WINDOWS\SYSTEM\mswinsck.ocx и зарегистрировать его при помощи команды<br> 
WINDOWS\SYSTEM\regsvr32.exe mswinsck.ocx<br> 
Если приложение будет требовать какие-то дополнительные dll модули перепишите их со своей машины на удаленную.<br> 
   На своей машине, откройте проект Server и запустите его. <br> 
   На клиентской машине нажмите кнопку Connect и наберите текст внутри 
текстового поля txtSendData на каждой форме и убедитесь, что тот же 
самый текст появится в текстовом поле txtOutput в приложении, запущенном
 на другом компьютере.<br> 
 <br> <br> 
 
Обработка более чем одного запроса на установление соединения<br> <br> 

Приложение-сервер, которое мы создавали сначала может обработать только 
один запрос на соединение. Тем не менее, существует возможность 
обработать несколько запросов на соединение, используя тот же самый 
управляющий элемент как один из массива управляющих элементов.<br> 
В этом случае, необязательно закрывать соединение - просто создайте 
новый вариант управляющего элемента (использовав его свойство Index) и 
вызовите метод Accept для этого нового варианта управляющего элемента.<br>
 
В приведенном ниже тексте программы, свойству Index, размещенного на 
форме Winsock-компонента sckServer, присваивается значение 0, таким 
образом, управляющий элемент становится частью массива управляющих 
элементов. В разделе Declarations описана локальная переменная intMax. 
Когда для формы происходит событие Load, переменной intMax присваивается
 значение 0 и свойству LocalPort первого элемента массива<br> 
управляющих элементов присваивается значение 1001. Только после того, 
как вызывается метод Listen этого управляющего элемента, он начинает 
слушать указанный порт. Когда поступает новый запрос на соединение, 
осуществляется проверка значения Index и равно ли оно 0 (значение 
элемента, который слушает порт). Таким образом, элемент который слушает 
порт, будет приращивать переменную intMax и использовать значение этой 
переменной для создания нового элемента массива. Этот новый элемент 
будет использоваться для обработки запроса на соединение.<br> 
<br> 
Private intMax As Long<br> 
<br> 
Private Sub Form_Load()<br> 
intMax = 0<br> 
sckServer(0).LocalPort = 1001<br> 
sckServer(0).Listen<br> 
End Sub<br> <br> 

Private Sub sckServer_ConnectionRequest (Index As Integer, ByVal requestID As Long)<br> 
   If Index = 0 Then<br> 
      intMax = intMax + 1<br> 
      Load sckServer(intMax)<br> 
      sckServer(intMax).LocalPort = 0<br> 
      sckServer(intMax).Accept requestID<br> 
      Load txtData(intMax)<br> 
   End If<br> 
End Sub<br> 
<br> <br> <br> 

 

 
Основы UDP<br> <br> 

Создавать приложения, использующие UDP протокол проще, чем создавать 
приложения, использующие TCP протокол. Дело в том, что UDP не требует 
уже установленного соединения, как необходимого условия для передачи 
данных. В приложениях использующих TCP соединение, один Winsock элемент 
должен обязательно "слушать" порт, в ожидании пока какое-нибудь другое 
приложение не станет инициатором соединения, использовав метод Connect. 
UDP протокол не требует обязательно установленного соединения для 
передачи данных. Для передачи данных между двумя приложениями, 
необходимо выполнить три следующих пункта с обеих соединяющихся сторон:<br> 
   присвоить свойству RemoteHost дружественное имя или IP-адрес компьютера с которым предстоит соединение;<br> 
   установить свойство RemotePort для LocalPort property of the second control.<br> 
   Вызвать метод Bind указав какой локальный порт будет использоваться (метод Bind подробнее будет обсужден ниже).<br>
 
Т.к. оба компьютера полагаются равными в установлении соединения, мы 
можем назвать это соединение peer-to-peer. Чтобы продемонстрировать<br> 
это соединение мы создадим так называемое приложение-chat позволяющее двум людям общаться в реальном режиме времени.<br> <br> <br> 
 
 
Для создания UDP соединения<br> <br> 

Создайте Standard EXE проект.<br> 
   Измените свойство name формы на frmPeerA.<br> 
   Измените свойство caption формы на "Peer A"<br> 
   Перетащите с панели инструментов иконку Winsock компонента и 
разместите его на форме. Присвойте свойству name значение udpPeerA. <br> 
   Измените свойство Protocol на UDPProtocol.<br> 
   Добавьте два текстовых поля на форму.<br> 
Имя первой должно быть txtSend а второй txtOutput.<br> 
Добавьте приведенный ниже код на форму.<br> <br> 

Private Sub Form_Load()<br> 
   ' Имя Winsock элемента udpPeerA<br> 
   With udpPeerA<br> 
      ' Важно: правильно укажите значение RemoteHost<br> 
      ' компьютера, с которым предстоит соединение.<br> 
     .RemoteHost= "PeerB"<br> 
     .RemotePort = 1001 ' Имя порта для соединения.<br> 
      .Bind 1002 ' Привязка к локальному порту.<br> 
   End With<br> 
   frmPeerB.Show ' Показать вторую форму.<br> 
End Sub<br> <br> 

Private Sub txtSend_Change()<br> 
   ' Послать текст, как только он будет набран.<br> 
   udpPeerA.SendData txtSend.Text<br> 
End Sub<br> <br> 

Private Sub udpPeerA_DataArrival (ByVal bytesTotal As Long)<br> 
   Dim strData As String<br> 
   udpPeerA.GetData strData<br> 
   txtOutput.Text = strData<br> 
End Sub<br> <br> <br> 


 
 
Чтобы создать второе UDP приложение<br> <br> 

   Добавить стандартную форму в проект.<br> 
   Изменить имя формы на frmPeerB.<br> 
   Изменить свойство caption формы на "Peer B".<br> 
   Перетащить и разместить иконку Winsock компонента на форму.<br> 
   Изменить имя Winsock на udpPeerB.<br> 
   Изменить свойство Protocol на UDPProtocol.<br> 
   Добавить два текстовых поля на форму.<br> 
Имя первого должно быть txtSend, а второго txtOutput.<br> 
Добавьте следующий код в форму.<br> <br> 

Private Sub Form_Load()<br> 
   ' Имя Winsock элемента udpPeerB.<br> 
   With udpPeerB<br> 
      ' Будьте внимательны указывая имя или IP-адрес<br> 
      ' компьютера с которым предстоит соединение.<br> 
      .RemoteHost= "PeerA"<br> 
      .RemotePort = 1002 ' Номер порта для соединения.<br> 
      .Bind 1001 ' Привязка к локальному порту.<br> 
   End With<br> 
End Sub<br> <br> 

Private Sub txtSend_Change()<br> 
   ' Пересылать текст, как только он будет набран в текстовом поле.<br> 
   udpPeerB.SendData txtSend.Text<br> 
End Sub<br> <br> 

Private Sub udpPeerB_DataArrival (ByVal bytesTotal As Long)<br> 
   Dim strData As String<br> 
   udpPeerB.GetData strData<br> 
   txtOutput.Text = strData<br> 
End Sub<br> <br> <br> 


Чтобы попробовать приложение запустите проект, и наберите в текстовом поле txtSend каждой формы какой-то текст.<br> 
Этот текст появится в текстовых полях txtOutput другой формы.<br> <br> <br> 
 
 
О методе Bind<br> <br> 

Как показано в приведенном выше примере, Вы должны вызывать метод Bind, 
когда создается UDP приложение. Метод Bind резервирует локальный порт 
для использования его элементом Winsock. Например, когда Вы привязываете
 свой элемент Winsock к порту 1001, то ни одно другое приложение не 
может использовать этот порт для прослушивания. Это может быть полезным,
 когда Вы хотите воспрепятствовать какому-либо другому приложению 
использовать этот порт. Метод Bind имеет еще один необязательный 
аргумент. Если на вашем компьютере установлено более одного сетевого 
адаптера, аргумент LocalIP позволит Вам точно указать  адаптер, который 
необходимо использовать. Если Вы не укажите этот аргумент, то Winsock 
компонент будет использовать  тот сетевой адаптер, который расположен 
первым в списке, который можно посмотреть в Пуск\Настройка\Панель 
управления\Система\Сетевые платы. Когда используется UDP протокол, Вы 
можете изменять свойства RemoteHost и RemotePort пока сохраняется 
привязка к тому же самому LocalPort. Если бы Вы использовали TCP 
протокол, то прежде чем сменить свойства RemoteHost и RemotePort, 
необходимо сначала закрыть соединение.<br> <br> 

<b>Автор:</b> Oleg Palayda 
 
      <hr size="1" noshade="noshade" color="#334775">
	 <a href="http://vbrus.narod.ru/Info.htm#tab" font="" style="font-size:10pt"> Наверх </a> </ol>

                  
       <h2><a name="10"><b>10. Как заставить Winsock работать с несколькими соединениями? - VB</b></a></h2>
    <ol font="" style="font-size:10pt">
       
       
       Контрол Winsock позволяет создавать только одно соединение между 
двумя компьютерами. Однако, можно создать несколько соединений 
(несколько компьютеров к одному) путём создания нескольких экземпляров 
Winsock-а во время работы. <br> <br> 

Добавьте контрол Winsock в Вашу форму и установите его индекс в 0, затем
 добавьте следующий код в программу сервера, к которому Вы собираетесь 
создавать несколько соединений: <br> 
 <br> 
Option Explicit <br> 
Public NumSockets As Integer <br> 
'//Public Variable to track number of Connections <br>  <br> 

Private Sub Form_Load() <br> 
	Caption = Winsock1(0).LocalHostName &amp; Winsock1(0).LocalIP <br> 
	Winsock1(0).LocalPort = 1066 <br> 
	Print "Listening to " + Str(Winsock1(0).LocalPort) <br> 
	Winsock1(0).Listen <br> 
End Sub <br>  <br> 

Private Sub Winsock1_Close(Index As Integer) <br> 
	Print "Connection Closed :" &amp; Winsock1(Index).RemoteHostIP <br> 
	Winsock1(Index).Close <br> 
End Sub <br>  <br> 

Private Sub Winsock1_ConnectionRequest(Index As Integer,ByVal requestID As Long) <br> 
	Print "Connection Request from : " &amp; Winsock1(Index).RemoteHostIP <br> 
	NumSockets = NumSockets + 1 <br> 
	'//Увеличиваем количество Сокетов на один. <br> 
	Load Winsock1(NumSockets) <br> 
	'//Загружаем новый объект Winsock <br> 
	Winsock1(NumSockets).Accept requestID <br> 
	'//Ждём нового соединения <br> 
End Sub <br>  <br> 

Private Sub Winsock1_DataArrival(Index As Integer, ByVal bytesTotal As Long) <br> 
	Dim vtData As String <br> 
	Winsock1(Index).GetData vtData, vbString <br> 
	Print vtData <br> 
End Sub <br>  <br> 

Теперь Мы можем продолжать ожидать соединения. </ol></td></tr></tbody></table>
</body>
</html></p></body></html>