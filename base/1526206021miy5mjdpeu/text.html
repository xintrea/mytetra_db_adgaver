<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<html>
<h3 class="post-title entry-title" itemprop="name">
Урок 1. Эксперимент по редактированию Fluent UI.
</h3>
<div class="post-header">
<div class="post-header-line-1"></div>
</div>
<div class="post-body entry-content" id="post-body-374008281896440982" itemprop="articleBody">
<div dir="ltr" style="text-align: left;" trbidi="on">
Чтобы не перенапрягать читателя нудной теорией, мы в первом же уроке 
проведём практический эксперимент по модификации ленточного 
пользовательского интерфейса приложений Microsoft Office на примере 
Word, как наиболее распространённого приложения пакета. Замечу, что 
принципиальных отличий от Excel и PowerPoint в области модификации 
интерфейса у Word нет, поэтому всё, что справедливо для Word, можно 
применять и к другим приложениям.<br>
<br>
Текста для чтения на этом уроке будет много, но фактических действий — 
всего ничего. Несколько раз щёлкнуть мышкой, так что не пугайтесь. Весь 
остальной текст — всего лишь дополнительная информация для тех, кто 
вообще не в курсе темы.<br>
<br>
В отличие от 2007-й версии офиса, в более современных версиях (2010 и 
2013) уже кое-что можно сделать и собственными настройками ленты. 
Впрочем, далеко не всё. Поэтому этот вариант настройки мы рассматривать 
не будем — в нём и так всё предельно понятно, потому что он специально 
сделан для широких пользовательских масс. Остановимся на другом, 
низкоуровневом варианте модификации, где нам потребуется построить 
некоторые описательные конструкции на языке разметки XML, но зато нас не
 будут ограничивать рамки конкретной реализации настроек офиса.<br>
<br>
<div style="margin-left: 35.4pt;">
Небольшое отступление о том, какие преимущества даёт нам разработка 
интерфейса на XML. Одним из таковых является то, что описание интерфейса
 внедряется не в приложение, а в документ или шаблон, и поэтому может 
распространяться вместе с ним. Кроме того, для добавляемых 
пользовательских элементов посредством процедур обратного вызова можно 
динамически определять атрибуты, чего нельзя сделать через обычные 
настройки. На вкладке можно разместить не только уже существующие 
элементы или кнопки запуска макросов, но и элементы, подобные 
существующим, но наделённые своим функционалом. Также, можно 
группировать элементы при помощи элемента box, да и, пожалуй, много чего
 ещё, чего функционал стандартных настроек не позволяет.</div>
<br>
Итак, как я уже сказал выше, для построения своего интерфейса нам нужно 
его куда-то внедрять — в шаблон или документ. Думаю, проще всего нам 
создать для опытов обычный документ Word. Откроем Word и сохраним 
созданный подопытный документ на диск под любым удобным для вас именем, 
как «Документ Word (*.docx)». Замечу, что для нашей цели нельзя 
создавать документ через контекстное меню проводника, потому что таким 
способом создастся просто пустой файл с названием и правильным 
расширением, но без внутренней структуры, и нам тогда некуда будет 
внедрять свой интерфейс.<br>
<br>
Сейчас файл для опытов создан, и теперь настало время выбрать 
инструмент, который позволил бы нам построить и внедрить в созданный 
документ наш интерфейс. Сегодня в Интернете можно найти множество 
различных редакторов, делающих это, начиная с примитивной утилиты Custom
 UI Editor for Microsoft Office, и заканчивая пакетом Microsoft Visual 
Studio от того же разработчика. Существуют даже варианты в виде 
надстроек, реализующие тот же функционал. Но всё это либо неудобно, либо
 слишком сложно, либо не поддерживает русский язык, либо откровенно 
глючит, не говоря уже о том, что многое из этого платно.<br>
<br>
Среди всего этого многообразия наиболее удобным, на мой взгляд, является специализированный XML-редактор <a href="http://novikovmaxim.narod.ru/products/ribbon/ribbon.htm" target="_blank">Ribbon XML Editоr</a> (<i>известный ещё как RibbonXMLEditor или RXE</i>)
 отечественного разработчика. Этот редактор появился ещё на заре 
зарождения ленточного интерфейса, в далёком 2007 году, и до сих пор 
поддерживается и развивается. Это не какая-нибудь там надстройка, а 
полноценная программа, рассчитанная на ускоренное написание нужных нам 
XML-конструкций. Плюс ко всему прочему — редактор этот абсолютно 
бесплатный. Ещё один плюс — он не требует установки, а просто 
распаковывается из архива, и сразу же можно пользоваться.<br>
<br>
Итак, скачиваем редактор с <a href="http://novikovmaxim.narod.ru/products/ribbon/ribbon.htm" target="_blank">официального сайта</a> (<i>чтобы гарантированно получить последнюю версию</i>), распаковываем, например, в «C:\Program Files» или «C:\Program Files (x86)» (<i>в 64-битных системах</i>), и запускаем:<br>
<br>
<div class="separator" style="clear: both; text-align: center;">
<a href="1.png" imageanchor="1" style=""><img src="1.png" border="0"></a></div>
<br>
Снизу рыжая вкладка означает, что выбрано создание интерфейса версии 
2007-го офиса. Рядом расположена другая вкладка — для интерфейса 2010 
или 2013 офиса. На этом следует остановиться подробнее. Нам надо понять,
 какую версию интерфейса мы будем разрабатывать.<br>
<br>
Если мы хотим сделать наш документ совместимым со всеми версиями, 
начиная с 2007-й, то оставляем первую вкладку. Если мы хотим 
использовать дополнительные возможности по конфигурированию (например, 
сконфигурировать закулисное пространство, находящееся под ярлыком 
«Файл»), то переключаемся на вторую вкладку. Если мы хотим использовать в
 версии 2007 один интерфейс, а в версии 2010 или 2013 — другой, то нам 
надо будет прописать эти интерфейсы на обеих вкладках.<br>
<br>
Для нашего эксперимента мы воспользуемся первой вкладкой, то есть 
сделаем наши изменения интерфейса доступными для всех версий офисного 
пакета, начиная с 2007. Итак, начнём работу.<br>
<br>
Для начала открываем в редакторе созданный в Word’е документ. Для этого просто нажимаем <b>Ctrl+O</b>
 и выбираем в открывшемся окне нужный файл. Если вы привыкли работать 
мышкой, можно нажать на кнопку с папочкой в верхнем левом углу 
программы. Замечу, что все кнопки в редакторе снабжены подробными 
всплывающими подсказками, что очень удобно, особенно для новичков. На 
кнопке с папочкой как раз и всплывёт подсказка «Открыть документ», и 
будет указана комбинация клавиш для этого же действия с клавиатуры.<br>
<br>
После открытия документа его имя появится в шапке программы. Если 
документ новый, и до нас никто ничего в него не внедрял, то окно 
редактора останется пустым. В нём мы и будем писать наш XML-код, 
описывающий интерфейс.<br>
<br>
Как вы, наверное, уже могли заметить в процессе пользования ленточным 
интерфейсом, элементы в нём располагаются иерархически. На ленте 
расположены вкладки, на вкладках — группы, в группах — кнопки и другие 
элементы. При этом нельзя кнопку или другой элемент поместить сразу на 
вкладку, вне группы. Чтобы представлять себе разрешённую иерархию 
элементов в целом, можно нажать <b>F1</b>, и в открывшейся справке 
выбрать ссылку «Лента (ribbon) — схема интерфейса». Теперь, 
последовательно нажимая одну и ту же клавишу <b>F1</b>, можно переходить от схемы к коду и обратно.<br>
<br>
На схеме видно, что корнем иерархии ленты является элемент ribbon 
(собственно, лента). Внутри ленты помещается четыре вложенных элемента. 
Из них нас будет интересовать сегодня только элемент tabs (вкладки). 
Вкладки, как понятно из названия, содержат в себе, собственно, одиночные
 вкладки — tab. Каждая вкладка содержит в себе группу элементов (group),
 которая, в свою очередь, может содержать большое количество разных 
других элементов, которые я перечислять не буду — все они видны на 
схеме.<br>
<br>
Итак, начинаем конструирование. Добавляем в область текста корневой 
элемент ribbon. Для этого нажимаем кнопку с выбором действия с надписью 
«rib» вверху левой панели, но действие для кнопки не выбираем, оставляем
 по умолчанию:<br>
<br>
<div class="separator" style="clear: both; text-align: center;">
<a href="2.png" imageanchor="1" style=""><img src="2.png" border="0"></a></div>
<br>
Для интересующихся другими возможными действиями этой кнопки советую 
почитать всплывающую подсказку, из которой становится понятно, что кроме
 элемента ленты кнопка позволяет вставлять элемент commands (команды), 
который мы пока не рассматриваем:<br>
<br>
После нажатия кнопки «ribbon» в области текста тотчас же появится следующая конструкция:<br>
<br>
<p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;customUI xmlns="http://schemas.microsoft.com/office/2006/01/customui"&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    &lt;ribbon startFromScratch="false"&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        │</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    &lt;/ribbon&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;/customUI&gt;</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<br>
Давайте кратко пробежимся по ней. Первая строчка нас мало интересует, 
она присутствует для соответствия XML-кода общему стандарту, и её мы 
рассмотрим как-нибудь потом. Далее мы видим тег customUI внутри которого
 вставлен тег ribbon выбранного нами элемента. Таким образом, 
получается, что элемент ленты на самом деле не является корневым, а 
находится внутри действительно корневого элемента — customUI 
(настраиваемый пользовательский интерфейс).<br>
<br>
Корневой элемент customUI помимо ленты может включать в себя уже 
упомянутый элемент «команды», а в версиях, начиная с 2010, «контекстные 
меню» и «закулисье», находящееся под ярлыком «Файл». Но не будем 
отвлекаться, и ограничимся пока лентой.<br>
<br>
Следующим этапом, согласно схеме (<b>F1</b>), в элемент ribbon нужно 
вставить элемент tabs, и соответствующую кнопку мы как раз видим чуть 
ниже. Но мы пойдём ещё более простым путём. Чтобы каждый раз не лазить в
 схему, и не смотреть, что во что вложено, мы просто нажимаем комбинацию
 клавиш <b>Ctrl+Пробел</b>, т.е. принудительно вызываем автодополнение. 
После нажатия этого сочетания откроется список элементов, доступных 
внутри текущего элемента. Среди предложенных вариантов видим tabs. 
Выбираем его, и внутрь элемента ribbon вставляется элемент tabs, сразу 
же внутрь него — элемент tab, потому что других вариантов всё равно нет,
 а внутрь tab — group.<br>
<br>
Мы выполнили совсем мало телодвижений, а уже почти создали нужную нам 
конструкцию. Нам осталось лишь заполнить значения атрибутов (прописать 
их внутри кавычек). В атрибуты id элементов впишем прямо по-русски, к 
примеру, «мояВкладка» и «мояГруппа» соответственно, а в атрибуты label —
 «Моя вкладка» и «Моя группа».<br>
<br>
Замечу, что все идентификаторы поддерживают строки Unicode, то есть их 
можно писать и на латинице, и на кириллице, и ещё много на чём. Очень 
полезную информацию о типах строк можно получить из прекрасной справки 
Ribbon XML Editor, перейдя с главной её страницы по ссылке «Атрибуты, их
 типы и списки значений» и прокрутив на последние две таблицы. Проследив
 иерархию нужного строкового типа можно установить, какая именно строка 
допустима в строковом значении того или иного атрибута.<br>
<br>
На этом модификацию интерфейса пока закончим, и попробуем посмотреть 
вживую, что у нас получилось. Сначала нужно проверить правильность нашей
 разметки интерфейса. Для этого нажимаем клавишу <b>F7</b>, и читаем результат проверки во всплывшем окне. Вместо клавиши <b>F7</b> можно также нажать кнопку с зелёной галочкой в верхнем ряду кнопок программы:<br>
<br>
<div class="separator" style="clear: both; text-align: center;">
<a href="3.png" imageanchor="1" style=""><img src="3.png" border="0"></a></div>
<br>
Если результат проверки положителен, можно попробовать запустить 
документ на выполнение, чтобы убедиться, что наша модификация сработала.
 Для этого нажимаем клавишу <b>F9</b> (или кнопку с зелёной стрелкой, 
расположенной через две кнопки правее от кнопки с галочкой). Откроется 
Word, и мы увидим, что в конец набора вкладок добавилась новая вкладка с
 присвоенным нами именем «Моя вкладка». Если мы её откроем, то увидим и 
вставленную нами в неё группу:<br>
<br>
<div class="separator" style="clear: both; text-align: center;">
<a href="4.png" imageanchor="1" style=""><img src="4.png" border="0"></a></div>
<br>
<br>
Во время открытия документа могут проявится ошибки, которые не определились или были проигнорированы на этапе валидации (<b>F7</b>)
 в Ribbon XML Editor. Чтобы Word нам сообщал о них, следует включить в 
нём галочку напротив пункта настроек: «Файл → Параметры → Дополнительно →
 Общие → Показывать ошибки интерфейса пользователя надстроек».<br>
<br>
На этом сегодняшний урок мы закончим. Закрываем Word, затем закрываем 
Ribbon XML Editor. Если после запуска вы что-то меняли в тексте, 
последует вопрос о сохранении изменений. Подтверждаем изменения и 
закроем редактор.<br>
<br>
Сегодня мы получили общее представление о модификации ленточного 
интерфейса. На следующем уроке мы чуть глубже погрузимся в структуру 
документа, и узнаем, как в нём хранится настраиваемый пользовательский 
интерфейс для приложения.</div></div>
</body>
</html></p></body></html>