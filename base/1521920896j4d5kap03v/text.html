<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<html>
<div class="" id="api-doc-contents"><h1 id="using-activex-controls-on-sheets"><span data-ttu-id="509af-103" data-original-title="" title="" class="translation-hover" aria-describedby="popover642829">Использование элементов управления ActiveX на листах</span></h1><span><div class="gitContributors"><span class="author-bio"><a target="_blank" href="https://github.com/o365devx" aria-label="office 365 dev account"><span class="author-img" style="background-image:url('https://avatars.githubusercontent.com/u/29209169?v=3&amp;s=50')"></span></a></span><span class="username"><a target="_blank" href="https://github.com/o365devx">office 365 dev account</a></span><span class="contributorSplitter">|</span><span class="contributorsLabel">Последнее обновление: 29.09.2017</span><div id="contributorList"><span class="contributorSplitter">|</span><div class="contributors"><span class="contributorsLabel">1 Участник</span><ul><li><a target="_blank" href="https://github.com/olprod" aria-label="olprod"><span class="contributor-img" style="background-image:url('https://avatars.githubusercontent.com/u/16075726?v=3&amp;s=25')"></span></a></li></ul></div></div></div></span><div id="movileInPageNav"></div><p><span data-ttu-id="509af-104" data-original-title="" title="" class="">В этом разделе описываются конкретные сведения об использовании элементов управления ActiveX в листы и листы диаграмм.</span><span data-ttu-id="509af-105" data-original-title="" title="" class="">Общие сведения о добавлении и работа с элементами управления просмотрите <a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/using-activex-controls-on-a-document">С помощью элементов управления ActiveX в документе</a> и <a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/create-a-custom-dialog-box">Создание настраиваемого диалогового окна</a>.</span></p><p><span data-ttu-id="509af-106" data-original-title="" title="" class="">При работе с элементами управления на листах необходимо помните следующее:</span></p><ul><li><span data-ttu-id="509af-107" data-original-title="" title="" class="">Помимо
 стандартных свойств, доступных для элементов управления ActiveX, можно 
использовать следующие свойства с помощью элементов управления ActiveX в
 Microsoft Excel: <strong><a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/oleobject-bottomrightcell-property-excel">BottomRightCell</a></strong>, <strong><a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/oleobject-linkedcell-property-excel">LinkedCell</a></strong>, <strong><a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/oleobject-listfillrange-property-excel">ListFillRange</a></strong>, <strong><a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/oleobject-placement-property-excel">Размещение</a></strong>, <strong><a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/oleobject-printobject-property-excel"> Печать объекта</a></strong>, <strong><a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/oleobject-topleftcell-property-excel">TopLeftCell</a></strong>и <strong><a href="https://msdn.microsoft.com/ru-ru/vba/excel-vba/articles/oleobject-zorder-property-excel">ZOrder</a></strong>.</span></li></ul><p><span data-ttu-id="509af-108" data-original-title="" title="" class="">Эти свойства можно задать и возвращаются в имени элемента управления ActiveX.</span><span data-ttu-id="509af-109" data-original-title="" title="" class="">Следующий пример прокрутка окна книги, поэтому CommandButton1 находится в левом верхнем углу.</span></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  <span class="hljs-keyword">Set</span> t = Sheet1.CommandButton1.TopLeftCell</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="hljs-keyword">With</span> ActiveWindow</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    .ScrollRow = t.Row</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    .ScrollColumn = t.Column</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="hljs-keyword">End</span> <span class="hljs-keyword">With</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><ul><li><span data-ttu-id="509af-110" data-original-title="" title="" class="">При активации элемента управления ActiveX отключены некоторые свойства и методы Microsoft Excel Visual Basic.</span><span data-ttu-id="509af-111" data-original-title="" title="" class="">Например метод <strong>сортировки</strong>
 не может использоваться, когда элемент управления активен, поэтому 
следующие возникает ошибка кода кнопки в процедуре события click (так 
как элемент управления остаются активными при нажатии его).</span></li></ul><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  <span class="hljs-keyword">Private</span> <span class="hljs-keyword">Sub</span> CommandButton1.Click </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Range(<span class="hljs-string">"a1:a10"</span>).Sort Key1:=Range(<span class="hljs-string">"a1"</span>) </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="hljs-keyword">End</span> <span class="hljs-keyword">Sub</span> </p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">You can work around this problem by activating some other element on the sheet before you <span class="hljs-keyword">use</span> the property <span class="hljs-keyword">or</span> method that <span class="hljs-keyword">failed</span>. <span class="hljs-keyword">For</span> example, the <span class="hljs-keyword">following</span> code sorts the <span class="hljs-keyword">range</span>:</p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  <span class="hljs-keyword">Private</span> <span class="hljs-keyword">Sub</span> CommandButton1.Click </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Range(<span class="hljs-string">"a1"</span>).Activate </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Range(<span class="hljs-string">"a1:a10"</span>).Sort Key1:=Range(<span class="hljs-string">"a1"</span>) </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    CommandButton1.Activate </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="hljs-keyword">End</span> <span class="hljs-keyword">Sub</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><ul><li><p><span data-ttu-id="509af-112" data-original-title="" title="">Элементы
 управления на книги Microsoft Excel, внедренные в документ в другом 
приложении не будут работать при двойном щелчке рабочей книги для ее 
редактирования.</span><span data-ttu-id="509af-113" data-original-title="" title="">Элементы управления будет работать, если пользователь щелкает правой кнопкой мыши книгу и выбирает команду <strong>Открыть</strong> контекстное меню.</span></p></li><li><p><span data-ttu-id="509af-114" data-original-title="" title="">При сохранении книги Microsoft Excel в формате книги Microsoft Excel 5.0/95 теряются данные элемента управления ActiveX.</span></p></li><li><p><span data-ttu-id="509af-115" data-original-title="" title="">Ключевое слово <strong>Me</strong> в процедуре события для элемента управления ActiveX на листе ссылается на лист, не к элементу управления.</span></p></li></ul><h2 id="adding-controls-with-visual-basic"><span data-ttu-id="509af-116" data-original-title="" title="">Добавление элементов управления с помощью Visual Basic</span></h2><p><span data-ttu-id="509af-117" data-original-title="" title="">В Microsoft Excel элементы управления ActiveX, представлены <strong>OLEObject</strong> объектов в коллекции <strong>OLEObjects</strong> (все объекты <strong>OLEObject</strong> также находятся в коллекции <strong>фигур</strong> ).</span><span data-ttu-id="509af-118" data-original-title="" title="">Для программного добавления элемента управления ActiveX в лист, используйте метод <strong>Add</strong> коллекции <strong>OLEObjects</strong> .</span><span data-ttu-id="509af-119" data-original-title="" title="">В следующем примере добавляется кнопка команды на листе 1.</span></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Worksheets(<span class="hljs-number">1</span>).OLEObjects.Add <span class="hljs-string">"Forms.CommandButton.1"</span>, _ </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Left:=<span class="hljs-number">10</span>, Top:=<span class="hljs-number">10</span>, Height:=<span class="hljs-number">20</span>, Width:=<span class="hljs-number">100</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><h2 id="using-control-properties-with-visual-basic"><span data-ttu-id="509af-120" data-original-title="" title="">С помощью свойства элемента управления с помощью Visual Basic</span></h2><p><span data-ttu-id="509af-121" data-original-title="" title="">Чаще всего кода Visual Basic будет ссылаться на элементы управления ActiveX с именем.</span><span data-ttu-id="509af-122" data-original-title="" title="">В следующем примере изменяется заголовок элемента управления с именем «CommandButton1».</span></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Sheet1.CommandButton1.Caption = <span class="hljs-string">"Run"</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p><span data-ttu-id="509af-123" data-original-title="" title="">Обратите
 внимание, что при использовании имя элемента управления за пределами 
модуль класса для таблицы, содержащей элемент управления, необходимо 
указать имя элемента управления, с помощью имя листа.</span></p><p><span data-ttu-id="509af-124" data-original-title="" title="" class="">Чтобы
 изменить имя элемента управления, используемого в коде Visual Basic, 
выберите элемент управления и в окне Свойства задайте для свойства <strong>(имя)</strong> .</span></p><p><span data-ttu-id="509af-125" data-original-title="" title="" class="">Так как элементы управления ActiveX также представлены <strong>OLEObject</strong> объектов в коллекции <strong>OLEObjects</strong> , можно задать с помощью объектов в коллекции свойств элемента управления.</span><span data-ttu-id="509af-126" data-original-title="" title="">В следующем примере задается положение левого края элемента управления с именем «CommandButton1».</span></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Worksheets(<span class="hljs-number">1</span>).OLEObjects(<span class="hljs-string">"CommandButton1"</span>).Left = <span class="hljs-number">10</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p><span data-ttu-id="509af-127" data-original-title="" title="" class="">Возвращает объект фактического элемента управления, с помощью свойства <strong>объекта</strong> можно задать свойства элемента управления, которые не отображаются в виде свойства объекта <strong>OLEObject</strong> .</span><span data-ttu-id="509af-128" data-original-title="" title="">В следующем примере задается заголовок для CommandButton1.</span></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Worksheets(<span class="hljs-number">1</span>).OLEObjects(<span class="hljs-string">"CommandButton1"</span>). _ </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span class="hljs-built_in">Object</span>.Caption = <span class="hljs-string">"run me"</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p><span data-ttu-id="509af-129" data-original-title="" title="" class="">Так как все объекты OLE, также входят в коллекции <strong>фигур</strong> , коллекции можно использовать для настройки свойств для нескольких элементов управления.</span><span data-ttu-id="509af-130" data-original-title="" title="">Следующий пример выравнивание левого края все элементы управления на листе 1.</span></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="hljs-keyword">For</span> <span class="hljs-keyword">Each</span> s <span class="hljs-keyword">In</span> Worksheets(<span class="hljs-number">1</span>).Shapes </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span class="hljs-keyword">If</span> s.Type = msoOLEControlObject <span class="hljs-keyword">Then</span> s.Left = <span class="hljs-number">10</span> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="hljs-keyword">Next</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><h2 id="using-control-names-with-the-shapes-and-oleobjects-collections"><span data-ttu-id="509af-131" data-original-title="" title="">Имена элементов управления с помощью фигур и OLEObjects семейств сайтов</span></h2><p><span data-ttu-id="509af-132" data-original-title="" title="" class="">Элемент управления ActiveX на листе имеет два имени: имя, который содержит элемент управления, который можно просмотреть в поле <strong>имя</strong> при просмотре листа и имя кода для элемента управления, который можно просматривать в ячейке справа от <strong>(имя)</strong> в свойств фигуры окно ES.</span><span data-ttu-id="509af-133" data-original-title="" title="">При первом добавлении элемента управления в лист, соответствующие имени фигуры и с кодовым именем.</span><span data-ttu-id="509af-134" data-original-title="" title="" class="">Тем не менее если изменить код имени или имени фигуры, другой не изменяется автоматически в соответствии с.</span></p><p><span data-ttu-id="509af-135" data-original-title="" title="">Использование кода имя элемента управления в именах его процедур обработки событий.</span><span data-ttu-id="509af-136" data-original-title="" title="" class="">Тем не менее при вернуть элемент управления из коллекции <strong>фигур</strong> или <strong>OLEObjects</strong> для листа, необходимо использовать имя фигуры, а не имя кода, для ссылки на элемент управления по имени.</span><span data-ttu-id="509af-137" data-original-title="" title="">Например предположим, что флажок Добавить в лист и наличия CheckBox1 фигуры имя по умолчанию и имя кода по умолчанию.</span><span data-ttu-id="509af-138" data-original-title="" title="" class="">Нажмите, чтобы изменить имя элемента управления кода с помощью следующей команды <strong>chkFinished</strong> рядом с пунктом <strong>(имя)</strong>
 в окне Свойства, необходимо использовать chkFinished в процедуру имен 
событий, но по-прежнему необходимо использовать CheckBox1 возвращает 
элемент управления из <strong>фигур</strong> или ** OLEObject** семейства сайтов, как показано в следующем примере.</span></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="hljs-keyword">Private</span> <span class="hljs-keyword">Sub</span> chkFinished_Click() </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    ActiveSheet.OLEObjects(<span class="hljs-string">"CheckBox1"</span>).<span class="hljs-built_in">Object</span>.Value = <span class="hljs-number">1</span> </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span class="hljs-keyword">End</span> <span class="hljs-keyword">Sub</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></div>
</body>
</html></p></body></html>