<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Создаем свою панель инструментов.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В новом офисе, начиная с версии 2007, внедрена новая панель инструментов RibbonUI. Но к сожалению, в VBA не создали средств для создания и редактирования новой панели. Это создает определенные неудобства для разработчиков.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рассмотрим <span style=" font-weight:600;">способы создания собственной панели инструментов</span>:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">1. Встроенными средствами приложений MS Office.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Можно легко и быстро создать свою панель инструментов и настроить привязку запуска макросов к определенным кнопкам. Но данный способ обладает следующими недостатками: панель запускается всегда на вашем компьютере, но на другом компьютере панель не запускается. Для того чтобы корректно выполнялись макросы, требуется одновременный запуск файла с макросами. Данный способ подходит, если вы создаете индивидуальную надстройку с макросами, и создаете на своем компьютере панель инструментов. Но что делать, если вы пожелаете поделиться своей надстройкой с привязанными макросами из панели инструментов. Или вы пожелаете создать временную панель инструментов для определенной книги с макросами. В этом случае воспользуемся следующим способом.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">2. С помощью внешнего редактора.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Воспользуемся внешним редактором <span style=" font-weight:600;">Office Custom UI Editor</span> для создания панели инструментов. Рекомендую воспользоваться редактором, на который ссылается официальный сайт microsoft:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://msdn.microsoft.com/ru-ru/library/office/ee691832(v=office.14).aspx"><span style=" text-decoration: underline; color:#0000ff;">https://msdn.microsoft.com/ru-ru/library/office/ee691832(v=office.14).aspx</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На указанной странице есть ссылка на ресурс:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://openxmldeveloper.org/blog/b/openxmldeveloper/archive/2009/08/06/7293.aspx"><span style=" text-decoration: underline; color:#0000ff;">http://openxmldeveloper.org/blog/b/openxmldeveloper/archive/2009/08/06/7293.aspx</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Скачиваем дистрибутив:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://openxmldeveloper.org/cfs-file.ashx/__key/communityserver-components-postattachments/00-00-00-72-93/OfficeCustomUIEditorSetup.zip"><span style=" text-decoration: underline; color:#0000ff;">http://openxmldeveloper.org/cfs-file.ashx/__key/communityserver-components-postattachments/00-00-00-72-93/OfficeCustomUIEditorSetup.zip</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">С помощью данного редактора открываем необходимый файл с макросами или надстройку и создаем панель инструментов. Настраиваем привязку запускаемых макросов к определенным кнопкам панели инструментов.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рекомендую указывать тип панели = “временный”. Таким образом панель будет создаваться, только когда пользователь будет открывать ваш файл с макросами (или надстройку). Если пользователь откажется от вашего файла, то будет запускаться стандартная панель инструментов.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создаем свою панель инструментов с помощью XML.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Структура документа:</span><br />1. Разметка<br />2. Панель инструментов<br />3. Группа (группы) кнопок<br />4. Кнопа (кнопки)</p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">&lt;customUI [.. </span><span style=" font-family:'Courier New'; color:#0000ff;">параметры разметки</span><span style=" font-family:'Courier New';">..]&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">   &lt;ribbon &gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">      &lt;tabs &gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">         &lt;tab [.. </span><span style=" font-family:'Courier New'; color:#0000ff;">параметры панели</span><span style=" font-family:'Courier New';"> ..]&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">            &lt;group [.. </span><span style=" font-family:'Courier New'; color:#0000ff;">параметры группы</span><span style=" font-family:'Courier New';"> ..]&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">               &lt;button [.. </span><span style=" font-family:'Courier New'; color:#0000ff;">параметры кнопки</span><span style=" font-family:'Courier New';"> ..]/&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">            &lt;/group &gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">         &lt;/tab &gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">      &lt;/tabs &gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">   &lt;/ribbon &gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">&lt;/customUI &gt;</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Параметры разметки:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">xmlns=”http://schemas.microsoft.com/office/2006/01/customui”</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Параметры панели:<br />ID=”Panel1″<br />label=”Моя панель”</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Параметры группы:<br />id=”Group1″<br />label=”Первая”</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Параметры кнопки:<br />id=”Button1″<br />label=”Привет”<br />imageMso=”HappyFace”<br />size=”large”<br />onAction=”MacroHelloWord”</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пример простой панели инструментов:</p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">&lt;customUI xmlns=&quot;http://schemas.microsoft.com/office/2006/01/customui&quot;&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';"> &lt;ribbon&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">  &lt;tabs&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">   &lt;tab id=&quot;Panel1&quot; label=&quot;Моя панель&quot;&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">    &lt;group id=&quot;Group1&quot; label=&quot;Первая&quot;&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">     &lt;button id=&quot;Button1&quot; label=&quot;Привет&quot; imageMso=&quot;HappyFace&quot; size=&quot;large&quot; onAction=&quot;MacroHelloWorld&quot; /&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">     &lt;/group&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">    &lt;/tab&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">  &lt;/tabs&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';"> &lt;/ribbon&gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">&lt;/customUI&gt;</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для того чтобы работала кнопка, необходимо, чтобы файл содержал макрос <span style=" color:#0000ff;">MacroHelloWorld</span>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Кому интересно, можно почитать на сайте <a href="https://msdn.microsoft.com/en-us/library/dd905264(v=office.12).aspx"><span style=" text-decoration: underline; color:#0000ff;">MSDN</span></a></p></body></html>