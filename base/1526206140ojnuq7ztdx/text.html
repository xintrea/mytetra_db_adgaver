<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<html>
<div class="post hentry uncustomized-post-template" itemscope="itemscope" itemtype="http://schema.org/BlogPosting"><h3 class="post-title entry-title" itemprop="name">
Урок 10. Создание простейшей надстройки.
</h3>
<div class="post-header">
<div class="post-header-line-1"></div>
</div>
<div class="post-body entry-content" id="post-body-2122775994292570675" itemprop="articleBody">
<div dir="ltr" style="text-align: left;" trbidi="on">
Конструирование интерфейсов чаще всего используется при создании 
надстроек. Надстройка представляет собой невидимый документ со 
встроенным VBA-кодом и с собственными дополнениями к интерфейсу, 
автоматически открываемый приложением при запуске. При запуске он не 
показывает своё тело (т.е. содержимое документа <span style="font-family: &quot;Times New Roman&quot;,serif; font-size: 12.0pt; mso-ansi-language: RU; mso-bidi-language: AR-SA; mso-fareast-font-family: Calibri; mso-fareast-language: EN-US; mso-fareast-theme-font: minor-latin;">—</span>
 текст, рисунки и пр.), а проявляется только своими изменениями в 
интерфейсе и подключенными макросами. Таким образом, приложение 
Microsoft Office дополняет свой функционал, и позволяет редактировать 
другие документы, используя вновь полученные функции.<br>
<br>
Документ надстройки для Word имеет расширение .dotm. Фактически, 
надстройка для Word является обычным шаблоном с поддержкой макросов. Для
 надстроек Excel и PowerPoint имеются отдельные расширения — .xlam и 
.ppam соответственно. <br>
<br>
Замечу, что надстройки .xlam и .ppam просто так не открываются в 
приложениях в качестве документа для редактирования, поэтому пока такая 
надстройка не готова, её сохраняют как обычный документ с поддержкой 
макросов. А вот шаблон .dotm можно открыть в Word именно как шаблон (по 
крайней мере, Ribbon XML Editor это делает), поэтому его можно сохранять
 шаблоном и в процессе разработки надстройки. Однако, я всё же 
рекомендую действовать единообразно, и исходники надстроек всегда 
держать в формате обычных документов с поддержкой макросов, и переводить
 их в шаблоны или надстройки только после полного окончания их 
разработки.<br>
<br>
Итак, давайте попробуем построить надстройку Word, которая будет 
выглядеть, как отдельная вкладка, и содержать группу с кнопками, 
выполняющими некоторые действия. Пусть это будут некие действия с 
пробелами. Замечу, что процесс создания надстройки Excel ничем не 
отличается от создания надстройки Word и, умея создавать одно, вы будете
 уметь создавать другое.<br>
<br>
Откроем Ribbon XML Editor, откроем в нём наш подопытный документ, и в 
окно для 2007-го интерфейса скопируем текст интерфейса нашей надстройки:<br>
<br>
<p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;customUI xmlns="http://schemas.microsoft.com/office/2006/01/customui"&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    &lt;ribbon startFromScratch="false"&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        &lt;tabs&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">            &lt;tab id="Вкладка1" label="Полезные надстройки" insertBeforeMso="TabHome" keytip="Н"&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                &lt;group id="РаботаСПробелами" label="Работа с пробелами"&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                    &lt;button </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        id="УдалитьПовторяющиесяПробелы" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        onAction="УдалитьПовторяющиесяПробелы" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        label="Удалить повторяющиеся пробелы" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        keytip="У" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        imageMso="WordArtSpacingMenu" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        size="large" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        screentip="Удалить повторяющиеся пробелы" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        supertip="Найти и заменить все повторяющиеся пробелы одним"/&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                    &lt;button </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        id="ПробелыВПереносыСтрок" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        onAction="ПробелыВПереносыСтрок" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        label="Пробелы в переносы строк" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        keytip="ПС" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        imageMso="PivotExpandField" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        size="large" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        screentip="Пробелы в переносы строк" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        supertip="Найти и заменить все пробелы переносом строки"/&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                    &lt;button </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        id="ПереносыСтрокВПробелы" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        onAction="ПереносыСтрокВПробелы" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        label="Переносы строк в пробелы" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        keytip="СП" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        imageMso="PivotCollapseField" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        size="large" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        screentip="Переносы строк в пробелы" </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                        supertip="Найти и заменить все переносы строк пробелами"/&gt;                        </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">                &lt;/group&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">            &lt;/tab&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        &lt;/tabs&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    &lt;/ribbon&gt;</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&lt;/customUI&gt;</p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<br>
Ознакомьтесь с кодом интерфейса. Тут всё просто. Надстройка добавляет 
новую вкладку, и располагает на ней группу работы с пробелами, 
содержащую три кнопки. Для упрощения примера, в качестве иконок для 
кнопок я использовал максимально подходящие встроенные изображения. Вы 
можете использовать вместо них свои собственные, вы это уже умеете.<br>
<br>
Первая кнопка удаляет все повторяющиеся пробелы. Довольно полезная 
функция, учитывая то, что правильная вёрстка в Word вообще не 
предполагает идущих подряд пробелов. Вторая кнопка преобразует все 
пробелы в переносы строк, а третья — обратное действие, т.е. переносы 
строк в пробелы. Тоже нужная функция для работы с последовательностями 
различных лексем.<br>
<br>
Сгенерируем функции обратного вызова (<b>Alt+F11</b>). Скопируем шаблоны
 в буфер обмена (обращаем внимание на раскладку клавиатуры во избежание 
появления кракозябр). Закроем окно шаблонов и запустим документ. 
Перейдём в редактор Бейсика (<b>Alt+F11</b>) и вставим взятые в буфер обмена шаблоны функций вместо наших старых функций модуля RibbonCallbacks.<br>
<br>
Теперь осталось написать на Бейсике нужные команды. Очевидно, нам 
понадобится функция поиска и замены. С помощью штатной функции записи 
макросов я выяснил, каким кодом осуществляется поиск и замена, и 
организовал это в виде отдельной функции, которую мы будем использовать 
внутри наших функций обратного вызова.<br>
<br>
Итак, вставляем в код новую функцию:<br>
<br>
<p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'НайтиИЗаменить (компонент: button, атрибут: onAction), 2007</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Sub НайтиИЗаменить(findString As String, replaceString As String)</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    With Selection.Find</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .ClearFormatting</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .Replacement.ClearFormatting</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .Text = findString</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .Replacement.Text = replaceString</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .Forward = True</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .Wrap = wdFindContinue</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .Format = False</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .MatchCase = False</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .MatchWholeWord = False</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .MatchWildcards = False</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .MatchSoundsLike = False</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .MatchAllWordForms = False</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        .Execute Replace:=wdReplaceAll</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    End With </p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub</p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<br>
Функция принимает на вход строку для поиска и строку для замены, а 
внутри функции вставлен код из макроса, который записывался во время 
реального поиска и замены. Несомненно, в нём много лишнего, так как все 
эти параметры наверняка имеют значения по умолчанию. Тем не менее, для 
надёжности я оставил всё как есть — хуже уж точно не будет.<br>
<br>
Теперь заполняем шаблоны процедур обратного вызова:<br>
<br>
<p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'УдалитьПовторяющиесяПробелы (компонент: button, атрибут: onAction), 2007</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Sub УдалитьПовторяющиесяПробелы(control As IRibbonControl)</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Dim NumCharsBefore As Long, NumCharsAfter As Long</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Do</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        NumCharsBefore = ActiveDocument.Characters.Count</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        Call НайтиИЗаменить("  ", " ")</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        NumCharsAfter = ActiveDocument.Characters.Count</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Loop Until NumCharsBefore = NumCharsAfter</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub</p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'ПробелыВПереносыСтрок (компонент: button, атрибут: onAction), 2007</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Sub ПробелыВПереносыСтрок(control As IRibbonControl)</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Call НайтиИЗаменить(" ","^p")</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub</p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">'ПереносыСтрокВПробелы (компонент: button, атрибут: onAction), 2007</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Sub ПереносыСтрокВПробелы(control As IRibbonControl)</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Call НайтиИЗаменить("^p", " ")</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    Call НайтиИЗаменить("^w^p", "")</p><p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub</p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<br>
Как видите, код элементарен, ничего сложного. В первой функции мы 
организовываем цикл, в котором сдвоенные пробелы меняем на одинарные, и 
который будет выполняться до тех пор, пока при очередной его итерации 
размер текста до и после поиска и замены не останется равным. Это будет 
означать, что сдвоенных пробелов в тексте уже не осталось.<br>
<br>
Две последние функции ещё более элементарны. Там просто вызывается наша 
функция по поиску и замене, которая меняет пробел на символ абзаца (^p) 
или наоборот. В последнем случае мы ещё и удаляем появившийся в конце 
текста из-за неубирающегося символа абзаца лишний пробел (^w — чистое 
пространство, например, пробелы или табуляция).<br>
<br>
Сохраняем код, закрываем редактор Бейсика и сразу проверяем работу 
кнопок в документе. Замечу, что закрывать редактор Бейсика не 
обязательно, можно просто сохранить в нём изменения и переключиться в 
окно документа. Если кнопки заработали, как надо, сохраняем документ как
 шаблон с макросами (.dotm) в папку:<br>
<br>
<p style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">C:\Users\[ИмяПользователя]\AppData\Roaming\Microsoft\Word\STARTUP</p><p style="-qt-paragraph-type:empty; margin-top:0px; background-color:#eff0f1; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; font-size:10px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<br>
Теперь добавим нашу надстройку. Закрываем всё, открываем Word, лезем в 
Файл -&gt; Параметры -&gt; Надстройки -&gt; Управление, выбираем  
«Надстройки Word» и нажимаем кнопку «Перейти». В открывшемся окне на 
первой же вкладке нажимаем «Добавить…» и выбираем наш файл. Нажимаем 
«ОК», и наша надстройка начинает действовать.</div>
<div style="clear: both;"></div>
</div>
<div class="post-footer">
<div class="post-footer-line post-footer-line-1">
<span class="post-author vcard">
<span class="fn" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">

<a href="https://www.blogger.com/profile/15132597310126998409" rel="author" title="author profile">
<span itemprop="name">dolbodub</span>
</a>
</span>
</span>
<span class="post-timestamp">
на

<a class="timestamp-link" href="http://fluentui.blogspot.ru/2015/03/10.html?m=1" rel="bookmark" title="permanent link"><abbr class="published" itemprop="datePublished" title="2015-03-07T14:52:00+03:00">14:52</abbr></a>
</span>
<span class="post-comment-link">
</span>
</div>
<div class="post-footer-line post-footer-line-2">
<div class="mobile-link-button goog-inline-block" id="mobile-share-button">
<a href="javascript:void(0);">Поделиться</a>
</div>
<div class="goog-inline-block dummy-container"><div style="text-indent: 0px; margin: 0px; padding: 0px; background: transparent none repeat scroll 0% 0%; border-style: none; float: none;  font-size: 1px; vertical-align: baseline; display: inline-block; width: 32px; height: 20px;" id="___plusone_0"><iframe ng-non-bindable="" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 32px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" tabindex="0" vspace="0" id="I0_1526205969228" name="I0_1526205969228" src="1.png" data-gapiattached="true" title="G+" frameborder="0" width="100%"></iframe></div></div>
</div>
</div>
</div>
<div class="comments" id="comments">
<a name="comments"></a>
<h4>4 комментария:</h4>
<div class="comments-content">


<div id="comment-holder">

<div id="bc_0_5C" kind="c"><div id="bc_0_5CT"><div id="bc_0_4T" class="comment-thread" kind="r" t="0" u="0"><ol id="bc_0_4TB"><li id="bc_0_1B" class="comment" kind="b"><div class="avatar-image-container"><img src="2.png"></div><div id="c2482103396324296512" class="comment-block"><div id="bc_0_1M" class="comment-header" kind="m"><cite class="user">Анонимный</cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://fluentui.blogspot.com/2015/03/10.html?showComment=1434540506554&amp;m=1#c2482103396324296512">17 июня, 2015 14:28</a></span></div><p id="bc_0_1MC" class="comment-content">В функциях ПробелыВПереносыСтрок и ПереносыСтрокВПробелы какие то проблемы с кавычками.<br> VBA они почему то не нравятся, возможно что то со шрифтом, у Вас на сайте ^p тоже выделились как то не правильно<br>Вообще ресурс отличный, большое спасибо ;-)</p><span id="bc_0_1MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Ответить</a></span></div><div id="bc_0_1BR" class="comment-replies"><span id="bc_0_1b+seedCDLZD" kind="d"><div id="bc_0_0T" class="comment-thread inline-thread" kind="t" t="0" u="0"><span id="bc_0_0TT" class="thread-toggle thread-expanded" kind="g"><span id="bc_0_0TA" class="thread-arrow"></span><span id="bc_0_0TN" class="thread-count"><a href="javascript:;" target="_self">Ответы</a><div id="bc_0_0TD" class="thread-dropContainer thread-expanded"><span class="thread-drop"></span></div></span></span><ol id="bc_0_0TC" class="thread-chrome thread-expanded"><div><li id="bc_0_0B" class="comment" kind="b"><div class="avatar-image-container"><img src="3.png"></div><div id="c7296094269093002358" class="comment-block"><div id="bc_0_0M" class="comment-header" kind="m"><cite class="user blog-author"><a rel="nofollow" href="https://www.blogger.com/profile/15132597310126998409">dolbodub</a></cite><span class="icon user blog-author"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://fluentui.blogspot.com/2015/03/10.html?showComment=1434565600839&amp;m=1#c7296094269093002358">17 июня, 2015 21:26</a></span></div><p id="bc_0_0MC" class="comment-content">Спасибо за замеченную ошибку, исправил!</p><span id="bc_0_0MN" class="comment-actions secondary-text" kind="m"></span></div><div id="bc_0_0BR" class="comment-replies"></div><div id="bc_0_0B_box" class="comment-replybox-single"></div></li></div><div id="bc_0_0I" class="continue" kind="ci"><a href="javascript:;" target="_self">Ответить</a></div></ol><div id="bc_0_0T_box" class="comment-replybox-thread"></div></div></span></div><div id="bc_0_1B_box" class="comment-replybox-single"></div></li><li id="bc_0_3B" class="comment" kind="b"><div class="avatar-image-container"><img src="4.png"></div><div id="c8491837323687730155" class="comment-block"><div id="bc_0_3M" class="comment-header" kind="m"><cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/13357728351184639665">Алексей Мальков</a></cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://fluentui.blogspot.com/2015/03/10.html?showComment=1444220578343&amp;m=1#c8491837323687730155">07 октября, 2015 15:22</a></span></div><p id="bc_0_3MC" class="comment-content">Такой
 интересный вопрос: а как отключить надстройку. Если снимать галочку, 
она пропадает, но при перезагрузке появляется. Кнопка Удалить... не 
активна.<br>Файл удалять что ли?</p><span id="bc_0_3MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Ответить</a></span></div><div id="bc_0_3BR" class="comment-replies"><span id="bc_0_3b+seedCDLbD" kind="d"><div id="bc_0_2T" class="comment-thread inline-thread" kind="t" t="0" u="0"><span id="bc_0_2TT" class="thread-toggle thread-expanded" kind="g"><span id="bc_0_2TA" class="thread-arrow"></span><span id="bc_0_2TN" class="thread-count"><a href="javascript:;" target="_self">Ответы</a><div id="bc_0_2TD" class="thread-dropContainer thread-expanded"><span class="thread-drop"></span></div></span></span><ol id="bc_0_2TC" class="thread-chrome thread-expanded"><div><li id="bc_0_2B" class="comment" kind="b"><div class="avatar-image-container"><img src="3.png"></div><div id="c2454605305115550351" class="comment-block"><div id="bc_0_2M" class="comment-header" kind="m"><cite class="user blog-author"><a rel="nofollow" href="https://www.blogger.com/profile/15132597310126998409">dolbodub</a></cite><span class="icon user blog-author"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://fluentui.blogspot.com/2015/03/10.html?showComment=1444256059907&amp;m=1#c2454605305115550351">08 октября, 2015 01:14</a></span></div><p id="bc_0_2MC" class="comment-content">Я
 тоже столкнулся с этим. Можно создать вложенную папку, и перемещать 
файлы туда. Я в это глубоко не вникал, но, вероятно, можно создавать 
файлы не в STARTUP а в другой папке, и тогда они не будут подключаться 
автоматически при перезагрузке. По крайней мере, это было бы логично.</p></div></li></div></ol></div></span></div></li></ol></div></div></div></div></div></div>
</body>
</html></p></body></html>