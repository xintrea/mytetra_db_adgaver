<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/tools/FTP"><span style=" text-decoration: underline; color:#0000ff;">Работа с FTP из VBA (без использования WinAPI)</span></a> </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/tools"><span style=" text-decoration: underline; color:#0000ff;">Инструменты разработчика VBA</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/taxonomy/term/14"><span style=" text-decoration: underline; color:#0000ff;">Макросы VBA Excel</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/downloads"><span style=" text-decoration: underline; color:#0000ff;">Скачивание файлов</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/another"><span style=" text-decoration: underline; color:#0000ff;">Разное</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/internet"><span style=" text-decoration: underline; color:#0000ff;">Интернет</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/password"><span style=" text-decoration: underline; color:#0000ff;">Логин и пароль</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/internet/FTP"><span style=" text-decoration: underline; color:#0000ff;">Работа с FTP</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/text"><span style=" text-decoration: underline; color:#0000ff;">Текстовые файлы</span></a></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/class"><span style=" text-decoration: underline; color:#0000ff;">Модули класса</span></a></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/files"><span style=" text-decoration: underline; color:#0000ff;">Работа с файлами</span></a> </li></ul></td></tr></table>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Представляю вашему вниманию инструментарий для работы с файлами по FTP, не требующий использования системных функций (WinAPI)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как известно, <span style=" font-weight:600;">отправить файл на FTP сервер (или загрузить файл с FTP, создать папку на FTP сервере, и т.д.) можно при помощи таких API-функций</span> из библиотеки <span style=" font-weight:600; font-style:italic;">wininet.dll</span>, как <span style=" font-weight:600; font-style:italic;">FtpPutFile, FtpGetFile, FtpRenameFile, FtpDeleteFile, FtpRemoveDirectory, FtpCreateDirectory, FtpFindFirstFile</span> и т.д.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как именно использовать эти функции - можете посмотреть в коде <a href="http://excelvba.ru/programmes/FTP_for_Excel"><span style=" text-decoration: underline; color:#0000ff;">надстройки для отправки файлов Excel на FTP сервер</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">В чем недостаток этого способа - так это в необходимости обеспечения совместимости кода с различными платформами</span>.<br />В частности, чтобы код с функциями API работал и в <span style=" font-weight:600;">Office 2010</span>, и в <span style=" font-weight:600;">64-битной Windows</span>, необходимо <a href="http://excelvba.ru/articles/WinAPI"><span style=" text-decoration: underline; color:#0000ff;">заметно увеличить объём кода</span></a>. А, поскольку описание этих функций из <span style=" font-weight:600; font-style:italic;">wininet.dll</span> и без того занимает много места (а универсальный код вообще займёт сотню строк), да и надо ещё и разбираться во всех этих функциях, т.к. в разных версиях Windows возможны различия в способе вызова функций из wininet.dll, и <span style=" font-weight:600;">были созданы аналоги этих функций для работы с FTP, не использующие WinAPI</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сподвигла меня на это решение необходимость реализации <a href="http://excelvba.ru/programmes/AddinUpdater"><span style=" text-decoration: underline; color:#0000ff;">средств обновления надстроек Excel</span></a>, где необходимо было реализовать функционал отправки файлов Excel на FTP сервер, причем так, чтобы это стабильно работало на всех компьютерах. Попутно, кстати, родилась и <a href="http://excelvba.ru/code/DownloadFile"><span style=" text-decoration: underline; color:#0000ff;">функция загрузки файла с сервера без использования WinAPI</span></a>, которая тоже вошла в состав данного инструментария.</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Основу предлагаемого мной решения составляет модуль класса </span><span style=" font-size:x-large; font-weight:600; color:#ff0000;">FTPcommander</span><span style=" font-size:x-large; font-weight:600;">, который предоставляет вам следующие функции:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Function DownloadFile(ByVal FtpFolder$, ByVal FtpFilename$, ByVal LocalPath$) As Boolean</span><br />(Функция скачивает файл с FTP-сервера с именем FtpFilename$ из папки FtpFolder$. Скачанный файл сохраняется на компьютере под именем (и по пути) LocalPath$. Функция возвращает TRUE, если загрузка файла завершилась успешно)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Function UploadFile(ByVal LocalPath$, Optional ByVal FtpFolder$, Optional ByVal FtpFilename$ = &quot;&quot;) As String</span><br />(Функция загружает файл LocalPath$ по FTP на сервер в папку FtpFolder$. Если задан параметр FtpFilename$, отправленный файл получает имя FtpFilename$. Функция возвращает ссылку на файл, если закачка файла завершилась успешно)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Function CreateNewFolder(ByVal FtpFolder$) As Boolean</span><br />(Функция создаёт папку FtpFolder$ на FTP сервере. Возвращает TRUE, если папка была успешно создана, или существовала ранее)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Function DeleteFile(ByVal FtpFolder$, ByVal FtpFilename$) As Boolean</span><br />(Функция создаёт папку FtpFolder$ на FTP сервере. Возвращает TRUE, если папка была успешно создана, или существовала ранее)</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Function DownloadFileFromURL(ByVal URL$, ByVal LocalPath$) As Boolean</span><br />(Функция скачивает файл по ссылке URL$, и сохраняет его по пути LocalPath$. Возвращает TRUE, если файл был успешно загружен)</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функция <span style=" font-weight:600;">GetLastError</span> возвращает информацию об ошибке, если некая функция была завершена некорректно (возвратила FALSE)</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Дополнительно в составе модуля класса есть <a href="http://excelvba.ru/code/txt"><span style=" text-decoration: underline; color:#0000ff;">функции чтения и записи текстовых файлов ReadTXTfile и SaveTXTfile</span></a>, а также <a href="http://excelvba.ru/code/Encode"><span style=" text-decoration: underline; color:#0000ff;">функции перекодировки файлов и текста ChangeFileCharset и ChangeTextCharset</span></a></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Как использовать модуль класса FTPcommander для работы с файлами по FTP:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1) Откройте прикреплённый к статье файл Excel, и мышом перетащите модуль класса <span style=" font-weight:600;">FTPcommander</span> в свой файл</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2) Пропишите настройки FTP аккаунта в специальной функции, или сохраните их в реестре Windows<br />(подробнее об этом - ниже)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3) В своём макросе создаёте экземпляр класса <span style=" font-weight:600;">FTPcommander</span>, и используете его методы для работы с файлами<br />Создать экземпляр класса вам поможет следующий код:  <span style=" font-weight:600;">Dim FTP As New FTPcommander<br />Примеры макросов отправки и скачивания файлов доступны в прикреплённом файле </span>(в модуле mod_TestFTP):</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот один из примеров использования класса FTPcommander:</p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Private</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> ЗагрузкаФайлаНаFTPсервер()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Этот макрос загружает файл &quot;C:\ПЖиВ.jpg&quot; в корневую папку FTP сервера,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' переименовывая файл в &quot;ER&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Dim</span><span style=" font-family:'monospace';"> FTP </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">New</span><span style=" font-family:'monospace';"> FTPcommander</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    Link$ = FTP.UploadFile(</span><span style=" font-family:'monospace'; color:#800000;">&quot;C:\ПЖиВ.jpg&quot;</span><span style=" font-family:'monospace';">, , </span><span style=" font-family:'monospace'; color:#800000;">&quot;ER&quot;</span><span style=" font-family:'monospace';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' В переменную Link$ возвращается ссылка вида &quot;http://u3661.seiko.vps-private.net/ER&quot;,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' по которой доступен загруженный через FTP файл</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как видите, всего 2 строки кода, - и ваш файл оказался загружен на FTP сервер.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ещё один пример использования:</p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Private</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> ЗагрузкаСПоследующимСкачиваниемФайла()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Dim</span><span style=" font-family:'monospace';"> FTP </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">New</span><span style=" font-family:'monospace';"> FTPcommander</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    fn$ = </span><span style=" font-family:'monospace'; color:#800000;">&quot;C:\Documents and Settings\Admin\Рабочий стол\stamp.png&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' отправляем файл с рабочего стола на FTP сервер</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' (на сервере файл получит имя &quot;1 2 3.png&quot;)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    Link$ = FTP.UploadFile(fn$, , </span><span style=" font-family:'monospace'; color:#800000;">&quot;1 2 3.png&quot;</span><span style=" font-family:'monospace';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> Len(Link$) </span><span style=" font-family:'monospace'; color:#000080;">Then</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Загруженный файл доступен по ссылке: &quot;</span><span style=" font-family:'monospace';">, Link$</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Ошибка: &quot;</span><span style=" font-family:'monospace';">, FTP.GetLastError</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">If</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' а теперь скачиваем с сервера ранее загруженный файл &quot;1 2 3.png&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Скачанный файл окажется в той же папке (Рабочий стол),</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' и получит имя &quot;stamp.png222&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    res = FTP.DownloadFile(</span><span style=" font-family:'monospace'; color:#800000;">&quot;&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;1 2 3.png&quot;</span><span style=" font-family:'monospace';">, fn$ &amp; </span><span style=" font-family:'monospace'; color:#800000;">&quot;222&quot;</span><span style=" font-family:'monospace';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">If</span><span style=" font-family:'monospace';"> res </span><span style=" font-family:'monospace'; color:#000080;">Then</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Файл успешно загружен с FTP&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        Debug.</span><span style=" font-family:'monospace'; color:#000080;">Print</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#800000;">&quot;Ошибка: &quot;</span><span style=" font-family:'monospace';">, FTP.GetLastError</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">If</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Есть 2 способа задать настройки FTP аккаунта для использования объектом FTPcommander:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#ff0000;">1 способ</span><span style=" font-weight:600;"> - один раз запустить макрос следующего вида:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> Save_FTP_Account_Information()    </span><span style=" font-family:'monospace'; color:#008000;">' достаточно запустить ОДИН РАЗ!</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' Cохраняем в реестре Windows настройки FTP-аккаунта по-умолчанию</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    SaveSetting Application.Name, </span><span style=" font-family:'monospace'; color:#800000;">&quot;FTP&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;Host&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;Имя или IP адрес сервера FTP&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    SaveSetting Application.Name, </span><span style=" font-family:'monospace'; color:#800000;">&quot;FTP&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;Login&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;Имя пользователя (логин)&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    SaveSetting Application.Name, </span><span style=" font-family:'monospace'; color:#800000;">&quot;FTP&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;Password&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;Пароль к FTP серверу&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    SaveSetting Application.Name, </span><span style=" font-family:'monospace'; color:#800000;">&quot;FTP&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;BaseFolder&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;путь к стартовой папке, например, /www/&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    SaveSetting Application.Name, </span><span style=" font-family:'monospace'; color:#800000;">&quot;FTP&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;BaseURL&quot;</span><span style=" font-family:'monospace';">, </span><span style=" font-family:'monospace'; color:#800000;">&quot;http://Адрес Вашего Сайта, куда будут закачиваться файлы/&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Этот макрос запишет все необходимые настройки в реестр Windows, и впоследствии будет брать их оттуда</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Преимущество этого способа:</span> один раз запустили макрос, потом удалили его, - и можно нигде в коде не прописывать секретные данные FTP аккаунта</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Недостаток этого способа:</span> при хранении настроек в реестре, возможен доступ только к одному FTP серверу</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#ff0000;">2 способ</span><span style=" font-weight:600;"> - для инициализации объекта FTPcommander использовать специальные функции с настройками:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Function</span><span style=" font-family:'monospace';"> MyFTPaccount() </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> FTPcommander</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#008000;">' возвращает объект типа FTPcommander, с нужными настройками</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Set</span><span style=" font-family:'monospace';"> MyFTPaccount = </span><span style=" font-family:'monospace'; color:#000080;">New</span><span style=" font-family:'monospace';"> FTPcommander</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">With</span><span style=" font-family:'monospace';"> MyFTPaccount</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .Host = </span><span style=" font-family:'monospace'; color:#800000;">&quot;Имя или IP адрес сервера FTP&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .Login = </span><span style=" font-family:'monospace'; color:#800000;">&quot;Имя пользователя (логин)&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .Password = </span><span style=" font-family:'monospace'; color:#800000;">&quot;Пароль к FTP серверу&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .BaseFolder = </span><span style=" font-family:'monospace'; color:#800000;">&quot;путь к стартовой папке, например, /www/&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">        .BaseURL = </span><span style=" font-family:'monospace'; color:#800000;">&quot;http://Адрес Вашего Сайта, куда будут закачиваться файлы/&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">With</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Function</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пример использования функции:</p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">Sub</span><span style=" font-family:'monospace';"> test()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Dim</span><span style=" font-family:'monospace';"> FTP </span><span style=" font-family:'monospace'; color:#000080;">As</span><span style=" font-family:'monospace';"> FTPcommander    </span><span style=" font-family:'monospace'; color:#008000;">' объявляем переменную</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    </span><span style=" font-family:'monospace'; color:#000080;">Set</span><span style=" font-family:'monospace';"> FTP = MyFTPaccount    </span><span style=" font-family:'monospace'; color:#008000;">' создаём объект с нужными настройками</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace';">    FTP.UploadFile (</span><span style=" font-family:'monospace'; color:#800000;">&quot;C:\123.jpg&quot;</span><span style=" font-family:'monospace';">)    </span><span style=" font-family:'monospace'; color:#008000;">' отправляем файл на сервер</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000080;">End</span><span style=" font-family:'monospace';"> </span><span style=" font-family:'monospace'; color:#000080;">Sub</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Преимущества этого способа:</span> возможно работать с несколькими FTP серверами одновременно, конфиденциальные данные (настройки FTP аккаунта) не хранятся в открытом виде в реестре</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Недостаток этого способа:</span> настройки FTP аккаунта хранятся в коде VBA - если файл попадёт постороннему человеку, он легко сможет добраться до этих настроек (как известно, любые пароли на VBA ломаются за секунду)</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0"><thead>
<tr>
<td></td>
<td></td>
<td></td>
<td></td></tr></thead></table>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0"><thead>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Вложение</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Размер</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Загрузки</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Последняя загрузка</span></p></td></tr></thead>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://ExcelVBA.ru/sites/default/files/FTP_0.xls"><span style=" text-decoration: underline; color:#0000ff;">FTP.xls</span></a></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">45.5 КБ</p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">36</p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">48 недель 5 дней назад</p></td></tr>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://ExcelVBA.ru/sites/default/files/ftp_new_version_WinAPI.xlsb"><span style=" text-decoration: underline; color:#0000ff;">ftp_new_version_WinAPI.xlsb</span></a></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">89.81 КБ</p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0</p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ещё не загружался</p></td></tr></table>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">35348 просмотров </li></ul></td>
<td></td></tr></table></body></html>