<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://opennotes.ru/knowledge/vba-knowledge/poluchnie-dannyx-dlya-excel-s-pomoshu-zaprosa/"><span style=" font-family:'DejaVu Sans'; font-weight:600; text-decoration: underline; color:#0000ff;">Получние данных для Excel с помощью запроса к базе данных</span></a><span style=" font-family:'DejaVu Sans';">								</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">									</span><span style=" font-family:'DejaVu Sans'; font-style:italic;">						</span><span style=" font-family:'DejaVu Sans';">					</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Если, например, требуется получить одно единственное значение с помощью запроса к базе данных (сам запрос может иметь заранее заданную конструкцию, меняющуюся в зависимости от определённых условий), то пригодится следующией код.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-weight:600;">Для MS SQL</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#eff0f1">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#e56717;">Sub</span><span style=" font-family:'Courier New,Courier,sans-serif';"> Get_MSSQL_Data()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">Dim</span><span style=" font-family:'Courier New,Courier,sans-serif';"> db </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">As</span><span style=" font-family:'Courier New,Courier,sans-serif';"> ADODB.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">Dim</span><span style=" font-family:'Courier New,Courier,sans-serif';"> rs </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">As</span><span style=" font-family:'Courier New,Courier,sans-serif';"> ADODB.Recordset</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">Dim</span><span style=" font-family:'Courier New,Courier,sans-serif';"> sqlStr </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">As</span><span style=" font-family:'Courier New,Courier,sans-serif';"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#f660ab;">String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">Set</span><span style=" font-family:'Courier New,Courier,sans-serif';"> rs = </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#e56717;">CreateObject</span><span style=" font-family:'Courier New,Courier,sans-serif';">(</span><span style=" font-family:'Courier New,Courier,sans-serif'; color:#800000;">&quot;ADODB.Recordset&quot;</span><span style=" font-family:'Courier New,Courier,sans-serif';">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">Set</span><span style=" font-family:'Courier New,Courier,sans-serif';"> db = </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#e56717;">New</span><span style=" font-family:'Courier New,Courier,sans-serif';"> ADODB.Connection</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> db.</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">Open</span><span style=" font-family:'Courier New,Courier,sans-serif';"> _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;">  </span><span style=" font-family:'Courier New,Courier,sans-serif'; color:#800000;">&quot;DRIVER={SQL Server};SERVER=SName;UID=UserName;PWD=Password;DATABASE=DBName&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> sqlStr = </span><span style=" font-family:'Courier New,Courier,sans-serif'; color:#800000;">&quot;SELECT Count(*) as cnt FROM [DBName].[DB].[Table]&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> rs.</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#151b8d;">Open</span><span style=" font-family:'Courier New,Courier,sans-serif';"> sqlStr, db</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#8d38c9;">While</span><span style=" font-family:'Courier New,Courier,sans-serif';"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#8d38c9;">Not</span><span style=" font-family:'Courier New,Courier,sans-serif';"> rs.EOF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;">    str1 = rs.Fields(</span><span style=" font-family:'Courier New,Courier,sans-serif'; color:#800000;">&quot;cnt&quot;</span><span style=" font-family:'Courier New,Courier,sans-serif';">).Value</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;">    rs.MoveNext</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;">    Wend</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> rs.</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#8d38c9;">Close</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; background-color:#eff0f1;"> db.</span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#8d38c9;">Close</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#8d38c9;">End</span><span style=" font-family:'Courier New,Courier,sans-serif';"> </span><span style=" font-family:'Courier New,Courier,sans-serif'; font-weight:600; color:#e56717;">Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="more-516"></a><span style=" font-family:'DejaVu Sans';">Д</span><span style=" font-family:'DejaVu Sans';">ля других баз данных нужно изменить строку подключения:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#eff0f1">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; color:#800000;">&quot;DRIVER={SQL Server};SERVER=SName;UID=UserName;PWD=Password;DATABASE=DBName&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-weight:600;">Teradata ODBC Driver</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">на следующий вариант для Teradata:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#eff0f1">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; color:#800000;">&quot;Provider=Teradata;DBCName=DbcName;Database=DBName;Uid=UserName;Pwd=Password&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-weight:600;">OLE DB Provider for Oracle</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">на следующий вариант для Oracle:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#eff0f1">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Courier New,Courier,sans-serif'; color:#800000;">&quot;Provider=OraOLEDB.Oracle;Data Source=DWH;User ID=UserName;Password=Password;&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.connectionstrings.com/teradata"><span style=" font-family:'DejaVu Sans'; text-decoration: underline; color:#0000ff;">Другие варианты</span></a></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-weight:600;">User-defined type not defined</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Для того, чтобы при выполнении кода не возникало ошибки «Compile error: User-defined type not defined»:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:9pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Нужно зайти в Tools-&gt;Reference и выбрать следующие пункты:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:9pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-weight:600;">Полезные ссыкли</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu Sans';" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.anshumusing.co.in/running-teradata-queries-excel-vba/"><span style=" text-decoration: underline; color:#0000ff;">Running Teradata Queries From MS-Excel 2007 Using VBA</span></a></li>
<li style=" font-family:'DejaVu Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.attunity.com/forums/micorosft-ssis-teradata-connector/ssis-connection-string-expression-2211.html"><span style=" text-decoration: underline; color:#0000ff;">SSIS connection String with expression</span></a></li>
<li style=" font-family:'DejaVu Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://forums.teradata.com/forum/connectivity/working-with-blobs-with-ado-vb"><span style=" text-decoration: underline; color:#0000ff;">Working with BLOBs with ADO (VB)</span></a></li>
<li style=" font-family:'DejaVu Sans';" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.codeproject.com/Articles/2304/ADO-Connection-Strings"><span style=" text-decoration: underline; color:#0000ff;">ADO Connection Strings</span></a></li></ul></body></html>