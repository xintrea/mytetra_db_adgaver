<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Получение повышенных привилегий Администратора</span> (перезапуск скрипта с сохранением исходных аргументов)<br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">Sub</span> Elevate<span style=" color:#000000;">(</span>msg<span style=" color:#000000;">)</span><br />    <span style=" font-weight:600; color:#0000ff;">Const</span> DQ <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;&quot;&quot;&quot;</span><br />    <span style=" font-weight:600; color:#0000ff;">if</span> <a href="http://www.google.com/search?q=MSGBOX+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">msgbox</span></a><span style=" color:#000000;">(</span>msg <span style=" color:#000000;">&amp;</span> vblf <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;Запустить с Административными привилегиями ?&quot;</span>, vbQuestion <span style=" color:#000000;">+</span> vbYesNo,<span style=" color:#a52a2a;">&quot;Подтверждение&quot;</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> vbNo <span style=" font-weight:600; color:#0000ff;">then</span> WScript<span style=" color:#000000;">.Quit</span> <span style=" color:#a52a2a;">5</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> oShellApp: <span style=" font-weight:600; color:#0000ff;">Set</span> oShellApp <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;Shell.Application&quot;</span><span style=" color:#000000;">)</span><br />    <span style=" font-style:italic; color:#008000;">' Конкатенация аргументов</span><br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> args, i: <span style=" font-weight:600; color:#0000ff;">For</span> i <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">1</span> <span style=" font-weight:600; color:#0000ff;">to</span> WScript<span style=" color:#000000;">.Arguments.Count</span><br />        args <span style=" color:#000000;">=</span> args <span style=" color:#000000;">&amp;</span> DQ <span style=" color:#000000;">&amp;</span> WScript<span style=" color:#000000;">.Arguments(</span>i <span style=" color:#000000;">-</span> <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&amp;</span> DQ <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot; &quot;</span><br />    <span style=" font-weight:600; color:#0000ff;">Next</span><br />    oShellApp<span style=" color:#000000;">.ShellExecute</span> WScript<span style=" color:#000000;">.FullName</span>, DQ <span style=" color:#000000;">&amp;</span> WScript<span style=" color:#000000;">.ScriptFullName</span> <span style=" color:#000000;">&amp;</span> DQ <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot; &quot;</span> <span style=" color:#000000;">&amp;</span> args, <span style=" color:#a52a2a;">&quot;&quot;</span>, <span style=" color:#a52a2a;">&quot;runas&quot;</span>, <span style=" color:#a52a2a;">1</span><br />    <span style=" font-weight:600; color:#0000ff;">set</span> oShellApp <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Проверка, запущен ли скрипт от имени Администратора</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600; color:#0000ff;">Function</span> isAdminRights<span style=" color:#000000;">()</span><br />    <span style=" font-weight:600; color:#0000ff;">Const</span> KQV <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">1</span>, KSV <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">2</span>, HKLM <span style=" color:#000000;">=</span> <span style=" color:#000000;">&amp;</span>H80000002<br />    <span style=" font-weight:600; color:#0000ff;">Dim</span> oReg, strKey, intErrNum, flagAccess<br />    <span style=" font-weight:600; color:#0000ff;">Set</span> oReg <span style=" color:#000000;">=</span> GetObject<span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;winmgmts:root\default:StdRegProv&quot;</span><span style=" color:#000000;">)</span><br />    strKey <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;System\CurrentControlSet\Control\Session Manager&quot;</span><br />    intErrNum <span style=" color:#000000;">=</span> oReg<span style=" color:#000000;">.CheckAccess(</span>HKLM, strKey, KQV <span style=" color:#000000;">+</span> KSV, flagAccess<span style=" color:#000000;">)</span><br />    isAdminRights <span style=" color:#000000;">=</span> flagAccess<br />    <span style=" font-weight:600; color:#0000ff;">Set</span> oReg <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Перезапуск скрипта в консольном режиме, если запущен через WScript</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">const</span> vbT <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">1</span> <span style=" font-style:italic; color:#008000;">'vbTextCompare</span><br /><span style=" font-weight:600; color:#0000ff;">const</span> QT <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;&quot;&quot;&quot;</span><br /><br /><span style=" font-weight:600; color:#0000ff;">Set</span> oFSO   <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;Scripting.FileSystemObject&quot;</span><span style=" color:#000000;">)</span><br /><span style=" font-weight:600; color:#0000ff;">Set</span> oShell <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;WScript.Shell&quot;</span><span style=" color:#000000;">)</span><br /><br /><span style=" font-style:italic; color:#008000;">' Запущен ли из консоли</span><br />vbHost <span style=" color:#000000;">=</span> oFSO<span style=" color:#000000;">.GetBaseName(</span>Wscript<span style=" color:#000000;">.FullName)</span><br /><span style=" font-weight:600; color:#0000ff;">if</span> <a href="http://www.google.com/search?q=STRCOMP+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">strcomp</span></a><span style=" color:#000000;">(</span>vbHost, <span style=" color:#a52a2a;">&quot;cscript&quot;</span>, vbT<span style=" color:#000000;">)</span> <span style=" color:#000000;">&lt;&gt;</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">then</span><br />    oShell<span style=" color:#000000;">.Run</span> QT <span style=" color:#000000;">&amp;</span> oShell<span style=" color:#000000;">.ExpandEnvironmentStrings(</span><span style=" color:#a52a2a;">&quot;%SystemRoot%&quot;</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;\system32\cscript.exe&quot;</span> <span style=" color:#000000;">&amp;</span> QT <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot; //nologo &quot;</span> <span style=" color:#000000;">&amp;</span> QT <span style=" color:#000000;">&amp;</span> WScript<span style=" color:#000000;">.ScriptFullName</span> <span style=" color:#000000;">&amp;</span> QT, <span style=" color:#a52a2a;">1</span>, <span style=" font-weight:600; color:#0000ff;">false</span><br />    WScript<span style=" color:#000000;">.Quit</span><br /><span style=" font-weight:600; color:#0000ff;">end</span> <span style=" font-weight:600; color:#0000ff;">if</span><br /><br />WScript<span style=" color:#000000;">.Echo</span> vbHost<br />WScript<span style=" color:#000000;">.StdIn.ReadLine()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Процентный прогрессбар в консоли</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">WScript<span style=" color:#000000;">.StdOut.Write</span> <span style=" color:#a52a2a;">&quot;ProgressBar = &quot;</span><br />n <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span><br /><span style=" font-weight:600; color:#0000ff;">Do</span><br />    WScript<span style=" color:#000000;">.StdOut.Write</span> <span style=" color:#6a5acd;">String</span><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">3</span> <span style=" color:#000000;">-</span> len<span style=" color:#000000;">(</span><span style=" color:#cd6a5a;">cstr</span><span style=" color:#000000;">(</span>n<span style=" color:#000000;">))</span>, <span style=" color:#a52a2a;">&quot; &quot;</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&amp;</span> n <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot; %&quot;</span><br />    n <span style=" color:#000000;">=</span> n <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">1</span><br />    WScript<span style=" color:#000000;">.Sleep</span> <span style=" color:#a52a2a;">20</span><br />    WScript<span style=" color:#000000;">.StdOut.Write</span> <span style=" color:#6a5acd;">String</span><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">5</span>, <a href="http://www.google.com/search?q=CHR+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">chr</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">8</span><span style=" color:#000000;">))</span><br /><span style=" font-weight:600; color:#0000ff;">Loop</span> <span style=" font-weight:600; color:#0000ff;">While</span> n <span style=" color:#000000;">&lt;=</span> <span style=" color:#a52a2a;">100</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Получить путь к запущенному скрипту</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600; color:#0000ff;">Set</span> oFSO <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;Scripting.FileSystemObject&quot;</span><span style=" color:#000000;">)</span><br />cur <span style=" color:#000000;">=</span> oFSO<span style=" color:#000000;">.GetParentFolderName(</span>WScript<span style=" color:#000000;">.ScriptFullName)</span></p></body></html>