<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вставить в письмо подпись из Outlook через VBA </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Последнее время стал часто встречать вопрос о том, как в письмо, созданное кодом VBA в Excel, добавить стандартную подпись Outlook.<br />Немного теории для тех, кто не знает как создать и использовать подписи в Outlook. Дело в том, что в Outlook можно создавать несколько подписей и какую-то использовать по умолчанию, а остальные можно вставлять в письмо по необходимости.<br />Чтобы создать подпись в Excel 2007 и выше необходимо перейти в меню:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">для 2007</span>: <span style=" font-weight:600;">Сервис</span> -<span style=" font-weight:600;">Параметры</span> -<span style=" font-weight:600;">Сообщение</span> -<span style=" font-weight:600;">Подписи</span></li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">для 2010 и выше</span>: <span style=" font-weight:600;">Файл(File)</span> -<span style=" font-weight:600;">Параметры(Options)</span> -<span style=" font-weight:600;">Почта(Mail)</span> -<span style=" font-weight:600;">Подписи(Signatures)</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image19953.png" /><span style=" font-size:8.25pt;"><br />В появившемся окне на вкладке </span><span style=" font-size:8.25pt; font-weight:600;">Электронная подпись(E-mail Signature)</span><span style=" font-size:8.25pt;"> необходимо нажать кнопку </span><span style=" font-size:8.25pt; font-weight:600;">Создать(New)</span><span style=" font-size:8.25pt;">. Будет предложено ввести имя новой подписи. После чего необходимо подтвердить создание нажатием кнопки ОК и подпись будет добавлена. После добавления необходимо выбрать созданную подпись и добавить текст. Все созданные подписи отображаются в поле </span><span style=" font-size:8.25pt; font-weight:600;">Выберите подпись для изменения(Select signature to edit)</span><span style=" font-size:8.25pt;">. При выборе любой подписи в нижнем окне </span><span style=" font-size:8.25pt; font-weight:600;">Изменить подпись(Edit signature)</span><span style=" font-size:8.25pt;"> можно изменить как сам текст подписи и другие параметры: добавить/изменить текст, отформатировать его, вставить гиперссылки, картинки(логотип компании, например) и т.д. Для сохранения изменений необходимо нажать кнопку Сохранить(под верхним окном). Не очень интуитивненько, но как есть.<br />В этой же вкладке можно настроить использование подписей по умолчанию для выбранной учетной записи(для каждой учетной записи можно назначить свою подпись по умолчанию) - в правой части окна.<br />Чтобы после создания письма вставить любую из созданных ранее подписей необходимо из окна созданного сообщения перейти на вкладку </span><span style=" font-size:8.25pt; font-weight:600;">Вставка(Insert)</span><span style=" font-size:8.25pt;"> -</span><span style=" font-size:8.25pt; font-weight:600;">Подписи(Signatures)</span><span style=" font-size:8.25pt;"> и выбрать нужную подпись.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Как я уже упоминал вначале статьи - из VBA так же можно создавать письма в Outlook. Подробнее об этом можно прочитать в этой статье: </span><a href="http://www.excel-vba.ru/chto-umeet-excel/kak-otpravit-pismo-iz-excel/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Как отправить письмо из Excel?</span></a><span style=" font-size:8.25pt;">. И вот там как раз есть небольшой недостаток - при создании письма подпись не добавляется автоматом, даже если она создана и настроена для вставки в новые сообщения. Это и побудило меня написать данную статью. Дело в том, что все созданные подписи хранятся на ПК в определенном месте на диске(%AppData%\Microsoft\Signatures\) и до них можно достучаться. Правда, сэмулировать выбор подписи непосредственно из меню не представляется возможным, а вот определить наличие подписей и сделать их вставку можно. Перебрать все созданные подписи можно кодом: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce72d0c43e187306234"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ub SeeSigns() Dim sSignPath As String Dim sF sSignPath = Environ(&quot;appdata&quot;) &amp; &quot;\Microsoft\Signatures\&quot; '&quot; sF = Dir(sSignPath &amp; &quot;*.txt&quot;) Do While sF &lt;&gt; &quot;&quot; MsgBox sF, vbInformation, &quot;www.excel-vba.ru&quot; sF = Dir Loop End Sub </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><span style=" font-size:8.25pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">9</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">10 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce72d0c43e187306234-1"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ub SeeSigns()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-2"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim sSignPath As String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-3"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim sF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-4"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   sSignPath = Environ(&quot;appdata&quot;) &amp; &quot;\Microsoft\Signatures\&quot; '&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-5"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   sF = Dir(sSignPath &amp; &quot;*.txt&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-6"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Do While sF &lt;&gt; &quot;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-7"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       MsgBox sF, vbInformation, &quot;www.excel-vba.ru&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-8"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       sF = Dir</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-9"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Loop</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce72d0c43e187306234-10"></a><span style=" font-size:8.25pt;">E</span><span style=" font-size:8.25pt;">nd Sub</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Этот код просматривает только текстовые подписи - т.е. без оформления в виде картинок и гиперссылок. Однако в самой папке помимо текстовых файлов есть файлы с форматированием в формате .htm. Они добавляются в письма, которые пишутся с применением форматирования, т.е. письма формата .HTML.</span></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Создание письма кодом VBA с выбранной подписью</span><span style=" font-size:8.25pt;"><br />Чтобы сильно не заморачивать всеми премудростями и хитросплетениями кодинга я просто приложу файл, который умеет создавать письма с подписями, при этом можно выбрать нужную подпись и тип: простой текст или форматированный.<br />Скачать пример </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image29487.png" /><span style=" font-size:8.25pt;">  </span><a href="http://www.excel-vba.ru/download/186/"><span style=" font-size:8.25pt; font-weight:600; text-decoration: underline; color:#0000ff;">Tips_Macro_CreateMailWithSign.xls</span></a><span style=" font-size:8.25pt;"> (66,5 KiB, 900 скачиваний)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"><br />После скачивания файла прежде чем нажать кнопку Создать письмо в Outlook с подписью надо будет настроить параметры письма в ячейках:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в <span style=" font-weight:600;">В11</span> - адрес получателя(кому отправить письмо)</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в <span style=" font-weight:600;">В12</span> - тема письма</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в <span style=" font-weight:600;">В13</span> - текст письма</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image23876.png" /><span style=" font-size:8.25pt;"><br />Если планируется отправить письмо с форматированием текста(жирный шрифт, различный цвет шрифта и т.п.) - то надо будет к письму применить теги HTML(ячейка </span><span style=" font-size:8.25pt; font-weight:600;">В13</span><span style=" font-size:8.25pt;">). В файле я составил именно такой текст, чтобы был пример подобных писем. При этом для форматированного письма в форме следует выбрать пункт </span><span style=" font-size:8.25pt; font-weight:600;">Форматированный текст (.htm)</span><span style=" font-size:8.25pt;">. Иначе текст письма будет обычный, но со всеми тегами(ровно так, как он выглядит в самой ячейке на листе). Если форматирование не нужно - то просто записываем текст в ячейку и в форме выбираем </span><span style=" font-size:8.25pt; font-weight:600;">Обычный текст (.txt)</span><span style=" font-size:8.25pt;">.<br />После нажатия Ок появится запрос:<br /></span><img src="image135.png" /><span style=" font-size:8.25pt;"><br />Если нажать </span><span style=" font-size:8.25pt; font-weight:600;">Нет(No)</span><span style=" font-size:8.25pt;">, то письмо будет создано, подпись добавлена, но письмо не будет отправлено, а просто будет выведено на экран, чтобы можно было проверить правильно ли все заполнено и создано. Если нажать </span><span style=" font-size:8.25pt; font-weight:600;">Да(Yes)</span><span style=" font-size:8.25pt;">, то письмо будет создано и сразу отправлено, без вывода на экран.<br />Рекомендую сначала пользоваться предпросмотром, чтобы понять как правильно создавать и форматировать письма.<br />Для тех, кто уже имеет опыт программирования в VBA, полагаю, не составит труда адаптировать код под какие-то свои коды или коды на этом сайте.</span></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Если совсем не охота вдумываться в макросы и нужно готовое решение по рассылке с вложениями и подписями - есть готовое решение: </span><img src="image25959.png" /><a href="http://www.excel-vba.ru/multex/otpravka-listaknigi-po-pochte/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;"> Отправка листа/книги по почте</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p></body></html>