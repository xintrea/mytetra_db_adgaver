<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Как я могу отправить данные из веб-запроса Excel после завершения запроса?</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td style=" vertical-align:middle; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="admediator-54575-361976"></a><span style=" font-size:8.25pt;">К</span><span style=" font-size:8.25pt;">ак разработчик электронных таблиц, я пытаюсь сшить два набора строк: один из веб-запроса в собственный веб-сервис, а другой - набор ручных строк, добавленных пользователем электронной таблицы (а не я).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Excel, встроенный в объект Web Query/Connections, предоставляет только два режима: я могу включить &quot;Включить обновление фона&quot;, что делает асинхронный веб-запрос или снимите его.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Если он не установлен, Excel зависает во время выполнения запроса, что нежелательно. Проверяя, что, как представляется, не существует какого-либо обратного вызова или события, доступного для уведомления, чтобы я мог работать против обновленных веб-данных.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Есть ли другой способ сделать это? </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">0 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://qaru.site/questions/tagged/event-handling"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">event-handling</span></a><span style=" font-size:8.25pt;"> </span><a href="http://qaru.site/questions/tagged/events"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">events</span></a><span style=" font-size:8.25pt;"> </span><a href="http://qaru.site/questions/tagged/vba"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">vba</span></a><span style=" font-size:8.25pt;"> </span><a href="http://qaru.site/questions/tagged/web-services"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">web-services</span></a><span style=" font-size:8.25pt;"> </span><a href="http://qaru.site/questions/tagged/excel"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">excel</span></a><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://stackoverflow.com/users/3782/mcw0933"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">mcw0933</span></a><span style=" font-size:8.25pt;"> 06 окт. '15 в 16:04 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://stackoverflow.com/questions/32974553/how-can-i-post-process-the-data-from-an-excel-web-query-when-the-query-is-comple"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">источник</span></a><span style=" font-size:8.25pt;"> </span><a href="http://qaru.site/questions/292690/how-can-i-post-process-the-data-from-an-excel-web-query-when-the-query-is-complete"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">поделиться</span></a><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="answers"></a><span style=" font-size:8.25pt;">2</span><span style=" font-size:8.25pt;"> ответа </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="1444702"></a><span style=" font-size:8.25pt;">В</span><span style=" font-size:8.25pt;"> веб-запросе Excel используется объект, называемый QueryTable, для выполнения бизнеса по извлечению и отображению данных.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Доступ к QueryTable можно получить с помощью VBA. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">И так же, как объект диаграммы, объект запроса имеет события, на которые можно ответить только с помощью ключевого слова </span><span style=" font-family:'Courier New'; font-size:8.25pt;">WithEvents</span><span style=" font-size:8.25pt;"> из </span><span style=" font-size:8.25pt; font-weight:600;">класса</span><span style=" font-size:8.25pt;">, например:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">Private WithEvents MyQueryTable As QueryTable</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">Private Sub MyQueryTable_AfterRefresh(ByVal Success As Boolean)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">    'Do your post processing here...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">End Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">+1 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://stackoverflow.com/users/3566998/excel-hero"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Excel Hero</span></a><span style=" font-size:8.25pt;"> 06 окт. '15 в 16:45 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://stackoverflow.com/questions/32974553/how-can-i-post-process-the-data-from-an-excel-web-query-when-the-query-is-comple/32975304#32975304"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">источник</span></a><span style=" font-size:8.25pt;"> </span><a href="http://qaru.site/questions/292690/how-can-i-post-process-the-data-from-an-excel-web-query-when-the-query-is-complete/1444702#1444702"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">поделиться</span></a><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="1444701"></a><span style=" font-size:8.25pt;">E</span><span style=" font-size:8.25pt;">xcel поддерживает возможность открытия URL-адреса в качестве другой книги Excel с помощью </span><a href="https://msdn.microsoft.com/EN-US/library/office/ff194819.aspx"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Workbooks.Open method</span></a><span style=" font-size:8.25pt;">:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://msdn.microsoft.com/en-us/library/office/aa203721(v=office.11).aspx"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Из MSDN:</span></a></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">Sub OpenUSDRatesPage()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">   Dim objBK As Workbook</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">   Dim objRng As Range</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">   'Open the page as a workbook.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">   Set objBK = Workbooks.Open(&quot;http://www.x-rates.com/tables/USD.HTML&quot;)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">   'Find the Canadian Dollar cell.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">   Set objRng = objBK.Worksheets(1).Cells.Find(&quot;Canadian Dollar&quot;)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">   'Retrieve the exchange rate.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">   MsgBox &quot;The CAD/USD exchange rate is &quot; &amp; objRng.Offset(-6, -1).Value</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt;">End Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Вызов синхронный, поэтому вы можете работать с результирующими данными в новой книге сразу после открытого вызова. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Во время загрузки книги Excel отображает индикатор выполнения. Когда вы закончите, вы можете позвонить. Закрыть, чтобы закрыть книгу веб-данных. (например, для примера MSDN вы должны позвонить </span><span style=" font-family:'Courier New'; font-size:8.25pt;">objBK.Close</span><span style=" font-size:8.25pt;">, когда закончите.)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Предостережения об использовании этого подхода:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы пытаетесь перенести данные из веб-книги самостоятельно (<span style=" font-family:'Courier New';">ThisWorkbook</span>) самостоятельно, в отличие от обновляемого веб-запроса Excel, который имеет назначенное место назначения.</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если ваша конечная точка веб-сайта имеет имя документа, соответствующее имени открытого документа в Excel, пользователь получит предупреждение о том, что документ с тем же именем открыт.</li></ul></body></html>