<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="container"></a><a href="https://webhamster.ru/mytetrashare/index/mtb0/1503661151frcwo99z6t"><span style=" text-decoration: underline; color:#0000ff;">w</span></a><span style=" text-decoration: underline; color:#0000ff;">ebhamster.ru</span> </p>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="reader-title"></a><span style=" font-size:xx-large; font-weight:600;">К</span><span style=" font-size:xx-large; font-weight:600;">ак сделать подключение к репозитарию Git через Socks Proxy в условиях отсутствия DNS</span> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="reader-credits"></a>4-5 минут </p>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="moz-reader-content"></a>В сети есть обсуждение такого нерешенного вопроса: </p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.linux.org.ru/forum/admin/12726837"><span style=" text-decoration: underline; color:#0000ff;">Работа Git (например с GitHub) через SOCKS5 Proxy в условиях отсутствия DNS</span></a> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Кратко, проблема вот в чем: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нахожусь в корпоративной сети. Имею доступ как пользователь к линуховому серверу, у которого есть выход в интернет. Захожу на этот сервер по SSH через Putty.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На рабочем месте Windows 7. Для серфинга включаю Putty, которая делает туннель и поднимает локально на машине порт SOCKS5 Proxy. Запускаю FireFox, у которого настроено использование SOCKS5 Proxy, и стоит галочка «Удаленный DNS» (в других браузерах, кстати, такой настройки не предусмотрено, поэтому они не подходят). И интернет в FireFox работает.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь мне нужно начать работать с git. В git есть глобальные настройки:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&gt; git config --list</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">http.proxy='socks5://127.0.0.1:9999'</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">https.proxy='socks5://127.0.0.1:9999'</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">socks.proxy=127.0.0.1:9999</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">socks5.proxy=127.0.0.1:9999</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Однако при попытке запушить изменения, получаю ошибку:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">&gt; git push</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ssh: github.com: no address associated with name</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">fatal: Could not read from remote repository. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Please make sure you have the correct access rights</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">and the repository exists.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Похоже, что ошибка эта из-за того, что git не умеет резолвить DNS-имена через SOCKS5 Proxy, а просто пользуется тем что есть в системе. А может быть, нужна какая-то дополнительная настройка.<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В ответ на этот вопрос было предложено решение: прописать IP адрес github.com в файл windows\system32\drivers\etc\hosts. Проблема в том, что это решение не помогает, потому что вопрос оказался куда сложнее. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Перед дальнейшим обсуждением, подведу краткий итог. Для организации доступа Git в Интернет надо: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1. Иметь запущенным Putty с проброшенным SOCKS5 туннелем (опция -D): </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">putty.exe -load funnyLinuxHost -D 9999 10.159.168.48 </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2. В конфиге Git (в каталоге пользователя есть файл .gitconfig) иметь, как минимум, опцию: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[http]</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">proxy = socks5://127.0.0.1:9999 </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3. В файле hosts иметь интернетовый IP-адрес для доменного имени github.com </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А что нужно еще, написано дальше. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Долгие попытки настройки показали, что обращение к socks-прокси возможно только при использовании http/https протокола. Git не работает через socks5-прокси, если адрес репозитария прописан по протоколу git, например git@github.com:xintrea/monitoring-sp.git. Обнаружить эту особенность в документации мне не удалось (может быть плохо читал), но по факту это так. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если поменять в настройках репозитария адрес сервера на протокол https (например на https://github.com/xintrea/monitoring-sp.git), то Git начинает соединяться с github. (Настройки репозитария проще всего поменять в файле ./git/config, опция url). Казалось бы, проблема решена. Но нет, тут вступает в дело политика самого GitHub.com. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Дело в том, что соединение на внесение изменений в репозитарий (например git push) на сервисе GitHub.com допустимо как про протоколу git, так и по протоколу https. Но есть нюанс: по протоколу git возможна авторизация по SSH ключу, а по протоколу https такая авторизация почему-то запрещена, даже если все ключи установлены. Поэтому при использовании репозитария по протоколу https, Git будет всегда запрашивать логин и пароль. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь возникает вопрос: как комфортно работать с удаленным репозитарием по протоколу https, чтобы все время не вводить логин-пароль на каждую операцию. Оказывается, этот вопрос не так уж и прост. Например, можно попытаться воспользоваться кешированием пароля: </p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://help.github.com/articles/caching-your-github-password-in-git/"><span style=" text-decoration: underline; color:#0000ff;">Caching your GitHub password in Git</span></a> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Но и тут проблема: кеширование пароля (в среде Windows) работает только в нативном Git-шелле Git for Windows. А если пользоваться обычным cmd, то в нем такой возможности нет. Опять же об удобстве использования в нативном окружении Windows не может быть и речи. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таким образом, для решения данного вопроса придется идти на крайние меры: прописать логин и пароль прямо в https-линк репозитария. Вот так: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[remote &quot;origin&quot;]</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">url = https://пользователь:пароль@github.com/xintrea/monitoring-sp.git </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Да, это не секьюрно, но другого варианта нормальной работы через socks5-proxy в Windows просто нет. </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>