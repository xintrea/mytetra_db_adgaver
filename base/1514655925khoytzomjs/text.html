<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Класс для создания и распаковки архивов ZIP.</span><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">- позволяет обходить ошибку при добавлении пустых папок*<br />- позволяет добавлять файлы с атрибутом &quot;скрытый&quot;<br />- правильно рассчитывает задержку при распаковке в папку, где уже есть другие файлы<br /><br /><span style=" font-size:12px;">* за исключением уникальных случаев, когда в корне папки для упаковки попадутся:<br />объект (файл или папка) со знаком ; и пустая папка с таким же именем, где на месте ; стоит любой другой знак.</span><br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (vb.net): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">Option</span> Explicit<br /><br /><span style=" font-style:italic; color:#008000;">' ========= Пример архивирования папки ========</span><br /><span style=" font-weight:600; color:#0000ff;">Dim</span> Zip, ArcPath, FolderPath<br /><span style=" font-style:italic; color:#008000;">' Где создаем архив</span><br />ArcPath      <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;h:\_VBS, WSH\Архивация\My_Class\test.zip&quot;</span><br /><span style=" font-style:italic; color:#008000;">' Какую папку архивируем</span><br />FolderPath   <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;h:\_VBS, WSH\Архивация\My_Class\ToArc&quot;</span><br /><br /><span style=" font-weight:600; color:#0000ff;">Set</span> Zip <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">New</span> ZipClass<br /><span style=" font-weight:600; color:#0000ff;">if</span> <span style=" color:#000000;">(</span>Zip<span style=" color:#000000;">.CreateArchive</span> <span style=" color:#000000;">(</span>ArcPath<span style=" color:#000000;">))</span> <span style=" font-weight:600; color:#0000ff;">then</span> <span style=" font-style:italic; color:#008000;">' старый архив затирается</span><br />    Zip<span style=" color:#000000;">.CopyFolderToArchive</span> FolderPath<br /><span style=" font-weight:600; color:#0000ff;">end</span> <span style=" font-weight:600; color:#0000ff;">if</span><br />msgbox <span style=" color:#a52a2a;">&quot;Папка &quot;</span> <span style=" color:#000000;">&amp;</span> FolderPath <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot; заархивирована.&quot;</span><br /><br /><br /><span style=" font-style:italic; color:#008000;">' ========= Пример добавления файла в уже созданный архив ========</span><br /><span style=" font-weight:600; color:#0000ff;">Dim</span> FilePath<br /><span style=" font-style:italic; color:#008000;">' Какой файл архивировать</span><br />FilePath     <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;h:\_VBS, WSH\Архивация\My_Class\ZipClass.xls&quot;</span><br /><br />Zip<span style=" color:#000000;">.CopyFileToArchive</span> FilePath<br />msgbox <span style=" color:#a52a2a;">&quot;Файл &quot;</span> <span style=" color:#000000;">&amp;</span> FilePath <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot; добавлен к архиву &quot;</span> <span style=" color:#000000;">&amp;</span> ArcPath<br /><br /><br /><span style=" font-style:italic; color:#008000;">' ================== Распаковка архива ===================</span><br /><span style=" font-weight:600; color:#0000ff;">Dim</span> UnpackPath<br /><span style=" font-style:italic; color:#008000;">' Путь, куда распаковуем</span><br />UnpackPath   <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;h:\_VBS, WSH\Архивация\My_Class\Unpack&quot;</span><br /><br />Zip<span style=" color:#000000;">.UnpackArchive</span> ArcPath, UnpackPath<br />msgbox <span style=" color:#a52a2a;">&quot;Архив распакован в папку: &quot;</span> <span style=" color:#000000;">&amp;</span> UnpackPath<br /><br /><span style=" font-style:italic; color:#008000;">' --------------------------------------------------------------------------------------</span><br /><span style=" font-style:italic; color:#008000;">' Класс создания архивов ZIP. Maded by Dragokas</span><br /><span style=" font-style:italic; color:#008000;">'</span><br /><span style=" font-style:italic; color:#008000;">' - позволяет обходить ошибку при добавлении пустых папок</span><br /><span style=" font-style:italic; color:#008000;">' - позволяет добавлять файлы с атрибутом &quot;скрытый&quot;</span><br /><span style=" font-style:italic; color:#008000;">' - правильно рассчитывает задержку при распаковке в папку, где уже есть другие файлы</span><br /><span style=" font-style:italic; color:#008000;">' --------------------------------------------------------------------------------------</span><br /><span style=" font-weight:600; color:#0000ff;">Class</span> ZipClass<br />        <span style=" font-weight:600; color:#0000ff;">Private</span> oShApp, oFSO, oArchive, ArcItemsNewCount, oFolderItems, oFolderItem, oArchiveItems, oTarget, oTargetItems, ZipHeader, isEmptyFolder, SHCONTF_FILES_AND_FOLDERS<br />        <span style=" font-weight:600; color:#0000ff;">Private</span> <span style=" font-weight:600; color:#0000ff;">Sub</span> Class_Initialize<span style=" color:#000000;">()</span> <span style=" font-style:italic; color:#008000;">'Инициализация объектов</span><br />            <span style=" font-style:italic; color:#008000;">'FolderItems3.Filter method ' http://msdn.microsoft.com/en-us/library/windows/desktop/bb787787(v=vs.85).aspx</span><br />            <span style=" font-weight:600; color:#0000ff;">Const</span> SHCONTF_FOLDERS               <span style=" color:#000000;">=</span> <span style=" color:#000000;">&amp;</span>H20<br />            <span style=" font-weight:600; color:#0000ff;">Const</span> SHCONTF_NONFOLDERS            <span style=" color:#000000;">=</span> <span style=" color:#000000;">&amp;</span>H40<br />            <span style=" font-weight:600; color:#0000ff;">Const</span> SHCONTF_INCLUDEHIDDEN         <span style=" color:#000000;">=</span> <span style=" color:#000000;">&amp;</span>H80<br />            <span style=" font-weight:600; color:#0000ff;">Const</span> SHCONTF_INCLUDESUPERHIDDEN    <span style=" color:#000000;">=</span> <span style=" color:#000000;">&amp;</span>H10000 <span style=" font-style:italic; color:#008000;">' Windows 7 and Later</span><br />            SHCONTF_FILES_AND_FOLDERS <span style=" color:#000000;">=</span> SHCONTF_FOLDERS <span style=" font-weight:600; color:#0000ff;">Or</span> SHCONTF_NONFOLDERS <span style=" font-weight:600; color:#0000ff;">Or</span> SHCONTF_INCLUDEHIDDEN <span style=" font-weight:600; color:#0000ff;">Or</span> SHCONTF_INCLUDESUPERHIDDEN<br />            <span style=" font-weight:600; color:#0000ff;">Set</span> oShApp <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;Shell.Application&quot;</span><span style=" color:#000000;">)</span><br />            <span style=" font-weight:600; color:#0000ff;">set</span> oFSO <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;Scripting.FileSystemObject&quot;</span><span style=" color:#000000;">)</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Sub</span><br />        <span style=" font-weight:600; color:#0000ff;">Function</span> UnpackArchive<span style=" color:#000000;">(</span>SourceArchive, DestPath<span style=" color:#000000;">)</span> <span style=" font-style:italic; color:#008000;">'Распаковка архива</span><br />            <span style=" font-weight:600; color:#0000ff;">Set</span> oArchiveItems <span style=" color:#000000;">=</span> oShApp<span style=" color:#000000;">.</span><span style=" font-weight:600; color:#0000ff;">NameSpace</span><span style=" color:#000000;">(</span>SourceArchive<span style=" color:#000000;">).Items</span><br />            <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">resume</span> <span style=" font-weight:600; color:#0000ff;">next</span><br />            <span style=" font-weight:600; color:#0000ff;">if</span> <span style=" font-weight:600; color:#0000ff;">not</span> oFSO<span style=" color:#000000;">.FolderExists(</span>DestPath<span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">then</span> oFSO<span style=" color:#000000;">.CreateFolder(</span>DestPath<span style=" color:#000000;">)</span><br />            <span style=" font-weight:600; color:#0000ff;">if</span> Err<span style=" color:#000000;">.Number</span> <span style=" color:#000000;">&lt;&gt;</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">then</span> WScript<span style=" color:#000000;">.Echo(</span><span style=" color:#a52a2a;">&quot;Не хватает прав для создания временной папки распаковки!&quot;</span><span style=" color:#000000;">)</span>: UnpackArchive <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">false</span>: <span style=" font-weight:600; color:#0000ff;">Exit</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br />            <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">goto</span> <span style=" color:#a52a2a;">0</span><br />            <span style=" font-weight:600; color:#0000ff;">Set</span> oTarget <span style=" color:#000000;">=</span> oShApp<span style=" color:#000000;">.</span><span style=" font-weight:600; color:#0000ff;">NameSpace</span><span style=" color:#000000;">(</span>DestPath<span style=" color:#000000;">)</span><br />            <span style=" font-weight:600; color:#0000ff;">set</span> oTargetItems <span style=" color:#000000;">=</span> oTarget<span style=" color:#000000;">.Items</span><br />            <span style=" font-weight:600; color:#0000ff;">Dim</span> oSCR: <span style=" font-weight:600; color:#0000ff;">set</span> oSCR <span style=" color:#000000;">=</span> <a href="http://www.google.com/search?q=CREATEOBJECT+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">CreateObject</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">&quot;Scripting.Dictionary&quot;</span><span style=" color:#000000;">)</span>: oSCR<span style=" color:#000000;">.CompareMode</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">1</span><br />            <span style=" font-weight:600; color:#0000ff;">for</span> <span style=" font-weight:600; color:#0000ff;">each</span> oFolderItem <span style=" font-weight:600; color:#0000ff;">in</span> oTargetItems: oSCR<span style=" color:#000000;">.Add</span> oFolderItem<span style=" color:#000000;">.Name</span>, <span style=" color:#a52a2a;">&quot;&quot;</span>: <span style=" font-weight:600; color:#0000ff;">Next</span> <span style=" font-style:italic; color:#008000;">' подсчет кол-ва уникальных файлов</span><br />            <span style=" font-weight:600; color:#0000ff;">for</span> <span style=" font-weight:600; color:#0000ff;">each</span> oFolderItem <span style=" font-weight:600; color:#0000ff;">in</span> oArchiveItems<br />                <span style=" font-weight:600; color:#0000ff;">if</span> <span style=" font-weight:600; color:#0000ff;">not</span> oSCR<span style=" color:#000000;">.Exists(</span>oFolderItem<span style=" color:#000000;">.Name)</span> <span style=" font-weight:600; color:#0000ff;">then</span> oSCR<span style=" color:#000000;">.Add</span> oFolderItem<span style=" color:#000000;">.Name</span>, <span style=" color:#a52a2a;">&quot;&quot;</span><br />            <span style=" font-weight:600; color:#0000ff;">Next</span><br />            <span style=" font-style:italic; color:#008000;">'CopyHere option ENUM: http://msdn.microsoft.com/en-us/library/windows/desktop/bb787866(v=vs.85).aspx</span><br />            oTarget<span style=" color:#000000;">.CopyHere</span> oArchiveItems, <span style=" color:#a52a2a;">4</span><span style=" color:#000000;">+</span><span style=" color:#a52a2a;">16</span> <span style=" font-style:italic; color:#008000;">'(4 - no ProgressBar, 16 - Yes to all, 1024 - suppress all errors)</span><br />            <span style=" font-weight:600; color:#0000ff;">Do</span>: Wscript<span style=" color:#000000;">.Sleep</span> <span style=" color:#a52a2a;">200</span>: oTargetItems<span style=" color:#000000;">.Filter</span> SHCONTF_FILES_AND_FOLDERS, <span style=" color:#a52a2a;">&quot;*&quot;</span>: <span style=" font-weight:600; color:#0000ff;">Loop</span> Until oTargetItems<span style=" color:#000000;">.Count</span> <span style=" color:#000000;">=&gt;</span> oSCR<span style=" color:#000000;">.Count</span><br />            UnpackArchive <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">true</span>: <span style=" font-weight:600; color:#0000ff;">set</span> oArchiveItems <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span>: <span style=" font-weight:600; color:#0000ff;">set</span> oTarget <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br />        <span style=" font-weight:600; color:#0000ff;">Function</span> CreateArchive<span style=" color:#000000;">(</span>ZipArchivePath<span style=" color:#000000;">)</span> <span style=" font-style:italic; color:#008000;">'Подготовка ZIP-архива</span><br />            <span style=" font-weight:600; color:#0000ff;">If</span> <a href="http://www.google.com/search?q=LCASE+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">lcase</span></a><span style=" color:#000000;">(</span>oFSO<span style=" color:#000000;">.GetExtensionName(</span>ZipArchivePath<span style=" color:#000000;">))</span> <span style=" color:#000000;">&lt;&gt;</span> <span style=" color:#a52a2a;">&quot;zip&quot;</span> <span style=" font-weight:600; color:#0000ff;">Then</span> WScript<span style=" color:#000000;">.Echo(</span><span style=" color:#a52a2a;">&quot;Указано неверное расширение для архива!&quot;</span><span style=" color:#000000;">)</span>: <span style=" font-weight:600; color:#0000ff;">Exit</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br />            ZipHeader <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">&quot;PK&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=CHR+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Chr</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">5</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=CHR+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">Chr</span></a><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">6</span><span style=" color:#000000;">)</span> <span style=" color:#000000;">&amp;</span> <span style=" color:#6a5acd;">String</span><span style=" color:#000000;">(</span><span style=" color:#a52a2a;">18</span>, vbNullChar<span style=" color:#000000;">)</span><br />            <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">resume</span> <span style=" font-weight:600; color:#0000ff;">next</span><br />            <span style=" font-weight:600; color:#0000ff;">with</span> oFSO<span style=" color:#000000;">.OpenTextFile(</span>ZipArchivePath, <span style=" color:#a52a2a;">2</span>, <span style=" font-weight:600; color:#0000ff;">True</span><span style=" color:#000000;">)</span><br />                <span style=" font-weight:600; color:#0000ff;">if</span> Err<span style=" color:#000000;">.Number</span> <span style=" color:#000000;">&lt;&gt;</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">then</span> WScript<span style=" color:#000000;">.Echo(</span><span style=" color:#a52a2a;">&quot;Не хватает прав для создания архива!&quot;</span><span style=" color:#000000;">)</span>: CreateArchive <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">False</span>: <span style=" font-weight:600; color:#0000ff;">Exit</span> <span style=" font-weight:600; color:#0000ff;">function</span><br />            <span style=" color:#000000;">.Write</span> ZipHeader: <span style=" color:#000000;">.Close</span>: <span style=" font-weight:600; color:#0000ff;">end</span> <span style=" font-weight:600; color:#0000ff;">with</span><br />            <span style=" font-weight:600; color:#0000ff;">on</span> <span style=" font-weight:600; color:#0000ff;">error</span> <span style=" font-weight:600; color:#0000ff;">goto</span> <span style=" color:#a52a2a;">0</span><br />            <span style=" font-weight:600; color:#0000ff;">Do</span>: WScript<span style=" color:#000000;">.Sleep(</span><span style=" color:#a52a2a;">100</span><span style=" color:#000000;">)</span>: <span style=" font-weight:600; color:#0000ff;">Loop</span> until oFSO<span style=" color:#000000;">.FileExists(</span>ZipArchivePath<span style=" color:#000000;">)</span>: WScript<span style=" color:#000000;">.Sleep(</span><span style=" color:#a52a2a;">200</span><span style=" color:#000000;">)</span> <span style=" font-style:italic; color:#008000;">'выжидаем время, пока ZIP-архив не будет создан</span><br />            <span style=" font-weight:600; color:#0000ff;">Set</span> oArchive <span style=" color:#000000;">=</span> oShApp<span style=" color:#000000;">.</span><span style=" font-weight:600; color:#0000ff;">NameSpace</span><span style=" color:#000000;">(</span>ZipArchivePath<span style=" color:#000000;">)</span>: <span style=" font-weight:600; color:#0000ff;">if</span> <span style=" font-weight:600; color:#0000ff;">Not</span> <span style=" color:#000000;">(</span>oArchive <span style=" font-weight:600; color:#0000ff;">is</span> <span style=" font-weight:600; color:#0000ff;">Nothing</span><span style=" color:#000000;">)</span> <span style=" font-weight:600; color:#0000ff;">Then</span> CreateArchive <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">True</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br />        <span style=" font-weight:600; color:#0000ff;">Function</span> CopyFileToArchive<span style=" color:#000000;">(</span>srcFilePath<span style=" color:#000000;">)</span> <span style=" font-style:italic; color:#008000;">'Копируем файл в ZIP-архив</span><br />            ArcItemsNewCount <span style=" color:#000000;">=</span> oArchive<span style=" color:#000000;">.Items.Count</span> <span style=" color:#000000;">+</span> <span style=" color:#a52a2a;">1</span><br />            <span style=" font-weight:600; color:#0000ff;">Dim</span> srcFileName: srcFileName <span style=" color:#000000;">=</span> oFSO<span style=" color:#000000;">.GetBaseName(</span>srcFilePath<span style=" color:#000000;">)</span><br />            <span style=" font-weight:600; color:#0000ff;">for</span> <span style=" font-weight:600; color:#0000ff;">each</span> oFolderItem <span style=" font-weight:600; color:#0000ff;">in</span> oArchive<span style=" color:#000000;">.Items</span> <span style=" font-style:italic; color:#008000;">' Проверяем, существует ли уже такой файл в архиве</span><br />                <span style=" font-weight:600; color:#0000ff;">if</span> <a href="http://www.google.com/search?q=STRCOMP+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">strcomp</span></a><span style=" color:#000000;">(</span>oFolderItem<span style=" color:#000000;">.name</span>, srcFileName<span style=" color:#000000;">)</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">then</span> ArcItemsNewCount <span style=" color:#000000;">=</span> oArchive<span style=" color:#000000;">.Items.Count</span> <span style=" color:#000000;">-</span> <span style=" color:#a52a2a;">1</span>: <span style=" font-weight:600; color:#0000ff;">exit</span> <span style=" font-weight:600; color:#0000ff;">for</span><br />            <span style=" font-weight:600; color:#0000ff;">next</span><br />            oArchive<span style=" color:#000000;">.CopyHere</span> srcFilePath <span style=" font-style:italic; color:#008000;">', 4 + 16 + 1024 'these options works only with unzipped folder</span><br />            <span style=" font-weight:600; color:#0000ff;">Do</span>: Wscript<span style=" color:#000000;">.Sleep</span> <span style=" color:#a52a2a;">200</span>: <span style=" font-weight:600; color:#0000ff;">Loop</span> Until oArchive<span style=" color:#000000;">.Items.Count</span> <span style=" color:#000000;">=&gt;</span> ArcItemsNewCount <span style=" font-style:italic; color:#008000;">'Выжидаем пока кол-во объектов в ZIP-архиве станет &gt;= копируемым в него</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br />        <span style=" font-weight:600; color:#0000ff;">Function</span> CopyFolderToArchive<span style=" color:#000000;">(</span>srcFolderPath<span style=" color:#000000;">)</span> <span style=" font-style:italic; color:#008000;">'Копируем содержимое папки в ZIP-архив</span><br />            <span style=" font-weight:600; color:#0000ff;">Dim</span> sFilter: <span style=" font-weight:600; color:#0000ff;">set</span> oFolderItems <span style=" color:#000000;">=</span> oShApp<span style=" color:#000000;">.</span><span style=" font-weight:600; color:#0000ff;">NameSpace</span><span style=" color:#000000;">(</span>srcFolderPath<span style=" color:#000000;">).Items</span><br />            oFolderItems<span style=" color:#000000;">.Filter</span> SHCONTF_FILES_AND_FOLDERS, <span style=" color:#a52a2a;">&quot;*&quot;</span> <span style=" font-style:italic; color:#008000;">'включаем в архив скрытые файлы</span><br />            <span style=" font-weight:600; color:#0000ff;">For</span> <span style=" font-weight:600; color:#0000ff;">each</span> oFolderItem <span style=" font-weight:600; color:#0000ff;">in</span> oFolderItems <span style=" font-style:italic; color:#008000;">' поиск пустых папок</span><br />                isEmptyFolder <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">false</span><br />                <span style=" font-weight:600; color:#0000ff;">if</span> oFolderItem<span style=" color:#000000;">.IsFolder</span> <span style=" font-weight:600; color:#0000ff;">then</span> <span style=" font-weight:600; color:#0000ff;">if</span> oFolderItem<span style=" color:#000000;">.GetFolder.Items.Count</span> <span style=" color:#000000;">=</span> <span style=" color:#a52a2a;">0</span> <span style=" font-weight:600; color:#0000ff;">then</span> isEmptyFolder <span style=" color:#000000;">=</span> <span style=" font-weight:600; color:#0000ff;">true</span><br />                <span style=" font-weight:600; color:#0000ff;">if</span> <span style=" font-weight:600; color:#0000ff;">not</span> isEmptyFolder <span style=" font-weight:600; color:#0000ff;">then</span> sFilter <span style=" color:#000000;">=</span> sFilter <span style=" color:#000000;">&amp;</span> <span style=" color:#a52a2a;">&quot;;&quot;</span> <span style=" color:#000000;">&amp;</span> <a href="http://www.google.com/search?q=REPLACE+site:msdn.microsoft.com"><span style=" text-decoration: underline; color:#000066;">replace</span></a><span style=" color:#000000;">(</span>oFolderItem<span style=" color:#000000;">.Name</span>, <span style=" color:#a52a2a;">&quot;;&quot;</span>, <span style=" color:#a52a2a;">&quot;?&quot;</span><span style=" color:#000000;">)</span> <span style=" font-style:italic; color:#008000;">' белый список объектов для фильтра</span><br />            <span style=" font-weight:600; color:#0000ff;">Next</span><br />            oFolderItems<span style=" color:#000000;">.Filter</span> SHCONTF_FILES_AND_FOLDERS, mid<span style=" color:#000000;">(</span>sFilter, <span style=" color:#a52a2a;">1</span><span style=" color:#000000;">)</span><br />            ArcItemsNewCount <span style=" color:#000000;">=</span> oArchive<span style=" color:#000000;">.Items.Count</span> <span style=" color:#000000;">+</span> oFolderItems<span style=" color:#000000;">.Count</span><br />            oArchive<span style=" color:#000000;">.CopyHere</span> oFolderItems<br />            <span style=" font-weight:600; color:#0000ff;">Do</span>: Wscript<span style=" color:#000000;">.Sleep</span> <span style=" color:#a52a2a;">200</span>: <span style=" font-weight:600; color:#0000ff;">Loop</span> Until oArchive<span style=" color:#000000;">.Items.Count</span> <span style=" color:#000000;">=&gt;</span> ArcItemsNewCount <span style=" font-style:italic; color:#008000;">'Выжидаем пока кол-во объектов в ZIP-архиве станет &gt;= копируемым в него</span><br />        <span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Function</span><br /><span style=" font-weight:600; color:#0000ff;">End</span> <span style=" font-weight:600; color:#0000ff;">Class</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><span style=" font-weight:600;">Реестр Windows. Работа с ключами и параметрами.</span></p></body></html>