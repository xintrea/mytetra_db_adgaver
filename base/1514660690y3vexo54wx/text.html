<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#0000ff;">Поиск альтернативных файловых потоков, которые занимают слишком много места на диске</span><br /><br />Как известно, большинство программ оценки свободного места (вроде WinDirStat) не показывают объем, занимаемый альтернативными файловыми потоками.<br />Этот скрипт призван заполнить такой недостаток.<br /><br />По-умолчанию сканируется только системный диск.<br />В отчёт попадут файли и папки, чьи ADS занимают более 1000 байт. Можете изменить этот лимит в переменной MAX_STREAM_SIZE.<br /><br />Совместимость: Windows Vista и выше.<br /><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Код (DOS): </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#33cc33;">@</span><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> off<br /><a href="http://www.ss64.com/nt/setlocal.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">SetLocal</span></a> EnableExtensions<br /><br /><a href="http://www.ss64.com/nt/set.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">set</span></a> &quot;MAX_STREAM_SIZE=1000&quot;<br /><br /><a href="http://www.ss64.com/nt/cd.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">cd</span></a> /d &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~dp0</span>&quot;<br />2<span style=" color:#33cc33;">&gt;</span><a href="http://www.ss64.com/nt/nul.html"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">nul</span></a> <a href="http://www.ss64.com/nt/del.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">del</span></a> ADS.log<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> _______________________________<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a>  ADS scaner by Alex Dragokas<br /><a href="http://www.ss64.com/nt/title.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">title</span></a> ADS scaner by Alex Dragokas<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> _______________________________<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a>.<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> Scanning disk <span style=" color:#33cc33;">%</span><span style=" color:#448888;">SystemDrive</span><span style=" color:#33cc33;">%</span> ...<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> Please, wait.<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a>.<br /><br />net session <span style=" color:#33cc33;">&gt;</span><a href="http://www.ss64.com/nt/nul.html"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">NUL</span></a> 2<span style=" color:#33cc33;">&gt;</span><a href="http://www.ss64.com/nt/nul.html"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">NUL</span></a> <span style=" color:#33cc33;">||</span> <span style=" color:#33cc33;">(</span><br />  <a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> Запустите утилиту от имени Администратора <span style=" color:#33cc33;">!!!</span><br />  <a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> You need to launch this app. as Admin <span style=" color:#33cc33;">!!!</span><br />  pause<span style=" color:#33cc33;">&gt;</span><a href="http://www.ss64.com/nt/nul.html"><span style=" font-weight:600; text-decoration: underline; color:#0000ff;">nul</span></a> <span style=" color:#33cc33;">&amp;</span> <a href="http://www.ss64.com/nt/goto.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">goto</span></a> :<span style=" font-weight:600; color:#b100b1;">eof</span><br /><span style=" color:#33cc33;">)</span><br /><span style=" font-style:italic; color:#b100b1;">:: for pseudo progress-bar purposes</span><br /><br /><a href="http://www.ss64.com/nt/set.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">set</span></a> Drive=<span style=" color:#33cc33;">%</span><span style=" color:#448888;">SystemDrive</span><span style=" color:#33cc33;">%</span><br /><br /><a href="http://www.ss64.com/nt/call.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">call</span></a> :<span style=" font-weight:600; color:#b100b1;">ScanFolder</span> <span style=" color:#33cc33;">%</span><span style=" color:#448888;">Drive</span><span style=" color:#33cc33;">%</span><br /><span style=" font-style:italic; color:#b100b1;"><br />:: 1 level</span><br /><a href="http://www.ss64.com/nt/for.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">for</span></a> /f &quot;delims=&quot; <span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span> <a href="http://www.ss64.com/nt/in.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">in</span></a> <span style=" color:#33cc33;">(</span>'<a href="http://www.ss64.com/nt/dir.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">dir</span></a> /b /ad-l &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Drive</span><span style=" color:#33cc33;">%</span>\*&quot;'<span style=" color:#33cc33;">)</span> <a href="http://www.ss64.com/nt/do.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">do</span></a> <span style=" color:#33cc33;">(</span><br /><br />  <a href="http://www.ss64.com/nt/call.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">call</span></a> :<span style=" font-weight:600; color:#b100b1;">ScanFolder</span> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Drive</span><span style=" color:#33cc33;">%</span>\<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span>&quot;<br /><span style=" font-style:italic; color:#808080;"><br />  rem 2 level</span><br />  <a href="http://www.ss64.com/nt/for.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">for</span></a> /f &quot;delims=&quot; <span style=" color:#33cc33;">%%</span><span style=" color:#448888;">b</span> <a href="http://www.ss64.com/nt/in.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">in</span></a> <span style=" color:#33cc33;">(</span>'<a href="http://www.ss64.com/nt/dir.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">dir</span></a> /b /ad-l &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Drive</span><span style=" color:#33cc33;">%</span>\<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span>\*&quot;'<span style=" color:#33cc33;">)</span> <a href="http://www.ss64.com/nt/do.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">do</span></a> <span style=" color:#33cc33;">(</span><br /><span style=" font-style:italic; color:#808080;"><br />    rem Start recursive scanning on 2 level</span><br />    <a href="http://www.ss64.com/nt/call.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">call</span></a> :<span style=" font-weight:600; color:#b100b1;">ScanFolder</span> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Drive</span><span style=" color:#33cc33;">%</span>\<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span>\<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">b</span>&quot; /s<br />  <span style=" color:#33cc33;">)</span><br /><span style=" color:#33cc33;">)</span><br /><br /><a href="http://www.ss64.com/nt/del.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">del</span></a> t.log t2.log<br />explorer ADS.log<br /><a href="http://www.ss64.com/nt/pause.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">pause</span></a><br /><a href="http://www.ss64.com/nt/goto.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">goto</span></a> :<span style=" font-weight:600; color:#b100b1;">eof</span><br /><br />:<span style=" font-weight:600; color:#b100b1;">ScanFolder</span> [Path] [/s <a href="http://www.ss64.com/nt/for.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">for</span></a> recursive]<br /><br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~1</span>&quot;<br /><a href="http://www.ss64.com/nt/dir.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">dir</span></a> /r /a-l /-c <span style=" color:#33cc33;">%</span><span style=" color:#448888;">~2</span> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~1</span>\*&quot; <span style=" color:#33cc33;">&gt;</span> t.log<br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> Parsing ...<br /><span style=" color:#33cc33;">&lt;</span> t.log <span style=" color:#33cc33;">&gt;</span> t2.log findstr /r /c:&quot;:.*:&quot; /c:&quot;Содержимое папки&quot; /c:&quot;Directory of&quot;<br /><br /><a href="http://www.ss64.com/nt/for.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">for</span></a> /f &quot;tokens=1-2*&quot; <span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span> <a href="http://www.ss64.com/nt/in.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">in</span></a> <span style=" color:#33cc33;">(</span>t2.log<span style=" color:#33cc33;">)</span> <a href="http://www.ss64.com/nt/do.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">do</span></a> <span style=" color:#33cc33;">(</span><br /><br />  <a href="http://www.ss64.com/nt/if.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">if</span></a> &quot;<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span> <span style=" color:#33cc33;">%%</span><span style=" color:#448888;">b</span>&quot;==&quot;Содержимое папки&quot; <span style=" color:#33cc33;">(</span><br />    <a href="http://www.ss64.com/nt/set.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">set</span></a> &quot;Folder=<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">c</span>&quot;<br />  <span style=" color:#33cc33;">)</span> <a href="http://www.ss64.com/nt/else.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">else</span></a> <span style=" color:#33cc33;">(</span><br />  <a href="http://www.ss64.com/nt/if.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">if</span></a> &quot;<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span> <span style=" color:#33cc33;">%%</span><span style=" color:#448888;">b</span>&quot;==&quot;Directory of&quot; <span style=" color:#33cc33;">(</span><br />    <a href="http://www.ss64.com/nt/set.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">set</span></a> &quot;Folder=<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">c</span>&quot;<br />  <span style=" color:#33cc33;">)</span> <a href="http://www.ss64.com/nt/else.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">else</span></a> <span style=" color:#33cc33;">(</span><br />  <a href="http://www.ss64.com/nt/if.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">if</span></a> <span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span> <a href="http://www.ss64.com/nt/gtr.html"><span style=" font-weight:600; text-decoration: underline; color:#000000;">GTR</span></a> <span style=" color:#33cc33;">%</span><span style=" color:#448888;">MAX_STREAM_SIZE</span><span style=" color:#33cc33;">%</span> <a href="http://www.ss64.com/nt/call.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">call</span></a> :<span style=" font-weight:600; color:#b100b1;">Log</span> &quot;<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">a</span>&quot; &quot;<span style=" color:#33cc33;">%%</span><span style=" color:#448888;">b</span> <span style=" color:#33cc33;">%%</span><span style=" color:#448888;">c</span>&quot;<br />  <span style=" color:#33cc33;">))</span><br /><span style=" color:#33cc33;">)</span><br /><a href="http://www.ss64.com/nt/exit.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">exit</span></a> /b<br /><br />:<span style=" font-weight:600; color:#b100b1;">Log</span><br /><a href="http://www.ss64.com/nt/echo.html"><span style=" font-weight:600; text-decoration: underline; color:#b1b100;">echo</span></a> <span style=" color:#33cc33;">%</span><span style=" color:#448888;">~1</span> &quot;<span style=" color:#33cc33;">%</span><span style=" color:#448888;">Folder</span><span style=" color:#33cc33;">%</span>\<span style=" color:#33cc33;">%</span><span style=" color:#448888;">~2</span>&quot; <span style=" color:#33cc33;">&gt;&gt;</span> ADS.log<br /><a href="http://www.ss64.com/nt/exit.html"><span style=" font-weight:600; text-decoration: underline; color:#00b100;">exit</span></a> /b<br /> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Батник обязательно сохранять в кодировке OEM-866.</span></p></body></html>