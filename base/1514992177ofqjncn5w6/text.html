<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как оставить в ячейке только цифры или только текст?<span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Вот бывает так: есть у Вас в ячейке некий текст. Допустим &quot;Было доставлено кусков мыла 763шт.&quot;. Вам нужно из этого только 763 - чтобы можно было провести с этим некие математические действия. Если это только одна ячейка - проблем тут нет, а если таких ячеек пару тысяч? И к тому же все разные?</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Было доставлено кусков мыла 763шт.</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Всего пришло 34</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Тюбики - 54 доставлено</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">и т.д.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Никакой зацепки для извлечения данных. Пару тысяч таких строк удалять вручную весьма утомительное занятие, надо сказать. Да еще и не быстрое.<br />Есть несколько вариантов решения подобной задачи.</span></p>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">СПОСОБ 1: не используем макросы<br />можно применить </span><a href="http://www.excel-vba.ru/chto-umeet-excel/chto-takoe-formula-massiva/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">формулу массива</span></a><span style=" font-size:8.25pt;">, вроде такой:<br />=ПСТР(A1;МИН(ЕСЛИ(ЕЧИСЛО(-ПСТР(A1;СТРОКА($1:$99);1));СТРОКА($1:$99)));ПРОСМОТР(2;1/ЕЧИСЛО(-ПСТР(A1;СТРОКА($1:$99);1));СТРОКА($1:$99))-МИН(ЕСЛИ(ЕЧИСЛО(-ПСТР(A1;СТРОКА($1:$99);1));СТРОКА($1:$99)))+1)<br />Три важных момента:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Формула вводится в ячейку сочетанием клавиш Ctrl+Shift+Enter, т.к. является формулой массива. Подробнее про эти формулы читайте в статье: <a href="http://www.excel-vba.ru/chto-umeet-excel/chto-takoe-formula-massiva/"><span style=" text-decoration: underline; color:#0000ff;">Что такое формула массива</span></a></li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в таком виде формула работает с текстом, количество символов в котором не превышает 99. Чтобы расширить необходимо в формуле во всех местах заменить СТРОКА($1:$99) на СТРОКА($1:$200). Т.е. вместо 99 указать количество символов с запасом. Только не увлекайтесь, иначе может получиться, что формула будет работать слишком долго</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">формула не обработает корректно текст &quot;Было доставлено кусков мыла 763шт., а заказывали 780&quot; и ему подобный, где числа раскиданы по тексту.</li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Теперь коротко разберем формулу на примере фразы: Было доставлено кусков мыла 763шт.</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в A1 сам текст, из которого необходимо извлечь числа: Было доставлено кусков мыла 763шт., а заказывали 780</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">блок: МИН(ЕСЛИ(ЕЧИСЛО(-ПСТР(A1;СТРОКА($1:$99);1));СТРОКА($1:$99)))<br />вычисляет позицию первой цифры в ячейке - <span style=" font-weight:600;">29</span></li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">блок: ПРОСМОТР(2;1/ЕЧИСЛО(-ПСТР(A1;СТРОКА($1:$99);1));СТРОКА($1:$99))<br />вычисляет позицию последней цифры в ячейке - <span style=" font-weight:600;">31</span></li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">в результате получается: =ПСТР(A1;<span style=" font-weight:600;">29</span>;<span style=" font-weight:600;">31</span>-<span style=" font-weight:600;">29</span>+1)<br />функция ПСТР извлекает из текста, указанного первым аргументом(A1) текст, начиная с указанной позиции(<span style=" font-weight:600;">29</span>) с количеством символов, указанным третьим аргументом(<span style=" font-weight:600;">31</span>-<span style=" font-weight:600;">29</span>+1)</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И в итоге:<br />=ПСТР(A1;<span style=" font-weight:600;">29</span>;<span style=" font-weight:600;">31</span>-<span style=" font-weight:600;">29</span>+1)<br />=&gt; =ПСТР(A1;<span style=" font-weight:600;">29</span>;2+1)<br />=&gt; =ПСТР(A1;<span style=" font-weight:600;">29</span>;3)<br />=&gt; 763</li></ul>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">СПОСОБ 2: используем макросы<br />Самый главный недостаток метода при помощи формулы, приведенной выше - из текста &quot;Было доставлено кусков мыла 763шт., а заказывали 780&quot; формула вернет не только числа, а и текст между первой и последней цифрой: 763шт., а заказывали 780.<br />Решить же проблему извлечения цифр даже из такого текста при помощи VBA куда проще и гибче. Плюс можно не только цифры извлекать, но и наоборот - цифры удалить, а извлечь только текст. Ниже приведен код </span><a href="http://www.excel-vba.ru/chto-umeet-excel/chto-takoe-funkciya-polzovatelyaudf/"><span style=" font-size:8.25pt; font-style:italic; text-decoration: underline; color:#0000ff;">пользовательской функции</span></a><span style=" font-size:8.25pt;">, которая поможет извлечь из строки только числа либо только текст. Иными словами, результатом функции будет либо только текст, либо только числа. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6fd6648a164010792"></a><span style=" font-size:8.25pt;">F</span><span style=" font-size:8.25pt;">unction Extract_Number_from_Text(sWord As String, Optional Metod As Integer) 'sWord = ссылка на ячейку или непосредственно текст 'Metod = 0 – числа 'Metod = 1 – текст Dim sSymbol As String, sInsertWord As String Dim i As Integer If sWord = &quot;&quot; Then Extract_Number_from_Text = &quot;Нет данных!&quot;: Exit Function sInsertWord = &quot;&quot; sSymbol = &quot;&quot; For i = 1 To Len(sWord) sSymbol = Mid(sWord, i, 1) If Metod = 1 Then If Not LCase(sSymbol) Like &quot;*[0-9]*&quot; Then If (sSymbol = &quot;,&quot; Or sSymbol = &quot;.&quot; Or sSymbol = &quot; &quot;) And i &gt; 1 Then If Mid(sWord, i - 1, 1) Like &quot;*[0-9]*&quot; And Mid(sWord, i + 1, 1) Like &quot;*[0-9]*&quot; Then sSymbol = &quot;&quot; End If End If sInsertWord = sInsertWord &amp; sSymbol End If Else If LCase(sSymbol) Like &quot;*[0-9.,;:-]*&quot; Then If LCase(sSymbol) Like &quot;*[.,]*&quot; And i &gt; 1 Then If Not Mid(sWord, i - 1, 1) Like &quot;*[0-9]*&quot; Or Not Mid(sWord, i + 1, 1) Like &quot;*[0-9]*&quot; Then sSymbol = &quot;&quot; End If End If sInsertWord = sInsertWord &amp; sSymbol End If End If Next i Extract_Number_from_Text = sInsertWord End Function </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><span style=" font-size:8.25pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">9</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">12</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">14</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">15</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">17</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">18</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">19</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">20</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">21</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">22</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">23</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">24</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">25</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">26</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">27</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">28</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">29</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">30</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">31</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">32</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">33</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">34 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6fd6648a164010792-1"></a><span style=" font-size:8.25pt;">F</span><span style=" font-size:8.25pt;">unction Extract_Number_from_Text(sWord As String, Optional Metod As Integer)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-2"></a><span style=" font-size:8.25pt;">'</span><span style=" font-size:8.25pt;">sWord = ссылка на ячейку или непосредственно текст</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-3"></a><span style=" font-size:8.25pt;">'</span><span style=" font-size:8.25pt;">Metod = 0 – числа</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-4"></a><span style=" font-size:8.25pt;">'</span><span style=" font-size:8.25pt;">Metod = 1 – текст</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-5"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim sSymbol As String, sInsertWord As String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-6"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Dim i As Integer</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-7"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   If sWord = &quot;&quot; Then Extract_Number_from_Text = &quot;Нет данных!&quot;: Exit Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-9"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   sInsertWord = &quot;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-10"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   sSymbol = &quot;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-11"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   For i = 1 To Len(sWord)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-12"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       sSymbol = Mid(sWord, i, 1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-13"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       If Metod = 1 Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-14"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">           If Not LCase(sSymbol) Like &quot;*[0-9]*&quot; Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-15"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">               If (sSymbol = &quot;,&quot; Or sSymbol = &quot;.&quot; Or sSymbol = &quot; &quot;) And i &gt; 1 Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-16"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                   If Mid(sWord, i - 1, 1) Like &quot;*[0-9]*&quot; And Mid(sWord, i + 1, 1) Like &quot;*[0-9]*&quot; Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-17"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                       sSymbol = &quot;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-18"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                   End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-19"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">               End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-20"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">               sInsertWord = sInsertWord &amp; sSymbol</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-21"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">           End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-22"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-23"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">           If LCase(sSymbol) Like &quot;*[0-9.,;:-]*&quot; Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-24"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">               If LCase(sSymbol) Like &quot;*[.,]*&quot; And i &gt; 1 Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-25"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                   If Not Mid(sWord, i - 1, 1) Like &quot;*[0-9]*&quot; Or Not Mid(sWord, i + 1, 1) Like &quot;*[0-9]*&quot; Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-26"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                       sSymbol = &quot;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-27"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">                   End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-28"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">               End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-29"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">               sInsertWord = sInsertWord &amp; sSymbol</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-30"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">           End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-31"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">       End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-32"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Next i</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-33"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Extract_Number_from_Text = sInsertWord</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a4ce6fd6648a164010792-34"></a><span style=" font-size:8.25pt;">E</span><span style=" font-size:8.25pt;">nd Function</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Данный код необходимо поместить в </span><a href="http://www.excel-vba.ru/chto-umeet-excel/chto-takoe-modul-kakie-byvayut-moduli#StandartModule"><span style=" font-size:8.25pt; font-style:italic; text-decoration: underline; color:#0000ff;">стандартный модуль</span></a><span style=" font-size:8.25pt;"> книги. После этого в мастере функций в категории Определенные пользователем (User Defined) будет доступна функция Extract_Number_from_Text, которую можно будет применять как обычную функцию на листе.<br />Для извлечения только чисел<br />=Extract_Number_from_Text(A1; 0)<br />или<br />=Extract_Number_from_Text(A1)<br />Для извлечения только текста<br />=Extract_Number_from_Text(A1; 1)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Подробнее про создание пользовательских функции и их применении можно почитать в статье </span><a href="http://www.excel-vba.ru/chto-umeet-excel/chto-takoe-funkciya-polzovatelyaudf/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">Что такое функция пользователя(UDF)?</span></a></p>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Помимо функции пользователя решил выложить и вариант с использованием диалогового окна:<br /></span><img src="image17801.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Выбрать ячейку или диапазон с текстом</span><span style=" font-size:8.25pt;">(Лист1!</span><span style=" font-size:8.25pt; color:#0000ff;">$A$2:$A$10</span><span style=" font-size:8.25pt;">) - здесь указывается диапазон с исходными значениями, из которого необходимо оставить только числа или только текст.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Выберите ячейку для вывода данных</span><span style=" font-size:8.25pt;">(Лист1!</span><span style=" font-size:8.25pt; color:#0000ff;">$A$2</span><span style=" font-size:8.25pt;">) - указывается одна ячейка, с которой начать вывод преобразованных значений. В качестве этой ячейки можно выбрать первую ячейку диапазона с текстом</span><span style=" font-size:8.25pt; font-style:italic;">(исходного)</span><span style=" font-size:8.25pt;"> если необходимо произвести изменения сразу в этих же ячейках</span><span style=" font-size:8.25pt; font-style:italic;">(как на рисунке)</span><span style=" font-size:8.25pt;">. Осторожнее с таким указанием, т.к. результат работы кода может быть не совсем таким, какой вы ожидали, а вернуть прежние данные уже не получится - если только не закрыть файл без сохранения изменений.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Оставить только цифры</span><span style=" font-size:8.25pt;">, </span><span style=" font-size:8.25pt; font-weight:600;">Оставить только текст</span><span style=" font-size:8.25pt;">- думаю не надо пояснять. Здесь выбираем, что оставить в качестве результата.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Небольшое дополнение к использованию кода<br />В коде есть строка: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6fd66497502146045"></a><span style=" font-size:8.25pt;">I</span><span style=" font-size:8.25pt;">f LCase(sSymbol) Like &quot;*[0-9.,;:-]*&quot; Then </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6fd66497502146045-1"></a><span style=" font-size:8.25pt;">I</span><span style=" font-size:8.25pt;">f LCase(sSymbol) Like &quot;*[0-9.,;:-]*&quot; Then</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Данная строка отвечает за текстовые символы, которые могут встречаться внутри чисел и которые надо оставить(не удалять наравне с другими не числовыми символами). Следовательно, если какие-то из данных символов не нужны в конечном тексте - их надо просто удалить. Например, чтобы оставались исключительно числа(без запятых и пр.): </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6fd6649d543612369"></a><span style=" font-size:8.25pt;">I</span><span style=" font-size:8.25pt;">f LCase(sSymbol) Like &quot;*[0-9]*&quot; Then </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6fd6649d543612369-1"></a><span style=" font-size:8.25pt;">I</span><span style=" font-size:8.25pt;">f LCase(sSymbol) Like &quot;*[0-9]*&quot; Then</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">если надо исключить из удаления помимо цифр точку(т.е. будут извлечены цифры и точка): </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6fd664a3735483109"></a><span style=" font-size:8.25pt;">I</span><span style=" font-size:8.25pt;">f LCase(sSymbol) Like &quot;*[0-9.]*&quot; Then </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px;"><a name="crayon-5a4ce6fd664a3735483109-1"></a><span style=" font-size:8.25pt;">I</span><span style=" font-size:8.25pt;">f LCase(sSymbol) Like &quot;*[0-9.]*&quot; Then</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">и т.д.<br />Скачать пример: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image19748.png" /><span style=" font-size:8.25pt;">  </span><a href="http://www.excel-vba.ru/download/31/"><span style=" font-size:8.25pt; font-weight:600; text-decoration: underline; color:#0000ff;">Tips_Macro_Number_From_Text.xls</span></a><span style=" font-size:8.25pt;"> (80,0 KiB, 9 014 скачиваний)</span></p></body></html>